function _typeof(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}(function(a,b){if("function"==typeof define&&define.amd){define ("qtype_coderunner/blockly/lua_compressed",["./blockly_compressed.js"],b)}else if("object"===("undefined"==typeof exports?"undefined":_typeof(exports))){module.exports=b(require("./blockly_compressed.js"))}else{a.Blockly.Lua=b(a.Blockly)}})(this,function(i){'use strict';i.Lua=new i.Generator("Lua");i.Lua.addReservedWords("_,__inext,assert,bit,colors,colours,coroutine,disk,dofile,error,fs,fetfenv,getmetatable,gps,help,io,ipairs,keys,loadfile,loadstring,math,native,next,os,paintutils,pairs,parallel,pcall,peripheral,print,printError,rawequal,rawget,rawset,read,rednet,redstone,rs,select,setfenv,setmetatable,sleep,string,table,term,textutils,tonumber,tostring,turtle,type,unpack,vector,write,xpcall,_VERSION,__indext,HTTP,and,break,do,else,elseif,end,false,for,function,if,in,local,nil,not,or,repeat,return,then,true,until,while,add,sub,mul,div,mod,pow,unm,concat,len,eq,lt,le,index,newindex,call,assert,collectgarbage,dofile,error,_G,getmetatable,inpairs,load,loadfile,next,pairs,pcall,print,rawequal,rawget,rawlen,rawset,select,setmetatable,tonumber,tostring,type,_VERSION,xpcall,require,package,string,table,math,bit32,io,file,os,debug");i.Lua.ORDER_ATOMIC=0;i.Lua.ORDER_HIGH=1;i.Lua.ORDER_EXPONENTIATION=2;i.Lua.ORDER_UNARY=3;i.Lua.ORDER_MULTIPLICATIVE=4;i.Lua.ORDER_ADDITIVE=5;i.Lua.ORDER_CONCATENATION=6;i.Lua.ORDER_RELATIONAL=7;i.Lua.ORDER_AND=8;i.Lua.ORDER_OR=9;i.Lua.ORDER_NONE=99;i.Lua.init=function(b){i.Lua.definitions_=Object.create(null);i.Lua.functionNames_=Object.create(null);i.Lua.variableDB_?i.Lua.variableDB_.reset():i.Lua.variableDB_=new i.Names(i.Lua.RESERVED_WORDS_);i.Lua.variableDB_.setVariableMap(b.getVariableMap())};i.Lua.finish=function(d){var a=[],b;for(b in i.Lua.definitions_){a.push(i.Lua.definitions_[b])}delete i.Lua.definitions_;delete i.Lua.functionNames_;i.Lua.variableDB_.reset();return a.join("\n\n")+"\n\n\n"+d};i.Lua.scrubNakedValue=function(b){return"local _ = "+b+"\n"};i.Lua.quote_=function(b){b=b.replace(/\\/g,"\\\\").replace(/\n/g,"\\\n").replace(/'/g,"\\'");return"'"+b+"'"};i.Lua.multiline_quote_=function(b){b=b.replace(/\\/g,"\\\\").replace(/\n/g,"\\\n").replace(/'/g,"\\'");return"[==="+b+"===]"};i.Lua.scrub_=function(g,h,b){var j="";if(!g.outputConnection||!g.outputConnection.targetConnection){var k=g.getCommentText();k&&(k=i.utils.string.wrap(k,i.Lua.COMMENT_WRAP-3),j+=i.Lua.prefixLines(k,"-- ")+"\n");for(var l=0;l<g.inputList.length;l++){g.inputList[l].type==i.INPUT_VALUE&&(k=g.inputList[l].connection.targetBlock())&&(k=i.Lua.allNestedComments(k))&&(j+=i.Lua.prefixLines(k,"-- "))}}g=g.nextConnection&&g.nextConnection.targetBlock();b=b?"":i.Lua.blockToCode(g);return j+h+b};i.Lua.colour={};i.Lua.colour_picker=function(b){return[i.Lua.quote_(b.getFieldValue("COLOUR")),i.Lua.ORDER_ATOMIC]};i.Lua.colour_random=function(){return["string.format(\"#%06x\", math.random(0, 2^24 - 1))",i.Lua.ORDER_HIGH]};i.Lua.colour_rgb=function(e){var f=i.Lua.provideFunction_("colour_rgb",["function "+i.Lua.FUNCTION_NAME_PLACEHOLDER_+"(r, g, b)","  r = math.floor(math.min(100, math.max(0, r)) * 2.55 + .5)","  g = math.floor(math.min(100, math.max(0, g)) * 2.55 + .5)","  b = math.floor(math.min(100, math.max(0, b)) * 2.55 + .5)","  return string.format(\"#%02x%02x%02x\", r, g, b)","end"]),b=i.Lua.valueToCode(e,"RED",i.Lua.ORDER_NONE)||0,c=i.Lua.valueToCode(e,"GREEN",i.Lua.ORDER_NONE)||0;e=i.Lua.valueToCode(e,"BLUE",i.Lua.ORDER_NONE)||0;return[f+"("+b+", "+c+", "+e+")",i.Lua.ORDER_HIGH]};i.Lua.colour_blend=function(e){var f=i.Lua.provideFunction_("colour_blend",["function "+i.Lua.FUNCTION_NAME_PLACEHOLDER_+"(colour1, colour2, ratio)","  local r1 = tonumber(string.sub(colour1, 2, 3), 16)","  local r2 = tonumber(string.sub(colour2, 2, 3), 16)","  local g1 = tonumber(string.sub(colour1, 4, 5), 16)","  local g2 = tonumber(string.sub(colour2, 4, 5), 16)","  local b1 = tonumber(string.sub(colour1, 6, 7), 16)","  local b2 = tonumber(string.sub(colour2, 6, 7), 16)","  local ratio = math.min(1, math.max(0, ratio))","  local r = math.floor(r1 * (1 - ratio) + r2 * ratio + .5)","  local g = math.floor(g1 * (1 - ratio) + g2 * ratio + .5)","  local b = math.floor(b1 * (1 - ratio) + b2 * ratio + .5)","  return string.format(\"#%02x%02x%02x\", r, g, b)","end"]),b=i.Lua.valueToCode(e,"COLOUR1",i.Lua.ORDER_NONE)||"'#000000'",c=i.Lua.valueToCode(e,"COLOUR2",i.Lua.ORDER_NONE)||"'#000000'";e=i.Lua.valueToCode(e,"RATIO",i.Lua.ORDER_NONE)||0;return[f+"("+b+", "+c+", "+e+")",i.Lua.ORDER_HIGH]};i.Lua.lists={};i.Lua.lists_create_empty=function(){return["{}",i.Lua.ORDER_HIGH]};i.Lua.lists_create_with=function(d){for(var a=Array(d.itemCount_),b=0;b<d.itemCount_;b++){a[b]=i.Lua.valueToCode(d,"ADD"+b,i.Lua.ORDER_NONE)||"None"}return["{"+a.join(", ")+"}",i.Lua.ORDER_HIGH]};i.Lua.lists_repeat=function(d){var e=i.Lua.provideFunction_("create_list_repeated",["function "+i.Lua.FUNCTION_NAME_PLACEHOLDER_+"(item, count)","  local t = {}","  for i = 1, count do","    table.insert(t, item)","  end","  return t","end"]),b=i.Lua.valueToCode(d,"ITEM",i.Lua.ORDER_NONE)||"None";d=i.Lua.valueToCode(d,"NUM",i.Lua.ORDER_NONE)||"0";return[e+"("+b+", "+d+")",i.Lua.ORDER_HIGH]};i.Lua.lists_length=function(b){return["#"+(i.Lua.valueToCode(b,"VALUE",i.Lua.ORDER_UNARY)||"{}"),i.Lua.ORDER_UNARY]};i.Lua.lists_isEmpty=function(b){return["#"+(i.Lua.valueToCode(b,"VALUE",i.Lua.ORDER_UNARY)||"{}")+" == 0",i.Lua.ORDER_RELATIONAL]};i.Lua.lists_indexOf=function(d){var a=i.Lua.valueToCode(d,"FIND",i.Lua.ORDER_NONE)||"''",b=i.Lua.valueToCode(d,"VALUE",i.Lua.ORDER_NONE)||"{}";return[("FIRST"==d.getFieldValue("END")?i.Lua.provideFunction_("first_index",["function "+i.Lua.FUNCTION_NAME_PLACEHOLDER_+"(t, elem)","  for k, v in ipairs(t) do","    if v == elem then","      return k","    end","  end","  return 0","end"]):i.Lua.provideFunction_("last_index",["function "+i.Lua.FUNCTION_NAME_PLACEHOLDER_+"(t, elem)","  for i = #t, 1, -1 do","    if t[i] == elem then","      return i","    end","  end","  return 0","end"]))+"("+b+", "+a+")",i.Lua.ORDER_HIGH]};i.Lua.lists.getIndex_=function(d,a,b){return"FIRST"==a?"1":"FROM_END"==a?"#"+d+" + 1 - "+b:"LAST"==a?"#"+d:"RANDOM"==a?"math.random(#"+d+")":b};i.Lua.lists_getIndex=function(g){var h=g.getFieldValue("MODE")||"GET",j=g.getFieldValue("WHERE")||"FROM_START",k=i.Lua.valueToCode(g,"VALUE",i.Lua.ORDER_HIGH)||"({})",d=i.Lua.lists.getIndex_;if("LAST"!=j&&"FROM_END"!=j&&"RANDOM"!=j||k.match(/^\w+$/)){e="GET"==h&&"FROM_END"==j?i.Lua.ORDER_ADDITIVE:i.Lua.ORDER_NONE;g=i.Lua.valueToCode(g,"AT",e)||"1";g=d(k,j,g);if("GET"==h)return[k+"["+g+"]",i.Lua.ORDER_HIGH];j="table.remove("+k+", "+g+")";return"GET_REMOVE"==h?[j,i.Lua.ORDER_HIGH]:j+"\n"}if("REMOVE"==h){var e="FROM_END"==j?i.Lua.ORDER_ADDITIVE:i.Lua.ORDER_NONE;g=i.Lua.valueToCode(g,"AT",e)||"1";h=i.Lua.variableDB_.getDistinctName("tmp_list",i.VARIABLE_CATEGORY_NAME);g=d(h,j,g);return h+" = "+k+"\ntable.remove("+h+", "+g+")\n"}g=i.Lua.valueToCode(g,"AT",i.Lua.ORDER_NONE)||"1";return[("GET"==h?i.Lua.provideFunction_("list_get_"+j.toLowerCase(),["function "+i.Lua.FUNCTION_NAME_PLACEHOLDER_+"(t"+("FROM_END"==j||"FROM_START"==j?", at)":")"),"  return t["+d("t",j,"at")+"]","end"]):i.Lua.provideFunction_("list_remove_"+j.toLowerCase(),["function "+i.Lua.FUNCTION_NAME_PLACEHOLDER_+"(t"+("FROM_END"==j||"FROM_START"==j?", at)":")"),"  return table.remove(t, "+d("t",j,"at")+")","end"]))+"("+k+("FROM_END"==j||"FROM_START"==j?", "+g:"")+")",i.Lua.ORDER_HIGH]};i.Lua.lists_setIndex=function(j){var k=i.Lua.valueToCode(j,"LIST",i.Lua.ORDER_HIGH)||"{}",l=j.getFieldValue("MODE")||"SET",c=j.getFieldValue("WHERE")||"FROM_START",d=i.Lua.valueToCode(j,"AT",i.Lua.ORDER_ADDITIVE)||"1";j=i.Lua.valueToCode(j,"TO",i.Lua.ORDER_NONE)||"None";var e=i.Lua.lists.getIndex_,f="";if(("LAST"==c||"FROM_END"==c||"RANDOM"==c)&&!k.match(/^\w+$/)){var m=i.Lua.variableDB_.getDistinctName("tmp_list",i.VARIABLE_CATEGORY_NAME);f=m+" = "+k+"\n";k=m}f="SET"==l?f+(k+"["+e(k,c,d)+"] = "+j):f+("table.insert("+k+", "+(e(k,c,d)+("LAST"==c?" + 1":""))+", "+j+")");return f+"\n"};i.Lua.lists_getSublist=function(g){var h=i.Lua.valueToCode(g,"LIST",i.Lua.ORDER_NONE)||"{}",b=g.getFieldValue("WHERE1"),c=g.getFieldValue("WHERE2"),d=i.Lua.valueToCode(g,"AT1",i.Lua.ORDER_NONE)||"1";g=i.Lua.valueToCode(g,"AT2",i.Lua.ORDER_NONE)||"1";var e=i.Lua.lists.getIndex_;return[i.Lua.provideFunction_("list_sublist_"+b.toLowerCase()+"_"+c.toLowerCase(),["function "+i.Lua.FUNCTION_NAME_PLACEHOLDER_+"(source"+("FROM_END"==b||"FROM_START"==b?", at1":"")+("FROM_END"==c||"FROM_START"==c?", at2":"")+")","  local t = {}","  local start = "+e("source",b,"at1"),"  local finish = "+e("source",c,"at2"),"  for i = start, finish do","    table.insert(t, source[i])","  end","  return t","end"])+"("+h+("FROM_END"==b||"FROM_START"==b?", "+d:"")+("FROM_END"==c||"FROM_START"==c?", "+g:"")+")",i.Lua.ORDER_HIGH]};i.Lua.lists_sort=function(d){var e=i.Lua.valueToCode(d,"LIST",i.Lua.ORDER_NONE)||"{}",b="1"===d.getFieldValue("DIRECTION")?1:-1;d=d.getFieldValue("TYPE");return[i.Lua.provideFunction_("list_sort",["function "+i.Lua.FUNCTION_NAME_PLACEHOLDER_+"(list, typev, direction)","  local t = {}","  for n,v in pairs(list) do table.insert(t, v) end","  local compareFuncs = {","    NUMERIC = function(a, b)","      return (tonumber(tostring(a)) or 0)","          < (tonumber(tostring(b)) or 0) end,","    TEXT = function(a, b)","      return tostring(a) < tostring(b) end,","    IGNORE_CASE = function(a, b)","      return string.lower(tostring(a)) < string.lower(tostring(b)) end","  }","  local compareTemp = compareFuncs[typev]","  local compare = compareTemp","  if direction == -1","  then compare = function(a, b) return compareTemp(b, a) end","  end","  table.sort(t, compare)","  return t","end"])+"("+e+",\""+d+"\", "+b+")",i.Lua.ORDER_HIGH]};i.Lua.lists_split=function(d){var e=i.Lua.valueToCode(d,"INPUT",i.Lua.ORDER_NONE),f=i.Lua.valueToCode(d,"DELIM",i.Lua.ORDER_NONE)||"''";d=d.getFieldValue("MODE");if("SPLIT"==d)e||(e="''"),d=i.Lua.provideFunction_("list_string_split",["function "+i.Lua.FUNCTION_NAME_PLACEHOLDER_+"(input, delim)","  local t = {}","  local pos = 1","  while true do","    next_delim = string.find(input, delim, pos)","    if next_delim == nil then","      table.insert(t, string.sub(input, pos))","      break","    else","      table.insert(t, string.sub(input, pos, next_delim-1))","      pos = next_delim + #delim","    end","  end","  return t","end"]);else if("JOIN"==d)e||(e="{}"),d="table.concat";else throw Error("Unknown mode: "+d);return[d+"("+e+", "+f+")",i.Lua.ORDER_HIGH]};i.Lua.lists_reverse=function(b){b=i.Lua.valueToCode(b,"LIST",i.Lua.ORDER_NONE)||"{}";return[i.Lua.provideFunction_("list_reverse",["function "+i.Lua.FUNCTION_NAME_PLACEHOLDER_+"(input)","  local reversed = {}","  for i = #input, 1, -1 do","    table.insert(reversed, input[i])","  end","  return reversed","end"])+"("+b+")",i.Lua.ORDER_HIGH]};i.Lua.logic={};i.Lua.controls_if=function(f){var a=0,g="";i.Lua.STATEMENT_PREFIX&&(g+=i.Lua.injectId(i.Lua.STATEMENT_PREFIX,f));do{var h=i.Lua.valueToCode(f,"IF"+a,i.Lua.ORDER_NONE)||"false",d=i.Lua.statementToCode(f,"DO"+a);i.Lua.STATEMENT_SUFFIX&&(d=i.Lua.prefixLines(i.Lua.injectId(i.Lua.STATEMENT_SUFFIX,f),i.Lua.INDENT)+d);g+=(0<a?"else":"")+"if "+h+" then\n"+d;++a}while(f.getInput("IF"+a));if(f.getInput("ELSE")||i.Lua.STATEMENT_SUFFIX)d=i.Lua.statementToCode(f,"ELSE"),i.Lua.STATEMENT_SUFFIX&&(d=i.Lua.prefixLines(i.Lua.injectId(i.Lua.STATEMENT_SUFFIX,f),i.Lua.INDENT)+d),g+="else\n"+d;return g+"end\n"};i.Lua.controls_ifelse=i.Lua.controls_if;i.Lua.logic_compare=function(d){var e={EQ:"==",NEQ:"~=",LT:"<",LTE:"<=",GT:">",GTE:">="}[d.getFieldValue("OP")],b=i.Lua.valueToCode(d,"A",i.Lua.ORDER_RELATIONAL)||"0";d=i.Lua.valueToCode(d,"B",i.Lua.ORDER_RELATIONAL)||"0";return[b+" "+e+" "+d,i.Lua.ORDER_RELATIONAL]};i.Lua.logic_operation=function(f){var g="AND"==f.getFieldValue("OP")?"and":"or",b="and"==g?i.Lua.ORDER_AND:i.Lua.ORDER_OR,c=i.Lua.valueToCode(f,"A",b);f=i.Lua.valueToCode(f,"B",b);if(c||f){var h="and"==g?"true":"false";c||(c=h);f||(f=h)}else f=c="false";return[c+" "+g+" "+f,b]};i.Lua.logic_negate=function(b){return["not "+(i.Lua.valueToCode(b,"BOOL",i.Lua.ORDER_UNARY)||"true"),i.Lua.ORDER_UNARY]};i.Lua.logic_boolean=function(b){return["TRUE"==b.getFieldValue("BOOL")?"true":"false",i.Lua.ORDER_ATOMIC]};i.Lua.logic_null=function(){return["nil",i.Lua.ORDER_ATOMIC]};i.Lua.logic_ternary=function(d){var e=i.Lua.valueToCode(d,"IF",i.Lua.ORDER_AND)||"false",b=i.Lua.valueToCode(d,"THEN",i.Lua.ORDER_AND)||"nil";d=i.Lua.valueToCode(d,"ELSE",i.Lua.ORDER_OR)||"nil";return[e+" and "+b+" or "+d,i.Lua.ORDER_OR]};i.Lua.loops={};i.Lua.CONTINUE_STATEMENT="goto continue\n";i.Lua.addContinueLabel_=function(b){return-1!=b.indexOf(i.Lua.CONTINUE_STATEMENT)?b+i.Lua.INDENT+"::continue::\n":b};i.Lua.controls_repeat_ext=function(d){var a=d.getField("TIMES")?+d.getFieldValue("TIMES")+"":i.Lua.valueToCode(d,"TIMES",i.Lua.ORDER_NONE)||"0";a=i.isNumber(a)?parseInt(a,10):"math.floor("+a+")";var e=i.Lua.statementToCode(d,"DO");e=i.Lua.addLoopTrap(e,d);e=i.Lua.addContinueLabel_(e);return"for "+i.Lua.variableDB_.getDistinctName("count",i.VARIABLE_CATEGORY_NAME)+" = 1, "+a+" do\n"+e+"end\n"};i.Lua.controls_repeat=i.Lua.controls_repeat_ext;i.Lua.controls_whileUntil=function(e){var a="UNTIL"==e.getFieldValue("MODE"),b=i.Lua.valueToCode(e,"BOOL",a?i.Lua.ORDER_UNARY:i.Lua.ORDER_NONE)||"false",f=i.Lua.statementToCode(e,"DO");f=i.Lua.addLoopTrap(f,e);f=i.Lua.addContinueLabel_(f);a&&(b="not "+b);return"while "+b+" do\n"+f+"end\n"};i.Lua.controls_for=function(h){var j=i.Lua.variableDB_.getName(h.getFieldValue("VAR"),i.VARIABLE_CATEGORY_NAME),b=i.Lua.valueToCode(h,"FROM",i.Lua.ORDER_NONE)||"0",c=i.Lua.valueToCode(h,"TO",i.Lua.ORDER_NONE)||"0",d=i.Lua.valueToCode(h,"BY",i.Lua.ORDER_NONE)||"1",e=i.Lua.statementToCode(h,"DO");e=i.Lua.addLoopTrap(e,h);e=i.Lua.addContinueLabel_(e);h="";if(i.isNumber(b)&&i.isNumber(c)&&i.isNumber(d))var k=(+b<=+c?"":"-")+Math.abs(+d);else h="",k=i.Lua.variableDB_.getDistinctName(j+"_inc",i.VARIABLE_CATEGORY_NAME),h+=k+" = ",h=i.isNumber(d)?h+(Math.abs(d)+"\n"):h+("math.abs("+d+")\n"),h=h+("if ("+b+") > ("+c+") then\n")+(i.Lua.INDENT+k+" = -"+k+"\n"),h+="end\n";return h+("for "+j+" = "+b+", "+c+", "+k)+(" do\n"+e+"end\n")};i.Lua.controls_forEach=function(e){var a=i.Lua.variableDB_.getName(e.getFieldValue("VAR"),i.VARIABLE_CATEGORY_NAME),b=i.Lua.valueToCode(e,"LIST",i.Lua.ORDER_NONE)||"{}",c=i.Lua.statementToCode(e,"DO");c=i.Lua.addLoopTrap(c,e);c=i.Lua.addContinueLabel_(c);return"for _, "+a+" in ipairs("+b+") do \n"+c+"end\n"};i.Lua.controls_flow_statements=function(d){var a="";i.Lua.STATEMENT_PREFIX&&(a+=i.Lua.injectId(i.Lua.STATEMENT_PREFIX,d));i.Lua.STATEMENT_SUFFIX&&(a+=i.Lua.injectId(i.Lua.STATEMENT_SUFFIX,d));if(i.Lua.STATEMENT_PREFIX){var e=i.Constants.Loops.CONTROL_FLOW_IN_LOOP_CHECK_MIXIN.getSurroundLoop(d);e&&!e.suppressPrefixSuffix&&(a+=i.Lua.injectId(i.Lua.STATEMENT_PREFIX,e))}switch(d.getFieldValue("FLOW")){case"BREAK":return a+"break\n";case"CONTINUE":return a+i.Lua.CONTINUE_STATEMENT;}throw Error("Unknown flow statement.")};i.Lua.math={};i.Lua.math_number=function(b){b=+b.getFieldValue("NUM");return[b,0>b?i.Lua.ORDER_UNARY:i.Lua.ORDER_ATOMIC]};i.Lua.math_arithmetic=function(e){var f={ADD:[" + ",i.Lua.ORDER_ADDITIVE],MINUS:[" - ",i.Lua.ORDER_ADDITIVE],MULTIPLY:[" * ",i.Lua.ORDER_MULTIPLICATIVE],DIVIDE:[" / ",i.Lua.ORDER_MULTIPLICATIVE],POWER:[" ^ ",i.Lua.ORDER_EXPONENTIATION]}[e.getFieldValue("OP")],g=f[0];f=f[1];var c=i.Lua.valueToCode(e,"A",f)||"0";e=i.Lua.valueToCode(e,"B",f)||"0";return[c+g+e,f]};i.Lua.math_single=function(c){var d=c.getFieldValue("OP");if("NEG"==d)return c=i.Lua.valueToCode(c,"NUM",i.Lua.ORDER_UNARY)||"0",["-"+c,i.Lua.ORDER_UNARY];if("POW10"==d)return c=i.Lua.valueToCode(c,"NUM",i.Lua.ORDER_EXPONENTIATION)||"0",["10 ^ "+c,i.Lua.ORDER_EXPONENTIATION];c="ROUND"==d?i.Lua.valueToCode(c,"NUM",i.Lua.ORDER_ADDITIVE)||"0":i.Lua.valueToCode(c,"NUM",i.Lua.ORDER_NONE)||"0";switch(d){case"ABS":d="math.abs("+c+")";break;case"ROOT":d="math.sqrt("+c+")";break;case"LN":d="math.log("+c+")";break;case"LOG10":d="math.log("+c+", 10)";break;case"EXP":d="math.exp("+c+")";break;case"ROUND":d="math.floor("+c+" + .5)";break;case"ROUNDUP":d="math.ceil("+c+")";break;case"ROUNDDOWN":d="math.floor("+c+")";break;case"SIN":d="math.sin(math.rad("+c+"))";break;case"COS":d="math.cos(math.rad("+c+"))";break;case"TAN":d="math.tan(math.rad("+c+"))";break;case"ASIN":d="math.deg(math.asin("+c+"))";break;case"ACOS":d="math.deg(math.acos("+c+"))";break;case"ATAN":d="math.deg(math.atan("+c+"))";break;default:throw Error("Unknown math operator: "+d);}return[d,i.Lua.ORDER_HIGH]};i.Lua.math_constant=function(b){return{PI:["math.pi",i.Lua.ORDER_HIGH],E:["math.exp(1)",i.Lua.ORDER_HIGH],GOLDEN_RATIO:["(1 + math.sqrt(5)) / 2",i.Lua.ORDER_MULTIPLICATIVE],SQRT2:["math.sqrt(2)",i.Lua.ORDER_HIGH],SQRT1_2:["math.sqrt(1 / 2)",i.Lua.ORDER_HIGH],INFINITY:["math.huge",i.Lua.ORDER_HIGH]}[b.getFieldValue("CONSTANT")]};i.Lua.math_number_property=function(e){var f=i.Lua.valueToCode(e,"NUMBER_TO_CHECK",i.Lua.ORDER_MULTIPLICATIVE)||"0",b=e.getFieldValue("PROPERTY");if("PRIME"==b)return[i.Lua.provideFunction_("math_isPrime",["function "+i.Lua.FUNCTION_NAME_PLACEHOLDER_+"(n)","  -- https://en.wikipedia.org/wiki/Primality_test#Naive_methods","  if n == 2 or n == 3 then","    return true","  end","  -- False if n is NaN, negative, is 1, or not whole.","  -- And false if n is divisible by 2 or 3.","  if not(n > 1) or n % 1 ~= 0 or n % 2 == 0 or n % 3 == 0 then","    return false","  end","  -- Check all the numbers of form 6k +/- 1, up to sqrt(n).","  for x = 6, math.sqrt(n) + 1.5, 6 do","    if n % (x - 1) == 0 or n % (x + 1) == 0 then","      return false","    end","  end","  return true","end"])+"("+f+")",i.Lua.ORDER_HIGH];switch(b){case"EVEN":var c=f+" % 2 == 0";break;case"ODD":c=f+" % 2 == 1";break;case"WHOLE":c=f+" % 1 == 0";break;case"POSITIVE":c=f+" > 0";break;case"NEGATIVE":c=f+" < 0";break;case"DIVISIBLE_BY":e=i.Lua.valueToCode(e,"DIVISOR",i.Lua.ORDER_MULTIPLICATIVE);if(!e||"0"==e)return["nil",i.Lua.ORDER_ATOMIC];c=f+" % "+e+" == 0";}return[c,i.Lua.ORDER_RELATIONAL]};i.Lua.math_change=function(c){var d=i.Lua.valueToCode(c,"DELTA",i.Lua.ORDER_ADDITIVE)||"0";c=i.Lua.variableDB_.getName(c.getFieldValue("VAR"),i.VARIABLE_CATEGORY_NAME);return c+" = "+c+" + "+d+"\n"};i.Lua.math_round=i.Lua.math_single;i.Lua.math_trig=i.Lua.math_single;i.Lua.math_on_list=function(d){function e(){return i.Lua.provideFunction_("math_sum",["function "+i.Lua.FUNCTION_NAME_PLACEHOLDER_+"(t)","  local result = 0","  for _, v in ipairs(t) do","    result = result + v","  end","  return result","end"])}var b=d.getFieldValue("OP");d=i.Lua.valueToCode(d,"LIST",i.Lua.ORDER_NONE)||"{}";switch(b){case"SUM":b=e();break;case"MIN":b=i.Lua.provideFunction_("math_min",["function "+i.Lua.FUNCTION_NAME_PLACEHOLDER_+"(t)","  if #t == 0 then","    return 0","  end","  local result = math.huge","  for _, v in ipairs(t) do","    if v < result then","      result = v","    end","  end","  return result","end"]);break;case"AVERAGE":b=i.Lua.provideFunction_("math_average",["function "+i.Lua.FUNCTION_NAME_PLACEHOLDER_+"(t)","  if #t == 0 then","    return 0","  end","  return "+e()+"(t) / #t","end"]);break;case"MAX":b=i.Lua.provideFunction_("math_max",["function "+i.Lua.FUNCTION_NAME_PLACEHOLDER_+"(t)","  if #t == 0 then","    return 0","  end","  local result = -math.huge","  for _, v in ipairs(t) do","    if v > result then","      result = v","    end","  end","  return result","end"]);break;case"MEDIAN":b=i.Lua.provideFunction_("math_median",["function "+i.Lua.FUNCTION_NAME_PLACEHOLDER_+"(t)","  -- Source: http://lua-users.org/wiki/SimpleStats","  if #t == 0 then","    return 0","  end","  local temp={}","  for _, v in ipairs(t) do","    if type(v) == \"number\" then","      table.insert(temp, v)","    end","  end","  table.sort(temp)","  if #temp % 2 == 0 then","    return (temp[#temp/2] + temp[(#temp/2)+1]) / 2","  else","    return temp[math.ceil(#temp/2)]","  end","end"]);break;case"MODE":b=i.Lua.provideFunction_("math_modes",["function "+i.Lua.FUNCTION_NAME_PLACEHOLDER_+"(t)","  -- Source: http://lua-users.org/wiki/SimpleStats","  local counts={}","  for _, v in ipairs(t) do","    if counts[v] == nil then","      counts[v] = 1","    else","      counts[v] = counts[v] + 1","    end","  end","  local biggestCount = 0","  for _, v  in pairs(counts) do","    if v > biggestCount then","      biggestCount = v","    end","  end","  local temp={}","  for k, v in pairs(counts) do","    if v == biggestCount then","      table.insert(temp, k)","    end","  end","  return temp","end"]);break;case"STD_DEV":b=i.Lua.provideFunction_("math_standard_deviation",["function "+i.Lua.FUNCTION_NAME_PLACEHOLDER_+"(t)","  local m","  local vm","  local total = 0","  local count = 0","  local result","  m = #t == 0 and 0 or "+e()+"(t) / #t","  for _, v in ipairs(t) do","    if type(v) == 'number' then","      vm = v - m","      total = total + (vm * vm)","      count = count + 1","    end","  end","  result = math.sqrt(total / (count-1))","  return result","end"]);break;case"RANDOM":b=i.Lua.provideFunction_("math_random_list",["function "+i.Lua.FUNCTION_NAME_PLACEHOLDER_+"(t)","  if #t == 0 then","    return nil","  end","  return t[math.random(#t)]","end"]);break;default:throw Error("Unknown operator: "+b);}return[b+"("+d+")",i.Lua.ORDER_HIGH]};i.Lua.math_modulo=function(c){var d=i.Lua.valueToCode(c,"DIVIDEND",i.Lua.ORDER_MULTIPLICATIVE)||"0";c=i.Lua.valueToCode(c,"DIVISOR",i.Lua.ORDER_MULTIPLICATIVE)||"0";return[d+" % "+c,i.Lua.ORDER_MULTIPLICATIVE]};i.Lua.math_constrain=function(d){var e=i.Lua.valueToCode(d,"VALUE",i.Lua.ORDER_NONE)||"0",b=i.Lua.valueToCode(d,"LOW",i.Lua.ORDER_NONE)||"-math.huge";d=i.Lua.valueToCode(d,"HIGH",i.Lua.ORDER_NONE)||"math.huge";return["math.min(math.max("+e+", "+b+"), "+d+")",i.Lua.ORDER_HIGH]};i.Lua.math_random_int=function(c){var d=i.Lua.valueToCode(c,"FROM",i.Lua.ORDER_NONE)||"0";c=i.Lua.valueToCode(c,"TO",i.Lua.ORDER_NONE)||"0";return["math.random("+d+", "+c+")",i.Lua.ORDER_HIGH]};i.Lua.math_random_float=function(){return["math.random()",i.Lua.ORDER_HIGH]};i.Lua.math_atan2=function(c){var a=i.Lua.valueToCode(c,"X",i.Lua.ORDER_NONE)||"0";return["math.deg(math.atan2("+(i.Lua.valueToCode(c,"Y",i.Lua.ORDER_NONE)||"0")+", "+a+"))",i.Lua.ORDER_HIGH]};i.Lua.procedures={};i.Lua.procedures_defreturn=function(j){var a=i.Lua.variableDB_.getName(j.getFieldValue("NAME"),i.PROCEDURE_CATEGORY_NAME),b="";i.Lua.STATEMENT_PREFIX&&(b+=i.Lua.injectId(i.Lua.STATEMENT_PREFIX,j));i.Lua.STATEMENT_SUFFIX&&(b+=i.Lua.injectId(i.Lua.STATEMENT_SUFFIX,j));b&&(b=i.Lua.prefixLines(b,i.Lua.INDENT));var m="";i.Lua.INFINITE_LOOP_TRAP&&(m=i.Lua.prefixLines(i.Lua.injectId(i.Lua.INFINITE_LOOP_TRAP,j),i.Lua.INDENT));var n=i.Lua.statementToCode(j,"STACK"),o=i.Lua.valueToCode(j,"RETURN",i.Lua.ORDER_NONE)||"",p="";n&&o&&(p=b);o?o=i.Lua.INDENT+"return "+o+"\n":n||(n="");for(var q=[],h=j.getVars(),l=0;l<h.length;l++){q[l]=i.Lua.variableDB_.getName(h[l],i.VARIABLE_CATEGORY_NAME)}b="function "+a+"("+q.join(", ")+")\n"+b+m+n+p+o+"end\n";b=i.Lua.scrub_(j,b);i.Lua.definitions_["%"+a]=b;return null};i.Lua.procedures_defnoreturn=i.Lua.procedures_defreturn;i.Lua.procedures_callreturn=function(f){for(var a=i.Lua.variableDB_.getName(f.getFieldValue("NAME"),i.PROCEDURE_CATEGORY_NAME),b=[],c=f.getVars(),d=0;d<c.length;d++){b[d]=i.Lua.valueToCode(f,"ARG"+d,i.Lua.ORDER_NONE)||"nil"}return[a+"("+b.join(", ")+")",i.Lua.ORDER_HIGH]};i.Lua.procedures_callnoreturn=function(b){return i.Lua.procedures_callreturn(b)[0]+"\n"};i.Lua.procedures_ifreturn=function(c){var d="if "+(i.Lua.valueToCode(c,"CONDITION",i.Lua.ORDER_NONE)||"false")+" then\n";i.Lua.STATEMENT_SUFFIX&&(d+=i.Lua.prefixLines(i.Lua.injectId(i.Lua.STATEMENT_SUFFIX,c),i.Lua.INDENT));c.hasReturnValue_?(c=i.Lua.valueToCode(c,"VALUE",i.Lua.ORDER_NONE)||"nil",d+=i.Lua.INDENT+"return "+c+"\n"):d+=i.Lua.INDENT+"return\n";return d+"end\n"};i.Lua.texts={};i.Lua.text=function(b){return[i.Lua.quote_(b.getFieldValue("TEXT")),i.Lua.ORDER_ATOMIC]};i.Lua.text_multiline=function(b){return[i.Lua.multiline_quote_(b.getFieldValue("TEXT")),i.Lua.ORDER_ATOMIC]};i.Lua.text_join=function(d){if(0==d.itemCount_)return["''",i.Lua.ORDER_ATOMIC];if(1==d.itemCount_)return["tostring("+(i.Lua.valueToCode(d,"ADD0",i.Lua.ORDER_NONE)||"''")+")",i.Lua.ORDER_HIGH];if(2==d.itemCount_){var e=i.Lua.valueToCode(d,"ADD0",i.Lua.ORDER_CONCATENATION)||"''";d=i.Lua.valueToCode(d,"ADD1",i.Lua.ORDER_CONCATENATION)||"''";return[e+" .. "+d,i.Lua.ORDER_CONCATENATION]}e=[];for(var f=0;f<d.itemCount_;f++){e[f]=i.Lua.valueToCode(d,"ADD"+f,i.Lua.ORDER_NONE)||"''"}d="table.concat({"+e.join(", ")+"})";return[d,i.Lua.ORDER_HIGH]};i.Lua.text_append=function(c){var d=i.Lua.variableDB_.getName(c.getFieldValue("VAR"),i.VARIABLE_CATEGORY_NAME);c=i.Lua.valueToCode(c,"TEXT",i.Lua.ORDER_CONCATENATION)||"''";return d+" = "+d+" .. "+c+"\n"};i.Lua.text_length=function(b){return["#"+(i.Lua.valueToCode(b,"VALUE",i.Lua.ORDER_UNARY)||"''"),i.Lua.ORDER_UNARY]};i.Lua.text_isEmpty=function(b){return["#"+(i.Lua.valueToCode(b,"VALUE",i.Lua.ORDER_UNARY)||"''")+" == 0",i.Lua.ORDER_RELATIONAL]};i.Lua.text_indexOf=function(d){var a=i.Lua.valueToCode(d,"FIND",i.Lua.ORDER_NONE)||"''",b=i.Lua.valueToCode(d,"VALUE",i.Lua.ORDER_NONE)||"''";return[("FIRST"==d.getFieldValue("END")?i.Lua.provideFunction_("firstIndexOf",["function "+i.Lua.FUNCTION_NAME_PLACEHOLDER_+"(str, substr) ","  local i = string.find(str, substr, 1, true)","  if i == nil then","    return 0","  else","    return i","  end","end"]):i.Lua.provideFunction_("lastIndexOf",["function "+i.Lua.FUNCTION_NAME_PLACEHOLDER_+"(str, substr)","  local i = string.find(string.reverse(str), string.reverse(substr), 1, true)","  if i then","    return #str + 2 - i - #substr","  end","  return 0","end"]))+"("+b+", "+a+")",i.Lua.ORDER_HIGH]};i.Lua.text_charAt=function(d){var e=d.getFieldValue("WHERE")||"FROM_START",f=i.Lua.valueToCode(d,"AT","FROM_END"==e?i.Lua.ORDER_UNARY:i.Lua.ORDER_NONE)||"1";d=i.Lua.valueToCode(d,"VALUE",i.Lua.ORDER_NONE)||"''";if("RANDOM"==e)e=i.Lua.provideFunction_("text_random_letter",["function "+i.Lua.FUNCTION_NAME_PLACEHOLDER_+"(str)","  local index = math.random(string.len(str))","  return string.sub(str, index, index)","end"]),d=e+"("+d+")";else{if("FIRST"==e)f="1";else if("LAST"==e)f="-1";else if("FROM_START"!=e)if("FROM_END"==e)f="-"+f;else throw Error("Unhandled option (text_charAt).");f.match(/^-?\w*$/)?d="string.sub("+d+", "+f+", "+f+")":(e=i.Lua.provideFunction_("text_char_at",["function "+i.Lua.FUNCTION_NAME_PLACEHOLDER_+"(str, index)","  return string.sub(str, index, index)","end"]),d=e+"("+d+", "+f+")")}return[d,i.Lua.ORDER_HIGH]};i.Lua.text_getSubstring=function(e){var f=i.Lua.valueToCode(e,"STRING",i.Lua.ORDER_NONE)||"''",b=e.getFieldValue("WHERE1"),g=i.Lua.valueToCode(e,"AT1","FROM_END"==b?i.Lua.ORDER_UNARY:i.Lua.ORDER_NONE)||"1";if("FIRST"==b)b=1;else if("FROM_START"==b)b=g;else if("FROM_END"==b)b="-"+g;else throw Error("Unhandled option (text_getSubstring)");g=e.getFieldValue("WHERE2");e=i.Lua.valueToCode(e,"AT2","FROM_END"==g?i.Lua.ORDER_UNARY:i.Lua.ORDER_NONE)||"1";if("LAST"==g)e=-1;else if("FROM_START"!=g)if("FROM_END"==g)e="-"+e;else throw Error("Unhandled option (text_getSubstring)");return["string.sub("+f+", "+b+", "+e+")",i.Lua.ORDER_HIGH]};i.Lua.text_changeCase=function(d){var e=d.getFieldValue("CASE");d=i.Lua.valueToCode(d,"TEXT",i.Lua.ORDER_NONE)||"''";if("UPPERCASE"==e)var b="string.upper";else"LOWERCASE"==e?b="string.lower":"TITLECASE"==e&&(b=i.Lua.provideFunction_("text_titlecase",["function "+i.Lua.FUNCTION_NAME_PLACEHOLDER_+"(str)","  local buf = {}","  local inWord = false","  for i = 1, #str do","    local c = string.sub(str, i, i)","    if inWord then","      table.insert(buf, string.lower(c))","      if string.find(c, \"%s\") then","        inWord = false","      end","    else","      table.insert(buf, string.upper(c))","      inWord = true","    end","  end","  return table.concat(buf)","end"]));return[b+"("+d+")",i.Lua.ORDER_HIGH]};i.Lua.text_trim=function(c){var a={LEFT:"^%s*(,-)",RIGHT:"(.-)%s*$",BOTH:"^%s*(.-)%s*$"}[c.getFieldValue("MODE")];return["string.gsub("+(i.Lua.valueToCode(c,"TEXT",i.Lua.ORDER_NONE)||"''")+", \""+a+"\", \"%1\")",i.Lua.ORDER_HIGH]};i.Lua.text_print=function(b){return"print("+(i.Lua.valueToCode(b,"TEXT",i.Lua.ORDER_NONE)||"''")+")\n"};i.Lua.text_prompt_ext=function(c){var a=c.getField("TEXT")?i.Lua.quote_(c.getFieldValue("TEXT")):i.Lua.valueToCode(c,"TEXT",i.Lua.ORDER_NONE)||"''";a=i.Lua.provideFunction_("text_prompt",["function "+i.Lua.FUNCTION_NAME_PLACEHOLDER_+"(msg)","  io.write(msg)","  io.flush()","  return io.read()","end"])+"("+a+")";"NUMBER"==c.getFieldValue("TYPE")&&(a="tonumber("+a+", 10)");return[a,i.Lua.ORDER_HIGH]};i.Lua.text_prompt=i.Lua.text_prompt_ext;i.Lua.text_count=function(c){var d=i.Lua.valueToCode(c,"TEXT",i.Lua.ORDER_NONE)||"''";c=i.Lua.valueToCode(c,"SUB",i.Lua.ORDER_NONE)||"''";return[i.Lua.provideFunction_("text_count",["function "+i.Lua.FUNCTION_NAME_PLACEHOLDER_+"(haystack, needle)","  if #needle == 0 then","    return #haystack + 1","  end","  local i = 1","  local count = 0","  while true do","    i = string.find(haystack, needle, i, true)","    if i == nil then","      break","    end","    count = count + 1","    i = i + #needle","  end","  return count","end"])+"("+d+", "+c+")",i.Lua.ORDER_HIGH]};i.Lua.text_replace=function(d){var e=i.Lua.valueToCode(d,"TEXT",i.Lua.ORDER_NONE)||"''",b=i.Lua.valueToCode(d,"FROM",i.Lua.ORDER_NONE)||"''";d=i.Lua.valueToCode(d,"TO",i.Lua.ORDER_NONE)||"''";return[i.Lua.provideFunction_("text_replace",["function "+i.Lua.FUNCTION_NAME_PLACEHOLDER_+"(haystack, needle, replacement)","  local buf = {}","  local i = 1","  while i <= #haystack do","    if string.sub(haystack, i, i + #needle - 1) == needle then","      for j = 1, #replacement do","        table.insert(buf, string.sub(replacement, j, j))","      end","      i = i + #needle","    else","      table.insert(buf, string.sub(haystack, i, i))","      i = i + 1","    end","  end","  return table.concat(buf)","end"])+"("+e+", "+b+", "+d+")",i.Lua.ORDER_HIGH]};i.Lua.text_reverse=function(b){return["string.reverse("+(i.Lua.valueToCode(b,"TEXT",i.Lua.ORDER_HIGH)||"''")+")",i.Lua.ORDER_HIGH]};i.Lua.variables={};i.Lua.variables_get=function(b){return[i.Lua.variableDB_.getName(b.getFieldValue("VAR"),i.VARIABLE_CATEGORY_NAME),i.Lua.ORDER_ATOMIC]};i.Lua.variables_set=function(c){var a=i.Lua.valueToCode(c,"VALUE",i.Lua.ORDER_NONE)||"0";return i.Lua.variableDB_.getName(c.getFieldValue("VAR"),i.VARIABLE_CATEGORY_NAME)+" = "+a+"\n"};i.Lua.variablesDynamic={};i.Lua.variables_get_dynamic=i.Lua.variables_get;i.Lua.variables_set_dynamic=i.Lua.variables_set;return i.Lua});
//# sourceMappingURL=lua_compressed.min.js.map
