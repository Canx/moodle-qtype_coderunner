{"version":3,"sources":["../../../src/blockly/core/comment.js"],"names":["goog","provide","require","Blockly","Comment","block","superClass_","constructor","call","model_","commentModel","text","cachedText_","onMouseUpWrapper_","onWheelWrapper_","onChangeWrapper_","onInputWrapper_","createIcon","utils","object","inherits","Icon","prototype","drawIcon_","group","dom","createSvgElement","createEditor_","foreignObject_","Bubble","BORDER_WIDTH","body","document","createElementNS","HTML_NS","setAttribute","className","textarea_","textarea","block_","RTL","value","resizeTextarea_","appendChild","bindEventWithChecks_","startEdit_","e","stopPropagation","Events","fire","BlockChange","setTimeout","focus","bind","updateEditable","isVisible","disposeBubble_","createBubble_","onBubbleResize_","size","bubble_","getBubbleSize","doubleBorderWidth","widthMinusBorder","width","heightMinusBorder","height","style","setVisible","visible","Ui","pinned","isEditable","userAgent","IE","createNonEditableBubble_","createEditableBubble_","workspace","pathObject","svgPath","iconXY_","setSvgId","id","registerResizeEvent","applyColour","Warning","createBubble","paragraphElement_","disposeBubble","unbindEvent_","dispose","promote","setBubbleSize","getText","setText","updateText","firstChild","textContent","comment","Css","register"],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Object representing a code comment.\n * @author fraser@google.com (Neil Fraser)\n */\n'use strict';\n\ngoog.provide('Blockly.Comment');\n\ngoog.require('Blockly.Bubble');\ngoog.require('Blockly.Css');\ngoog.require('Blockly.Events');\ngoog.require('Blockly.Events.BlockChange');\ngoog.require('Blockly.Events.Ui');\ngoog.require('Blockly.Icon');\ngoog.require('Blockly.utils.dom');\ngoog.require('Blockly.utils.object');\ngoog.require('Blockly.utils.userAgent');\ngoog.require('Blockly.Warning');\n\n\n/**\n * Class for a comment.\n * @param {!Blockly.Block} block The block associated with this comment.\n * @extends {Blockly.Icon}\n * @constructor\n */\nBlockly.Comment = function(block) {\n  Blockly.Comment.superClass_.constructor.call(this, block);\n\n  /**\n   * The model for this comment.\n   * @type {!Blockly.Block.CommentModel}\n   * @private\n   */\n  this.model_ = block.commentModel;\n  // If someone creates the comment directly instead of calling\n  // block.setCommentText we want to make sure the text is non-null;\n  this.model_.text = this.model_.text || '';\n\n  /**\n   * The model's text value at the start of an edit.\n   * Used to tell if an event should be fired at the end of an edit.\n   * @type {?string}\n   * @private\n   */\n  this.cachedText_ = '';\n\n  /**\n   * Mouse up event data.\n   * @type {?Blockly.EventData}\n   * @private\n   */\n  this.onMouseUpWrapper_ = null;\n\n  /**\n   * Wheel event data.\n   * @type {?Blockly.EventData}\n   * @private\n   */\n  this.onWheelWrapper_ = null;\n\n  /**\n   * Change event data.\n   * @type {?Blockly.EventData}\n   * @private\n   */\n  this.onChangeWrapper_ = null;\n\n  /**\n   * Input event data.\n   * @type {?Blockly.EventData}\n   * @private\n   */\n  this.onInputWrapper_ = null;\n\n  this.createIcon();\n};\nBlockly.utils.object.inherits(Blockly.Comment, Blockly.Icon);\n\n/**\n * Draw the comment icon.\n * @param {!Element} group The icon group.\n * @protected\n */\nBlockly.Comment.prototype.drawIcon_ = function(group) {\n  // Circle.\n  Blockly.utils.dom.createSvgElement('circle',\n      {'class': 'blocklyIconShape', 'r': '8', 'cx': '8', 'cy': '8'},\n      group);\n  // Can't use a real '?' text character since different browsers and operating\n  // systems render it differently.\n  // Body of question mark.\n  Blockly.utils.dom.createSvgElement('path',\n      {\n        'class': 'blocklyIconSymbol',\n        'd': 'm6.8,10h2c0.003,-0.617 0.271,-0.962 0.633,-1.266 2.875,-2.405' +\n          '0.607,-5.534 -3.765,-3.874v1.7c3.12,-1.657 3.698,0.118 2.336,1.25' +\n          '-1.201,0.998 -1.201,1.528 -1.204,2.19z'},\n      group);\n  // Dot of question mark.\n  Blockly.utils.dom.createSvgElement('rect',\n      {\n        'class': 'blocklyIconSymbol',\n        'x': '6.8',\n        'y': '10.78',\n        'height': '2',\n        'width': '2'\n      },\n      group);\n};\n\n/**\n * Create the editor for the comment's bubble.\n * @return {!SVGElement} The top-level node of the editor.\n * @private\n */\nBlockly.Comment.prototype.createEditor_ = function() {\n  /* Create the editor.  Here's the markup that will be generated in\n   * editable mode:\n    <foreignObject x=\"8\" y=\"8\" width=\"164\" height=\"164\">\n      <body xmlns=\"http://www.w3.org/1999/xhtml\" class=\"blocklyMinimalBody\">\n        <textarea xmlns=\"http://www.w3.org/1999/xhtml\"\n            class=\"blocklyCommentTextarea\"\n            style=\"height: 164px; width: 164px;\"></textarea>\n      </body>\n    </foreignObject>\n   * For non-editable mode see Warning.textToDom_.\n   */\n\n  this.foreignObject_ = Blockly.utils.dom.createSvgElement('foreignObject',\n      {'x': Blockly.Bubble.BORDER_WIDTH, 'y': Blockly.Bubble.BORDER_WIDTH},\n      null);\n\n  var body = document.createElementNS(Blockly.utils.dom.HTML_NS, 'body');\n  body.setAttribute('xmlns', Blockly.utils.dom.HTML_NS);\n  body.className = 'blocklyMinimalBody';\n\n  this.textarea_ = document.createElementNS(\n      Blockly.utils.dom.HTML_NS, 'textarea');\n  var textarea = this.textarea_;\n  textarea.className = 'blocklyCommentTextarea';\n  textarea.setAttribute('dir', this.block_.RTL ? 'RTL' : 'LTR');\n  textarea.value = this.model_.text;\n  this.resizeTextarea_();\n\n  body.appendChild(textarea);\n  this.foreignObject_.appendChild(body);\n\n  // Ideally this would be hooked to the focus event for the comment.\n  // However doing so in Firefox swallows the cursor for unknown reasons.\n  // So this is hooked to mouseup instead.  No big deal.\n  this.onMouseUpWrapper_ = Blockly.bindEventWithChecks_(\n      textarea, 'mouseup', this, this.startEdit_, true, true);\n  // Don't zoom with mousewheel.\n  this.onWheelWrapper_ = Blockly.bindEventWithChecks_(\n      textarea, 'wheel', this, function(e) {\n        e.stopPropagation();\n      });\n  this.onChangeWrapper_ = Blockly.bindEventWithChecks_(\n      textarea, 'change', this, function(_e) {\n        if (this.cachedText_ != this.model_.text) {\n          Blockly.Events.fire(new Blockly.Events.BlockChange(\n              this.block_, 'comment', null, this.cachedText_, this.model_.text));\n        }\n      });\n  this.onInputWrapper_ = Blockly.bindEventWithChecks_(\n      textarea, 'input', this, function(_e) {\n        this.model_.text = textarea.value;\n      });\n\n  setTimeout(textarea.focus.bind(textarea), 0);\n\n  return this.foreignObject_;\n};\n\n/**\n * Add or remove editability of the comment.\n * @override\n */\nBlockly.Comment.prototype.updateEditable = function() {\n  Blockly.Comment.superClass_.updateEditable.call(this);\n  if (this.isVisible()) {\n    // Recreate the bubble with the correct UI.\n    this.disposeBubble_();\n    this.createBubble_();\n  }\n};\n\n/**\n * Callback function triggered when the bubble has resized.\n * Resize the text area accordingly.\n * @private\n */\nBlockly.Comment.prototype.onBubbleResize_ = function() {\n  if (!this.isVisible()) {\n    return;\n  }\n  this.model_.size = this.bubble_.getBubbleSize();\n  this.resizeTextarea_();\n};\n\n/**\n * Resizes the text area to match the size defined on the model (which is\n * the size of the bubble).\n * @private\n */\nBlockly.Comment.prototype.resizeTextarea_ = function() {\n  var size = this.model_.size;\n  var doubleBorderWidth = 2 * Blockly.Bubble.BORDER_WIDTH;\n  var widthMinusBorder = size.width - doubleBorderWidth;\n  var heightMinusBorder = size.height - doubleBorderWidth;\n  this.foreignObject_.setAttribute('width', widthMinusBorder);\n  this.foreignObject_.setAttribute('height', heightMinusBorder);\n  this.textarea_.style.width = (widthMinusBorder - 4) + 'px';\n  this.textarea_.style.height = (heightMinusBorder - 4) + 'px';\n};\n\n/**\n * Show or hide the comment bubble.\n * @param {boolean} visible True if the bubble should be visible.\n */\nBlockly.Comment.prototype.setVisible = function(visible) {\n  if (visible == this.isVisible()) {\n    return;\n  }\n  Blockly.Events.fire(\n      new Blockly.Events.Ui(this.block_, 'commentOpen', !visible, visible));\n  this.model_.pinned = visible;\n  if (visible) {\n    this.createBubble_();\n  } else {\n    this.disposeBubble_();\n  }\n};\n\n/**\n * Show the bubble. Handles deciding if it should be editable or not.\n * @private\n */\nBlockly.Comment.prototype.createBubble_ = function() {\n  if (!this.block_.isEditable() || Blockly.utils.userAgent.IE) {\n    // Steal the code from warnings to make an uneditable text bubble.\n    // MSIE does not support foreignobject; textareas are impossible.\n    // https://docs.microsoft.com/en-us/openspecs/ie_standards/ms-svg/56e6e04c-7c8c-44dd-8100-bd745ee42034\n    // Always treat comments in IE as uneditable.\n    this.createNonEditableBubble_();\n  } else {\n    this.createEditableBubble_();\n  }\n};\n\n/**\n * Show an editable bubble.\n * @private\n */\nBlockly.Comment.prototype.createEditableBubble_ = function() {\n  this.bubble_ = new Blockly.Bubble(\n      /** @type {!Blockly.WorkspaceSvg} */ (this.block_.workspace),\n      this.createEditor_(), this.block_.pathObject.svgPath,\n      /** @type {!Blockly.utils.Coordinate} */ (this.iconXY_),\n      this.model_.size.width, this.model_.size.height);\n  // Expose this comment's block's ID on its top-level SVG group.\n  this.bubble_.setSvgId(this.block_.id);\n  this.bubble_.registerResizeEvent(this.onBubbleResize_.bind(this));\n  this.applyColour();\n};\n\n/**\n * Show a non-editable bubble.\n * @private\n * @suppress {checkTypes} Suppress `this` type mismatch.\n */\nBlockly.Comment.prototype.createNonEditableBubble_ = function() {\n  // TODO (#2917): It would be great if the comment could support line breaks.\n  Blockly.Warning.prototype.createBubble.call(this);\n};\n\n/**\n * Dispose of the bubble.\n * @private\n * @suppress {checkTypes} Suppress `this` type mismatch.\n */\nBlockly.Comment.prototype.disposeBubble_ = function() {\n  if (this.paragraphElement_) {\n    // We're using the warning UI so we have to let it dispose.\n    Blockly.Warning.prototype.disposeBubble.call(this);\n    return;\n  }\n  if (this.onMouseUpWrapper_) {\n    Blockly.unbindEvent_(this.onMouseUpWrapper_);\n    this.onMouseUpWrapper_ = null;\n  }\n  if (this.onWheelWrapper_) {\n    Blockly.unbindEvent_(this.onWheelWrapper_);\n    this.onWheelWrapper_ = null;\n  }\n  if (this.onChangeWrapper_) {\n    Blockly.unbindEvent_(this.onChangeWrapper_);\n    this.onChangeWrapper_ = null;\n  }\n  if (this.onInputWrapper_) {\n    Blockly.unbindEvent_(this.onInputWrapper_);\n    this.onInputWrapper_ = null;\n  }\n  this.bubble_.dispose();\n  this.bubble_ = null;\n  this.textarea_ = null;\n  this.foreignObject_ = null;\n};\n\n/**\n * Callback fired when an edit starts.\n *\n * Bring the comment to the top of the stack when clicked on. Also cache the\n * current text so it can be used to fire a change event.\n * @param {!Event} _e Mouse up event.\n * @private\n */\nBlockly.Comment.prototype.startEdit_ = function(_e) {\n  if (this.bubble_.promote()) {\n    // Since the act of moving this node within the DOM causes a loss of focus,\n    // we need to reapply the focus.\n    this.textarea_.focus();\n  }\n\n  this.cachedText_ = this.model_.text;\n};\n\n/**\n * Get the dimensions of this comment's bubble.\n * @return {Blockly.utils.Size} Object with width and height properties.\n */\nBlockly.Comment.prototype.getBubbleSize = function() {\n  return this.model_.size;\n};\n\n/**\n * Size this comment's bubble.\n * @param {number} width Width of the bubble.\n * @param {number} height Height of the bubble.\n */\nBlockly.Comment.prototype.setBubbleSize = function(width, height) {\n  if (this.bubble_) {\n    this.bubble_.setBubbleSize(width, height);\n  } else {\n    this.model_.size.width = width;\n    this.model_.size.height = height;\n  }\n};\n\n/**\n * Returns this comment's text.\n * @return {string} Comment text.\n * @deprecated August 2019 Use block.getCommentText() instead.\n */\nBlockly.Comment.prototype.getText = function() {\n  return this.model_.text || '';\n};\n\n/**\n * Set this comment's text.\n *\n * If you want to receive a comment change event, then this should not be called\n * directly. Instead call block.setCommentText();\n * @param {string} text Comment text.\n * @deprecated August 2019 Use block.setCommentText() instead.\n */\nBlockly.Comment.prototype.setText = function(text) {\n  if (this.model_.text == text) {\n    return;\n  }\n  this.model_.text = text;\n  this.updateText();\n};\n\n/**\n * Update the comment's view to match the model.\n * @package\n */\nBlockly.Comment.prototype.updateText = function() {\n  if (this.textarea_) {\n    this.textarea_.value = this.model_.text;\n  } else if (this.paragraphElement_) {\n    // Non-Editable mode.\n    // TODO (#2917): If 2917 gets added this will probably need to be updated.\n    this.paragraphElement_.firstChild.textContent = this.model_.text;\n  }\n};\n\n/**\n * Dispose of this comment.\n *\n * If you want to receive a comment \"delete\" event (newValue: null), then this\n * should not be called directly. Instead call block.setCommentText(null);\n */\nBlockly.Comment.prototype.dispose = function() {\n  this.block_.comment = null;\n  Blockly.Icon.prototype.dispose.call(this);\n};\n\n/**\n * CSS for block comment.  See css.js for use.\n */\nBlockly.Css.register([\n  /* eslint-disable indent */\n  '.blocklyCommentTextarea {',\n    'background-color: #fef49c;',\n    'border: 0;',\n    'outline: 0;',\n    'margin: 0;',\n    'padding: 3px;',\n    'resize: none;',\n    'display: block;',\n    'overflow: hidden;',\n  '}'\n  /* eslint-enable indent */\n]);\n"],"file":"comment.min.js"}