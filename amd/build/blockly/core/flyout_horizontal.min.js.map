{"version":3,"sources":["../../../src/blockly/core/flyout_horizontal.js"],"names":["goog","provide","require","requireType","Blockly","HorizontalFlyout","workspaceOptions","superClass_","constructor","call","horizontalLayout","utils","object","inherits","Flyout","prototype","getMetrics_","isVisible","optionBox","workspace_","getCanvas","getBBox","e","height","y","width","x","absoluteTop","SCROLLBAR_PADDING","absoluteLeft","toolboxPosition_","TOOLBOX_AT_BOTTOM","viewHeight","height_","TOOLBOX_AT_TOP","viewWidth","width_","metrics","contentHeight","MARGIN","scale","contentWidth","contentTop","contentLeft","viewTop","scrollY","viewLeft","scrollX","setMetrics_","xyRatio","translate","position","targetWorkspaceMetrics","targetWorkspace","getMetrics","edgeWidth","CORNER_RADIUS","edgeHeight","setBackgroundPath_","toolboxPosition","toolboxHeight","positionAt_","atTop","path","push","svgBackground_","setAttribute","join","scrollToStart","scrollbar","set","RTL","wheel_","scrollDelta","getScrollDeltaPixels","delta","pos","limit","Math","min","max","WidgetDiv","hide","DropDownDiv","hideWithoutAnimation","preventDefault","stopPropagation","layout_","contents","gaps","margin","cursorX","tabWidth_","cursorY","reverse","i","item","type","block","allBlocks","getDescendants","j","child","isInFlyout","render","root","getSvgRoot","blockHW","getHeightWidth","tab","outputConnection","moveX","moveBy","rect","createRect_","addBlockListeners_","initFlyoutButton_","button","isDragTowardWorkspace","currentDragDeltaXY","dx","dy","dragDirection","atan2","PI","range","dragAngleRange_","getClientRect","svgGroup_","flyoutRect","getBoundingClientRect","BIG_NUM","top","Rect","reflowInternal_","flyoutHeight","blocks","getTopBlocks","Scrollbar","scrollbarThickness","flyoutRect_","moveRectToBlock_"],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Horizontal flyout tray containing blocks which may be created.\n * @author fenichel@google.com (Rachel Fenichel)\n */\n'use strict';\n\ngoog.provide('Blockly.HorizontalFlyout');\n\ngoog.require('Blockly.Block');\ngoog.require('Blockly.Flyout');\ngoog.require('Blockly.Scrollbar');\ngoog.require('Blockly.utils');\ngoog.require('Blockly.utils.object');\ngoog.require('Blockly.utils.Rect');\ngoog.require('Blockly.WidgetDiv');\n\ngoog.requireType('Blockly.utils.Metrics');\n\n\n/**\n * Class for a flyout.\n * @param {!Blockly.Options} workspaceOptions Dictionary of options for the\n *     workspace.\n * @extends {Blockly.Flyout}\n * @constructor\n */\nBlockly.HorizontalFlyout = function(workspaceOptions) {\n  Blockly.HorizontalFlyout.superClass_.constructor.call(this, workspaceOptions);\n  \n  this.horizontalLayout = true;\n};\nBlockly.utils.object.inherits(Blockly.HorizontalFlyout, Blockly.Flyout);\n\n/**\n * Return an object with all the metrics required to size scrollbars for the\n * flyout.  The following properties are computed:\n * .viewHeight: Height of the visible rectangle,\n * .viewWidth: Width of the visible rectangle,\n * .contentHeight: Height of the contents,\n * .contentWidth: Width of the contents,\n * .viewTop: Offset of top edge of visible rectangle from parent,\n * .contentTop: Offset of the top-most content from the y=0 coordinate,\n * .absoluteTop: Top-edge of view.\n * .viewLeft: Offset of the left edge of visible rectangle from parent,\n * .contentLeft: Offset of the left-most content from the x=0 coordinate,\n * .absoluteLeft: Left-edge of view.\n * @return {Blockly.utils.Metrics} Contains size and position metrics of the\n *     flyout.\n * @protected\n */\nBlockly.HorizontalFlyout.prototype.getMetrics_ = function() {\n  if (!this.isVisible()) {\n    // Flyout is hidden.\n    return null;\n  }\n\n  try {\n    var optionBox = this.workspace_.getCanvas().getBBox();\n  } catch (e) {\n    // Firefox has trouble with hidden elements (Bug 528969).\n    var optionBox = {height: 0, y: 0, width: 0, x: 0};\n  }\n\n  var absoluteTop = this.SCROLLBAR_PADDING;\n  var absoluteLeft = this.SCROLLBAR_PADDING;\n  if (this.toolboxPosition_ == Blockly.TOOLBOX_AT_BOTTOM) {\n    absoluteTop = 0;\n  }\n  var viewHeight = this.height_;\n  if (this.toolboxPosition_ == Blockly.TOOLBOX_AT_TOP) {\n    viewHeight -= this.SCROLLBAR_PADDING;\n  }\n  var viewWidth = this.width_ - 2 * this.SCROLLBAR_PADDING;\n\n  var metrics = {\n    contentHeight: (optionBox.height + 2 * this.MARGIN) * this.workspace_.scale,\n    contentWidth: (optionBox.width + 2 * this.MARGIN) * this.workspace_.scale,\n    contentTop: 0,\n    contentLeft: 0,\n    \n    viewHeight: viewHeight,\n    viewWidth: viewWidth,\n    viewTop: -this.workspace_.scrollY,\n    viewLeft: -this.workspace_.scrollX,\n    \n    absoluteTop: absoluteTop,\n    absoluteLeft: absoluteLeft\n  };\n  return metrics;\n};\n\n/**\n * Sets the translation of the flyout to match the scrollbars.\n * @param {!{x:number,y:number}} xyRatio Contains a y property which is a float\n *     between 0 and 1 specifying the degree of scrolling and a\n *     similar x property.\n * @protected\n */\nBlockly.HorizontalFlyout.prototype.setMetrics_ = function(xyRatio) {\n  var metrics = this.getMetrics_();\n  // This is a fix to an apparent race condition.\n  if (!metrics) {\n    return;\n  }\n\n  if (typeof xyRatio.x == 'number') {\n    this.workspace_.scrollX = -metrics.contentWidth * xyRatio.x;\n  }\n\n  this.workspace_.translate(this.workspace_.scrollX + metrics.absoluteLeft,\n      this.workspace_.scrollY + metrics.absoluteTop);\n};\n\n/**\n * Move the flyout to the edge of the workspace.\n */\nBlockly.HorizontalFlyout.prototype.position = function() {\n  if (!this.isVisible()) {\n    return;\n  }\n  var targetWorkspaceMetrics = this.targetWorkspace.getMetrics();\n  if (!targetWorkspaceMetrics) {\n    // Hidden components will return null.\n    return;\n  }\n  // Record the width for Blockly.Flyout.getMetrics_.\n  this.width_ = targetWorkspaceMetrics.viewWidth;\n\n  var edgeWidth = targetWorkspaceMetrics.viewWidth - 2 * this.CORNER_RADIUS;\n  var edgeHeight = this.height_ - this.CORNER_RADIUS;\n  this.setBackgroundPath_(edgeWidth, edgeHeight);\n\n  // X is always 0 since this is a horizontal flyout.\n  var x = 0;\n  // If this flyout is the toolbox flyout.\n  if (this.targetWorkspace.toolboxPosition == this.toolboxPosition_) {\n    // If there is a toolbox.\n    if (targetWorkspaceMetrics.toolboxHeight) {\n      if (this.toolboxPosition_ == Blockly.TOOLBOX_AT_TOP) {\n        var y = targetWorkspaceMetrics.toolboxHeight;\n      } else {\n        var y = targetWorkspaceMetrics.viewHeight - this.height_;\n      }\n    } else {\n      if (this.toolboxPosition_ == Blockly.TOOLBOX_AT_TOP) {\n        var y = 0;\n      } else {\n        var y = targetWorkspaceMetrics.viewHeight;\n      }\n    }\n  } else {\n    if (this.toolboxPosition_ == Blockly.TOOLBOX_AT_TOP) {\n      var y = 0;\n    } else {\n      // Because the anchor point of the flyout is on the top, but we want\n      // to align the bottom edge of the flyout with the bottom edge of the\n      // blocklyDiv, we calculate the full height of the div minus the height\n      // of the flyout.\n      var y = targetWorkspaceMetrics.viewHeight +\n          targetWorkspaceMetrics.absoluteTop - this.height_;\n    }\n  }\n  this.positionAt_(this.width_, this.height_, x, y);\n};\n\n/**\n * Create and set the path for the visible boundaries of the flyout.\n * @param {number} width The width of the flyout, not including the\n *     rounded corners.\n * @param {number} height The height of the flyout, not including\n *     rounded corners.\n * @private\n */\nBlockly.HorizontalFlyout.prototype.setBackgroundPath_ = function(width,\n    height) {\n  var atTop = this.toolboxPosition_ == Blockly.TOOLBOX_AT_TOP;\n  // Start at top left.\n  var path = ['M 0,' + (atTop ? 0 : this.CORNER_RADIUS)];\n\n  if (atTop) {\n    // Top.\n    path.push('h', width + 2 * this.CORNER_RADIUS);\n    // Right.\n    path.push('v', height);\n    // Bottom.\n    path.push('a', this.CORNER_RADIUS, this.CORNER_RADIUS, 0, 0, 1,\n        -this.CORNER_RADIUS, this.CORNER_RADIUS);\n    path.push('h', -width);\n    // Left.\n    path.push('a', this.CORNER_RADIUS, this.CORNER_RADIUS, 0, 0, 1,\n        -this.CORNER_RADIUS, -this.CORNER_RADIUS);\n    path.push('z');\n  } else {\n    // Top.\n    path.push('a', this.CORNER_RADIUS, this.CORNER_RADIUS, 0, 0, 1,\n        this.CORNER_RADIUS, -this.CORNER_RADIUS);\n    path.push('h', width);\n    // Right.\n    path.push('a', this.CORNER_RADIUS, this.CORNER_RADIUS, 0, 0, 1,\n        this.CORNER_RADIUS, this.CORNER_RADIUS);\n    path.push('v', height);\n    // Bottom.\n    path.push('h', -width - 2 * this.CORNER_RADIUS);\n    // Left.\n    path.push('z');\n  }\n  this.svgBackground_.setAttribute('d', path.join(' '));\n};\n\n/**\n * Scroll the flyout to the top.\n */\nBlockly.HorizontalFlyout.prototype.scrollToStart = function() {\n  this.scrollbar.set(this.RTL ? Infinity : 0);\n};\n\n/**\n * Scroll the flyout.\n * @param {!Event} e Mouse wheel scroll event.\n * @protected\n */\nBlockly.HorizontalFlyout.prototype.wheel_ = function(e) {\n  var scrollDelta = Blockly.utils.getScrollDeltaPixels(e);\n  var delta = scrollDelta.x || scrollDelta.y;\n\n  if (delta) {\n    var metrics = this.getMetrics_();\n    var pos = metrics.viewLeft + delta;\n    var limit = metrics.contentWidth - metrics.viewWidth;\n    pos = Math.min(pos, limit);\n    pos = Math.max(pos, 0);\n    this.scrollbar.set(pos);\n    // When the flyout moves from a wheel event, hide WidgetDiv and DropDownDiv.\n    Blockly.WidgetDiv.hide();\n    Blockly.DropDownDiv.hideWithoutAnimation();\n  }\n\n  // Don't scroll the page.\n  e.preventDefault();\n  // Don't propagate mousewheel event (zooming).\n  e.stopPropagation();\n};\n\n/**\n * Lay out the blocks in the flyout.\n * @param {!Array.<!Object>} contents The blocks and buttons to lay out.\n * @param {!Array.<number>} gaps The visible gaps between blocks.\n * @protected\n */\nBlockly.HorizontalFlyout.prototype.layout_ = function(contents, gaps) {\n  this.workspace_.scale = this.targetWorkspace.scale;\n  var margin = this.MARGIN;\n  var cursorX = margin + this.tabWidth_;\n  var cursorY = margin;\n  if (this.RTL) {\n    contents = contents.reverse();\n  }\n\n  for (var i = 0, item; (item = contents[i]); i++) {\n    if (item.type == 'block') {\n      var block = item.block;\n      var allBlocks = block.getDescendants(false);\n      for (var j = 0, child; (child = allBlocks[j]); j++) {\n        // Mark blocks as being inside a flyout.  This is used to detect and\n        // prevent the closure of the flyout if the user right-clicks on such a\n        // block.\n        child.isInFlyout = true;\n      }\n      block.render();\n      var root = block.getSvgRoot();\n      var blockHW = block.getHeightWidth();\n\n      // Figure out where to place the block.\n      var tab = block.outputConnection ? this.tabWidth_ : 0;\n      if (this.RTL) {\n        var moveX = cursorX + blockHW.width;\n      } else {\n        var moveX = cursorX - tab;\n      }\n      block.moveBy(moveX, cursorY);\n\n      var rect = this.createRect_(block, moveX, cursorY, blockHW, i);\n      cursorX += (blockHW.width + gaps[i]);\n\n      this.addBlockListeners_(root, block, rect);\n    } else if (item.type == 'button') {\n      this.initFlyoutButton_(item.button, cursorX, cursorY);\n      cursorX += (item.button.width + gaps[i]);\n    }\n  }\n};\n\n/**\n * Determine if a drag delta is toward the workspace, based on the position\n * and orientation of the flyout. This is used in determineDragIntention_ to\n * determine if a new block should be created or if the flyout should scroll.\n * @param {!Blockly.utils.Coordinate} currentDragDeltaXY How far the pointer has\n *     moved from the position at mouse down, in pixel units.\n * @return {boolean} True if the drag is toward the workspace.\n * @package\n */\nBlockly.HorizontalFlyout.prototype.isDragTowardWorkspace = function(\n    currentDragDeltaXY) {\n  var dx = currentDragDeltaXY.x;\n  var dy = currentDragDeltaXY.y;\n  // Direction goes from -180 to 180, with 0 toward the right and 90 on top.\n  var dragDirection = Math.atan2(dy, dx) / Math.PI * 180;\n\n  var range = this.dragAngleRange_;\n  // Check for up or down dragging.\n  if ((dragDirection < 90 + range && dragDirection > 90 - range) ||\n      (dragDirection > -90 - range && dragDirection < -90 + range)) {\n    return true;\n  }\n  return false;\n};\n\n/**\n * Return the deletion rectangle for this flyout in viewport coordinates.\n * @return {Blockly.utils.Rect} Rectangle in which to delete.\n */\nBlockly.HorizontalFlyout.prototype.getClientRect = function() {\n  if (!this.svgGroup_) {\n    return null;\n  }\n\n  var flyoutRect = this.svgGroup_.getBoundingClientRect();\n  // BIG_NUM is offscreen padding so that blocks dragged beyond the shown flyout\n  // area are still deleted.  Must be larger than the largest screen size,\n  // but be smaller than half Number.MAX_SAFE_INTEGER (not available on IE).\n  var BIG_NUM = 1000000000;\n  var top = flyoutRect.top;\n\n  if (this.toolboxPosition_ == Blockly.TOOLBOX_AT_TOP) {\n    var height = flyoutRect.height;\n    return new Blockly.utils.Rect(-BIG_NUM, top + height, -BIG_NUM, BIG_NUM);\n  } else {  // Bottom.\n    return new Blockly.utils.Rect(top, BIG_NUM, -BIG_NUM, BIG_NUM);\n  }\n};\n\n/**\n * Compute height of flyout.  Position mat under each block.\n * For RTL: Lay out the blocks right-aligned.\n * @protected\n */\nBlockly.HorizontalFlyout.prototype.reflowInternal_ = function() {\n  this.workspace_.scale = this.targetWorkspace.scale;\n  var flyoutHeight = 0;\n  var blocks = this.workspace_.getTopBlocks(false);\n  for (var i = 0, block; (block = blocks[i]); i++) {\n    flyoutHeight = Math.max(flyoutHeight, block.getHeightWidth().height);\n  }\n  flyoutHeight += this.MARGIN * 1.5;\n  flyoutHeight *= this.workspace_.scale;\n  flyoutHeight += Blockly.Scrollbar.scrollbarThickness;\n\n  if (this.height_ != flyoutHeight) {\n    for (var i = 0, block; (block = blocks[i]); i++) {\n      if (block.flyoutRect_) {\n        this.moveRectToBlock_(block.flyoutRect_, block);\n      }\n    }\n    // Record the height for .getMetrics_ and .position.\n    this.height_ = flyoutHeight;\n    this.position();\n  }\n};\n"],"file":"flyout_horizontal.min.js"}