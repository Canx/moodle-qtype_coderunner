'use strict';goog.provide("Blockly.zelos");goog.provide("Blockly.zelos.RenderInfo");goog.require("Blockly.blockRendering.BottomRow");goog.require("Blockly.blockRendering.ExternalValueInput");goog.require("Blockly.blockRendering.InlineInput");goog.require("Blockly.blockRendering.InputRow");goog.require("Blockly.blockRendering.Measurable");goog.require("Blockly.blockRendering.NextConnection");goog.require("Blockly.blockRendering.OutputConnection");goog.require("Blockly.blockRendering.PreviousConnection");goog.require("Blockly.blockRendering.RenderInfo");goog.require("Blockly.blockRendering.RoundCorner");goog.require("Blockly.blockRendering.Row");goog.require("Blockly.blockRendering.SquareCorner");goog.require("Blockly.blockRendering.SpacerRow");goog.require("Blockly.blockRendering.TopRow");goog.require("Blockly.blockRendering.Types");goog.require("Blockly.utils.object");goog.require("Blockly.zelos.BottomRow");goog.require("Blockly.zelos.RightConnectionShape");goog.require("Blockly.zelos.StatementInput");goog.require("Blockly.zelos.TopRow");Blockly.zelos.RenderInfo=function(a,b){Blockly.zelos.RenderInfo.superClass_.constructor.call(this,a,b);this.topRow=new Blockly.zelos.TopRow(this.constants_);this.bottomRow=new Blockly.zelos.BottomRow(this.constants_);this.isInline=!0;this.isMultiRow=!b.getInputsInline()||b.isCollapsed();this.hasStatementInput=0<b.statementInputCount;this.rightSide=this.outputConnection?new Blockly.zelos.RightConnectionShape(this.constants_):null};Blockly.utils.object.inherits(Blockly.zelos.RenderInfo,Blockly.blockRendering.RenderInfo);Blockly.zelos.RenderInfo.prototype.getRenderer=function(){return this.renderer_};Blockly.zelos.RenderInfo.prototype.measure=function(){this.createRows_();this.addElemSpacing_();this.addRowSpacing_();this.adjustXPosition_();this.computeBounds_();this.alignRowElements_();this.finalize_()};Blockly.zelos.RenderInfo.prototype.shouldStartNewRow_=function(a,b){if(!b){return!1}if(a.type==Blockly.NEXT_STATEMENT||b.type==Blockly.NEXT_STATEMENT){return!0}if(a.type==Blockly.INPUT_VALUE||a.type==Blockly.DUMMY_INPUT){return!this.isInline||this.isMultiRow}return!1};Blockly.zelos.RenderInfo.prototype.getDesiredRowWidth_=function(a){if(a.hasStatement){var b=this.constants_.INSIDE_CORNERS.rightWidth||0;return this.width-this.startX-b}return Blockly.zelos.RenderInfo.superClass_.getDesiredRowWidth_.call(this,a)};Blockly.zelos.RenderInfo.prototype.getInRowSpacing_=function(a,b){if(!a||!b){if(this.outputConnection&&this.outputConnection.isDynamicShape&&!this.hasStatementInput&&!this.bottomRow.hasNextConnection){return this.constants_.NO_PADDING}}if(!a){if(b&&Blockly.blockRendering.Types.isStatementInput(b)){return this.constants_.STATEMENT_INPUT_PADDING_LEFT}}if(a&&Blockly.blockRendering.Types.isLeftRoundedCorner(a)&&b){if(Blockly.blockRendering.Types.isPreviousConnection(b)||Blockly.blockRendering.Types.isNextConnection(b)){return b.notchOffset-this.constants_.CORNER_RADIUS}}if(a&&Blockly.blockRendering.Types.isLeftSquareCorner(a)&&b&&Blockly.blockRendering.Types.isHat(b)){return this.constants_.NO_PADDING}return this.constants_.MEDIUM_PADDING};Blockly.zelos.RenderInfo.prototype.getSpacerRowHeight_=function(a,b){if(Blockly.blockRendering.Types.isTopRow(a)&&Blockly.blockRendering.Types.isBottomRow(b)){return this.constants_.EMPTY_BLOCK_SPACER_HEIGHT}var c=Blockly.blockRendering.Types.isInputRow(a)&&a.hasStatement,d=Blockly.blockRendering.Types.isInputRow(b)&&b.hasStatement;if(d||c){var e=this.constants_.INSIDE_CORNERS.rightHeight||0,f=Math.max(this.constants_.NOTCH_HEIGHT,e);return d&&c?Math.max(f,this.constants_.DUMMY_INPUT_MIN_HEIGHT):f}if(Blockly.blockRendering.Types.isTopRow(a)){if(!a.hasPreviousConnection&&(!this.outputConnection||this.hasStatementInput)){return Math.abs(this.constants_.NOTCH_HEIGHT-this.constants_.CORNER_RADIUS)}return this.constants_.NO_PADDING}if(Blockly.blockRendering.Types.isBottomRow(b)){if(!this.outputConnection){var g=Math.max(this.topRow.minHeight,Math.max(this.constants_.NOTCH_HEIGHT,this.constants_.CORNER_RADIUS))-this.constants_.CORNER_RADIUS;return g}else if(!b.hasNextConnection&&this.hasStatementInput){return Math.abs(this.constants_.NOTCH_HEIGHT-this.constants_.CORNER_RADIUS)}return this.constants_.NO_PADDING}return this.constants_.MEDIUM_PADDING};Blockly.zelos.RenderInfo.prototype.getSpacerRowWidth_=function(a,b){var c=this.width-this.startX;if(Blockly.blockRendering.Types.isInputRow(a)&&a.hasStatement||Blockly.blockRendering.Types.isInputRow(b)&&b.hasStatement){return Math.max(c,this.constants_.STATEMENT_INPUT_SPACER_MIN_WIDTH)}return c};Blockly.zelos.RenderInfo.prototype.getElemCenterline_=function(a,b){if(a.hasStatement&&!Blockly.blockRendering.Types.isSpacer(b)&&!Blockly.blockRendering.Types.isStatementInput(b)){return a.yPos+this.constants_.EMPTY_STATEMENT_INPUT_HEIGHT/2}if(Blockly.blockRendering.Types.isInlineInput(b)){var c=b.connectedBlock;if(c&&c.outputConnection&&c.nextConnection){return a.yPos+c.height/2}}return Blockly.zelos.RenderInfo.superClass_.getElemCenterline_.call(this,a,b)};Blockly.zelos.RenderInfo.prototype.addInput_=function(a,b){if(a.type==Blockly.DUMMY_INPUT&&b.hasDummyInput&&b.align==Blockly.ALIGN_LEFT&&a.align==Blockly.ALIGN_RIGHT){b.rightAlignedDummyInput=a}Blockly.zelos.RenderInfo.superClass_.addInput_.call(this,a,b)};Blockly.zelos.RenderInfo.prototype.addAlignmentPadding_=function(a,b){if(a.rightAlignedDummyInput){for(var c,d=0,e;e=a.elements[d];d++){if(Blockly.blockRendering.Types.isSpacer(e)){c=e}if(Blockly.blockRendering.Types.isField(e)&&e.parentInput==a.rightAlignedDummyInput){break}}if(c){c.width+=b;a.width+=b;return}}Blockly.zelos.RenderInfo.superClass_.addAlignmentPadding_.call(this,a,b)};Blockly.zelos.RenderInfo.prototype.adjustXPosition_=function(){for(var a=this.constants_.NOTCH_OFFSET_LEFT+this.constants_.NOTCH_WIDTH,b=a,c=2;c<this.rows.length-1;c+=2){var d=this.rows[c-1],e=this.rows[c],f=this.rows[c+1],g=2==c?!!this.topRow.hasPreviousConnection:!!d.followsStatement,h=c+2>=this.rows.length-1?!!this.bottomRow.hasNextConnection:!!f.precedesStatement;if(Blockly.blockRendering.Types.isInputRow(e)&&e.hasStatement){e.measure();b=e.width-e.getLastInput().width+a}else if(g&&(2==c||h)&&Blockly.blockRendering.Types.isInputRow(e)&&!e.hasStatement){for(var k=e.xPos,l=null,m=0,n;n=e.elements[m];m++){if(Blockly.blockRendering.Types.isSpacer(n)){l=n}if(l&&(Blockly.blockRendering.Types.isField(n)||Blockly.blockRendering.Types.isInput(n))){if(k<b&&!(Blockly.blockRendering.Types.isField(n)&&(n.field instanceof Blockly.FieldLabel||n.field instanceof Blockly.FieldImage))){var o=b-k;l.width+=o}}k+=n.width}}}};Blockly.zelos.RenderInfo.prototype.finalizeOutputConnection_=function(){if(!this.outputConnection||!this.outputConnection.isDynamicShape){return}for(var a=0,b=0,c;c=this.rows[b];b++){c.yPos=a;a+=c.height}this.height=a;var d=this.bottomRow.hasNextConnection?this.height-this.bottomRow.descenderHeight:this.height,e=this.outputConnection.shape.height(d),f=this.outputConnection.shape.width(d);this.outputConnection.height=e;this.outputConnection.width=f;this.outputConnection.startX=f;this.outputConnection.connectionOffsetY=this.outputConnection.shape.connectionOffsetY(e);this.outputConnection.connectionOffsetX=this.outputConnection.shape.connectionOffsetX(f);var g=0;if(!this.hasStatementInput&&!this.bottomRow.hasNextConnection){g=f;this.rightSide.height=e;this.rightSide.width=g;this.rightSide.centerline=e/2;this.rightSide.xPos=this.width+g}this.startX=f;this.width+=f+g;this.widthWithChildren+=f+g};Blockly.zelos.RenderInfo.prototype.finalizeHorizontalAlignment_=function(){if(!this.outputConnection||this.hasStatementInput||this.bottomRow.hasNextConnection){return}for(var a=0,b=0,c;c=this.rows[b];b++){if(!Blockly.blockRendering.Types.isInputRow(c)){continue}var d=c.elements[1],e=c.elements[c.elements.length-2],f=this.getNegativeSpacing_(d),g=this.getNegativeSpacing_(e);a=f+g;var h=this.constants_.MIN_BLOCK_WIDTH+2*this.outputConnection.width;if(this.width-a<h){a=this.width-h;f=a/2;g=a/2}c.elements.unshift(new Blockly.blockRendering.InRowSpacer(this.constants_,-f));c.elements.push(new Blockly.blockRendering.InRowSpacer(this.constants_,-g))}if(a){this.width-=a;this.widthWithChildren-=a;this.rightSide.xPos-=a;for(var b=0,c;c=this.rows[b];b++){if(Blockly.blockRendering.Types.isTopOrBottomRow(c)){c.elements[1].width-=a;c.elements[1].widthWithConnectedBlocks-=a}c.width-=a;c.widthWithConnectedBlocks-=a}}};Blockly.zelos.RenderInfo.prototype.getNegativeSpacing_=function(a){if(!a){return 0}var b=this.outputConnection.width,c=this.outputConnection.shape.type,d=this.constants_;if(this.isMultiRow&&1<this.inputRows.length){switch(c){case d.SHAPES.ROUND:var e=this.constants_.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH,f=this.height/2>e?e:this.height/2,g=this.constants_.SMALL_PADDING,h=f*(1-Math.sin(Math.acos((f-g)/f)));return b-h;default:return 0;}}if(Blockly.blockRendering.Types.isInlineInput(a)){var i=a.connectedBlock,j=i?i.pathObject.outputShapeType:a.shape.type;if(i&&i.outputConnection&&(i.statementInputCount||i.nextConnection)){return 0}if(c==d.SHAPES.HEXAGONAL&&c!=j){return 0}return b-this.constants_.SHAPE_IN_SHAPE_PADDING[c][j]}else if(Blockly.blockRendering.Types.isField(a)){if(c==d.SHAPES.ROUND&&a.field instanceof Blockly.FieldTextInput){return b-2.75*d.GRID_UNIT}return b-this.constants_.SHAPE_IN_SHAPE_PADDING[c][0]}else if(Blockly.blockRendering.Types.isIcon(a)){return this.constants_.SMALL_PADDING}return 0};Blockly.zelos.RenderInfo.prototype.finalizeVerticalAlignment_=function(){if(this.outputConnection){return}for(var a=2;a<this.rows.length-1;a+=2){var b=this.rows[a-1],c=this.rows[a],d=this.rows[a+1],e=2==a,f=e?!!this.topRow.hasPreviousConnection:!!b.followsStatement,g=a+2>=this.rows.length-1?!!this.bottomRow.hasNextConnection:!!d.precedesStatement;if(f){var h=3==c.elements.length&&(c.elements[1].field instanceof Blockly.FieldLabel||c.elements[1].field instanceof Blockly.FieldImage);if(!e&&h){b.height-=this.constants_.SMALL_PADDING;d.height-=this.constants_.SMALL_PADDING;c.height-=this.constants_.MEDIUM_PADDING}else if(!e&&!g){b.height+=this.constants_.SMALL_PADDING}else if(g){for(var k=!1,l=0,m;m=c.elements[l];l++){if(Blockly.blockRendering.Types.isInlineInput(m)&&m.connectedBlock&&!m.connectedBlock.isShadow()&&m.connectedBlock.getHeightWidth().height>=40){k=!0;break}}if(k){b.height-=this.constants_.SMALL_PADDING;d.height-=this.constants_.SMALL_PADDING}}}}};Blockly.zelos.RenderInfo.prototype.finalize_=function(){this.finalizeOutputConnection_();this.finalizeHorizontalAlignment_();this.finalizeVerticalAlignment_();Blockly.zelos.RenderInfo.superClass_.finalize_.call(this);if(this.rightSide){this.widthWithChildren+=this.rightSide.width}};
//# sourceMappingURL=info.min.js.map
