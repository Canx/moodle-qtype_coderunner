{"version":3,"sources":["../../../../../src/blockly/core/renderers/geras/drawer.js"],"names":["goog","provide","require","requireType","Blockly","geras","Drawer","block","info","superClass_","constructor","call","highlighter_","Highlighter","utils","object","inherits","blockRendering","prototype","draw","hideHiddenIcons_","drawOutline_","drawInternals_","pathObject","block_","setPath","outlinePath_","inlinePath_","setHighlightPath","getPath","info_","RTL","flipRTL","useDebugger","renderingDebugger","drawDebug","recordSizeOnBlock_","drawTop_","drawTopCorner","topRow","drawRightSideRow","drawJaggedEdge_","row","drawValueInput_","drawValueInput","drawStatementInput_","drawStatementInput","drawRightSideRow_","svgPaths","lineOnAxis","xPos","width","yPos","height","drawBottom_","drawBottomRow","bottomRow","drawLeft_","drawLeft","drawInlineInput_","input","drawInlineInput","positionInlineInputConnection_","centerline","connectionModel","connX","connectionWidth","constants_","DARK_PATH_OFFSET","setOffsetInBlock","connectionOffsetY","positionStatementInputConnection_","getLastInput","statementEdge","notchOffset","positionExternalValueConnection_","positionNextConnection_","connection","connInfo","x","baseline"],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Renderer that preserves the look and feel of Blockly pre-2019.\n * @author fenichel@google.com (Rachel Fenichel)\n */\n'use strict';\n\ngoog.provide('Blockly.geras.Drawer');\n\ngoog.require('Blockly.blockRendering.ConstantProvider');\ngoog.require('Blockly.blockRendering.Drawer');\ngoog.require('Blockly.geras.Highlighter');\ngoog.require('Blockly.geras.RenderInfo');\ngoog.require('Blockly.utils.object');\ngoog.require('Blockly.utils.svgPaths');\n\ngoog.requireType('Blockly.geras.PathObject');\n\n\n/**\n * An object that draws a block based on the given rendering information.\n * @param {!Blockly.BlockSvg} block The block to render.\n * @param {!Blockly.geras.RenderInfo} info An object containing all\n *   information needed to render this block.\n * @package\n * @constructor\n * @extends {Blockly.blockRendering.Drawer}\n */\nBlockly.geras.Drawer = function(block, info) {\n  Blockly.geras.Drawer.superClass_.constructor.call(this, block, info);\n  // Unlike Thrasos, Geras has highlights and drop shadows.\n  this.highlighter_ = new Blockly.geras.Highlighter(info);\n};\nBlockly.utils.object.inherits(Blockly.geras.Drawer,\n    Blockly.blockRendering.Drawer);\n\n/**\n * @override\n */\nBlockly.geras.Drawer.prototype.draw = function() {\n  this.hideHiddenIcons_();\n  this.drawOutline_();\n  this.drawInternals_();\n\n  var pathObject =\n    /** @type {!Blockly.geras.PathObject} */ (this.block_.pathObject);\n  pathObject.setPath(this.outlinePath_ + '\\n' + this.inlinePath_);\n  pathObject.setHighlightPath(this.highlighter_.getPath());\n  if (this.info_.RTL) {\n    pathObject.flipRTL();\n  }\n  if (Blockly.blockRendering.useDebugger) {\n    this.block_.renderingDebugger.drawDebug(this.block_, this.info_);\n  }\n  this.recordSizeOnBlock_();\n};\n\n/**\n * @override\n */\nBlockly.geras.Drawer.prototype.drawTop_ = function() {\n  this.highlighter_.drawTopCorner(this.info_.topRow);\n  this.highlighter_.drawRightSideRow(this.info_.topRow);\n\n  Blockly.geras.Drawer.superClass_.drawTop_.call(this);\n};\n\n/**\n * @override\n */\nBlockly.geras.Drawer.prototype.drawJaggedEdge_ = function(row) {\n  this.highlighter_.drawJaggedEdge_(row);\n\n  Blockly.geras.Drawer.superClass_.drawJaggedEdge_.call(this, row);\n};\n\n/**\n * @override\n */\nBlockly.geras.Drawer.prototype.drawValueInput_ = function(row) {\n  this.highlighter_.drawValueInput(row);\n\n  Blockly.geras.Drawer.superClass_.drawValueInput_.call(this, row);\n};\n\n/**\n * @override\n */\nBlockly.geras.Drawer.prototype.drawStatementInput_ = function(row) {\n  this.highlighter_.drawStatementInput(row);\n\n  Blockly.geras.Drawer.superClass_.drawStatementInput_.call(this, row);\n};\n\n/**\n * @override\n */\nBlockly.geras.Drawer.prototype.drawRightSideRow_ = function(row) {\n  this.highlighter_.drawRightSideRow(row);\n\n  this.outlinePath_ +=\n      Blockly.utils.svgPaths.lineOnAxis('H', row.xPos + row.width) +\n      Blockly.utils.svgPaths.lineOnAxis('V', row.yPos + row.height);\n};\n\n/**\n * @override\n */\nBlockly.geras.Drawer.prototype.drawBottom_ = function() {\n  this.highlighter_.drawBottomRow(this.info_.bottomRow);\n\n  Blockly.geras.Drawer.superClass_.drawBottom_.call(this);\n};\n\n/**\n * Add steps for the left side of the block, which may include an output\n * connection\n * @private\n */\nBlockly.geras.Drawer.prototype.drawLeft_ = function() {\n  this.highlighter_.drawLeft();\n\n  Blockly.geras.Drawer.superClass_.drawLeft_.call(this);\n};\n\n/**\n * @override\n */\nBlockly.geras.Drawer.prototype.drawInlineInput_ = function(input) {\n  this.highlighter_.drawInlineInput(input);\n\n  Blockly.geras.Drawer.superClass_.drawInlineInput_.call(this, input);\n};\n\n/**\n * @override\n */\nBlockly.geras.Drawer.prototype.positionInlineInputConnection_ = function(input) {\n  var yPos = input.centerline - input.height / 2;\n  // Move the connection.\n  if (input.connectionModel) {\n    // xPos already contains info about startX\n    var connX = input.xPos + input.connectionWidth +\n        this.constants_.DARK_PATH_OFFSET;\n    if (this.info_.RTL) {\n      connX *= -1;\n    }\n    input.connectionModel.setOffsetInBlock(\n        connX, yPos + input.connectionOffsetY +\n        this.constants_.DARK_PATH_OFFSET);\n  }\n};\n\n/**\n * @override\n */\nBlockly.geras.Drawer.prototype.positionStatementInputConnection_ = function(row) {\n  var input = row.getLastInput();\n  if (input.connectionModel) {\n    var connX = row.xPos + row.statementEdge + input.notchOffset;\n    if (this.info_.RTL) {\n      connX *= -1;\n    } else {\n      connX += this.constants_.DARK_PATH_OFFSET;\n    }\n    input.connectionModel.setOffsetInBlock(connX,\n        row.yPos + this.constants_.DARK_PATH_OFFSET);\n  }\n};\n\n/**\n * @override\n */\nBlockly.geras.Drawer.prototype.positionExternalValueConnection_ = function(row) {\n  var input = row.getLastInput();\n  if (input.connectionModel) {\n    var connX = row.xPos + row.width +\n        this.constants_.DARK_PATH_OFFSET;\n    if (this.info_.RTL) {\n      connX *= -1;\n    }\n    input.connectionModel.setOffsetInBlock(connX, row.yPos);\n  }\n};\n\n/**\n * @override\n */\nBlockly.geras.Drawer.prototype.positionNextConnection_ = function() {\n  var bottomRow = this.info_.bottomRow;\n\n  if (bottomRow.connection) {\n    var connInfo = bottomRow.connection;\n    var x = connInfo.xPos; // Already contains info about startX\n    var connX = (this.info_.RTL ? -x : x) +\n        (this.constants_.DARK_PATH_OFFSET / 2);\n    connInfo.connectionModel.setOffsetInBlock(\n        connX, bottomRow.baseline + this.constants_.DARK_PATH_OFFSET);\n  }\n};\n"],"file":"drawer.min.js"}