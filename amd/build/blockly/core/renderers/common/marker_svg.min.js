'use strict';goog.provide("Blockly.blockRendering.MarkerSvg");goog.require("Blockly.ASTNode");Blockly.blockRendering.MarkerSvg=function(a,b,c){this.workspace_=a;this.marker_=c;this.parent_=null;this.constants_=b;this.currentMarkerSvg=null;var d=this.isCursor()?this.constants_.CURSOR_COLOUR:this.constants_.MARKER_COLOUR;this.colour_=c.colour||d};Blockly.blockRendering.MarkerSvg.CURSOR_CLASS="blocklyCursor";Blockly.blockRendering.MarkerSvg.MARKER_CLASS="blocklyMarker";Blockly.blockRendering.MarkerSvg.HEIGHT_MULTIPLIER=3/4;Blockly.blockRendering.MarkerSvg.prototype.getSvgRoot=function(){return this.svgGroup_};Blockly.blockRendering.MarkerSvg.prototype.getMarker=function(){return this.marker_};Blockly.blockRendering.MarkerSvg.prototype.isCursor=function(){return"cursor"==this.marker_.type};Blockly.blockRendering.MarkerSvg.prototype.createDom=function(){var a=this.isCursor()?Blockly.blockRendering.MarkerSvg.CURSOR_CLASS:Blockly.blockRendering.MarkerSvg.MARKER_CLASS;this.svgGroup_=Blockly.utils.dom.createSvgElement("g",{class:a},null);this.createDomInternal_();return this.svgGroup_};Blockly.blockRendering.MarkerSvg.prototype.setParent_=function(a){if(!this.isCursor()){if(this.parent_){this.parent_.setMarkerSvg(null)}a.setMarkerSvg(this.getSvgRoot())}else{if(this.parent_){this.parent_.setCursorSvg(null)}a.setCursorSvg(this.getSvgRoot())}this.parent_=a};Blockly.blockRendering.MarkerSvg.prototype.draw=function(a,b){if(!b){this.hide();return}this.constants_=this.workspace_.getRenderer().getConstants();var c=this.isCursor()?this.constants_.CURSOR_COLOUR:this.constants_.MARKER_COLOUR;this.colour_=this.marker_.colour||c;this.applyColour_(b);this.showAtLocation_(b);this.fireMarkerEvent_(a,b);var d=this.currentMarkerSvg.childNodes[0];if(d!==void 0){d.beginElement&&d.beginElement()}};Blockly.blockRendering.MarkerSvg.prototype.showAtLocation_=function(a){var b=a.getLocation();if(a.getType()==Blockly.ASTNode.types.BLOCK){this.showWithBlock_(a)}else if(a.getType()==Blockly.ASTNode.types.OUTPUT){this.showWithOutput_(a)}else if(b.type==Blockly.INPUT_VALUE){this.showWithInput_(a)}else if(b.type==Blockly.NEXT_STATEMENT){this.showWithNext_(a)}else if(a.getType()==Blockly.ASTNode.types.PREVIOUS){this.showWithPrevious_(a)}else if(a.getType()==Blockly.ASTNode.types.FIELD){this.showWithField_(a)}else if(a.getType()==Blockly.ASTNode.types.WORKSPACE){this.showWithCoordinates_(a)}else if(a.getType()==Blockly.ASTNode.types.STACK){this.showWithStack_(a)}};Blockly.blockRendering.MarkerSvg.prototype.showWithBlockPrevOutput_=function(a){var b=a.getSourceBlock(),c=b.width,d=b.height,e=d*Blockly.blockRendering.MarkerSvg.HEIGHT_MULTIPLIER,f=this.constants_.CURSOR_BLOCK_PADDING;if(b.previousConnection){var g=this.constants_.shapeFor(b.previousConnection);this.positionPrevious_(c,f,e,g)}else if(b.outputConnection){var g=this.constants_.shapeFor(b.outputConnection);this.positionOutput_(c,d,g)}else{this.positionBlock_(c,f,e)}this.setParent_(b);this.showCurrent_()};Blockly.blockRendering.MarkerSvg.prototype.showWithBlock_=function(a){this.showWithBlockPrevOutput_(a)};Blockly.blockRendering.MarkerSvg.prototype.showWithPrevious_=function(a){this.showWithBlockPrevOutput_(a)};Blockly.blockRendering.MarkerSvg.prototype.showWithOutput_=function(a){this.showWithBlockPrevOutput_(a)};Blockly.blockRendering.MarkerSvg.prototype.showWithCoordinates_=function(a){var b=a.getWsCoordinate(),c=b.x,d=b.y;if(this.workspace_.RTL){c-=this.constants_.CURSOR_WS_WIDTH}this.positionLine_(c,d,this.constants_.CURSOR_WS_WIDTH);this.setParent_(this.workspace_);this.showCurrent_()};Blockly.blockRendering.MarkerSvg.prototype.showWithField_=function(a){var b=a.getLocation(),c=b.getSize().width,d=b.getSize().height;this.positionRect_(0,0,c,d);this.setParent_(b);this.showCurrent_()};Blockly.blockRendering.MarkerSvg.prototype.showWithInput_=function(a){var b=a.getLocation(),c=b.getSourceBlock();this.positionInput_(b);this.setParent_(c);this.showCurrent_()};Blockly.blockRendering.MarkerSvg.prototype.showWithNext_=function(a){var b=a.getLocation(),c=b.getSourceBlock(),d=0,e=b.getOffsetInBlock().y,f=c.getHeightWidth().width;if(this.workspace_.RTL){d=-f}this.positionLine_(d,e,f);this.setParent_(c);this.showCurrent_()};Blockly.blockRendering.MarkerSvg.prototype.showWithStack_=function(a){var b=a.getLocation(),c=b.getHeightWidth(),d=c.width+this.constants_.CURSOR_STACK_PADDING,e=c.height+this.constants_.CURSOR_STACK_PADDING,f=-this.constants_.CURSOR_STACK_PADDING/2,g=-this.constants_.CURSOR_STACK_PADDING/2,h=f;if(this.workspace_.RTL){h=-(d+f)}this.positionRect_(h,g,d,e);this.setParent_(b);this.showCurrent_()};Blockly.blockRendering.MarkerSvg.prototype.showCurrent_=function(){this.hide();this.currentMarkerSvg.style.display=""};Blockly.blockRendering.MarkerSvg.prototype.positionBlock_=function(a,b,c){var d=Blockly.utils.svgPaths.moveBy(-b,c)+Blockly.utils.svgPaths.lineOnAxis("V",-b)+Blockly.utils.svgPaths.lineOnAxis("H",a+2*b)+Blockly.utils.svgPaths.lineOnAxis("V",c);this.markerBlock_.setAttribute("d",d);if(this.workspace_.RTL){this.flipRtl_(this.markerBlock_)}this.currentMarkerSvg=this.markerBlock_};Blockly.blockRendering.MarkerSvg.prototype.positionInput_=function(a){var b=a.getOffsetInBlock().x,c=a.getOffsetInBlock().y,d=Blockly.utils.svgPaths.moveTo(0,0)+this.constants_.shapeFor(a).pathDown;this.markerInput_.setAttribute("d",d);this.markerInput_.setAttribute("transform","translate("+b+","+c+")"+(this.workspace_.RTL?" scale(-1 1)":""));this.currentMarkerSvg=this.markerInput_};Blockly.blockRendering.MarkerSvg.prototype.positionLine_=function(a,b,c){this.markerSvgLine_.setAttribute("x",a);this.markerSvgLine_.setAttribute("y",b);this.markerSvgLine_.setAttribute("width",c);this.currentMarkerSvg=this.markerSvgLine_};Blockly.blockRendering.MarkerSvg.prototype.positionOutput_=function(a,b,c){var d=Blockly.utils.svgPaths.moveBy(a,0)+Blockly.utils.svgPaths.lineOnAxis("h",-(a-c.width))+Blockly.utils.svgPaths.lineOnAxis("v",this.constants_.TAB_OFFSET_FROM_TOP)+c.pathDown+Blockly.utils.svgPaths.lineOnAxis("V",b)+Blockly.utils.svgPaths.lineOnAxis("H",a);this.markerBlock_.setAttribute("d",d);if(this.workspace_.RTL){this.flipRtl_(this.markerBlock_)}this.currentMarkerSvg=this.markerBlock_};Blockly.blockRendering.MarkerSvg.prototype.positionPrevious_=function(a,b,c,d){var e=Blockly.utils.svgPaths.moveBy(-b,c)+Blockly.utils.svgPaths.lineOnAxis("V",-b)+Blockly.utils.svgPaths.lineOnAxis("H",this.constants_.NOTCH_OFFSET_LEFT)+d.pathLeft+Blockly.utils.svgPaths.lineOnAxis("H",a+2*b)+Blockly.utils.svgPaths.lineOnAxis("V",c);this.markerBlock_.setAttribute("d",e);if(this.workspace_.RTL){this.flipRtl_(this.markerBlock_)}this.currentMarkerSvg=this.markerBlock_};Blockly.blockRendering.MarkerSvg.prototype.positionRect_=function(a,b,c,d){this.markerSvgRect_.setAttribute("x",a);this.markerSvgRect_.setAttribute("y",b);this.markerSvgRect_.setAttribute("width",c);this.markerSvgRect_.setAttribute("height",d);this.currentMarkerSvg=this.markerSvgRect_};Blockly.blockRendering.MarkerSvg.prototype.flipRtl_=function(a){a.setAttribute("transform","scale(-1 1)")};Blockly.blockRendering.MarkerSvg.prototype.hide=function(){this.markerSvgLine_.style.display="none";this.markerSvgRect_.style.display="none";this.markerInput_.style.display="none";this.markerBlock_.style.display="none"};Blockly.blockRendering.MarkerSvg.prototype.fireMarkerEvent_=function(a,b){var c=b.getSourceBlock(),d=this.isCursor()?"cursorMove":"markerMove",e=new Blockly.Events.Ui(c,d,a,b);if(b.getType()==Blockly.ASTNode.types.WORKSPACE){e.workspaceId=b.getLocation().id}Blockly.Events.fire(e)};Blockly.blockRendering.MarkerSvg.prototype.getBlinkProperties_=function(){return{attributeType:"XML",attributeName:"fill",dur:"1s",values:this.colour_+";transparent;transparent;",repeatCount:"indefinite"}};Blockly.blockRendering.MarkerSvg.prototype.createDomInternal_=function(){this.markerSvg_=Blockly.utils.dom.createSvgElement("g",{width:this.constants_.CURSOR_WS_WIDTH,height:this.constants_.WS_CURSOR_HEIGHT},this.svgGroup_);this.markerSvgLine_=Blockly.utils.dom.createSvgElement("rect",{width:this.constants_.CURSOR_WS_WIDTH,height:this.constants_.WS_CURSOR_HEIGHT,style:"display: none"},this.markerSvg_);this.markerSvgRect_=Blockly.utils.dom.createSvgElement("rect",{class:"blocklyVerticalMarker",rx:10,ry:10,style:"display: none"},this.markerSvg_);this.markerInput_=Blockly.utils.dom.createSvgElement("path",{transform:"",style:"display: none"},this.markerSvg_);this.markerBlock_=Blockly.utils.dom.createSvgElement("path",{transform:"",style:"display: none",fill:"none","stroke-width":this.constants_.CURSOR_STROKE_WIDTH},this.markerSvg_);if(this.isCursor()){var a=this.getBlinkProperties_();Blockly.utils.dom.createSvgElement("animate",a,this.markerSvgLine_);Blockly.utils.dom.createSvgElement("animate",a,this.markerInput_);a.attributeName="stroke";Blockly.utils.dom.createSvgElement("animate",a,this.markerBlock_)}return this.markerSvg_};Blockly.blockRendering.MarkerSvg.prototype.applyColour_=function(){this.markerSvgLine_.setAttribute("fill",this.colour_);this.markerSvgRect_.setAttribute("stroke",this.colour_);this.markerInput_.setAttribute("fill",this.colour_);this.markerBlock_.setAttribute("stroke",this.colour_);if(this.isCursor()){var a=this.colour_+";transparent;transparent;";this.markerSvgLine_.firstChild.setAttribute("values",a);this.markerInput_.firstChild.setAttribute("values",a);this.markerBlock_.firstChild.setAttribute("values",a)}};Blockly.blockRendering.MarkerSvg.prototype.dispose=function(){if(this.svgGroup_){Blockly.utils.dom.removeNode(this.svgGroup_)}};
//# sourceMappingURL=marker_svg.min.js.map
