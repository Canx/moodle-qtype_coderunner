'use strict';goog.provide("Blockly.blockRendering.Drawer");goog.require("Blockly.blockRendering.BottomRow");goog.require("Blockly.blockRendering.InputRow");goog.require("Blockly.blockRendering.Measurable");goog.require("Blockly.blockRendering.RenderInfo");goog.require("Blockly.blockRendering.Row");goog.require("Blockly.blockRendering.SpacerRow");goog.require("Blockly.blockRendering.TopRow");goog.require("Blockly.blockRendering.Types");goog.require("Blockly.utils.svgPaths");Blockly.blockRendering.Drawer=function(a,b){this.block_=a;this.info_=b;this.topLeft_=a.getRelativeToSurfaceXY();this.outlinePath_="";this.inlinePath_="";this.constants_=b.getRenderer().getConstants()};Blockly.blockRendering.Drawer.prototype.draw=function(){this.hideHiddenIcons_();this.drawOutline_();this.drawInternals_();this.block_.pathObject.setPath(this.outlinePath_+"\n"+this.inlinePath_);if(this.info_.RTL){this.block_.pathObject.flipRTL()}if(Blockly.blockRendering.useDebugger){this.block_.renderingDebugger.drawDebug(this.block_,this.info_)}this.recordSizeOnBlock_()};Blockly.blockRendering.Drawer.prototype.recordSizeOnBlock_=function(){this.block_.height=this.info_.height;this.block_.width=this.info_.widthWithChildren};Blockly.blockRendering.Drawer.prototype.hideHiddenIcons_=function(){for(var a=0,b;b=this.info_.hiddenIcons[a];a++){b.icon.iconGroup_.setAttribute("display","none")}};Blockly.blockRendering.Drawer.prototype.drawOutline_=function(){this.drawTop_();for(var a=1,b;a<this.info_.rows.length-1;a++){b=this.info_.rows[a];if(b.hasJaggedEdge){this.drawJaggedEdge_(b)}else if(b.hasStatement){this.drawStatementInput_(b)}else if(b.hasExternalInput){this.drawValueInput_(b)}else{this.drawRightSideRow_(b)}}this.drawBottom_();this.drawLeft_()};Blockly.blockRendering.Drawer.prototype.drawTop_=function(){var a=this.info_.topRow,b=a.elements;this.positionPreviousConnection_();this.outlinePath_+=Blockly.utils.svgPaths.moveBy(a.xPos,this.info_.startY);for(var c=0,d;d=b[c];c++){if(Blockly.blockRendering.Types.isLeftRoundedCorner(d)){this.outlinePath_+=this.constants_.OUTSIDE_CORNERS.topLeft}else if(Blockly.blockRendering.Types.isRightRoundedCorner(d)){this.outlinePath_+=this.constants_.OUTSIDE_CORNERS.topRight}else if(Blockly.blockRendering.Types.isPreviousConnection(d)){this.outlinePath_+=d.shape.pathLeft}else if(Blockly.blockRendering.Types.isHat(d)){this.outlinePath_+=this.constants_.START_HAT.path}else if(Blockly.blockRendering.Types.isSpacer(d)){this.outlinePath_+=Blockly.utils.svgPaths.lineOnAxis("h",d.width)}}this.outlinePath_+=Blockly.utils.svgPaths.lineOnAxis("v",a.height)};Blockly.blockRendering.Drawer.prototype.drawJaggedEdge_=function(a){var b=a.height-this.constants_.JAGGED_TEETH.height;this.outlinePath_+=this.constants_.JAGGED_TEETH.path+Blockly.utils.svgPaths.lineOnAxis("v",b)};Blockly.blockRendering.Drawer.prototype.drawValueInput_=function(a){var b=a.getLastInput();this.positionExternalValueConnection_(a);var c="function"==typeof b.shape.pathDown?b.shape.pathDown(b.height):b.shape.pathDown;this.outlinePath_+=Blockly.utils.svgPaths.lineOnAxis("H",b.xPos+b.width)+c+Blockly.utils.svgPaths.lineOnAxis("v",a.height-b.connectionHeight)};Blockly.blockRendering.Drawer.prototype.drawStatementInput_=function(a){var b=a.getLastInput(),c=b.xPos+b.notchOffset+b.shape.width,d=b.shape.pathRight+Blockly.utils.svgPaths.lineOnAxis("h",-(b.notchOffset-this.constants_.INSIDE_CORNERS.width))+this.constants_.INSIDE_CORNERS.pathTop,e=a.height-2*this.constants_.INSIDE_CORNERS.height;this.outlinePath_+=Blockly.utils.svgPaths.lineOnAxis("H",c)+d+Blockly.utils.svgPaths.lineOnAxis("v",e)+this.constants_.INSIDE_CORNERS.pathBottom+Blockly.utils.svgPaths.lineOnAxis("H",a.xPos+a.width);this.positionStatementInputConnection_(a)};Blockly.blockRendering.Drawer.prototype.drawRightSideRow_=function(a){this.outlinePath_+=Blockly.utils.svgPaths.lineOnAxis("V",a.yPos+a.height)};Blockly.blockRendering.Drawer.prototype.drawBottom_=function(){var a=this.info_.bottomRow,b=a.elements;this.positionNextConnection_();for(var c=0,d="",e=b.length-1,f;f=b[e];e--){if(Blockly.blockRendering.Types.isNextConnection(f)){d+=f.shape.pathRight}else if(Blockly.blockRendering.Types.isLeftSquareCorner(f)){d+=Blockly.utils.svgPaths.lineOnAxis("H",a.xPos)}else if(Blockly.blockRendering.Types.isLeftRoundedCorner(f)){d+=this.constants_.OUTSIDE_CORNERS.bottomLeft}else if(Blockly.blockRendering.Types.isRightRoundedCorner(f)){d+=this.constants_.OUTSIDE_CORNERS.bottomRight;c=this.constants_.OUTSIDE_CORNERS.rightHeight}else if(Blockly.blockRendering.Types.isSpacer(f)){d+=Blockly.utils.svgPaths.lineOnAxis("h",-1*f.width)}}this.outlinePath_+=Blockly.utils.svgPaths.lineOnAxis("V",a.baseline-c);this.outlinePath_+=d};Blockly.blockRendering.Drawer.prototype.drawLeft_=function(){var a=this.info_.outputConnection;this.positionOutputConnection_();if(a){var b=a.connectionOffsetY+a.height,c="function"==typeof a.shape.pathUp?a.shape.pathUp(a.height):a.shape.pathUp;this.outlinePath_+=Blockly.utils.svgPaths.lineOnAxis("V",b)+c}this.outlinePath_+="z"};Blockly.blockRendering.Drawer.prototype.drawInternals_=function(){for(var a=0,b;b=this.info_.rows[a];a++){for(var c=0,d;d=b.elements[c];c++){if(Blockly.blockRendering.Types.isInlineInput(d)){this.drawInlineInput_(d)}else if(Blockly.blockRendering.Types.isIcon(d)||Blockly.blockRendering.Types.isField(d)){this.layoutField_(d)}}}};Blockly.blockRendering.Drawer.prototype.layoutField_=function(a){if(Blockly.blockRendering.Types.isField(a)){var b=a.field.getSvgRoot()}else if(Blockly.blockRendering.Types.isIcon(a)){var b=a.icon.iconGroup_}var c=a.centerline-a.height/2,d=a.xPos,e="";if(this.info_.RTL){d=-(d+a.width);if(a.flipRtl){d+=a.width;e="scale(-1 1)"}}if(Blockly.blockRendering.Types.isIcon(a)){b.setAttribute("display","block");b.setAttribute("transform","translate("+d+","+c+")");a.icon.computeIconLocation()}else{b.setAttribute("transform","translate("+d+","+c+")"+e)}if(this.info_.isInsertionMarker){b.setAttribute("display","none")}};Blockly.blockRendering.Drawer.prototype.drawInlineInput_=function(a){var b=a.width,c=a.height,d=a.centerline-c/2,e=a.connectionOffsetY,f=a.connectionHeight+e,g=a.xPos+a.connectionWidth;this.inlinePath_+=Blockly.utils.svgPaths.moveTo(g,d)+Blockly.utils.svgPaths.lineOnAxis("v",e)+a.shape.pathDown+Blockly.utils.svgPaths.lineOnAxis("v",c-f)+Blockly.utils.svgPaths.lineOnAxis("h",b-a.connectionWidth)+Blockly.utils.svgPaths.lineOnAxis("v",-c)+"z";this.positionInlineInputConnection_(a)};Blockly.blockRendering.Drawer.prototype.positionInlineInputConnection_=function(a){var b=a.centerline-a.height/2;if(a.connectionModel){var c=a.xPos+a.connectionWidth+a.connectionOffsetX;if(this.info_.RTL){c*=-1}a.connectionModel.setOffsetInBlock(c,b+a.connectionOffsetY)}};Blockly.blockRendering.Drawer.prototype.positionStatementInputConnection_=function(a){var b=a.getLastInput();if(b.connectionModel){var c=a.xPos+a.statementEdge+b.notchOffset;if(this.info_.RTL){c*=-1}b.connectionModel.setOffsetInBlock(c,a.yPos)}};Blockly.blockRendering.Drawer.prototype.positionExternalValueConnection_=function(a){var b=a.getLastInput();if(b.connectionModel){var c=a.xPos+a.width;if(this.info_.RTL){c*=-1}b.connectionModel.setOffsetInBlock(c,a.yPos)}};Blockly.blockRendering.Drawer.prototype.positionPreviousConnection_=function(){var a=this.info_.topRow;if(a.connection){var b=a.xPos+a.notchOffset,c=this.info_.RTL?-b:b;a.connection.connectionModel.setOffsetInBlock(c,0)}};Blockly.blockRendering.Drawer.prototype.positionNextConnection_=function(){var a=this.info_.bottomRow;if(a.connection){var b=a.connection,c=b.xPos,d=this.info_.RTL?-c:c;b.connectionModel.setOffsetInBlock(d,a.baseline)}};Blockly.blockRendering.Drawer.prototype.positionOutputConnection_=function(){if(this.info_.outputConnection){var a=this.info_.startX+this.info_.outputConnection.connectionOffsetX,b=this.info_.RTL?-a:a;this.block_.outputConnection.setOffsetInBlock(b,this.info_.outputConnection.connectionOffsetY)}};
//# sourceMappingURL=drawer.min.js.map
