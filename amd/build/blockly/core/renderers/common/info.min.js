'use strict';goog.provide("Blockly.blockRendering.RenderInfo");goog.require("Blockly.blockRendering.BottomRow");goog.require("Blockly.blockRendering.ExternalValueInput");goog.require("Blockly.blockRendering.Hat");goog.require("Blockly.blockRendering.InlineInput");goog.require("Blockly.blockRendering.InRowSpacer");goog.require("Blockly.blockRendering.InputRow");goog.require("Blockly.blockRendering.Measurable");goog.require("Blockly.blockRendering.NextConnection");goog.require("Blockly.blockRendering.OutputConnection");goog.require("Blockly.blockRendering.PreviousConnection");goog.require("Blockly.blockRendering.RoundCorner");goog.require("Blockly.blockRendering.Row");goog.require("Blockly.blockRendering.SpacerRow");goog.require("Blockly.blockRendering.StatementInput");goog.require("Blockly.blockRendering.SquareCorner");goog.require("Blockly.blockRendering.TopRow");goog.require("Blockly.blockRendering.Types");Blockly.blockRendering.RenderInfo=function(a,b){this.block_=b;this.renderer_=a;this.constants_=this.renderer_.getConstants();this.outputConnection=!b.outputConnection?null:new Blockly.blockRendering.OutputConnection(this.constants_,b.outputConnection);this.isInline=b.getInputsInline()&&!b.isCollapsed();this.isCollapsed=b.isCollapsed();this.isInsertionMarker=b.isInsertionMarker();this.RTL=b.RTL;this.height=0;this.widthWithChildren=0;this.width=0;this.statementEdge=0;this.rows=[];this.inputRows=[];this.hiddenIcons=[];this.topRow=new Blockly.blockRendering.TopRow(this.constants_);this.bottomRow=new Blockly.blockRendering.BottomRow(this.constants_);this.startX=0;this.startY=0};Blockly.blockRendering.RenderInfo.prototype.getRenderer=function(){return this.renderer_};Blockly.blockRendering.RenderInfo.prototype.measure=function(){this.createRows_();this.addElemSpacing_();this.addRowSpacing_();this.computeBounds_();this.alignRowElements_();this.finalize_()};Blockly.blockRendering.RenderInfo.prototype.createRows_=function(){this.populateTopRow_();this.rows.push(this.topRow);var a=new Blockly.blockRendering.InputRow(this.constants_);this.inputRows.push(a);var b=this.block_.getIcons();if(b.length){for(var c=0,d,e;d=b[c];c++){e=new Blockly.blockRendering.Icon(this.constants_,d);if(this.isCollapsed&&d.collapseHidden){this.hiddenIcons.push(e)}else{a.elements.push(e)}}}for(var f=null,c=0,g;g=this.block_.inputList[c];c++){if(!g.isVisible()){continue}if(this.shouldStartNewRow_(g,f)){this.rows.push(a);a=new Blockly.blockRendering.InputRow(this.constants_);this.inputRows.push(a)}for(var h=0,k;k=g.fieldRow[h];h++){a.elements.push(new Blockly.blockRendering.Field(this.constants_,k,g))}this.addInput_(g,a);f=g}if(this.isCollapsed){a.hasJaggedEdge=!0;a.elements.push(new Blockly.blockRendering.JaggedEdge(this.constants_))}if(a.elements.length||a.hasDummyInput){this.rows.push(a)}this.populateBottomRow_();this.rows.push(this.bottomRow)};Blockly.blockRendering.RenderInfo.prototype.populateTopRow_=function(){var a=!!this.block_.previousConnection,b=(this.block_.hat?"cap"===this.block_.hat:this.constants_.ADD_START_HATS)&&!this.outputConnection&&!a,c=this.topRow.hasLeftSquareCorner(this.block_);if(c){this.topRow.elements.push(new Blockly.blockRendering.SquareCorner(this.constants_))}else{this.topRow.elements.push(new Blockly.blockRendering.RoundCorner(this.constants_))}if(b){var d=new Blockly.blockRendering.Hat(this.constants_);this.topRow.elements.push(d);this.topRow.capline=d.ascenderHeight}else if(a){this.topRow.hasPreviousConnection=!0;this.topRow.connection=new Blockly.blockRendering.PreviousConnection(this.constants_,this.block_.previousConnection);this.topRow.elements.push(this.topRow.connection)}var e=this.block_.inputList.length&&this.block_.inputList[0].type==Blockly.NEXT_STATEMENT;if(e&&!this.block_.isCollapsed()){this.topRow.minHeight=this.constants_.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT}else{this.topRow.minHeight=this.constants_.TOP_ROW_MIN_HEIGHT}var f=this.topRow.hasRightSquareCorner(this.block_);if(f){this.topRow.elements.push(new Blockly.blockRendering.SquareCorner(this.constants_,"right"))}else{this.topRow.elements.push(new Blockly.blockRendering.RoundCorner(this.constants_,"right"))}};Blockly.blockRendering.RenderInfo.prototype.populateBottomRow_=function(){this.bottomRow.hasNextConnection=!!this.block_.nextConnection;var a=this.block_.inputList.length&&this.block_.inputList[this.block_.inputList.length-1].type==Blockly.NEXT_STATEMENT;if(a){this.bottomRow.minHeight=this.constants_.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT}else{this.bottomRow.minHeight=this.constants_.BOTTOM_ROW_MIN_HEIGHT}var b=this.bottomRow.hasLeftSquareCorner(this.block_);if(b){this.bottomRow.elements.push(new Blockly.blockRendering.SquareCorner(this.constants_))}else{this.bottomRow.elements.push(new Blockly.blockRendering.RoundCorner(this.constants_))}if(this.bottomRow.hasNextConnection){this.bottomRow.connection=new Blockly.blockRendering.NextConnection(this.constants_,this.block_.nextConnection);this.bottomRow.elements.push(this.bottomRow.connection)}var c=this.bottomRow.hasRightSquareCorner(this.block_);if(c){this.bottomRow.elements.push(new Blockly.blockRendering.SquareCorner(this.constants_,"right"))}else{this.bottomRow.elements.push(new Blockly.blockRendering.RoundCorner(this.constants_,"right"))}};Blockly.blockRendering.RenderInfo.prototype.addInput_=function(a,b){if(this.isInline&&a.type==Blockly.INPUT_VALUE){b.elements.push(new Blockly.blockRendering.InlineInput(this.constants_,a));b.hasInlineInput=!0}else if(a.type==Blockly.NEXT_STATEMENT){b.elements.push(new Blockly.blockRendering.StatementInput(this.constants_,a));b.hasStatement=!0}else if(a.type==Blockly.INPUT_VALUE){b.elements.push(new Blockly.blockRendering.ExternalValueInput(this.constants_,a));b.hasExternalInput=!0}else if(a.type==Blockly.DUMMY_INPUT){b.minHeight=Math.max(b.minHeight,a.getSourceBlock()&&a.getSourceBlock().isShadow()?this.constants_.DUMMY_INPUT_SHADOW_MIN_HEIGHT:this.constants_.DUMMY_INPUT_MIN_HEIGHT);b.hasDummyInput=!0}if(null==b.align){b.align=a.align}};Blockly.blockRendering.RenderInfo.prototype.shouldStartNewRow_=function(a,b){if(!b){return!1}if(a.type==Blockly.NEXT_STATEMENT||b.type==Blockly.NEXT_STATEMENT){return!0}if(a.type==Blockly.INPUT_VALUE||a.type==Blockly.DUMMY_INPUT){return!this.isInline}return!1};Blockly.blockRendering.RenderInfo.prototype.addElemSpacing_=function(){for(var a=0,b,c;b=this.rows[a];a++){c=b.elements;b.elements=[];if(b.startsWithElemSpacer()){b.elements.push(new Blockly.blockRendering.InRowSpacer(this.constants_,this.getInRowSpacing_(null,c[0])))}if(!c.length){continue}for(var d=0;d<c.length-1;d++){b.elements.push(c[d]);var f=this.getInRowSpacing_(c[d],c[d+1]);b.elements.push(new Blockly.blockRendering.InRowSpacer(this.constants_,f))}b.elements.push(c[c.length-1]);if(b.endsWithElemSpacer()){b.elements.push(new Blockly.blockRendering.InRowSpacer(this.constants_,this.getInRowSpacing_(c[c.length-1],null)))}}};Blockly.blockRendering.RenderInfo.prototype.getInRowSpacing_=function(a,b){if(!a){if(b&&Blockly.blockRendering.Types.isStatementInput(b)){return this.constants_.STATEMENT_INPUT_PADDING_LEFT}}if(a&&Blockly.blockRendering.Types.isInput(a)&&!b){if(Blockly.blockRendering.Types.isExternalInput(a)){return this.constants_.NO_PADDING}else if(Blockly.blockRendering.Types.isInlineInput(a)){return this.constants_.LARGE_PADDING}else if(Blockly.blockRendering.Types.isStatementInput(a)){return this.constants_.NO_PADDING}}if(a&&Blockly.blockRendering.Types.isLeftSquareCorner(a)&&b){if(Blockly.blockRendering.Types.isPreviousConnection(b)||Blockly.blockRendering.Types.isNextConnection(b)){return b.notchOffset}}if(a&&Blockly.blockRendering.Types.isLeftRoundedCorner(a)&&b){if(Blockly.blockRendering.Types.isPreviousConnection(b)||Blockly.blockRendering.Types.isNextConnection(b)){return b.notchOffset-this.constants_.CORNER_RADIUS}}return this.constants_.MEDIUM_PADDING};Blockly.blockRendering.RenderInfo.prototype.computeBounds_=function(){for(var a=0,b=0,c=0,d=0,e;e=this.rows[d];d++){e.measure();b=Math.max(b,e.width);if(e.hasStatement){var f=e.getLastInput(),g=e.width-f.width;a=Math.max(a,g)}c=Math.max(c,e.widthWithConnectedBlocks)}this.statementEdge=a;this.width=b;for(var d=0,e;e=this.rows[d];d++){if(e.hasStatement){e.statementEdge=this.statementEdge}}this.widthWithChildren=Math.max(b,c);if(this.outputConnection){this.startX=this.outputConnection.width;this.width+=this.outputConnection.width;this.widthWithChildren+=this.outputConnection.width}};Blockly.blockRendering.RenderInfo.prototype.alignRowElements_=function(){for(var a=0,b;b=this.rows[a];a++){if(b.hasStatement){this.alignStatementRow_(b)}else{var c=b.width,d=this.getDesiredRowWidth_(b),e=d-c;if(0<e){this.addAlignmentPadding_(b,e)}if(Blockly.blockRendering.Types.isTopOrBottomRow(b)){b.widthWithConnectedBlocks=b.width}}}};Blockly.blockRendering.RenderInfo.prototype.getDesiredRowWidth_=function(){return this.width-this.startX};Blockly.blockRendering.RenderInfo.prototype.addAlignmentPadding_=function(a,b){var c=a.getFirstSpacer(),d=a.getLastSpacer();if(a.hasExternalInput||a.hasStatement){a.widthWithConnectedBlocks+=b}if(a.align==Blockly.ALIGN_LEFT){d.width+=b}else if(a.align==Blockly.ALIGN_CENTRE){c.width+=b/2;d.width+=b/2}else if(a.align==Blockly.ALIGN_RIGHT){c.width+=b}else{d.width+=b}a.width+=b};Blockly.blockRendering.RenderInfo.prototype.alignStatementRow_=function(a){var b=a.getLastInput(),c=a.width-b.width,d=this.statementEdge,e=d-c;if(0<e){this.addAlignmentPadding_(a,e)}c=a.width;d=this.getDesiredRowWidth_(a);b.width+=d-c;b.height=Math.max(b.height,a.height);a.width+=d-c;a.widthWithConnectedBlocks=Math.max(a.width,this.statementEdge+a.connectedBlockWidths)};Blockly.blockRendering.RenderInfo.prototype.addRowSpacing_=function(){var a=this.rows;this.rows=[];for(var b=0;b<a.length;b++){this.rows.push(a[b]);if(b!=a.length-1){this.rows.push(this.makeSpacerRow_(a[b],a[b+1]))}}};Blockly.blockRendering.RenderInfo.prototype.makeSpacerRow_=function(a,b){var c=this.getSpacerRowHeight_(a,b),d=this.getSpacerRowWidth_(a,b),e=new Blockly.blockRendering.SpacerRow(this.constants_,c,d);if(a.hasStatement){e.followsStatement=!0}if(b.hasStatement){e.precedesStatement=!0}return e};Blockly.blockRendering.RenderInfo.prototype.getSpacerRowWidth_=function(){return this.width-this.startX};Blockly.blockRendering.RenderInfo.prototype.getSpacerRowHeight_=function(){return this.constants_.MEDIUM_PADDING};Blockly.blockRendering.RenderInfo.prototype.getElemCenterline_=function(a,b){if(Blockly.blockRendering.Types.isSpacer(b)){return a.yPos+b.height/2}if(Blockly.blockRendering.Types.isBottomRow(a)){var c=a.yPos+a.height-a.descenderHeight;if(Blockly.blockRendering.Types.isNextConnection(b)){return c+b.height/2}return c-b.height/2}if(Blockly.blockRendering.Types.isTopRow(a)){if(Blockly.blockRendering.Types.isHat(b)){return a.capline-b.height/2}return a.capline+b.height/2}return a.yPos+a.height/2};Blockly.blockRendering.RenderInfo.prototype.recordElemPositions_=function(a){for(var b=a.xPos,c=0,d;d=a.elements[c];c++){if(Blockly.blockRendering.Types.isSpacer(d)){d.height=a.height}d.xPos=b;d.centerline=this.getElemCenterline_(a,d);b+=d.width}};Blockly.blockRendering.RenderInfo.prototype.finalize_=function(){for(var a=0,b=0,c=0,d;d=this.rows[c];c++){d.yPos=b;d.xPos=this.startX;b+=d.height;a=Math.max(a,d.widthWithConnectedBlocks);this.recordElemPositions_(d)}if(this.outputConnection&&this.block_.nextConnection&&this.block_.nextConnection.isConnected()){a=Math.max(a,this.block_.nextConnection.targetBlock().getHeightWidth().width)}this.widthWithChildren=a+this.startX;this.height=b;this.startY=this.topRow.capline;this.bottomRow.baseline=b-this.bottomRow.descenderHeight};
//# sourceMappingURL=info.min.js.map
