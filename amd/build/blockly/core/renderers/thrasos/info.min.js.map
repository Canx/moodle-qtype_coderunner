{"version":3,"sources":["../../../../../src/blockly/core/renderers/thrasos/info.js"],"names":["goog","provide","require","Blockly","thrasos","RenderInfo","renderer","block","superClass_","constructor","call","utils","object","inherits","blockRendering","prototype","getRenderer","renderer_","addElemSpacing_","hasExternalInputs","i","row","rows","hasExternalInput","oldElems","elements","startsWithElemSpacer","push","InRowSpacer","constants_","getInRowSpacing_","e","length","spacing","endsWithElemSpacer","hasDummyInput","TAB_WIDTH","prev","next","Types","isField","isEditable","MEDIUM_PADDING","isInlineInput","MEDIUM_LARGE_PADDING","isStatementInput","STATEMENT_INPUT_PADDING_LEFT","LARGE_PADDING","isInput","isIcon","isHat","NO_PADDING","isPreviousOrNextConnection","isLeftRoundedCorner","MIN_BLOCK_WIDTH","isJaggedEdge","isExternalInput","SMALL_PADDING","isLeftSquareCorner","isPreviousConnection","isNextConnection","notchOffset","CORNER_RADIUS","getSpacerRowHeight_","isTopRow","isBottomRow","EMPTY_BLOCK_SPACER_HEIGHT","hasStatement","BETWEEN_STATEMENT_PADDING_Y","getElemCenterline_","elem","isSpacer","yPos","height","baseline","descenderHeight","capline","result","offset","TALL_INPUT_FIELD_OFFSET_Y","finalize_","widestRowWithConnectedBlocks","yCursor","xPos","startX","Math","max","widthWithConnectedBlocks","heightWithoutHat","topRow","ascenderHeight","bottomRow","MIN_BLOCK_HEIGHT","diff","recordElemPositions_","outputConnection","block_","nextConnection","isConnected","targetBlock","getHeightWidth","width","widthWithChildren","startY"],"mappings":"AAWA,aAEAA,IAAI,CAACC,OAAL,CAAa,iBAAb,EACAD,IAAI,CAACC,OAAL,CAAa,4BAAb,EAEAD,IAAI,CAACE,OAAL,CAAa,kCAAb,EACAF,IAAI,CAACE,OAAL,CAAa,2CAAb,EACAF,IAAI,CAACE,OAAL,CAAa,oCAAb,EACAF,IAAI,CAACE,OAAL,CAAa,iCAAb,EACAF,IAAI,CAACE,OAAL,CAAa,mCAAb,EACAF,IAAI,CAACE,OAAL,CAAa,uCAAb,EACAF,IAAI,CAACE,OAAL,CAAa,yCAAb,EACAF,IAAI,CAACE,OAAL,CAAa,2CAAb,EACAF,IAAI,CAACE,OAAL,CAAa,mCAAb,EACAF,IAAI,CAACE,OAAL,CAAa,4BAAb,EACAF,IAAI,CAACE,OAAL,CAAa,kCAAb,EACAF,IAAI,CAACE,OAAL,CAAa,uCAAb,EACAF,IAAI,CAACE,OAAL,CAAa,+BAAb,EACAF,IAAI,CAACE,OAAL,CAAa,8BAAb,EACAF,IAAI,CAACE,OAAL,CAAa,sBAAb,EAgBAC,OAAO,CAACC,OAAR,CAAgBC,UAAhB,CAA6B,SAASC,CAAT,CAAmBC,CAAnB,CAA0B,CACrDJ,OAAO,CAACC,OAAR,CAAgBC,UAAhB,CAA2BG,WAA3B,CAAuCC,WAAvC,CAAmDC,IAAnD,CAAwD,IAAxD,CAA8DJ,CAA9D,CAAwEC,CAAxE,CACD,CAFD,CAGAJ,OAAO,CAACQ,KAAR,CAAcC,MAAd,CAAqBC,QAArB,CAA8BV,OAAO,CAACC,OAAR,CAAgBC,UAA9C,CACIF,OAAO,CAACW,cAAR,CAAuBT,UAD3B,EAQAF,OAAO,CAACC,OAAR,CAAgBC,UAAhB,CAA2BU,SAA3B,CAAqCC,WAArC,CAAmD,UAAW,CAC5D,MAAiD,MAAKC,SACvD,CAFD,CAOAd,OAAO,CAACC,OAAR,CAAgBC,UAAhB,CAA2BU,SAA3B,CAAqCG,eAArC,CAAuD,UAAW,CAEhE,OADIC,CAAAA,CAAiB,GACrB,CAASC,CAAC,CAAG,CAAb,CAAgBC,CAAhB,CAAsBA,CAAG,CAAG,KAAKC,IAAL,CAAUF,CAAV,CAA5B,CAA2CA,CAAC,EAA5C,CAAgD,CAC9C,GAAIC,CAAG,CAACE,gBAAR,CAA0B,CACxBJ,CAAiB,GAClB,CACF,CACD,IAAK,GAAIC,CAAAA,CAAC,CAAG,CAAR,CAAWC,CAAX,CACCG,CADN,CAAsBH,CAAG,CAAG,KAAKC,IAAL,CAAUF,CAAV,CAA5B,CAA2CA,CAAC,EAA5C,CAAgD,CAC1CI,CAD0C,CAC/BH,CAAG,CAACI,QAD2B,CAE9CJ,CAAG,CAACI,QAAJ,CAAe,EAAf,CAEA,GAAIJ,CAAG,CAACK,oBAAJ,EAAJ,CAAgC,CAE9BL,CAAG,CAACI,QAAJ,CAAaE,IAAb,CAAkB,GAAIxB,CAAAA,OAAO,CAACW,cAAR,CAAuBc,WAA3B,CACd,KAAKC,UADS,CACG,KAAKC,gBAAL,CAAsB,IAAtB,CAA4BN,CAAQ,CAAC,CAAD,CAApC,CADH,CAAlB,CAED,CACD,IAAK,GAAIO,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGP,CAAQ,CAACQ,MAAT,CAAkB,CAAtC,CAAyCD,CAAC,EAA1C,CAA8C,CAC5CV,CAAG,CAACI,QAAJ,CAAaE,IAAb,CAAkBH,CAAQ,CAACO,CAAD,CAA1B,EACA,GAAIE,CAAAA,CAAO,CAAG,KAAKH,gBAAL,CAAsBN,CAAQ,CAACO,CAAD,CAA9B,CAAmCP,CAAQ,CAACO,CAAC,CAAG,CAAL,CAA3C,CAAd,CACAV,CAAG,CAACI,QAAJ,CAAaE,IAAb,CACI,GAAIxB,CAAAA,OAAO,CAACW,cAAR,CAAuBc,WAA3B,CAAuC,KAAKC,UAA5C,CAAwDI,CAAxD,CADJ,CAED,CACDZ,CAAG,CAACI,QAAJ,CAAaE,IAAb,CAAkBH,CAAQ,CAACA,CAAQ,CAACQ,MAAT,CAAkB,CAAnB,CAA1B,EACA,GAAIX,CAAG,CAACa,kBAAJ,EAAJ,CAA8B,CAC5B,GAAID,CAAAA,CAAO,CAAG,KAAKH,gBAAL,CAAsBN,CAAQ,CAACA,CAAQ,CAACQ,MAAT,CAAkB,CAAnB,CAA9B,CAAqD,IAArD,CAAd,CACA,GAAIb,CAAiB,EAAIE,CAAG,CAACc,aAA7B,CAA4C,CAC1CF,CAAO,EAAI,KAAKJ,UAAL,CAAgBO,SAC5B,CAEDf,CAAG,CAACI,QAAJ,CAAaE,IAAb,CAAkB,GAAIxB,CAAAA,OAAO,CAACW,cAAR,CAAuBc,WAA3B,CACd,KAAKC,UADS,CACGI,CADH,CAAlB,CAED,CACF,CACF,CAjCD,CAsCA9B,OAAO,CAACC,OAAR,CAAgBC,UAAhB,CAA2BU,SAA3B,CAAqCe,gBAArC,CAAwD,SAASO,CAAT,CAAeC,CAAf,CAAqB,CAC3E,GAAI,CAACD,CAAL,CAAW,CAET,GAAIC,CAAI,EAAInC,OAAO,CAACW,cAAR,CAAuByB,KAAvB,CAA6BC,OAA7B,CAAqCF,CAArC,CAAR,EAC4CA,CAA5C,CAAmDG,UADvD,CACmE,CACjE,MAAO,MAAKZ,UAAL,CAAgBa,cACxB,CAED,GAAIJ,CAAI,EAAInC,OAAO,CAACW,cAAR,CAAuByB,KAAvB,CAA6BI,aAA7B,CAA2CL,CAA3C,CAAZ,CAA8D,CAC5D,MAAO,MAAKT,UAAL,CAAgBe,oBACxB,CACD,GAAIN,CAAI,EAAInC,OAAO,CAACW,cAAR,CAAuByB,KAAvB,CAA6BM,gBAA7B,CAA8CP,CAA9C,CAAZ,CAAiE,CAC/D,MAAO,MAAKT,UAAL,CAAgBiB,4BACxB,CAED,MAAO,MAAKjB,UAAL,CAAgBkB,aACxB,CAGD,GAAI,CAAC5C,OAAO,CAACW,cAAR,CAAuByB,KAAvB,CAA6BS,OAA7B,CAAqCX,CAArC,CAAD,EAA+C,CAACC,CAApD,CAA0D,CAExD,GAAInC,OAAO,CAACW,cAAR,CAAuByB,KAAvB,CAA6BC,OAA7B,CAAqCH,CAArC,GAC4CA,CAA5C,CAAmDI,UADvD,CACmE,CACjE,MAAO,MAAKZ,UAAL,CAAgBa,cACxB,CAED,GAAIvC,OAAO,CAACW,cAAR,CAAuByB,KAAvB,CAA6BU,MAA7B,CAAoCZ,CAApC,CAAJ,CAA+C,CAC7C,MAAwC,EAAhC,MAAKR,UAAL,CAAgBkB,aAAjB,CAAsC,CAC9C,CACD,GAAI5C,OAAO,CAACW,cAAR,CAAuByB,KAAvB,CAA6BW,KAA7B,CAAmCb,CAAnC,CAAJ,CAA8C,CAC5C,MAAO,MAAKR,UAAL,CAAgBsB,UACxB,CAED,GAAIhD,OAAO,CAACW,cAAR,CAAuByB,KAAvB,CAA6Ba,0BAA7B,CAAwDf,CAAxD,CAAJ,CAAmE,CACjE,MAAO,MAAKR,UAAL,CAAgBkB,aACxB,CAED,GAAI5C,OAAO,CAACW,cAAR,CAAuByB,KAAvB,CAA6Bc,mBAA7B,CAAiDhB,CAAjD,CAAJ,CAA4D,CAC1D,MAAO,MAAKR,UAAL,CAAgByB,eACxB,CAED,GAAInD,OAAO,CAACW,cAAR,CAAuByB,KAAvB,CAA6BgB,YAA7B,CAA0ClB,CAA1C,CAAJ,CAAqD,CACnD,MAAO,MAAKR,UAAL,CAAgBsB,UACxB,CAED,MAAO,MAAKtB,UAAL,CAAgBkB,aACxB,CAGD,GAAI5C,OAAO,CAACW,cAAR,CAAuByB,KAAvB,CAA6BS,OAA7B,CAAqCX,CAArC,GAA8C,CAACC,CAAnD,CAAyD,CACvD,GAAInC,OAAO,CAACW,cAAR,CAAuByB,KAAvB,CAA6BiB,eAA7B,CAA6CnB,CAA7C,CAAJ,CAAwD,CACtD,MAAO,MAAKR,UAAL,CAAgBsB,UACxB,CAFD,IAEO,IAAIhD,OAAO,CAACW,cAAR,CAAuByB,KAAvB,CAA6BI,aAA7B,CAA2CN,CAA3C,CAAJ,CAAsD,CAC3D,MAAO,MAAKR,UAAL,CAAgBkB,aACxB,CAFM,IAEA,IAAI5C,OAAO,CAACW,cAAR,CAAuByB,KAAvB,CAA6BM,gBAA7B,CAA8CR,CAA9C,CAAJ,CAAyD,CAC9D,MAAO,MAAKR,UAAL,CAAgBsB,UACxB,CACF,CAGD,GAAI,CAAChD,OAAO,CAACW,cAAR,CAAuByB,KAAvB,CAA6BS,OAA7B,CAAqCX,CAArC,CAAD,EACAC,CADA,EACQnC,OAAO,CAACW,cAAR,CAAuByB,KAAvB,CAA6BS,OAA7B,CAAqCV,CAArC,CADZ,CACwD,CAEtD,GAAInC,OAAO,CAACW,cAAR,CAAuByB,KAAvB,CAA6BC,OAA7B,CAAqCH,CAArC,GAC4CA,CAA5C,CAAmDI,UADvD,CACmE,CACjE,GAAItC,OAAO,CAACW,cAAR,CAAuByB,KAAvB,CAA6BI,aAA7B,CAA2CL,CAA3C,CAAJ,CAAsD,CACpD,MAAO,MAAKT,UAAL,CAAgB4B,aACxB,CAFD,IAEO,IAAItD,OAAO,CAACW,cAAR,CAAuByB,KAAvB,CAA6BiB,eAA7B,CAA6ClB,CAA7C,CAAJ,CAAwD,CAC7D,MAAO,MAAKT,UAAL,CAAgB4B,aACxB,CACF,CAPD,IAOO,CACL,GAAItD,OAAO,CAACW,cAAR,CAAuByB,KAAvB,CAA6BI,aAA7B,CAA2CL,CAA3C,CAAJ,CAAsD,CACpD,MAAO,MAAKT,UAAL,CAAgBe,oBACxB,CAFD,IAEO,IAAIzC,OAAO,CAACW,cAAR,CAAuByB,KAAvB,CAA6BiB,eAA7B,CAA6ClB,CAA7C,CAAJ,CAAwD,CAC7D,MAAO,MAAKT,UAAL,CAAgBe,oBACxB,CAFM,IAEA,IAAIzC,OAAO,CAACW,cAAR,CAAuByB,KAAvB,CAA6BM,gBAA7B,CAA8CP,CAA9C,CAAJ,CAAyD,CAC9D,MAAO,MAAKT,UAAL,CAAgBkB,aACxB,CACF,CACD,MAAO,MAAKlB,UAAL,CAAgBkB,aAAhB,CAAgC,CACxC,CAGD,GAAI5C,OAAO,CAACW,cAAR,CAAuByB,KAAvB,CAA6BU,MAA7B,CAAoCZ,CAApC,GACAC,CADA,EACQ,CAACnC,OAAO,CAACW,cAAR,CAAuByB,KAAvB,CAA6BS,OAA7B,CAAqCV,CAArC,CADb,CACyD,CACvD,MAAO,MAAKT,UAAL,CAAgBkB,aACxB,CAGD,GAAI5C,OAAO,CAACW,cAAR,CAAuByB,KAAvB,CAA6BI,aAA7B,CAA2CN,CAA3C,GACAC,CADA,EACQnC,OAAO,CAACW,cAAR,CAAuByB,KAAvB,CAA6BC,OAA7B,CAAqCF,CAArC,CADZ,CACwD,CAEtD,GAAgDA,CAA5C,CAAmDG,UAAvD,CAAmE,CACjE,MAAO,MAAKZ,UAAL,CAAgBa,cACxB,CAFD,IAEO,CAEL,MAAO,MAAKb,UAAL,CAAgBkB,aACxB,CACF,CAED,GAAI5C,OAAO,CAACW,cAAR,CAAuByB,KAAvB,CAA6BmB,kBAA7B,CAAgDrB,CAAhD,GAAyDC,CAA7D,CAAmE,CAEjE,GAAInC,OAAO,CAACW,cAAR,CAAuByB,KAAvB,CAA6BW,KAA7B,CAAmCZ,CAAnC,CAAJ,CAA8C,CAC5C,MAAO,MAAKT,UAAL,CAAgBsB,UACxB,CAED,GAAIhD,OAAO,CAACW,cAAR,CAAuByB,KAAvB,CAA6BoB,oBAA7B,CAAkDrB,CAAlD,GACAnC,OAAO,CAACW,cAAR,CAAuByB,KAAvB,CAA6BqB,gBAA7B,CAA8CtB,CAA9C,CADJ,CACyD,CACvD,MAAOA,CAAAA,CAAI,CAACuB,WACb,CACF,CAGD,GAAI1D,OAAO,CAACW,cAAR,CAAuByB,KAAvB,CAA6Bc,mBAA7B,CAAiDhB,CAAjD,GAA0DC,CAA9D,CAAoE,CAClE,MAAOA,CAAAA,CAAI,CAACuB,WAAL,CAAmB,KAAKhC,UAAL,CAAgBiC,aAC3C,CAGD,GAAI3D,OAAO,CAACW,cAAR,CAAuByB,KAAvB,CAA6BC,OAA7B,CAAqCH,CAArC,GACAC,CADA,EACQnC,OAAO,CAACW,cAAR,CAAuByB,KAAvB,CAA6BC,OAA7B,CAAqCF,CAArC,CADR,EAE6CD,CAA5C,CAAmDI,UAAnD,EAC+CH,CAA5C,CAAmDG,UAH3D,CAGwE,CACtE,MAAO,MAAKZ,UAAL,CAAgBkB,aACxB,CAGD,GAAIT,CAAI,EAAInC,OAAO,CAACW,cAAR,CAAuByB,KAAvB,CAA6BgB,YAA7B,CAA0CjB,CAA1C,CAAZ,CAA6D,CAC3D,MAAO,MAAKT,UAAL,CAAgBkB,aACxB,CAED,MAAO,MAAKlB,UAAL,CAAgBa,cACxB,CAnID,CAwIAvC,OAAO,CAACC,OAAR,CAAgBC,UAAhB,CAA2BU,SAA3B,CAAqCgD,mBAArC,CAA2D,SACvD1B,CADuD,CACjDC,CADiD,CAC3C,CAEd,GAAInC,OAAO,CAACW,cAAR,CAAuByB,KAAvB,CAA6ByB,QAA7B,CAAsC3B,CAAtC,GACAlC,OAAO,CAACW,cAAR,CAAuByB,KAAvB,CAA6B0B,WAA7B,CAAyC3B,CAAzC,CADJ,CACoD,CAClD,MAAO,MAAKT,UAAL,CAAgBqC,yBACxB,CAED,GAAI/D,OAAO,CAACW,cAAR,CAAuByB,KAAvB,CAA6ByB,QAA7B,CAAsC3B,CAAtC,GACAlC,OAAO,CAACW,cAAR,CAAuByB,KAAvB,CAA6B0B,WAA7B,CAAyC3B,CAAzC,CADJ,CACoD,CAClD,MAAO,MAAKT,UAAL,CAAgBsB,UACxB,CACD,GAAId,CAAI,CAACd,gBAAL,EAAyBe,CAAI,CAACf,gBAAlC,CAAoD,CAClD,MAAO,MAAKM,UAAL,CAAgBkB,aACxB,CACD,GAAI,CAACV,CAAI,CAAC8B,YAAN,EAAsB7B,CAAI,CAAC6B,YAA/B,CAA6C,CAC3C,MAAO,MAAKtC,UAAL,CAAgBuC,2BACxB,CACD,GAAI/B,CAAI,CAAC8B,YAAL,EAAqB7B,CAAI,CAAC6B,YAA9B,CAA4C,CAC1C,MAAO,MAAKtC,UAAL,CAAgBkB,aACxB,CACD,GAAIV,CAAI,CAACF,aAAL,EAAsBG,CAAI,CAACH,aAA/B,CAA8C,CAC5C,MAAO,MAAKN,UAAL,CAAgBkB,aACxB,CACD,MAAO,MAAKlB,UAAL,CAAgBa,cACxB,CAzBD,CA8BAvC,OAAO,CAACC,OAAR,CAAgBC,UAAhB,CAA2BU,SAA3B,CAAqCsD,kBAArC,CAA0D,SAAShD,CAAT,CAAciD,CAAd,CAAoB,CAC5E,GAAInE,OAAO,CAACW,cAAR,CAAuByB,KAAvB,CAA6BgC,QAA7B,CAAsCD,CAAtC,CAAJ,CAAiD,CAC/C,MAAOjD,CAAAA,CAAG,CAACmD,IAAJ,CAAWF,CAAI,CAACG,MAAL,CAAc,CACjC,CACD,GAAItE,OAAO,CAACW,cAAR,CAAuByB,KAAvB,CAA6B0B,WAA7B,CAAyC5C,CAAzC,CAAJ,CAAmD,CACjD,GAAIqD,CAAAA,CAAQ,CAAGrD,CAAG,CAACmD,IAAJ,CAAWnD,CAAG,CAACoD,MAAf,CAAwBpD,CAAG,CAACsD,eAA3C,CACA,GAAIxE,OAAO,CAACW,cAAR,CAAuByB,KAAvB,CAA6BqB,gBAA7B,CAA8CU,CAA9C,CAAJ,CAAyD,CACvD,MAAOI,CAAAA,CAAQ,CAAGJ,CAAI,CAACG,MAAL,CAAc,CACjC,CACD,MAAOC,CAAAA,CAAQ,CAAGJ,CAAI,CAACG,MAAL,CAAc,CACjC,CACD,GAAItE,OAAO,CAACW,cAAR,CAAuByB,KAAvB,CAA6ByB,QAA7B,CAAsC3C,CAAtC,CAAJ,CAAgD,CAC9C,GAAIlB,OAAO,CAACW,cAAR,CAAuByB,KAAvB,CAA6BW,KAA7B,CAAmCoB,CAAnC,CAAJ,CAA8C,CAC5C,MAAOjD,CAAAA,CAAG,CAACuD,OAAJ,CAAcN,CAAI,CAACG,MAAL,CAAc,CACpC,CACD,MAAOpD,CAAAA,CAAG,CAACuD,OAAJ,CAAcN,CAAI,CAACG,MAAL,CAAc,CACpC,CAED,GAAII,CAAAA,CAAM,CAAGxD,CAAG,CAACmD,IAAjB,CACA,GAAIrE,OAAO,CAACW,cAAR,CAAuByB,KAAvB,CAA6BC,OAA7B,CAAqC8B,CAArC,GAA8CjD,CAAG,CAAC8C,YAAtD,CAAoE,CAClE,GAAIW,CAAAA,CAAM,CAAG,KAAKjD,UAAL,CAAgBkD,yBAAhB,CACTT,CAAI,CAACG,MAAL,CAAc,CADlB,CAEAI,CAAM,EAAIC,CACX,CAJD,IAIO,CACLD,CAAM,EAAKxD,CAAG,CAACoD,MAAJ,CAAa,CACzB,CACD,MAAOI,CAAAA,CACR,CA3BD,CAgCA1E,OAAO,CAACC,OAAR,CAAgBC,UAAhB,CAA2BU,SAA3B,CAAqCiE,SAArC,CAAiD,UAAW,CAM1D,OAFIC,CAAAA,CAA4B,CAAG,CAEnC,CADIC,CAAO,CAAG,CACd,CAAS9D,CAAC,CAAG,CAAb,CAAgBC,CAAhB,CAAsBA,CAAG,CAAG,KAAKC,IAAL,CAAUF,CAAV,CAA5B,CAA2CA,CAAC,EAA5C,CAAgD,CAC9CC,CAAG,CAACmD,IAAJ,CAAWU,CAAX,CACA7D,CAAG,CAAC8D,IAAJ,CAAW,KAAKC,MAAhB,CACAF,CAAO,EAAI7D,CAAG,CAACoD,MAAf,CAEAQ,CAA4B,CACxBI,IAAI,CAACC,GAAL,CAASL,CAAT,CAAuC5D,CAAG,CAACkE,wBAA3C,CADJ,CAGA,GAAIC,CAAAA,CAAgB,CAAGN,CAAO,CAAG,KAAKO,MAAL,CAAYC,cAA7C,CACA,GAAIrE,CAAG,EAAI,KAAKsE,SAAZ,EACAH,CAAgB,CAAG,KAAK3D,UAAL,CAAgB+D,gBADvC,CACyD,CAEvD,GAAIC,CAAAA,CAAI,CAAG,KAAKhE,UAAL,CAAgB+D,gBAAhB,CAAmCJ,CAA9C,CACA,KAAKG,SAAL,CAAelB,MAAf,EAAyBoB,CAAzB,CACAX,CAAO,EAAIW,CACZ,CACD,KAAKC,oBAAL,CAA0BzE,CAA1B,CACD,CACD,GAAI,KAAK0E,gBAAL,EAAyB,KAAKC,MAAL,CAAYC,cAArC,EACA,KAAKD,MAAL,CAAYC,cAAZ,CAA2BC,WAA3B,EADJ,CAC8C,CAE5CjB,CAA4B,CACxBI,IAAI,CAACC,GAAL,CAASL,CAAT,CACI,KAAKe,MAAL,CAAYC,cAAZ,CAA2BE,WAA3B,GAAyCC,cAAzC,GAA0DC,KAD9D,CAEL,CAED,KAAKV,SAAL,CAAejB,QAAf,CAA0BQ,CAAO,CAAG,KAAKS,SAAL,CAAehB,eAAnD,CACA,KAAK2B,iBAAL,CAAyBrB,CAA4B,CAAG,KAAKG,MAA7D,CAEA,KAAKX,MAAL,CAAcS,CAAd,CACA,KAAKqB,MAAL,CAAc,KAAKd,MAAL,CAAYb,OAC3B,CArCD","sourcesContent":["/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview New (evolving) renderer.\n * Thrasos: spirit of boldness.\n * @author fenichel@google.com (Rachel Fenichel)\n */\n'use strict';\n\ngoog.provide('Blockly.thrasos');\ngoog.provide('Blockly.thrasos.RenderInfo');\n\ngoog.require('Blockly.blockRendering.BottomRow');\ngoog.require('Blockly.blockRendering.ExternalValueInput');\ngoog.require('Blockly.blockRendering.InlineInput');\ngoog.require('Blockly.blockRendering.InputRow');\ngoog.require('Blockly.blockRendering.Measurable');\ngoog.require('Blockly.blockRendering.NextConnection');\ngoog.require('Blockly.blockRendering.OutputConnection');\ngoog.require('Blockly.blockRendering.PreviousConnection');\ngoog.require('Blockly.blockRendering.RenderInfo');\ngoog.require('Blockly.blockRendering.Row');\ngoog.require('Blockly.blockRendering.SpacerRow');\ngoog.require('Blockly.blockRendering.StatementInput');\ngoog.require('Blockly.blockRendering.TopRow');\ngoog.require('Blockly.blockRendering.Types');\ngoog.require('Blockly.utils.object');\n\n\n/**\n * An object containing all sizing information needed to draw this block.\n *\n * This measure pass does not propagate changes to the block (although fields\n * may choose to rerender when getSize() is called).  However, calling it\n * repeatedly may be expensive.\n *\n * @param {!Blockly.thrasos.Renderer} renderer The renderer in use.\n * @param {!Blockly.BlockSvg} block The block to measure.\n * @constructor\n * @package\n * @extends {Blockly.blockRendering.RenderInfo}\n */\nBlockly.thrasos.RenderInfo = function(renderer, block) {\n  Blockly.thrasos.RenderInfo.superClass_.constructor.call(this, renderer, block);\n};\nBlockly.utils.object.inherits(Blockly.thrasos.RenderInfo,\n    Blockly.blockRendering.RenderInfo);\n\n/**\n * Get the block renderer in use.\n * @return {!Blockly.thrasos.Renderer} The block renderer in use.\n * @package\n */\nBlockly.thrasos.RenderInfo.prototype.getRenderer = function() {\n  return /** @type {!Blockly.thrasos.Renderer} */ (this.renderer_);\n};\n\n/**\n * @override\n */\nBlockly.thrasos.RenderInfo.prototype.addElemSpacing_ = function() {\n  var hasExternalInputs = false;\n  for (var i = 0, row; (row = this.rows[i]); i++) {\n    if (row.hasExternalInput) {\n      hasExternalInputs = true;\n    }\n  }\n  for (var i = 0, row; (row = this.rows[i]); i++) {\n    var oldElems = row.elements;\n    row.elements = [];\n    // No spacing needed before the corner on the top row or the bottom row.\n    if (row.startsWithElemSpacer()) {\n      // There's a spacer before the first element in the row.\n      row.elements.push(new Blockly.blockRendering.InRowSpacer(\n          this.constants_, this.getInRowSpacing_(null, oldElems[0])));\n    }\n    for (var e = 0; e < oldElems.length - 1; e++) {\n      row.elements.push(oldElems[e]);\n      var spacing = this.getInRowSpacing_(oldElems[e], oldElems[e + 1]);\n      row.elements.push(\n          new Blockly.blockRendering.InRowSpacer(this.constants_, spacing));\n    }\n    row.elements.push(oldElems[oldElems.length - 1]);\n    if (row.endsWithElemSpacer()) {\n      var spacing = this.getInRowSpacing_(oldElems[oldElems.length - 1], null);\n      if (hasExternalInputs && row.hasDummyInput) {\n        spacing += this.constants_.TAB_WIDTH;\n      }\n      // There's a spacer after the last element in the row.\n      row.elements.push(new Blockly.blockRendering.InRowSpacer(\n          this.constants_, spacing));\n    }\n  }\n};\n\n/**\n * @override\n */\nBlockly.thrasos.RenderInfo.prototype.getInRowSpacing_ = function(prev, next) {\n  if (!prev) {\n    // Between an editable field and the beginning of the row.\n    if (next && Blockly.blockRendering.Types.isField(next) &&\n        (/** @type Blockly.blockRendering.Field */ (next)).isEditable) {\n      return this.constants_.MEDIUM_PADDING;\n    }\n    // Inline input at the beginning of the row.\n    if (next && Blockly.blockRendering.Types.isInlineInput(next)) {\n      return this.constants_.MEDIUM_LARGE_PADDING;\n    }\n    if (next && Blockly.blockRendering.Types.isStatementInput(next)) {\n      return this.constants_.STATEMENT_INPUT_PADDING_LEFT;\n    }\n    // Anything else at the beginning of the row.\n    return this.constants_.LARGE_PADDING;\n  }\n\n  // Spacing between a non-input and the end of the row.\n  if (!Blockly.blockRendering.Types.isInput(prev) && !next) {\n    // Between an editable field and the end of the row.\n    if (Blockly.blockRendering.Types.isField(prev) &&\n        (/** @type Blockly.blockRendering.Field */ (prev)).isEditable) {\n      return this.constants_.MEDIUM_PADDING;\n    }\n    // Padding at the end of an icon-only row to make the block shape clearer.\n    if (Blockly.blockRendering.Types.isIcon(prev)) {\n      return (this.constants_.LARGE_PADDING * 2) + 1;\n    }\n    if (Blockly.blockRendering.Types.isHat(prev)) {\n      return this.constants_.NO_PADDING;\n    }\n    // Establish a minimum width for a block with a previous or next connection.\n    if (Blockly.blockRendering.Types.isPreviousOrNextConnection(prev)) {\n      return this.constants_.LARGE_PADDING;\n    }\n    // Between rounded corner and the end of the row.\n    if (Blockly.blockRendering.Types.isLeftRoundedCorner(prev)) {\n      return this.constants_.MIN_BLOCK_WIDTH;\n    }\n    // Between a jagged edge and the end of the row.\n    if (Blockly.blockRendering.Types.isJaggedEdge(prev)) {\n      return this.constants_.NO_PADDING;\n    }\n    // Between noneditable fields and icons and the end of the row.\n    return this.constants_.LARGE_PADDING;\n  }\n\n  // Between inputs and the end of the row.\n  if (Blockly.blockRendering.Types.isInput(prev) && !next) {\n    if (Blockly.blockRendering.Types.isExternalInput(prev)) {\n      return this.constants_.NO_PADDING;\n    } else if (Blockly.blockRendering.Types.isInlineInput(prev)) {\n      return this.constants_.LARGE_PADDING;\n    } else if (Blockly.blockRendering.Types.isStatementInput(prev)) {\n      return this.constants_.NO_PADDING;\n    }\n  }\n\n  // Spacing between a non-input and an input.\n  if (!Blockly.blockRendering.Types.isInput(prev) &&\n      next && Blockly.blockRendering.Types.isInput(next)) {\n    // Between an editable field and an input.\n    if (Blockly.blockRendering.Types.isField(prev) &&\n        (/** @type Blockly.blockRendering.Field */ (prev)).isEditable) {\n      if (Blockly.blockRendering.Types.isInlineInput(next)) {\n        return this.constants_.SMALL_PADDING;\n      } else if (Blockly.blockRendering.Types.isExternalInput(next)) {\n        return this.constants_.SMALL_PADDING;\n      }\n    } else {\n      if (Blockly.blockRendering.Types.isInlineInput(next)) {\n        return this.constants_.MEDIUM_LARGE_PADDING;\n      } else if (Blockly.blockRendering.Types.isExternalInput(next)) {\n        return this.constants_.MEDIUM_LARGE_PADDING;\n      } else if (Blockly.blockRendering.Types.isStatementInput(next)) {\n        return this.constants_.LARGE_PADDING;\n      }\n    }\n    return this.constants_.LARGE_PADDING - 1;\n  }\n\n  // Spacing between an icon and an icon or field.\n  if (Blockly.blockRendering.Types.isIcon(prev) &&\n      next && !Blockly.blockRendering.Types.isInput(next)) {\n    return this.constants_.LARGE_PADDING;\n  }\n\n  // Spacing between an inline input and a field.\n  if (Blockly.blockRendering.Types.isInlineInput(prev) &&\n      next && Blockly.blockRendering.Types.isField(next)) {\n    // Editable field after inline input.\n    if ((/** @type Blockly.blockRendering.Field */ (next)).isEditable) {\n      return this.constants_.MEDIUM_PADDING;\n    } else {\n      // Noneditable field after inline input.\n      return this.constants_.LARGE_PADDING;\n    }\n  }\n\n  if (Blockly.blockRendering.Types.isLeftSquareCorner(prev) && next) {\n    // Spacing between a hat and a corner\n    if (Blockly.blockRendering.Types.isHat(next)) {\n      return this.constants_.NO_PADDING;\n    }\n    // Spacing between a square corner and a previous or next connection\n    if (Blockly.blockRendering.Types.isPreviousConnection(next) ||\n        Blockly.blockRendering.Types.isNextConnection(next)) {\n      return next.notchOffset;\n    }\n  }\n\n  // Spacing between a rounded corner and a previous or next connection.\n  if (Blockly.blockRendering.Types.isLeftRoundedCorner(prev) && next) {\n    return next.notchOffset - this.constants_.CORNER_RADIUS;\n  }\n\n  // Spacing between two fields of the same editability.\n  if (Blockly.blockRendering.Types.isField(prev) &&\n      next && Blockly.blockRendering.Types.isField(next) &&\n      ((/** @type Blockly.blockRendering.Field */ (prev)).isEditable ==\n          (/** @type Blockly.blockRendering.Field */ (next)).isEditable)) {\n    return this.constants_.LARGE_PADDING;\n  }\n\n  // Spacing between anything and a jagged edge.\n  if (next && Blockly.blockRendering.Types.isJaggedEdge(next)) {\n    return this.constants_.LARGE_PADDING;\n  }\n\n  return this.constants_.MEDIUM_PADDING;\n};\n\n/**\n * @override\n */\nBlockly.thrasos.RenderInfo.prototype.getSpacerRowHeight_ = function(\n    prev, next) {\n  // If we have an empty block add a spacer to increase the height.\n  if (Blockly.blockRendering.Types.isTopRow(prev) &&\n      Blockly.blockRendering.Types.isBottomRow(next)) {\n    return this.constants_.EMPTY_BLOCK_SPACER_HEIGHT;\n  }\n  // Top and bottom rows act as a spacer so we don't need any extra padding.\n  if (Blockly.blockRendering.Types.isTopRow(prev) ||\n      Blockly.blockRendering.Types.isBottomRow(next)) {\n    return this.constants_.NO_PADDING;\n  }\n  if (prev.hasExternalInput && next.hasExternalInput) {\n    return this.constants_.LARGE_PADDING;\n  }\n  if (!prev.hasStatement && next.hasStatement) {\n    return this.constants_.BETWEEN_STATEMENT_PADDING_Y;\n  }\n  if (prev.hasStatement && next.hasStatement) {\n    return this.constants_.LARGE_PADDING;\n  }\n  if (prev.hasDummyInput || next.hasDummyInput) {\n    return this.constants_.LARGE_PADDING;\n  }\n  return this.constants_.MEDIUM_PADDING;\n};\n\n/**\n * @override\n */\nBlockly.thrasos.RenderInfo.prototype.getElemCenterline_ = function(row, elem) {\n  if (Blockly.blockRendering.Types.isSpacer(elem)) {\n    return row.yPos + elem.height / 2;\n  }\n  if (Blockly.blockRendering.Types.isBottomRow(row)) {\n    var baseline = row.yPos + row.height - row.descenderHeight;\n    if (Blockly.blockRendering.Types.isNextConnection(elem)) {\n      return baseline + elem.height / 2;\n    }\n    return baseline - elem.height / 2;\n  }\n  if (Blockly.blockRendering.Types.isTopRow(row)) {\n    if (Blockly.blockRendering.Types.isHat(elem)) {\n      return row.capline - elem.height / 2;\n    }\n    return row.capline + elem.height / 2;\n  }\n\n  var result = row.yPos;\n  if (Blockly.blockRendering.Types.isField(elem) && row.hasStatement) {\n    var offset = this.constants_.TALL_INPUT_FIELD_OFFSET_Y +\n        elem.height / 2;\n    result += offset;\n  } else {\n    result += (row.height / 2);\n  }\n  return result;\n};\n\n/**\n * @override\n */\nBlockly.thrasos.RenderInfo.prototype.finalize_ = function() {\n  // Performance note: this could be combined with the draw pass, if the time\n  // that this takes is excessive.  But it shouldn't be, because it only\n  // accesses and sets properties that already exist on the objects.\n  var widestRowWithConnectedBlocks = 0;\n  var yCursor = 0;\n  for (var i = 0, row; (row = this.rows[i]); i++) {\n    row.yPos = yCursor;\n    row.xPos = this.startX;\n    yCursor += row.height;\n\n    widestRowWithConnectedBlocks =\n        Math.max(widestRowWithConnectedBlocks, row.widthWithConnectedBlocks);\n    // Add padding to the bottom row if block height is less than minimum\n    var heightWithoutHat = yCursor - this.topRow.ascenderHeight;\n    if (row == this.bottomRow &&\n        heightWithoutHat < this.constants_.MIN_BLOCK_HEIGHT) {\n      // But the hat height shouldn't be part of this.\n      var diff = this.constants_.MIN_BLOCK_HEIGHT - heightWithoutHat;\n      this.bottomRow.height += diff;\n      yCursor += diff;\n    }\n    this.recordElemPositions_(row);\n  }\n  if (this.outputConnection && this.block_.nextConnection &&\n      this.block_.nextConnection.isConnected()) {\n    // Include width of connected block in value to stack width measurement.\n    widestRowWithConnectedBlocks =\n        Math.max(widestRowWithConnectedBlocks,\n            this.block_.nextConnection.targetBlock().getHeightWidth().width);\n  }\n\n  this.bottomRow.baseline = yCursor - this.bottomRow.descenderHeight;\n  this.widthWithChildren = widestRowWithConnectedBlocks + this.startX;\n\n  this.height = yCursor;\n  this.startY = this.topRow.capline;\n};\n"],"file":"info.min.js"}