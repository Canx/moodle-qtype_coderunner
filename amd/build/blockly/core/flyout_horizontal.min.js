'use strict';goog.provide("Blockly.HorizontalFlyout");goog.require("Blockly.Block");goog.require("Blockly.Flyout");goog.require("Blockly.Scrollbar");goog.require("Blockly.utils");goog.require("Blockly.utils.object");goog.require("Blockly.utils.Rect");goog.require("Blockly.WidgetDiv");goog.requireType("Blockly.utils.Metrics");Blockly.HorizontalFlyout=function(a){Blockly.HorizontalFlyout.superClass_.constructor.call(this,a);this.horizontalLayout=!0};Blockly.utils.object.inherits(Blockly.HorizontalFlyout,Blockly.Flyout);Blockly.HorizontalFlyout.prototype.getMetrics_=function(){if(!this.isVisible()){return null}try{var a=this.workspace_.getCanvas().getBBox()}catch(b){var a={height:0,y:0,width:0,x:0}}var b=this.SCROLLBAR_PADDING,c=this.SCROLLBAR_PADDING;if(this.toolboxPosition_==Blockly.TOOLBOX_AT_BOTTOM){b=0}var d=this.height_;if(this.toolboxPosition_==Blockly.TOOLBOX_AT_TOP){d-=this.SCROLLBAR_PADDING}var e=this.width_-2*this.SCROLLBAR_PADDING,f={contentHeight:(a.height+2*this.MARGIN)*this.workspace_.scale,contentWidth:(a.width+2*this.MARGIN)*this.workspace_.scale,contentTop:0,contentLeft:0,viewHeight:d,viewWidth:e,viewTop:-this.workspace_.scrollY,viewLeft:-this.workspace_.scrollX,absoluteTop:b,absoluteLeft:c};return f};Blockly.HorizontalFlyout.prototype.setMetrics_=function(a){var b=this.getMetrics_();if(!b){return}if("number"==typeof a.x){this.workspace_.scrollX=-b.contentWidth*a.x}this.workspace_.translate(this.workspace_.scrollX+b.absoluteLeft,this.workspace_.scrollY+b.absoluteTop)};Blockly.HorizontalFlyout.prototype.position=function(){if(!this.isVisible()){return}var a=this.targetWorkspace.getMetrics();if(!a){return}this.width_=a.viewWidth;var b=a.viewWidth-2*this.CORNER_RADIUS,c=this.height_-this.CORNER_RADIUS;this.setBackgroundPath_(b,c);if(this.targetWorkspace.toolboxPosition==this.toolboxPosition_){if(a.toolboxHeight){if(this.toolboxPosition_==Blockly.TOOLBOX_AT_TOP){var d=a.toolboxHeight}else{var d=a.viewHeight-this.height_}}else{if(this.toolboxPosition_==Blockly.TOOLBOX_AT_TOP){var d=0}else{var d=a.viewHeight}}}else{if(this.toolboxPosition_==Blockly.TOOLBOX_AT_TOP){var d=0}else{var d=a.viewHeight+a.absoluteTop-this.height_}}this.positionAt_(this.width_,this.height_,0,d)};Blockly.HorizontalFlyout.prototype.setBackgroundPath_=function(a,b){var c=this.toolboxPosition_==Blockly.TOOLBOX_AT_TOP,d=["M 0,"+(c?0:this.CORNER_RADIUS)];if(c){d.push("h",a+2*this.CORNER_RADIUS);d.push("v",b);d.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,-this.CORNER_RADIUS,this.CORNER_RADIUS);d.push("h",-a);d.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,-this.CORNER_RADIUS,-this.CORNER_RADIUS);d.push("z")}else{d.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,this.CORNER_RADIUS,-this.CORNER_RADIUS);d.push("h",a);d.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,this.CORNER_RADIUS,this.CORNER_RADIUS);d.push("v",b);d.push("h",-a-2*this.CORNER_RADIUS);d.push("z")}this.svgBackground_.setAttribute("d",d.join(" "))};Blockly.HorizontalFlyout.prototype.scrollToStart=function(){this.scrollbar.set(this.RTL?1/0:0)};Blockly.HorizontalFlyout.prototype.wheel_=function(a){var b=Blockly.utils.getScrollDeltaPixels(a),c=b.x||b.y;if(c){var d=this.getMetrics_(),e=d.viewLeft+c,f=d.contentWidth-d.viewWidth;e=Math.min(e,f);e=Math.max(e,0);this.scrollbar.set(e);Blockly.WidgetDiv.hide();Blockly.DropDownDiv.hideWithoutAnimation()}a.preventDefault();a.stopPropagation()};Blockly.HorizontalFlyout.prototype.layout_=function(a,b){this.workspace_.scale=this.targetWorkspace.scale;var c=this.MARGIN,d=c+this.tabWidth_,e=c;if(this.RTL){a=a.reverse()}for(var f=0,g;g=a[f];f++){if("block"==g.type){for(var h=g.block,k=h.getDescendants(!1),l=0,m;m=k[l];l++){m.isInFlyout=!0}h.render();var n=h.getSvgRoot(),o=h.getHeightWidth(),p=h.outputConnection?this.tabWidth_:0;if(this.RTL){var q=d+o.width}else{var q=d-p}h.moveBy(q,e);var r=this.createRect_(h,q,e,o,f);d+=o.width+b[f];this.addBlockListeners_(n,h,r)}else if("button"==g.type){this.initFlyoutButton_(g.button,d,e);d+=g.button.width+b[f]}}};Blockly.HorizontalFlyout.prototype.isDragTowardWorkspace=function(a){var b=a.x,c=a.y,d=180*(Math.atan2(c,b)/Math.PI),e=this.dragAngleRange_;if(d<90+e&&d>90-e||d>-90-e&&d<-90+e){return!0}return!1};Blockly.HorizontalFlyout.prototype.getClientRect=function(){if(!this.svgGroup_){return null}var a=this.svgGroup_.getBoundingClientRect(),b=1e9,c=a.top;if(this.toolboxPosition_==Blockly.TOOLBOX_AT_TOP){var d=a.height;return new Blockly.utils.Rect(-b,c+d,-b,b)}else{return new Blockly.utils.Rect(c,b,-b,b)}};Blockly.HorizontalFlyout.prototype.reflowInternal_=function(){this.workspace_.scale=this.targetWorkspace.scale;for(var a=0,b=this.workspace_.getTopBlocks(!1),c=0,d;d=b[c];c++){a=Math.max(a,d.getHeightWidth().height)}a+=1.5*this.MARGIN;a*=this.workspace_.scale;a+=Blockly.Scrollbar.scrollbarThickness;if(this.height_!=a){for(var c=0,d;d=b[c];c++){if(d.flyoutRect_){this.moveRectToBlock_(d.flyoutRect_,d)}}this.height_=a;this.position()}};
//# sourceMappingURL=flyout_horizontal.min.js.map
