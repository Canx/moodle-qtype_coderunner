'use strict';goog.provide("Blockly.WorkspaceCommentSvg");goog.require("Blockly.Css");goog.require("Blockly.Events");goog.require("Blockly.Events.CommentCreate");goog.require("Blockly.Events.CommentDelete");goog.require("Blockly.Events.CommentMove");goog.require("Blockly.Events.Ui");goog.require("Blockly.utils");goog.require("Blockly.utils.Coordinate");goog.require("Blockly.utils.dom");goog.require("Blockly.utils.object");goog.require("Blockly.utils.Rect");goog.require("Blockly.WorkspaceComment");goog.requireType("Blockly.IBoundedElement");goog.requireType("Blockly.ICopyable");Blockly.WorkspaceCommentSvg=function(a,b,c,d,e){this.onMouseUpWrapper_=null;this.onMouseMoveWrapper_=null;this.svgGroup_=Blockly.utils.dom.createSvgElement("g",{class:"blocklyComment"},null);this.svgGroup_.translate_="";this.svgRect_=Blockly.utils.dom.createSvgElement("rect",{class:"blocklyCommentRect",x:0,y:0,rx:Blockly.WorkspaceCommentSvg.BORDER_RADIUS,ry:Blockly.WorkspaceCommentSvg.BORDER_RADIUS});this.svgGroup_.appendChild(this.svgRect_);this.rendered_=!1;this.useDragSurface_=Blockly.utils.is3dSupported()&&!!a.blockDragSurface_;Blockly.WorkspaceCommentSvg.superClass_.constructor.call(this,a,b,c,d,e);this.render()};Blockly.utils.object.inherits(Blockly.WorkspaceCommentSvg,Blockly.WorkspaceComment);Blockly.WorkspaceCommentSvg.DEFAULT_SIZE=100;Blockly.WorkspaceCommentSvg.prototype.dispose=function(){if(!this.workspace){return}if(Blockly.selected==this){this.unselect();this.workspace.cancelCurrentGesture()}if(Blockly.Events.isEnabled()){Blockly.Events.fire(new Blockly.Events.CommentDelete(this))}Blockly.utils.dom.removeNode(this.svgGroup_);this.svgGroup_=null;this.svgRect_=null;this.disposeInternal_();Blockly.Events.disable();Blockly.WorkspaceCommentSvg.superClass_.dispose.call(this);Blockly.Events.enable()};Blockly.WorkspaceCommentSvg.prototype.initSvg=function(){if(!this.workspace.rendered){throw TypeError("Workspace is headless.")}if(!this.workspace.options.readOnly&&!this.eventsInit_){Blockly.bindEventWithChecks_(this.svgRectTarget_,"mousedown",this,this.pathMouseDown_);Blockly.bindEventWithChecks_(this.svgHandleTarget_,"mousedown",this,this.pathMouseDown_)}this.eventsInit_=!0;this.updateMovable();if(!this.getSvgRoot().parentNode){this.workspace.getBubbleCanvas().appendChild(this.getSvgRoot())}};Blockly.WorkspaceCommentSvg.prototype.pathMouseDown_=function(a){var b=this.workspace.getGesture(a);if(b){b.handleBubbleStart(a,this)}};Blockly.WorkspaceCommentSvg.prototype.showContextMenu=function(a){if(this.workspace.options.readOnly){return}var b=this,c=[];if(this.isDeletable()&&this.isMovable()){c.push(Blockly.ContextMenu.commentDuplicateOption(b));c.push(Blockly.ContextMenu.commentDeleteOption(b))}Blockly.ContextMenu.show(a,c,this.RTL)};Blockly.WorkspaceCommentSvg.prototype.select=function(){if(Blockly.selected==this){return}var a=null;if(Blockly.selected){a=Blockly.selected.id;Blockly.Events.disable();try{Blockly.selected.unselect()}finally{Blockly.Events.enable()}}var b=new Blockly.Events.Ui(null,"selected",a,this.id);b.workspaceId=this.workspace.id;Blockly.Events.fire(b);Blockly.selected=this;this.addSelect()};Blockly.WorkspaceCommentSvg.prototype.unselect=function(){if(Blockly.selected!=this){return}var a=new Blockly.Events.Ui(null,"selected",this.id,null);a.workspaceId=this.workspace.id;Blockly.Events.fire(a);Blockly.selected=null;this.removeSelect();this.blurFocus()};Blockly.WorkspaceCommentSvg.prototype.addSelect=function(){Blockly.utils.dom.addClass(this.svgGroup_,"blocklySelected");this.setFocus()};Blockly.WorkspaceCommentSvg.prototype.removeSelect=function(){Blockly.utils.dom.removeClass(this.svgGroup_,"blocklySelected");this.blurFocus()};Blockly.WorkspaceCommentSvg.prototype.addFocus=function(){Blockly.utils.dom.addClass(this.svgGroup_,"blocklyFocused")};Blockly.WorkspaceCommentSvg.prototype.removeFocus=function(){Blockly.utils.dom.removeClass(this.svgGroup_,"blocklyFocused")};Blockly.WorkspaceCommentSvg.prototype.getRelativeToSurfaceXY=function(){var a=0,b=0,c=this.useDragSurface_?this.workspace.blockDragSurface_.getGroup():null,d=this.getSvgRoot();if(d){do{var e=Blockly.utils.getRelativeXY(d);a+=e.x;b+=e.y;if(this.useDragSurface_&&this.workspace.blockDragSurface_.getCurrentBlock()==d){var f=this.workspace.blockDragSurface_.getSurfaceTranslation();a+=f.x;b+=f.y}d=d.parentNode}while(d&&d!=this.workspace.getBubbleCanvas()&&d!=c)}this.xy_=new Blockly.utils.Coordinate(a,b);return this.xy_};Blockly.WorkspaceCommentSvg.prototype.moveBy=function(a,b){var c=new Blockly.Events.CommentMove(this),d=this.getRelativeToSurfaceXY();this.translate(d.x+a,d.y+b);this.xy_=new Blockly.utils.Coordinate(d.x+a,d.y+b);c.recordNew();Blockly.Events.fire(c);this.workspace.resizeContents()};Blockly.WorkspaceCommentSvg.prototype.translate=function(a,b){this.xy_=new Blockly.utils.Coordinate(a,b);this.getSvgRoot().setAttribute("transform","translate("+a+","+b+")")};Blockly.WorkspaceCommentSvg.prototype.moveToDragSurface=function(){if(!this.useDragSurface_){return}var a=this.getRelativeToSurfaceXY();this.clearTransformAttributes_();this.workspace.blockDragSurface_.translateSurface(a.x,a.y);this.workspace.blockDragSurface_.setBlocksAndShow(this.getSvgRoot())};Blockly.WorkspaceCommentSvg.prototype.moveOffDragSurface=function(a){if(!this.useDragSurface_){return}this.translate(a.x,a.y);this.workspace.blockDragSurface_.clearAndHide(this.workspace.getCanvas())};Blockly.WorkspaceCommentSvg.prototype.moveDuringDrag=function(a,b){if(a){a.translateSurface(b.x,b.y)}else{this.svgGroup_.translate_="translate("+b.x+","+b.y+")";this.svgGroup_.setAttribute("transform",this.svgGroup_.translate_+this.svgGroup_.skew_)}};Blockly.WorkspaceCommentSvg.prototype.moveTo=function(a,b){this.translate(a,b)};Blockly.WorkspaceCommentSvg.prototype.clearTransformAttributes_=function(){this.getSvgRoot().removeAttribute("transform")};Blockly.WorkspaceCommentSvg.prototype.getBoundingRectangle=function(){var a=this.getRelativeToSurfaceXY(),b=this.getHeightWidth(),c=a.y,d=a.y+b.height,e,f;if(this.RTL){e=a.x-b.width;f=a.x}else{e=a.x;f=a.x+b.width}return new Blockly.utils.Rect(c,d,e,f)};Blockly.WorkspaceCommentSvg.prototype.updateMovable=function(){if(this.isMovable()){Blockly.utils.dom.addClass(this.svgGroup_,"blocklyDraggable")}else{Blockly.utils.dom.removeClass(this.svgGroup_,"blocklyDraggable")}};Blockly.WorkspaceCommentSvg.prototype.setMovable=function(a){Blockly.WorkspaceCommentSvg.superClass_.setMovable.call(this,a);this.updateMovable()};Blockly.WorkspaceCommentSvg.prototype.setEditable=function(a){Blockly.WorkspaceCommentSvg.superClass_.setEditable.call(this,a);if(this.textarea_){this.textarea_.readOnly=!a}};Blockly.WorkspaceCommentSvg.prototype.setDragging=function(a){if(a){var b=this.getSvgRoot();b.translate_="";b.skew_="";Blockly.utils.dom.addClass(this.svgGroup_,"blocklyDragging")}else{Blockly.utils.dom.removeClass(this.svgGroup_,"blocklyDragging")}};Blockly.WorkspaceCommentSvg.prototype.getSvgRoot=function(){return this.svgGroup_};Blockly.WorkspaceCommentSvg.prototype.getContent=function(){return this.textarea_?this.textarea_.value:this.content_};Blockly.WorkspaceCommentSvg.prototype.setContent=function(a){Blockly.WorkspaceCommentSvg.superClass_.setContent.call(this,a);if(this.textarea_){this.textarea_.value=a}};Blockly.WorkspaceCommentSvg.prototype.setDeleteStyle=function(a){if(a){Blockly.utils.dom.addClass(this.svgGroup_,"blocklyDraggingDelete")}else{Blockly.utils.dom.removeClass(this.svgGroup_,"blocklyDraggingDelete")}};Blockly.WorkspaceCommentSvg.prototype.setAutoLayout=function(){};Blockly.WorkspaceCommentSvg.fromXml=function(a,b,c){Blockly.Events.disable();try{var d=Blockly.WorkspaceComment.parseAttributes(a),e=new Blockly.WorkspaceCommentSvg(b,d.content,d.h,d.w,d.id);if(b.rendered){e.initSvg();e.render(!1)}if(!isNaN(d.x)&&!isNaN(d.y)){if(b.RTL){var f=c||b.getWidth();e.moveBy(f-d.x,d.y)}else{e.moveBy(d.x,d.y)}}}finally{Blockly.Events.enable()}Blockly.WorkspaceComment.fireCreateEvent(e);return e};Blockly.WorkspaceCommentSvg.prototype.toXmlWithXY=function(a){var b;if(this.workspace.RTL){b=this.workspace.getWidth()}var c=this.toXml(a),d=this.getRelativeToSurfaceXY();c.setAttribute("x",Math.round(this.workspace.RTL?b-d.x:d.x));c.setAttribute("y",Math.round(d.y));c.setAttribute("h",this.getHeight());c.setAttribute("w",this.getWidth());return c};Blockly.WorkspaceCommentSvg.prototype.toCopyData=function(){return{xml:this.toXmlWithXY(),source:this.workspace,typeCounts:null}};Blockly.Css.register([".blocklyCommentForeignObject {","position: relative;","z-index: 0;","}",".blocklyCommentRect {","fill: #E7DE8E;","stroke: #bcA903;","stroke-width: 1px;","}",".blocklyCommentTarget {","fill: transparent;","stroke: #bcA903;","}",".blocklyCommentTargetFocused {","fill: none;","}",".blocklyCommentHandleTarget {","fill: none;","}",".blocklyCommentHandleTargetFocused {","fill: transparent;","}",".blocklyFocused>.blocklyCommentRect {","fill: #B9B272;","stroke: #B9B272;","}",".blocklySelected>.blocklyCommentTarget {","stroke: #fc3;","stroke-width: 3px;","}",".blocklyCommentDeleteIcon {","cursor: pointer;","fill: #000;","display: none;","}",".blocklySelected > .blocklyCommentDeleteIcon {","display: block;","}",".blocklyDeleteIconShape {","fill: #000;","stroke: #000;","stroke-width: 1px;","}",".blocklyDeleteIconShape.blocklyDeleteIconHighlighted {","stroke: #fc3;","}"]);
//# sourceMappingURL=workspace_comment_svg.min.js.map
