'use strict';goog.provide("Blockly.DropDownDiv");goog.require("Blockly.utils.dom");goog.require("Blockly.utils.math");goog.require("Blockly.utils.style");goog.requireType("Blockly.utils.Rect");goog.requireType("Blockly.utils.Size");Blockly.DropDownDiv=function(){};Blockly.DropDownDiv.boundsElement_=null;Blockly.DropDownDiv.owner_=null;Blockly.DropDownDiv.positionToField_=null;Blockly.DropDownDiv.ARROW_SIZE=16;Blockly.DropDownDiv.BORDER_SIZE=1;Blockly.DropDownDiv.ARROW_HORIZONTAL_PADDING=12;Blockly.DropDownDiv.PADDING_Y=16;Blockly.DropDownDiv.ANIMATION_TIME=.25;Blockly.DropDownDiv.animateOutTimer_=null;Blockly.DropDownDiv.onHide_=null;Blockly.DropDownDiv.rendererClassName_="";Blockly.DropDownDiv.themeClassName_="";Blockly.DropDownDiv.BoundsInfo;Blockly.DropDownDiv.PositionMetrics;Blockly.DropDownDiv.createDom=function(){if(Blockly.DropDownDiv.DIV_){return}var a=document.createElement("div");a.className="blocklyDropDownDiv";var b=Blockly.parentContainer||document.body;b.appendChild(a);Blockly.DropDownDiv.DIV_=a;var c=document.createElement("div");c.className="blocklyDropDownContent";a.appendChild(c);Blockly.DropDownDiv.content_=c;var d=document.createElement("div");d.className="blocklyDropDownArrow";a.appendChild(d);Blockly.DropDownDiv.arrow_=d;Blockly.DropDownDiv.DIV_.style.opacity=0;Blockly.DropDownDiv.DIV_.style.transition="transform "+Blockly.DropDownDiv.ANIMATION_TIME+"s, opacity "+Blockly.DropDownDiv.ANIMATION_TIME+"s";a.addEventListener("focusin",function(){Blockly.utils.dom.addClass(a,"blocklyFocused")});a.addEventListener("focusout",function(){Blockly.utils.dom.removeClass(a,"blocklyFocused")})};Blockly.DropDownDiv.setBoundsElement=function(a){Blockly.DropDownDiv.boundsElement_=a};Blockly.DropDownDiv.getContentDiv=function(){return Blockly.DropDownDiv.content_};Blockly.DropDownDiv.clearContent=function(){Blockly.DropDownDiv.content_.textContent="";Blockly.DropDownDiv.content_.style.width=""};Blockly.DropDownDiv.setColour=function(a,b){Blockly.DropDownDiv.DIV_.style.backgroundColor=a;Blockly.DropDownDiv.DIV_.style.borderColor=b};Blockly.DropDownDiv.showPositionedByBlock=function(a,b,c,d){return Blockly.DropDownDiv.showPositionedByRect_(Blockly.DropDownDiv.getScaledBboxOfBlock_(b),a,c,d)};Blockly.DropDownDiv.showPositionedByField=function(a,b,c){Blockly.DropDownDiv.positionToField_=!0;return Blockly.DropDownDiv.showPositionedByRect_(Blockly.DropDownDiv.getScaledBboxOfField_(a),a,b,c)};Blockly.DropDownDiv.getScaledBboxOfBlock_=function(a){var b=a.getSvgRoot(),c=b.getBBox(),d=a.workspace.scale,e=c.height*d,f=c.width*d,g=Blockly.utils.style.getPageOffset(b);return new Blockly.utils.Rect(g.y,g.y+e,g.x,g.x+f)};Blockly.DropDownDiv.getScaledBboxOfField_=function(a){var b=a.getScaledBBox();return new Blockly.utils.Rect(b.top,b.bottom,b.left,b.right)};Blockly.DropDownDiv.showPositionedByRect_=function(a,b,c,d){var e=a.left+(a.right-a.left)/2,f=a.bottom,g=a.top;if(d){g+=d}var h=b.getSourceBlock(),i=h.workspace;while(i.options.parentWorkspace){i=i.options.parentWorkspace}Blockly.DropDownDiv.setBoundsElement(i.getParentSvg().parentNode);return Blockly.DropDownDiv.show(b,h.RTL,e,f,e,g,c)};Blockly.DropDownDiv.show=function(a,b,c,d,e,f,g){Blockly.DropDownDiv.owner_=a;Blockly.DropDownDiv.onHide_=g||null;var h=Blockly.DropDownDiv.DIV_;h.style.direction=b?"rtl":"ltr";var i=Blockly.getMainWorkspace();Blockly.DropDownDiv.rendererClassName_=i.getRenderer().getClassName();Blockly.DropDownDiv.themeClassName_=i.getTheme().getClassName();Blockly.utils.dom.addClass(h,Blockly.DropDownDiv.rendererClassName_);Blockly.utils.dom.addClass(h,Blockly.DropDownDiv.themeClassName_);return Blockly.DropDownDiv.positionInternal_(c,d,e,f)};Blockly.DropDownDiv.getBoundsInfo_=function(){var a=Blockly.utils.style.getPageOffset(Blockly.DropDownDiv.boundsElement_),b=Blockly.utils.style.getSize(Blockly.DropDownDiv.boundsElement_);return{left:a.x,right:a.x+b.width,top:a.y,bottom:a.y+b.height,width:b.width,height:b.height}};Blockly.DropDownDiv.getPositionMetrics_=function(a,b,c,d){var e=Blockly.DropDownDiv.getBoundsInfo_(),f=Blockly.utils.style.getSize(Blockly.DropDownDiv.DIV_);if(b+f.height<e.bottom){return Blockly.DropDownDiv.getPositionBelowMetrics_(a,b,e,f)}if(d-f.height>e.top){return Blockly.DropDownDiv.getPositionAboveMetrics_(c,d,e,f)}if(b+f.height<document.documentElement.clientHeight){return Blockly.DropDownDiv.getPositionBelowMetrics_(a,b,e,f)}if(d-f.height>document.documentElement.clientTop){return Blockly.DropDownDiv.getPositionAboveMetrics_(c,d,e,f)}return Blockly.DropDownDiv.getPositionTopOfPageMetrics_(a,e,f)};Blockly.DropDownDiv.getPositionBelowMetrics_=function(a,b,c,d){var e=Blockly.DropDownDiv.getPositionX(a,c.left,c.right,d.width),f=-(Blockly.DropDownDiv.ARROW_SIZE/2+Blockly.DropDownDiv.BORDER_SIZE),g=b+Blockly.DropDownDiv.PADDING_Y;return{initialX:e.divX,initialY:b,finalX:e.divX,finalY:g,arrowX:e.arrowX,arrowY:f,arrowAtTop:!0,arrowVisible:!0}};Blockly.DropDownDiv.getPositionAboveMetrics_=function(a,b,c,d){var e=Blockly.DropDownDiv.getPositionX(a,c.left,c.right,d.width),f=d.height-2*Blockly.DropDownDiv.BORDER_SIZE-Blockly.DropDownDiv.ARROW_SIZE/2,g=b-d.height-Blockly.DropDownDiv.PADDING_Y,h=b-d.height;return{initialX:e.divX,initialY:h,finalX:e.divX,finalY:g,arrowX:e.arrowX,arrowY:f,arrowAtTop:!1,arrowVisible:!0}};Blockly.DropDownDiv.getPositionTopOfPageMetrics_=function(a,b,c){var d=Blockly.DropDownDiv.getPositionX(a,b.left,b.right,c.width);return{initialX:d.divX,initialY:0,finalX:d.divX,finalY:0,arrowAtTop:null,arrowX:null,arrowY:null,arrowVisible:!1}};Blockly.DropDownDiv.getPositionX=function(a,b,c,d){var e,f;e=f=a;f-=d/2;f=Blockly.utils.math.clamp(b,f,c-d);e-=Blockly.DropDownDiv.ARROW_SIZE/2;var g=e-f,h=Blockly.DropDownDiv.ARROW_HORIZONTAL_PADDING;g=Blockly.utils.math.clamp(h,g,d-h-Blockly.DropDownDiv.ARROW_SIZE);return{arrowX:g,divX:f}};Blockly.DropDownDiv.isVisible=function(){return!!Blockly.DropDownDiv.owner_};Blockly.DropDownDiv.hideIfOwner=function(a,b){if(Blockly.DropDownDiv.owner_===a){if(b){Blockly.DropDownDiv.hideWithoutAnimation()}else{Blockly.DropDownDiv.hide()}return!0}return!1};Blockly.DropDownDiv.hide=function(){var a=Blockly.DropDownDiv.DIV_;a.style.transform="translate(0, 0)";a.style.opacity=0;Blockly.DropDownDiv.animateOutTimer_=setTimeout(function(){Blockly.DropDownDiv.hideWithoutAnimation()},1e3*Blockly.DropDownDiv.ANIMATION_TIME);if(Blockly.DropDownDiv.onHide_){Blockly.DropDownDiv.onHide_();Blockly.DropDownDiv.onHide_=null}};Blockly.DropDownDiv.hideWithoutAnimation=function(){if(!Blockly.DropDownDiv.isVisible()){return}if(Blockly.DropDownDiv.animateOutTimer_){clearTimeout(Blockly.DropDownDiv.animateOutTimer_)}var a=Blockly.DropDownDiv.DIV_;a.style.transform="";a.style.left="";a.style.top="";a.style.opacity=0;a.style.display="none";a.style.backgroundColor="";a.style.borderColor="";if(Blockly.DropDownDiv.onHide_){Blockly.DropDownDiv.onHide_();Blockly.DropDownDiv.onHide_=null}Blockly.DropDownDiv.clearContent();Blockly.DropDownDiv.owner_=null;if(Blockly.DropDownDiv.rendererClassName_){Blockly.utils.dom.removeClass(a,Blockly.DropDownDiv.rendererClassName_);Blockly.DropDownDiv.rendererClassName_=""}if(Blockly.DropDownDiv.themeClassName_){Blockly.utils.dom.removeClass(a,Blockly.DropDownDiv.themeClassName_);Blockly.DropDownDiv.themeClassName_=""}Blockly.getMainWorkspace().markFocused()};Blockly.DropDownDiv.positionInternal_=function(a,b,c,d){var e=Blockly.DropDownDiv.getPositionMetrics_(a,b,c,d);if(e.arrowVisible){Blockly.DropDownDiv.arrow_.style.display="";Blockly.DropDownDiv.arrow_.style.transform="translate("+e.arrowX+"px,"+e.arrowY+"px) rotate(45deg)";Blockly.DropDownDiv.arrow_.setAttribute("class",e.arrowAtTop?"blocklyDropDownArrow blocklyArrowTop":"blocklyDropDownArrow blocklyArrowBottom")}else{Blockly.DropDownDiv.arrow_.style.display="none"}var f=Math.floor(e.initialX),g=Math.floor(e.initialY),h=Math.floor(e.finalX),i=Math.floor(e.finalY),j=Blockly.DropDownDiv.DIV_;j.style.left=f+"px";j.style.top=g+"px";j.style.display="block";j.style.opacity=1;j.style.transform="translate("+(h-f)+"px,"+(i-g)+"px)";return!!e.arrowAtTop};Blockly.DropDownDiv.repositionForWindowResize=function(){if(Blockly.DropDownDiv.owner_){var a=Blockly.DropDownDiv.owner_,b=a.getSourceBlock(),c=Blockly.DropDownDiv.positionToField_?Blockly.DropDownDiv.getScaledBboxOfField_(a):Blockly.DropDownDiv.getScaledBboxOfBlock_(b),d=c.left+(c.right-c.left)/2,e=c.bottom,f=c.top;Blockly.DropDownDiv.positionInternal_(d,e,d,f)}else{Blockly.DropDownDiv.hide()}};
//# sourceMappingURL=dropdowndiv.min.js.map
