{"version":3,"sources":["../../../src/blockly/core/widgetdiv.js"],"names":["goog","provide","require","requireType","Blockly","WidgetDiv","owner_","dispose_","rendererClassName_","themeClassName_","createDom","DIV","document","createElement","className","container","parentContainer","body","appendChild","show","newOwner","rtl","dispose","hide","div","style","direction","display","mainWorkspace","getMainWorkspace","getRenderer","getClassName","getTheme","utils","dom","addClass","isVisible","left","top","textContent","removeClass","markFocused","hideIfOwner","oldOwner","positionInternal_","x","y","height","positionWithAnchor","viewportBBox","anchorBBox","widgetSize","calculateY_","calculateX_","widgetLeft","right","width","Math","max","min","bottom"],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright 2013 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview A div that floats on top of Blockly.  This singleton contains\n *     temporary HTML UI widgets that the user is currently interacting with.\n *     E.g. text input areas, colour pickers, context menus.\n * @author fraser@google.com (Neil Fraser)\n */\n'use strict';\n\n/**\n * @name Blockly.WidgetDiv\n * @namespace\n */\ngoog.provide('Blockly.WidgetDiv');\n\ngoog.require('Blockly.utils.style');\n\ngoog.requireType('Blockly.utils.Rect');\ngoog.requireType('Blockly.utils.Size');\n\n\n/**\n * The object currently using this container.\n * @type {Object}\n * @private\n */\nBlockly.WidgetDiv.owner_ = null;\n\n/**\n * Optional cleanup function set by whichever object uses the widget.\n * @type {Function}\n * @private\n */\nBlockly.WidgetDiv.dispose_ = null;\n\n/**\n * A class name representing the current owner's workspace renderer.\n * @type {string}\n * @private\n */\nBlockly.WidgetDiv.rendererClassName_ = '';\n\n/**\n * A class name representing the current owner's workspace theme.\n * @type {string}\n * @private\n */\nBlockly.WidgetDiv.themeClassName_ = '';\n\n/**\n * Create the widget div and inject it onto the page.\n */\nBlockly.WidgetDiv.createDom = function() {\n  if (Blockly.WidgetDiv.DIV) {\n    return;  // Already created.\n  }\n  /**\n   * The HTML container for popup overlays (e.g. editor widgets).\n   * @type {!Element}\n   */\n  Blockly.WidgetDiv.DIV = document.createElement('div');\n  Blockly.WidgetDiv.DIV.className = 'blocklyWidgetDiv';\n  var container = Blockly.parentContainer || document.body;\n  container.appendChild(Blockly.WidgetDiv.DIV);\n};\n\n/**\n * Initialize and display the widget div.  Close the old one if needed.\n * @param {!Object} newOwner The object that will be using this container.\n * @param {boolean} rtl Right-to-left (true) or left-to-right (false).\n * @param {Function} dispose Optional cleanup function to be run when the\n *     widget is closed.\n */\nBlockly.WidgetDiv.show = function(newOwner, rtl, dispose) {\n  Blockly.WidgetDiv.hide();\n  Blockly.WidgetDiv.owner_ = newOwner;\n  Blockly.WidgetDiv.dispose_ = dispose;\n  var div = Blockly.WidgetDiv.DIV;\n  div.style.direction = rtl ? 'rtl' : 'ltr';\n  div.style.display = 'block';\n  var mainWorkspace =\n    /** @type {!Blockly.WorkspaceSvg} */ (Blockly.getMainWorkspace());\n  Blockly.WidgetDiv.rendererClassName_ =\n      mainWorkspace.getRenderer().getClassName();\n  Blockly.WidgetDiv.themeClassName_ = mainWorkspace.getTheme().getClassName();\n  Blockly.utils.dom.addClass(div, Blockly.WidgetDiv.rendererClassName_);\n  Blockly.utils.dom.addClass(div, Blockly.WidgetDiv.themeClassName_);\n};\n\n/**\n * Destroy the widget and hide the div.\n */\nBlockly.WidgetDiv.hide = function() {\n  if (!Blockly.WidgetDiv.isVisible()) {\n    return;\n  }\n  Blockly.WidgetDiv.owner_ = null;\n\n  var div = Blockly.WidgetDiv.DIV;\n  div.style.display = 'none';\n  div.style.left = '';\n  div.style.top = '';\n  Blockly.WidgetDiv.dispose_ && Blockly.WidgetDiv.dispose_();\n  Blockly.WidgetDiv.dispose_ = null;\n  div.textContent = '';\n\n  if (Blockly.WidgetDiv.rendererClassName_) {\n    Blockly.utils.dom.removeClass(div, Blockly.WidgetDiv.rendererClassName_);\n    Blockly.WidgetDiv.rendererClassName_ = '';\n  }\n  if (Blockly.WidgetDiv.themeClassName_) {\n    Blockly.utils.dom.removeClass(div, Blockly.WidgetDiv.themeClassName_);\n    Blockly.WidgetDiv.themeClassName_ = '';\n  }\n  (/** @type {!Blockly.WorkspaceSvg} */ (\n    Blockly.getMainWorkspace())).markFocused();\n};\n\n/**\n * Is the container visible?\n * @return {boolean} True if visible.\n */\nBlockly.WidgetDiv.isVisible = function() {\n  return !!Blockly.WidgetDiv.owner_;\n};\n\n/**\n * Destroy the widget and hide the div if it is being used by the specified\n * object.\n * @param {!Object} oldOwner The object that was using this container.\n */\nBlockly.WidgetDiv.hideIfOwner = function(oldOwner) {\n  if (Blockly.WidgetDiv.owner_ == oldOwner) {\n    Blockly.WidgetDiv.hide();\n  }\n};\n\n/**\n * Set the widget div's position and height.  This function does nothing clever:\n * it will not ensure that your widget div ends up in the visible window.\n * @param {number} x Horizontal location (window coordinates, not body).\n * @param {number} y Vertical location (window coordinates, not body).\n * @param {number} height The height of the widget div (pixels).\n * @private\n */\nBlockly.WidgetDiv.positionInternal_ = function(x, y, height) {\n  Blockly.WidgetDiv.DIV.style.left = x + 'px';\n  Blockly.WidgetDiv.DIV.style.top = y + 'px';\n  Blockly.WidgetDiv.DIV.style.height = height + 'px';\n};\n\n/**\n * Position the widget div based on an anchor rectangle.\n * The widget should be placed adjacent to but not overlapping the anchor\n * rectangle.  The preferred position is directly below and aligned to the left\n * (LTR) or right (RTL) side of the anchor.\n * @param {!Blockly.utils.Rect} viewportBBox The bounding rectangle of the\n *     current viewport, in window coordinates.\n * @param {!Blockly.utils.Rect} anchorBBox The bounding rectangle of the anchor,\n *     in window coordinates.\n * @param {!Blockly.utils.Size} widgetSize The size of the widget that is inside\n *     the widget div, in window coordinates.\n * @param {boolean} rtl Whether the workspace is in RTL mode.  This determines\n *     horizontal alignment.\n * @package\n */\nBlockly.WidgetDiv.positionWithAnchor = function(viewportBBox, anchorBBox,\n    widgetSize, rtl) {\n  var y = Blockly.WidgetDiv.calculateY_(viewportBBox, anchorBBox, widgetSize);\n  var x = Blockly.WidgetDiv.calculateX_(viewportBBox, anchorBBox, widgetSize,\n      rtl);\n\n  if (y < 0) {\n    Blockly.WidgetDiv.positionInternal_(x, 0, widgetSize.height + y);\n  } else {\n    Blockly.WidgetDiv.positionInternal_(x, y, widgetSize.height);\n  }\n};\n\n/**\n * Calculate an x position (in window coordinates) such that the widget will not\n * be offscreen on the right or left.\n * @param {!Blockly.utils.Rect} viewportBBox The bounding rectangle of the\n *     current viewport, in window coordinates.\n * @param {!Blockly.utils.Rect} anchorBBox The bounding rectangle of the anchor,\n *     in window coordinates.\n * @param {Blockly.utils.Size} widgetSize The dimensions of the widget inside the\n *     widget div.\n * @param {boolean} rtl Whether the Blockly workspace is in RTL mode.\n * @return {number} A valid x-coordinate for the top left corner of the widget\n *     div, in window coordinates.\n * @private\n */\nBlockly.WidgetDiv.calculateX_ = function(viewportBBox, anchorBBox, widgetSize,\n    rtl) {\n  if (rtl) {\n    // Try to align the right side of the field and the right side of widget.\n    var widgetLeft = anchorBBox.right - widgetSize.width;\n    // Don't go offscreen left.\n    var x = Math.max(widgetLeft, viewportBBox.left);\n    // But really don't go offscreen right:\n    return Math.min(x, viewportBBox.right - widgetSize.width);\n  } else {\n    // Try to align the left side of the field and the left side of widget.\n    // Don't go offscreen right.\n    var x = Math.min(anchorBBox.left, viewportBBox.right - widgetSize.width);\n    // But left is more important, because that's where the text is.\n    return Math.max(x, viewportBBox.left);\n  }\n};\n\n/**\n * Calculate a y position (in window coordinates) such that the widget will not\n * be offscreen on the top or bottom.\n * @param {!Blockly.utils.Rect} viewportBBox The bounding rectangle of the\n *     current viewport, in window coordinates.\n * @param {!Blockly.utils.Rect} anchorBBox The bounding rectangle of the anchor,\n *     in window coordinates.\n * @param {Blockly.utils.Size} widgetSize The dimensions of the widget inside the\n *     widget div.\n * @return {number} A valid y-coordinate for the top left corner of the widget\n *     div, in window coordinates.\n * @private\n */\nBlockly.WidgetDiv.calculateY_ = function(viewportBBox, anchorBBox, widgetSize) {\n  // Flip the widget vertically if off the bottom.\n  if (anchorBBox.bottom + widgetSize.height >= viewportBBox.bottom) {\n    // The bottom of the widget is at the top of the field.\n    return anchorBBox.top - widgetSize.height;\n    // The widget could go off the top of the window, but it would also go off\n    // the bottom.  The window is just too small.\n  } else {\n    // The top of the widget is at the bottom of the field.\n    return anchorBBox.bottom;\n  }\n};\n"],"file":"widgetdiv.min.js"}