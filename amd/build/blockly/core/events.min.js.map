{"version":3,"sources":["../../../src/blockly/core/events.js"],"names":["goog","provide","require","Blockly","Events","group_","recordUndo","disabled_","CREATE","BLOCK_CREATE","DELETE","BLOCK_DELETE","CHANGE","BLOCK_CHANGE","MOVE","BLOCK_MOVE","VAR_CREATE","VAR_DELETE","VAR_RENAME","UI","COMMENT_CREATE","COMMENT_DELETE","COMMENT_CHANGE","COMMENT_MOVE","FINISHED_LOADING","BUMP_EVENTS","FIRE_QUEUE_","fire","event","isEnabled","length","setTimeout","fireNow_","push","queue","filter","i","workspaceId","workspace","Workspace","getById","fireChangeListener","queueIn","forward","slice","reverse","mergedQueue","hash","Object","create","isNull","key","type","blockId","join","lastEntry","lastEvent","index","newParentId","newInputName","newCoordinate","element","name","newValue","e","unshift","splice","clearPendingUndo","disable","enable","getGroup","setGroup","state","utils","genUid","getDescendantIds","block","ids","descendants","getDescendants","descendant","id","fromJson","json","Create","Delete","Change","Move","VarCreate","VarDelete","VarRename","Ui","CommentCreate","CommentChange","CommentMove","CommentDelete","FinishedLoading","Error","disableOrphans","getBlockById","parent","getParent","children","child","setEnabled","outputConnection","previousConnection","isDragging","getNextBlock"],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright 2016 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Events fired as a result of actions in Blockly's editor.\n * @author fraser@google.com (Neil Fraser)\n */\n'use strict';\n\n/**\n * Events fired as a result of actions in Blockly's editor.\n * @namespace Blockly.Events\n */\ngoog.provide('Blockly.Events');\n\ngoog.require('Blockly.utils');\n\n\n/**\n * Group ID for new events.  Grouped events are indivisible.\n * @type {string}\n * @private\n */\nBlockly.Events.group_ = '';\n\n/**\n * Sets whether the next event should be added to the undo stack.\n * @type {boolean}\n */\nBlockly.Events.recordUndo = true;\n\n/**\n * Allow change events to be created and fired.\n * @type {number}\n * @private\n */\nBlockly.Events.disabled_ = 0;\n\n/**\n * Name of event that creates a block. Will be deprecated for BLOCK_CREATE.\n * @const\n */\nBlockly.Events.CREATE = 'create';\n\n/**\n * Name of event that creates a block.\n * @const\n */\nBlockly.Events.BLOCK_CREATE = Blockly.Events.CREATE;\n\n/**\n * Name of event that deletes a block. Will be deprecated for BLOCK_DELETE.\n * @const\n */\nBlockly.Events.DELETE = 'delete';\n\n/**\n * Name of event that deletes a block.\n * @const\n */\nBlockly.Events.BLOCK_DELETE = Blockly.Events.DELETE;\n\n/**\n * Name of event that changes a block. Will be deprecated for BLOCK_CHANGE.\n * @const\n */\nBlockly.Events.CHANGE = 'change';\n\n/**\n * Name of event that changes a block.\n * @const\n */\nBlockly.Events.BLOCK_CHANGE = Blockly.Events.CHANGE;\n\n/**\n * Name of event that moves a block. Will be deprecated for BLOCK_MOVE.\n * @const\n */\nBlockly.Events.MOVE = 'move';\n\n/**\n * Name of event that moves a block.\n * @const\n */\nBlockly.Events.BLOCK_MOVE = Blockly.Events.MOVE;\n\n/**\n * Name of event that creates a variable.\n * @const\n */\nBlockly.Events.VAR_CREATE = 'var_create';\n\n/**\n * Name of event that deletes a variable.\n * @const\n */\nBlockly.Events.VAR_DELETE = 'var_delete';\n\n/**\n * Name of event that renames a variable.\n * @const\n */\nBlockly.Events.VAR_RENAME = 'var_rename';\n\n/**\n * Name of event that records a UI change.\n * @const\n */\nBlockly.Events.UI = 'ui';\n\n/**\n * Name of event that creates a comment.\n * @const\n */\nBlockly.Events.COMMENT_CREATE = 'comment_create';\n\n/**\n * Name of event that deletes a comment.\n * @const\n */\nBlockly.Events.COMMENT_DELETE = 'comment_delete';\n\n/**\n * Name of event that changes a comment.\n * @const\n */\nBlockly.Events.COMMENT_CHANGE = 'comment_change';\n\n/**\n * Name of event that moves a comment.\n * @const\n */\nBlockly.Events.COMMENT_MOVE = 'comment_move';\n\n/**\n * Name of event that records a workspace load.\n */\nBlockly.Events.FINISHED_LOADING = 'finished_loading';\n\n/**\n * List of events that cause objects to be bumped back into the visible\n * portion of the workspace (only used for non-movable workspaces).\n *\n * Not to be confused with bumping so that disconnected connections to do\n * not appear connected.\n * @const\n */\nBlockly.Events.BUMP_EVENTS = [\n  Blockly.Events.BLOCK_CREATE,\n  Blockly.Events.BLOCK_MOVE,\n  Blockly.Events.COMMENT_CREATE,\n  Blockly.Events.COMMENT_MOVE\n];\n\n/**\n * List of events queued for firing.\n * @private\n */\nBlockly.Events.FIRE_QUEUE_ = [];\n\n/**\n * Create a custom event and fire it.\n * @param {!Blockly.Events.Abstract} event Custom data for event.\n */\nBlockly.Events.fire = function(event) {\n  if (!Blockly.Events.isEnabled()) {\n    return;\n  }\n  if (!Blockly.Events.FIRE_QUEUE_.length) {\n    // First event added; schedule a firing of the event queue.\n    setTimeout(Blockly.Events.fireNow_, 0);\n  }\n  Blockly.Events.FIRE_QUEUE_.push(event);\n};\n\n/**\n * Fire all queued events.\n * @private\n */\nBlockly.Events.fireNow_ = function() {\n  var queue = Blockly.Events.filter(Blockly.Events.FIRE_QUEUE_, true);\n  Blockly.Events.FIRE_QUEUE_.length = 0;\n  for (var i = 0, event; (event = queue[i]); i++) {\n    if (!event.workspaceId) {\n      continue;\n    }\n    var workspace = Blockly.Workspace.getById(event.workspaceId);\n    if (workspace) {\n      workspace.fireChangeListener(event);\n    }\n  }\n};\n\n/**\n * Filter the queued events and merge duplicates.\n * @param {!Array.<!Blockly.Events.Abstract>} queueIn Array of events.\n * @param {boolean} forward True if forward (redo), false if backward (undo).\n * @return {!Array.<!Blockly.Events.Abstract>} Array of filtered events.\n */\nBlockly.Events.filter = function(queueIn, forward) {\n  var queue = queueIn.slice();  // Shallow copy of queue.\n  if (!forward) {\n    // Undo is merged in reverse order.\n    queue.reverse();\n  }\n  var mergedQueue = [];\n  var hash = Object.create(null);\n  // Merge duplicates.\n  for (var i = 0, event; (event = queue[i]); i++) {\n    if (!event.isNull()) {\n      var key = [event.type, event.blockId, event.workspaceId].join(' ');\n\n      var lastEntry = hash[key];\n      var lastEvent = lastEntry ? lastEntry.event : null;\n      if (!lastEntry) {\n        // Each item in the hash table has the event and the index of that event\n        // in the input array.  This lets us make sure we only merge adjacent\n        // move events.\n        hash[key] = { event: event, index: i};\n        mergedQueue.push(event);\n      } else if (event.type == Blockly.Events.MOVE &&\n          lastEntry.index == i - 1) {\n        // Merge move events.\n        lastEvent.newParentId = event.newParentId;\n        lastEvent.newInputName = event.newInputName;\n        lastEvent.newCoordinate = event.newCoordinate;\n        lastEntry.index = i;\n      } else if (event.type == Blockly.Events.CHANGE &&\n          event.element == lastEvent.element &&\n          event.name == lastEvent.name) {\n        // Merge change events.\n        lastEvent.newValue = event.newValue;\n      } else if (event.type == Blockly.Events.UI &&\n          event.element == 'click' &&\n          (lastEvent.element == 'commentOpen' ||\n           lastEvent.element == 'mutatorOpen' ||\n           lastEvent.element == 'warningOpen')) {\n        // Drop click events caused by opening/closing bubbles.\n      } else {\n        // Collision: newer events should merge into this event to maintain\n        // order.\n        hash[key] = {event: event, index: 1};\n        mergedQueue.push(event);\n      }\n    }\n  }\n  // Filter out any events that have become null due to merging.\n  queue = mergedQueue.filter(function(e) { return !e.isNull(); });\n  if (!forward) {\n    // Restore undo order.\n    queue.reverse();\n  }\n  // Move mutation events to the top of the queue.\n  // Intentionally skip first event.\n  for (var i = 1, event; (event = queue[i]); i++) {\n    if (event.type == Blockly.Events.CHANGE &&\n        event.element == 'mutation') {\n      queue.unshift(queue.splice(i, 1)[0]);\n    }\n  }\n  return queue;\n};\n\n/**\n * Modify pending undo events so that when they are fired they don't land\n * in the undo stack.  Called by Blockly.Workspace.clearUndo.\n */\nBlockly.Events.clearPendingUndo = function() {\n  for (var i = 0, event; (event = Blockly.Events.FIRE_QUEUE_[i]); i++) {\n    event.recordUndo = false;\n  }\n};\n\n/**\n * Stop sending events.  Every call to this function MUST also call enable.\n */\nBlockly.Events.disable = function() {\n  Blockly.Events.disabled_++;\n};\n\n/**\n * Start sending events.  Unless events were already disabled when the\n * corresponding call to disable was made.\n */\nBlockly.Events.enable = function() {\n  Blockly.Events.disabled_--;\n};\n\n/**\n * Returns whether events may be fired or not.\n * @return {boolean} True if enabled.\n */\nBlockly.Events.isEnabled = function() {\n  return Blockly.Events.disabled_ == 0;\n};\n\n/**\n * Current group.\n * @return {string} ID string.\n */\nBlockly.Events.getGroup = function() {\n  return Blockly.Events.group_;\n};\n\n/**\n * Start or stop a group.\n * @param {boolean|string} state True to start new group, false to end group.\n *   String to set group explicitly.\n */\nBlockly.Events.setGroup = function(state) {\n  if (typeof state == 'boolean') {\n    Blockly.Events.group_ = state ? Blockly.utils.genUid() : '';\n  } else {\n    Blockly.Events.group_ = state;\n  }\n};\n\n/**\n * Compute a list of the IDs of the specified block and all its descendants.\n * @param {!Blockly.Block} block The root block.\n * @return {!Array.<string>} List of block IDs.\n * @package\n */\nBlockly.Events.getDescendantIds = function(block) {\n  var ids = [];\n  var descendants = block.getDescendants(false);\n  for (var i = 0, descendant; (descendant = descendants[i]); i++) {\n    ids[i] = descendant.id;\n  }\n  return ids;\n};\n\n/**\n * Decode the JSON into an event.\n * @param {!Object} json JSON representation.\n * @param {!Blockly.Workspace} workspace Target workspace for event.\n * @return {!Blockly.Events.Abstract} The event represented by the JSON.\n */\nBlockly.Events.fromJson = function(json, workspace) {\n  // TODO: Should I have a way to register a new event into here?\n  var event;\n  switch (json.type) {\n    case Blockly.Events.CREATE:\n      event = new Blockly.Events.Create(null);\n      break;\n    case Blockly.Events.DELETE:\n      event = new Blockly.Events.Delete(null);\n      break;\n    case Blockly.Events.CHANGE:\n      event = new Blockly.Events.Change(null, '', '', '', '');\n      break;\n    case Blockly.Events.MOVE:\n      event = new Blockly.Events.Move(null);\n      break;\n    case Blockly.Events.VAR_CREATE:\n      event = new Blockly.Events.VarCreate(null);\n      break;\n    case Blockly.Events.VAR_DELETE:\n      event = new Blockly.Events.VarDelete(null);\n      break;\n    case Blockly.Events.VAR_RENAME:\n      event = new Blockly.Events.VarRename(null, '');\n      break;\n    case Blockly.Events.UI:\n      event = new Blockly.Events.Ui(null, '', '', '');\n      break;\n    case Blockly.Events.COMMENT_CREATE:\n      event = new Blockly.Events.CommentCreate(null);\n      break;\n    case Blockly.Events.COMMENT_CHANGE:\n      event = new Blockly.Events.CommentChange(null, '', '');\n      break;\n    case Blockly.Events.COMMENT_MOVE:\n      event = new Blockly.Events.CommentMove(null);\n      break;\n    case Blockly.Events.COMMENT_DELETE:\n      event = new Blockly.Events.CommentDelete(null);\n      break;\n    case Blockly.Events.FINISHED_LOADING:\n      event = new Blockly.Events.FinishedLoading(workspace);\n      break;\n    default:\n      throw Error('Unknown event type.');\n  }\n  event.fromJson(json);\n  event.workspaceId = workspace.id;\n  return event;\n};\n\n/**\n * Enable/disable a block depending on whether it is properly connected.\n * Use this on applications where all blocks should be connected to a top block.\n * Recommend setting the 'disable' option to 'false' in the config so that\n * users don't try to re-enable disabled orphan blocks.\n * @param {!Blockly.Events.Abstract} event Custom data for event.\n */\nBlockly.Events.disableOrphans = function(event) {\n  if (event.type == Blockly.Events.MOVE ||\n      event.type == Blockly.Events.CREATE) {\n    if (!event.workspaceId) {\n      return;\n    }\n    var workspace = Blockly.Workspace.getById(event.workspaceId);\n    var block = workspace.getBlockById(event.blockId);\n    if (block) {\n      var parent = block.getParent();\n      if (parent && parent.isEnabled()) {\n        var children = block.getDescendants(false);\n        for (var i = 0, child; (child = children[i]); i++) {\n          child.setEnabled(true);\n        }\n      } else if ((block.outputConnection || block.previousConnection) &&\n                 !workspace.isDragging()) {\n        do {\n          block.setEnabled(false);\n          block = block.getNextBlock();\n        } while (block);\n      }\n    }\n  }\n};\n"],"file":"events.min.js"}