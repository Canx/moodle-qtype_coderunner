'use strict';goog.provide("Blockly.ContextMenu");goog.require("Blockly.Events");goog.require("Blockly.Events.BlockCreate");goog.require("Blockly.Menu");goog.require("Blockly.MenuItem");goog.require("Blockly.Msg");goog.require("Blockly.utils");goog.require("Blockly.utils.Coordinate");goog.require("Blockly.utils.dom");goog.require("Blockly.utils.Rect");goog.require("Blockly.utils.userAgent");goog.require("Blockly.Xml");Blockly.ContextMenu.currentBlock=null;Blockly.ContextMenu.menu_=null;Blockly.ContextMenu.show=function(a,b,c){Blockly.WidgetDiv.show(Blockly.ContextMenu,c,Blockly.ContextMenu.dispose);if(!b.length){Blockly.ContextMenu.hide();return}var d=Blockly.ContextMenu.populate_(b,c);Blockly.ContextMenu.menu_=d;Blockly.ContextMenu.position_(d,a,c);setTimeout(function(){d.focus()},1);Blockly.ContextMenu.currentBlock=null};Blockly.ContextMenu.populate_=function(a,b){var c=new Blockly.Menu;c.setRole(Blockly.utils.aria.Role.MENU);for(var d=0,e,f;e=a[d];d++){f=new Blockly.MenuItem(e.text);f.setRightToLeft(b);f.setRole(Blockly.utils.aria.Role.MENUITEM);c.addChild(f);f.setEnabled(e.enabled);if(e.enabled){var g=function(){var a=this;Blockly.ContextMenu.hide();a.callback()};f.onAction(g,e)}}return c};Blockly.ContextMenu.position_=function(a,b,c){var d=Blockly.utils.getViewportBBox(),e=new Blockly.utils.Rect(b.clientY+d.top,b.clientY+d.top,b.clientX+d.left,b.clientX+d.left);Blockly.ContextMenu.createWidget_(a);var f=a.getSize();if(c){e.left+=f.width;e.right+=f.width;d.left+=f.width;d.right+=f.width}Blockly.WidgetDiv.positionWithAnchor(d,e,f,c);a.focus()};Blockly.ContextMenu.createWidget_=function(a){var b=Blockly.WidgetDiv.DIV;a.render(b);var c=a.getElement();Blockly.utils.dom.addClass(c,"blocklyContextMenu");Blockly.bindEventWithChecks_(c,"contextmenu",null,Blockly.utils.noEvent);a.focus()};Blockly.ContextMenu.hide=function(){Blockly.WidgetDiv.hideIfOwner(Blockly.ContextMenu);Blockly.ContextMenu.currentBlock=null};Blockly.ContextMenu.dispose=function(){if(Blockly.ContextMenu.menu_){Blockly.ContextMenu.menu_.dispose();Blockly.ContextMenu.menu_=null}};Blockly.ContextMenu.callbackFactory=function(a,b){return function(){Blockly.Events.disable();try{var c=Blockly.Xml.domToBlock(b,a.workspace),d=a.getRelativeToSurfaceXY();if(a.RTL){d.x-=Blockly.SNAP_RADIUS}else{d.x+=Blockly.SNAP_RADIUS}d.y+=2*Blockly.SNAP_RADIUS;c.moveBy(d.x,d.y)}finally{Blockly.Events.enable()}if(Blockly.Events.isEnabled()&&!c.isShadow()){Blockly.Events.fire(new Blockly.Events.BlockCreate(c))}c.select()}};Blockly.ContextMenu.blockDeleteOption=function(a){var b=a.getDescendants(!1).length,c=a.getNextBlock();if(c){b-=c.getDescendants(!1).length}var d={text:1==b?Blockly.Msg.DELETE_BLOCK:Blockly.Msg.DELETE_X_BLOCKS.replace("%1",b+""),enabled:!0,callback:function callback(){Blockly.Events.setGroup(!0);a.dispose(!0,!0);Blockly.Events.setGroup(!1)}};return d};Blockly.ContextMenu.blockHelpOption=function(a){var b="function"==typeof a.helpUrl?a.helpUrl():a.helpUrl,c={enabled:!!b,text:Blockly.Msg.HELP,callback:function callback(){a.showHelp()}};return c};Blockly.ContextMenu.blockDuplicateOption=function(a){var b=a.isDuplicatable(),c={text:Blockly.Msg.DUPLICATE_BLOCK,enabled:b,callback:function callback(){Blockly.duplicate(a)}};return c};Blockly.ContextMenu.blockCommentOption=function(a){var b={enabled:!Blockly.utils.userAgent.IE};if(a.getCommentIcon()){b.text=Blockly.Msg.REMOVE_COMMENT;b.callback=function(){a.setCommentText(null)}}else{b.text=Blockly.Msg.ADD_COMMENT;b.callback=function(){a.setCommentText("")}}return b};Blockly.ContextMenu.commentDeleteOption=function(a){var b={text:Blockly.Msg.REMOVE_COMMENT,enabled:!0,callback:function callback(){Blockly.Events.setGroup(!0);a.dispose(!0,!0);Blockly.Events.setGroup(!1)}};return b};Blockly.ContextMenu.commentDuplicateOption=function(a){var b={text:Blockly.Msg.DUPLICATE_COMMENT,enabled:!0,callback:function callback(){Blockly.duplicate(a)}};return b};Blockly.ContextMenu.workspaceCommentOption=function(a,b){if(!Blockly.WorkspaceCommentSvg){throw Error("Missing require for Blockly.WorkspaceCommentSvg")}var c=function(){var c=new Blockly.WorkspaceCommentSvg(a,Blockly.Msg.WORKSPACE_COMMENT_DEFAULT_TEXT,Blockly.WorkspaceCommentSvg.DEFAULT_SIZE,Blockly.WorkspaceCommentSvg.DEFAULT_SIZE),d=a.getInjectionDiv(),e=d.getBoundingClientRect(),f=new Blockly.utils.Coordinate(b.clientX-e.left,b.clientY-e.top),g=a.getOriginOffsetInPixels(),h=Blockly.utils.Coordinate.difference(f,g);h.scale(1/a.scale);var i=h.x,j=h.y;c.moveBy(i,j);if(a.rendered){c.initSvg();c.render();c.select()}},d={enabled:!Blockly.utils.userAgent.IE};d.text=Blockly.Msg.ADD_COMMENT;d.callback=function(){c()};return d};
//# sourceMappingURL=contextmenu.min.js.map
