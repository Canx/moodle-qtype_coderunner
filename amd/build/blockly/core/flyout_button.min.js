'use strict';goog.provide("Blockly.FlyoutButton");goog.require("Blockly.Css");goog.require("Blockly.utils");goog.require("Blockly.utils.Coordinate");goog.require("Blockly.utils.dom");Blockly.FlyoutButton=function(a,b,c,d){this.workspace_=a;this.targetWorkspace_=b;this.text_=c.text;this.position_=new Blockly.utils.Coordinate(0,0);this.isLabel_=d;this.callbackKey_=c.callbackKey||c.callbackkey;this.cssClass_=c["web-class"]||null;this.onMouseUpWrapper_=null};Blockly.FlyoutButton.MARGIN_X=5;Blockly.FlyoutButton.MARGIN_Y=2;Blockly.FlyoutButton.prototype.width=0;Blockly.FlyoutButton.prototype.height=0;Blockly.FlyoutButton.prototype.createDom=function(){var a=this.isLabel_?"blocklyFlyoutLabel":"blocklyFlyoutButton";if(this.cssClass_){a+=" "+this.cssClass_}this.svgGroup_=Blockly.utils.dom.createSvgElement("g",{class:a},this.workspace_.getCanvas());if(!this.isLabel_){var b=Blockly.utils.dom.createSvgElement("rect",{class:"blocklyFlyoutButtonShadow",rx:4,ry:4,x:1,y:1},this.svgGroup_)}var c=Blockly.utils.dom.createSvgElement("rect",{class:this.isLabel_?"blocklyFlyoutLabelBackground":"blocklyFlyoutButtonBackground",rx:4,ry:4},this.svgGroup_),d=Blockly.utils.dom.createSvgElement("text",{class:this.isLabel_?"blocklyFlyoutLabelText":"blocklyText",x:0,y:0,"text-anchor":"middle"},this.svgGroup_),e=Blockly.utils.replaceMessageReferences(this.text_);if(this.workspace_.RTL){e+="\u200F"}d.textContent=e;if(this.isLabel_){this.svgText_=d;this.workspace_.getThemeManager().subscribe(this.svgText_,"flyoutForegroundColour","fill")}var f=Blockly.utils.style.getComputedStyle(d,"fontSize"),g=Blockly.utils.style.getComputedStyle(d,"fontWeight"),h=Blockly.utils.style.getComputedStyle(d,"fontFamily");this.width=Blockly.utils.dom.getFastTextWidthWithSizeString(d,f,g,h);var i=Blockly.utils.dom.measureFontMetrics(e,f,g,h);this.height=i.height;if(!this.isLabel_){this.width+=2*Blockly.FlyoutButton.MARGIN_X;this.height+=2*Blockly.FlyoutButton.MARGIN_Y;b.setAttribute("width",this.width);b.setAttribute("height",this.height)}c.setAttribute("width",this.width);c.setAttribute("height",this.height);d.setAttribute("x",this.width/2);d.setAttribute("y",this.height/2-i.height/2+i.baseline);this.updateTransform_();this.onMouseUpWrapper_=Blockly.bindEventWithChecks_(this.svgGroup_,"mouseup",this,this.onMouseUp_);return this.svgGroup_};Blockly.FlyoutButton.prototype.show=function(){this.updateTransform_();this.svgGroup_.setAttribute("display","block")};Blockly.FlyoutButton.prototype.updateTransform_=function(){this.svgGroup_.setAttribute("transform","translate("+this.position_.x+","+this.position_.y+")")};Blockly.FlyoutButton.prototype.moveTo=function(a,b){this.position_.x=a;this.position_.y=b;this.updateTransform_()};Blockly.FlyoutButton.prototype.getPosition=function(){return this.position_};Blockly.FlyoutButton.prototype.getTargetWorkspace=function(){return this.targetWorkspace_};Blockly.FlyoutButton.prototype.dispose=function(){if(this.onMouseUpWrapper_){Blockly.unbindEvent_(this.onMouseUpWrapper_)}if(this.svgGroup_){Blockly.utils.dom.removeNode(this.svgGroup_)}if(this.svgText_){this.workspace_.getThemeManager().unsubscribe(this.svgText_)}};Blockly.FlyoutButton.prototype.onMouseUp_=function(a){var b=this.targetWorkspace_.getGesture(a);if(b){b.cancel()}if(this.isLabel_&&this.callbackKey_){console.warn("Labels should not have callbacks. Label text: "+this.text_)}else if(!this.isLabel_&&!(this.callbackKey_&&this.targetWorkspace_.getButtonCallback(this.callbackKey_))){console.warn("Buttons should have callbacks. Button text: "+this.text_)}else if(!this.isLabel_){this.targetWorkspace_.getButtonCallback(this.callbackKey_)(this)}};Blockly.Css.register([".blocklyFlyoutButton {","fill: #888;","cursor: default;","}",".blocklyFlyoutButtonShadow {","fill: #666;","}",".blocklyFlyoutButton:hover {","fill: #aaa;","}",".blocklyFlyoutLabel {","cursor: default;","}",".blocklyFlyoutLabelBackground {","opacity: 0;","}"]);
//# sourceMappingURL=flyout_button.min.js.map
