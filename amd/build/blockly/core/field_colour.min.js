'use strict';goog.provide("Blockly.FieldColour");goog.require("Blockly.Css");goog.require("Blockly.DropDownDiv");goog.require("Blockly.Events");goog.require("Blockly.Events.BlockChange");goog.require("Blockly.Field");goog.require("Blockly.fieldRegistry");goog.require("Blockly.navigation");goog.require("Blockly.utils.aria");goog.require("Blockly.utils.colour");goog.require("Blockly.utils.dom");goog.require("Blockly.utils.IdGenerator");goog.require("Blockly.utils.KeyCodes");goog.require("Blockly.utils.object");goog.require("Blockly.utils.Size");Blockly.FieldColour=function(a,b,c){Blockly.FieldColour.superClass_.constructor.call(this,a,b,c);this.picker_=null;this.highlightedIndex_=null;this.onClickWrapper_=null;this.onMouseMoveWrapper_=null;this.onMouseEnterWrapper_=null;this.onMouseLeaveWrapper_=null;this.onKeyDownWrapper_=null};Blockly.utils.object.inherits(Blockly.FieldColour,Blockly.Field);Blockly.FieldColour.fromJson=function(a){return new Blockly.FieldColour(a.colour,void 0,a)};Blockly.FieldColour.prototype.SERIALIZABLE=!0;Blockly.FieldColour.prototype.CURSOR="default";Blockly.FieldColour.prototype.isDirty_=!1;Blockly.FieldColour.prototype.colours_=null;Blockly.FieldColour.prototype.titles_=null;Blockly.FieldColour.prototype.columns_=0;Blockly.FieldColour.prototype.configure_=function(a){Blockly.FieldColour.superClass_.configure_.call(this,a);if(a.colourOptions){this.colours_=a.colourOptions;this.titles_=a.colourTitles}if(a.columns){this.columns_=a.columns}};Blockly.FieldColour.prototype.initView=function(){this.size_=new Blockly.utils.Size(this.getConstants().FIELD_COLOUR_DEFAULT_WIDTH,this.getConstants().FIELD_COLOUR_DEFAULT_HEIGHT);if(!this.getConstants().FIELD_COLOUR_FULL_BLOCK){this.createBorderRect_();this.borderRect_.style.fillOpacity="1"}else{this.clickTarget_=this.sourceBlock_.getSvgRoot()}};Blockly.FieldColour.prototype.applyColour=function(){if(!this.getConstants().FIELD_COLOUR_FULL_BLOCK){if(this.borderRect_){this.borderRect_.style.fill=this.getValue()}}else{this.sourceBlock_.pathObject.svgPath.setAttribute("fill",this.getValue());this.sourceBlock_.pathObject.svgPath.setAttribute("stroke","#fff")}};Blockly.FieldColour.prototype.doClassValidation_=function(a){if("string"!=typeof a){return null}return Blockly.utils.colour.parse(a)};Blockly.FieldColour.prototype.doValueUpdate_=function(a){this.value_=a;if(this.borderRect_){this.borderRect_.style.fill=a}else if(this.sourceBlock_&&this.sourceBlock_.rendered){this.sourceBlock_.pathObject.svgPath.setAttribute("fill",a);this.sourceBlock_.pathObject.svgPath.setAttribute("stroke","#fff")}};Blockly.FieldColour.prototype.getText=function(){var a=this.value_;if(/^#(.)\1(.)\2(.)\3$/.test(a)){a="#"+a[1]+a[3]+a[5]}return a};Blockly.FieldColour.COLOURS=["#ffffff","#cccccc","#c0c0c0","#999999","#666666","#333333","#000000","#ffcccc","#ff6666","#ff0000","#cc0000","#990000","#660000","#330000","#ffcc99","#ff9966","#ff9900","#ff6600","#cc6600","#993300","#663300","#ffff99","#ffff66","#ffcc66","#ffcc33","#cc9933","#996633","#663333","#ffffcc","#ffff33","#ffff00","#ffcc00","#999900","#666600","#333300","#99ff99","#66ff99","#33ff33","#33cc00","#009900","#006600","#003300","#99ffff","#33ffff","#66cccc","#00cccc","#339999","#336666","#003333","#ccffff","#66ffff","#33ccff","#3366ff","#3333ff","#000099","#000066","#ccccff","#9999ff","#6666cc","#6633ff","#6600cc","#333399","#330099","#ffccff","#ff99ff","#cc66cc","#cc33cc","#993399","#663366","#330033"];Blockly.FieldColour.prototype.DEFAULT_VALUE=Blockly.FieldColour.COLOURS[0];Blockly.FieldColour.TITLES=[];Blockly.FieldColour.COLUMNS=7;Blockly.FieldColour.prototype.setColours=function(a,b){this.colours_=a;if(b){this.titles_=b}return this};Blockly.FieldColour.prototype.setColumns=function(a){this.columns_=a;return this};Blockly.FieldColour.prototype.showEditor_=function(){this.picker_=this.dropdownCreate_();Blockly.DropDownDiv.getContentDiv().appendChild(this.picker_);Blockly.DropDownDiv.showPositionedByField(this,this.dropdownDispose_.bind(this));this.picker_.focus({preventScroll:!0})};Blockly.FieldColour.prototype.onClick_=function(a){var b=a.target,c=b&&b.label;if(null!==c){this.setValue(c);Blockly.DropDownDiv.hideIfOwner(this)}};Blockly.FieldColour.prototype.onKeyDown_=function(a){var b=!1;if(a.keyCode===Blockly.utils.KeyCodes.UP){this.moveHighlightBy_(0,-1);b=!0}else if(a.keyCode===Blockly.utils.KeyCodes.DOWN){this.moveHighlightBy_(0,1);b=!0}else if(a.keyCode===Blockly.utils.KeyCodes.LEFT){this.moveHighlightBy_(-1,0);b=!0}else if(a.keyCode===Blockly.utils.KeyCodes.RIGHT){this.moveHighlightBy_(1,0);b=!0}else if(a.keyCode===Blockly.utils.KeyCodes.ENTER){var c=this.getHighlighted_();if(c){var d=c&&c.label;if(null!==d){this.setValue(d)}}Blockly.DropDownDiv.hideWithoutAnimation();b=!0}if(b){a.stopPropagation()}};Blockly.FieldColour.prototype.onBlocklyAction=function(a){if(this.picker_){if(a===Blockly.navigation.ACTION_PREVIOUS){this.moveHighlightBy_(0,-1);return!0}else if(a===Blockly.navigation.ACTION_NEXT){this.moveHighlightBy_(0,1);return!0}else if(a===Blockly.navigation.ACTION_OUT){this.moveHighlightBy_(-1,0);return!0}else if(a===Blockly.navigation.ACTION_IN){this.moveHighlightBy_(1,0);return!0}}return Blockly.FieldColour.superClass_.onBlocklyAction.call(this,a)};Blockly.FieldColour.prototype.moveHighlightBy_=function(a,b){var c=this.colours_||Blockly.FieldColour.COLOURS,d=this.columns_||Blockly.FieldColour.COLUMNS,e=this.highlightedIndex_%d,f=Math.floor(this.highlightedIndex_/d);e+=a;f+=b;if(0>a){if(0>e&&0<f){e=d-1;f--}else if(0>e){e=0}}else if(0<a){if(e>d-1&&f<Math.floor(c.length/d)-1){e=0;f++}else if(e>d-1){e--}}else if(0>b){if(0>f){f=0}}else if(0<b){if(f>Math.floor(c.length/d)-1){f=Math.floor(c.length/d)-1}}var g=this.picker_.childNodes[f].childNodes[e],h=f*d+e;this.setHighlightedCell_(g,h)};Blockly.FieldColour.prototype.onMouseMove_=function(a){var b=a.target,c=b&&+b.getAttribute("data-index");if(null!==c&&c!==this.highlightedIndex_){this.setHighlightedCell_(b,c)}};Blockly.FieldColour.prototype.onMouseEnter_=function(){this.picker_.focus({preventScroll:!0})};Blockly.FieldColour.prototype.onMouseLeave_=function(){this.picker_.blur();var a=this.getHighlighted_();if(a){Blockly.utils.dom.removeClass(a,"blocklyColourHighlighted")}};Blockly.FieldColour.prototype.getHighlighted_=function(){var a=this.columns_||Blockly.FieldColour.COLUMNS,b=this.highlightedIndex_%a,c=Math.floor(this.highlightedIndex_/a),d=this.picker_.childNodes[c];if(!d){return null}var e=d.childNodes[b];return e};Blockly.FieldColour.prototype.setHighlightedCell_=function(a,b){var c=this.getHighlighted_();if(c){Blockly.utils.dom.removeClass(c,"blocklyColourHighlighted")}Blockly.utils.dom.addClass(a,"blocklyColourHighlighted");this.highlightedIndex_=b;Blockly.utils.aria.setState(this.picker_,Blockly.utils.aria.State.ACTIVEDESCENDANT,a.getAttribute("id"))};Blockly.FieldColour.prototype.dropdownCreate_=function(){var a=this.columns_||Blockly.FieldColour.COLUMNS,b=this.colours_||Blockly.FieldColour.COLOURS,c=this.titles_||Blockly.FieldColour.TITLES,d=this.getValue(),e=document.createElement("table");e.className="blocklyColourTable";e.tabIndex=0;e.dir="ltr";Blockly.utils.aria.setRole(e,Blockly.utils.aria.Role.GRID);Blockly.utils.aria.setState(e,Blockly.utils.aria.State.EXPANDED,!0);Blockly.utils.aria.setState(e,Blockly.utils.aria.State.ROWCOUNT,Math.floor(b.length/a));Blockly.utils.aria.setState(e,Blockly.utils.aria.State.COLCOUNT,a);for(var f,g=0;g<b.length;g++){if(0==g%a){f=document.createElement("tr");Blockly.utils.aria.setRole(f,Blockly.utils.aria.Role.ROW);e.appendChild(f)}var h=document.createElement("td");f.appendChild(h);h.label=b[g];h.title=c[g]||b[g];h.id=Blockly.utils.IdGenerator.getNextUniqueId();h.setAttribute("data-index",g);Blockly.utils.aria.setRole(h,Blockly.utils.aria.Role.GRIDCELL);Blockly.utils.aria.setState(h,Blockly.utils.aria.State.LABEL,b[g]);Blockly.utils.aria.setState(h,Blockly.utils.aria.State.SELECTED,b[g]==d);h.style.backgroundColor=b[g];if(b[g]==d){h.className="blocklyColourSelected";this.highlightedIndex_=g}}this.onClickWrapper_=Blockly.bindEventWithChecks_(e,"click",this,this.onClick_,!0);this.onMouseMoveWrapper_=Blockly.bindEventWithChecks_(e,"mousemove",this,this.onMouseMove_,!0);this.onMouseEnterWrapper_=Blockly.bindEventWithChecks_(e,"mouseenter",this,this.onMouseEnter_,!0);this.onMouseLeaveWrapper_=Blockly.bindEventWithChecks_(e,"mouseleave",this,this.onMouseLeave_,!0);this.onKeyDownWrapper_=Blockly.bindEventWithChecks_(e,"keydown",this,this.onKeyDown_);return e};Blockly.FieldColour.prototype.dropdownDispose_=function(){if(this.onClickWrapper_){Blockly.unbindEvent_(this.onClickWrapper_);this.onClickWrapper_=null}if(this.onMouseMoveWrapper_){Blockly.unbindEvent_(this.onMouseMoveWrapper_);this.onMouseMoveWrapper_=null}if(this.onMouseEnterWrapper_){Blockly.unbindEvent_(this.onMouseEnterWrapper_);this.onMouseEnterWrapper_=null}if(this.onMouseLeaveWrapper_){Blockly.unbindEvent_(this.onMouseLeaveWrapper_);this.onMouseLeaveWrapper_=null}if(this.onKeyDownWrapper_){Blockly.unbindEvent_(this.onKeyDownWrapper_);this.onKeyDownWrapper_=null}this.picker_=null;this.highlightedIndex_=null};Blockly.Css.register([".blocklyColourTable {","border-collapse: collapse;","display: block;","outline: none;","padding: 1px;","}",".blocklyColourTable>tr>td {","border: .5px solid #888;","box-sizing: border-box;","cursor: pointer;","display: inline-block;","height: 20px;","padding: 0;","width: 20px;","}",".blocklyColourTable>tr>td.blocklyColourHighlighted {","border-color: #eee;","box-shadow: 2px 2px 7px 2px rgba(0,0,0,.3);","position: relative;","}",".blocklyColourSelected, .blocklyColourSelected:hover {","border-color: #eee !important;","outline: 1px solid #333;","position: relative;","}"]);Blockly.fieldRegistry.register("field_colour",Blockly.FieldColour);
//# sourceMappingURL=field_colour.min.js.map
