'use strict';goog.provide("Blockly.ASTNode");goog.require("Blockly.utils.Coordinate");goog.requireType("Blockly.IASTNodeLocation");goog.requireType("Blockly.IASTNodeLocationWithBlock");Blockly.ASTNode=function(a,b,c){if(!b){throw Error("Cannot create a node without a location.")}this.type_=a;this.isConnection_=Blockly.ASTNode.isConnectionType_(a);this.location_=b;this.wsCoordinate_=null;this.processParams_(c||null)};Blockly.ASTNode.Params;Blockly.ASTNode.types={FIELD:"field",BLOCK:"block",INPUT:"input",OUTPUT:"output",NEXT:"next",PREVIOUS:"previous",STACK:"stack",WORKSPACE:"workspace"};Blockly.ASTNode.NAVIGATE_ALL_FIELDS=!1;Blockly.ASTNode.DEFAULT_OFFSET_Y=-20;Blockly.ASTNode.isConnectionType_=function(a){switch(a){case Blockly.ASTNode.types.PREVIOUS:case Blockly.ASTNode.types.NEXT:case Blockly.ASTNode.types.INPUT:case Blockly.ASTNode.types.OUTPUT:return!0;}return!1};Blockly.ASTNode.createFieldNode=function(a){if(!a){return null}return new Blockly.ASTNode(Blockly.ASTNode.types.FIELD,a)};Blockly.ASTNode.createConnectionNode=function(a){if(!a){return null}if(a.type==Blockly.INPUT_VALUE){return Blockly.ASTNode.createInputNode(a.getParentInput())}else if(a.type==Blockly.NEXT_STATEMENT&&a.getParentInput()){return Blockly.ASTNode.createInputNode(a.getParentInput())}else if(a.type==Blockly.NEXT_STATEMENT){return new Blockly.ASTNode(Blockly.ASTNode.types.NEXT,a)}else if(a.type==Blockly.OUTPUT_VALUE){return new Blockly.ASTNode(Blockly.ASTNode.types.OUTPUT,a)}else if(a.type==Blockly.PREVIOUS_STATEMENT){return new Blockly.ASTNode(Blockly.ASTNode.types.PREVIOUS,a)}return null};Blockly.ASTNode.createInputNode=function(a){if(!a||!a.connection){return null}return new Blockly.ASTNode(Blockly.ASTNode.types.INPUT,a.connection)};Blockly.ASTNode.createBlockNode=function(a){if(!a){return null}return new Blockly.ASTNode(Blockly.ASTNode.types.BLOCK,a)};Blockly.ASTNode.createStackNode=function(a){if(!a){return null}return new Blockly.ASTNode(Blockly.ASTNode.types.STACK,a)};Blockly.ASTNode.createWorkspaceNode=function(a,b){if(!b||!a){return null}return new Blockly.ASTNode(Blockly.ASTNode.types.WORKSPACE,a,{wsCoordinate:b})};Blockly.ASTNode.createTopNode=function(a){var b,c=a.previousConnection||a.outputConnection;if(c){b=Blockly.ASTNode.createConnectionNode(c)}else{b=Blockly.ASTNode.createBlockNode(a)}return b};Blockly.ASTNode.prototype.processParams_=function(a){if(!a){return}if(a.wsCoordinate){this.wsCoordinate_=a.wsCoordinate}};Blockly.ASTNode.prototype.getLocation=function(){return this.location_};Blockly.ASTNode.prototype.getType=function(){return this.type_};Blockly.ASTNode.prototype.getWsCoordinate=function(){return this.wsCoordinate_};Blockly.ASTNode.prototype.isConnection=function(){return this.isConnection_};Blockly.ASTNode.prototype.findNextForInput_=function(){for(var a=this.location_,b=a.getParentInput(),c=b.getSourceBlock(),d=c.inputList.indexOf(b),e=d+1,f,g;f=c.inputList[e];e++){g=f.fieldRow;for(var h=0,k;k=g[h];h++){if(k.isClickable()||Blockly.ASTNode.NAVIGATE_ALL_FIELDS){return Blockly.ASTNode.createFieldNode(k)}}if(f.connection){return Blockly.ASTNode.createInputNode(f)}}return null};Blockly.ASTNode.prototype.findNextForField_=function(){for(var a=this.location_,b=a.getParentInput(),c=a.getSourceBlock(),d=c.inputList.indexOf(b),e=b.fieldRow.indexOf(a)+1,f=d,g,h;g=c.inputList[f];f++){h=g.fieldRow;while(e<h.length){if(h[e].isClickable()||Blockly.ASTNode.NAVIGATE_ALL_FIELDS){return Blockly.ASTNode.createFieldNode(h[e])}e++}e=0;if(g.connection){return Blockly.ASTNode.createInputNode(g)}}return null};Blockly.ASTNode.prototype.findPrevForInput_=function(){for(var a=this.location_,b=a.getParentInput(),c=b.getSourceBlock(),d=c.inputList.indexOf(b),e=d,f;f=c.inputList[e];e--){if(f.connection&&f!==b){return Blockly.ASTNode.createInputNode(f)}for(var g=f.fieldRow,h=g.length-1,k;k=g[h];h--){if(k.isClickable()||Blockly.ASTNode.NAVIGATE_ALL_FIELDS){return Blockly.ASTNode.createFieldNode(k)}}}return null};Blockly.ASTNode.prototype.findPrevForField_=function(){for(var a=this.location_,b=a.getParentInput(),c=a.getSourceBlock(),d=c.inputList.indexOf(b),e=b.fieldRow.indexOf(a)-1,f=d,g;g=c.inputList[f];f--){if(g.connection&&g!==b){return Blockly.ASTNode.createInputNode(g)}var h=g.fieldRow;while(-1<e){if(h[e].isClickable()||Blockly.ASTNode.NAVIGATE_ALL_FIELDS){return Blockly.ASTNode.createFieldNode(h[e])}e--}if(0<=f-1){e=c.inputList[f-1].fieldRow.length-1}}return null};Blockly.ASTNode.prototype.navigateBetweenStacks_=function(a){var b=this.getLocation();if(!(b instanceof Blockly.Block)){b=b.getSourceBlock()}if(!b||!b.workspace){return null}for(var c=b.getRootBlock(),d=c.workspace.getTopBlocks(!0),e=0,f;f=d[e];e++){if(c.id==f.id){var g=a?1:-1,h=e+g;if(-1==h||h==d.length){return null}return Blockly.ASTNode.createStackNode(d[h])}}throw Error("Couldn't find "+(a?"next":"previous")+" stack?!")};Blockly.ASTNode.prototype.findTopASTNodeForBlock_=function(a){var b=a.previousConnection||a.outputConnection;if(b){return Blockly.ASTNode.createConnectionNode(b)}else{return Blockly.ASTNode.createBlockNode(a)}};Blockly.ASTNode.prototype.getOutAstNodeForBlock_=function(a){if(!a){return null}var b=a.getTopStackBlock();var c=b.previousConnection||b.outputConnection;if(c&&c.targetConnection&&c.targetConnection.getParentInput()){return Blockly.ASTNode.createInputNode(c.targetConnection.getParentInput())}else{return Blockly.ASTNode.createStackNode(b)}};Blockly.ASTNode.prototype.findFirstFieldOrInput_=function(a){for(var b=a.inputList,c=0,d,e;d=b[c];c++){e=d.fieldRow;for(var f=0,g;g=e[f];f++){if(g.isClickable()||Blockly.ASTNode.NAVIGATE_ALL_FIELDS){return Blockly.ASTNode.createFieldNode(g)}}if(d.connection){return Blockly.ASTNode.createInputNode(d)}}return null};Blockly.ASTNode.prototype.getSourceBlock=function(){if(this.getType()===Blockly.ASTNode.types.BLOCK){return this.getLocation()}else if(this.getType()===Blockly.ASTNode.types.STACK){return this.getLocation()}else if(this.getType()===Blockly.ASTNode.types.WORKSPACE){return null}else{return this.getLocation().getSourceBlock()}};Blockly.ASTNode.prototype.next=function(){switch(this.type_){case Blockly.ASTNode.types.STACK:return this.navigateBetweenStacks_(!0);case Blockly.ASTNode.types.OUTPUT:var a=this.location_;return Blockly.ASTNode.createBlockNode(a.getSourceBlock());case Blockly.ASTNode.types.FIELD:return this.findNextForField_();case Blockly.ASTNode.types.INPUT:return this.findNextForInput_();case Blockly.ASTNode.types.BLOCK:var b=this.location_,c=b.nextConnection;return Blockly.ASTNode.createConnectionNode(c);case Blockly.ASTNode.types.PREVIOUS:var a=this.location_;return Blockly.ASTNode.createBlockNode(a.getSourceBlock());case Blockly.ASTNode.types.NEXT:var a=this.location_,d=a.targetConnection;return Blockly.ASTNode.createConnectionNode(d);}return null};Blockly.ASTNode.prototype.in=function(){switch(this.type_){case Blockly.ASTNode.types.WORKSPACE:var a=this.location_,b=a.getTopBlocks(!0);if(0<b.length){return Blockly.ASTNode.createStackNode(b[0])}break;case Blockly.ASTNode.types.STACK:var c=this.location_;return this.findTopASTNodeForBlock_(c);case Blockly.ASTNode.types.BLOCK:var c=this.location_;return this.findFirstFieldOrInput_(c);case Blockly.ASTNode.types.INPUT:var d=this.location_,e=d.targetConnection;return Blockly.ASTNode.createConnectionNode(e);}return null};Blockly.ASTNode.prototype.prev=function(){switch(this.type_){case Blockly.ASTNode.types.STACK:return this.navigateBetweenStacks_(!1);case Blockly.ASTNode.types.OUTPUT:return null;case Blockly.ASTNode.types.FIELD:return this.findPrevForField_();case Blockly.ASTNode.types.INPUT:return this.findPrevForInput_();case Blockly.ASTNode.types.BLOCK:var a=this.location_,b=a.previousConnection||a.outputConnection;return Blockly.ASTNode.createConnectionNode(b);case Blockly.ASTNode.types.PREVIOUS:var c=this.location_,d=c.targetConnection;if(d&&!d.getParentInput()){return Blockly.ASTNode.createConnectionNode(d)}break;case Blockly.ASTNode.types.NEXT:var c=this.location_;return Blockly.ASTNode.createBlockNode(c.getSourceBlock());}return null};Blockly.ASTNode.prototype.out=function(){switch(this.type_){case Blockly.ASTNode.types.STACK:var a=this.location_,b=a.getRelativeToSurfaceXY(),c=new Blockly.utils.Coordinate(b.x,b.y+Blockly.ASTNode.DEFAULT_OFFSET_Y);return Blockly.ASTNode.createWorkspaceNode(a.workspace,c);case Blockly.ASTNode.types.OUTPUT:var d=this.location_,e=d.targetConnection;if(e){return Blockly.ASTNode.createConnectionNode(e)}return Blockly.ASTNode.createStackNode(d.getSourceBlock());case Blockly.ASTNode.types.FIELD:var f=this.location_;return Blockly.ASTNode.createBlockNode(f.getSourceBlock());case Blockly.ASTNode.types.INPUT:var d=this.location_;return Blockly.ASTNode.createBlockNode(d.getSourceBlock());case Blockly.ASTNode.types.BLOCK:var a=this.location_;return this.getOutAstNodeForBlock_(a);case Blockly.ASTNode.types.PREVIOUS:var d=this.location_;return this.getOutAstNodeForBlock_(d.getSourceBlock());case Blockly.ASTNode.types.NEXT:var d=this.location_;return this.getOutAstNodeForBlock_(d.getSourceBlock());}return null};
//# sourceMappingURL=ast_node.min.js.map
