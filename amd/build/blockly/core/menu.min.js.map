{"version":3,"sources":["../../../src/blockly/core/menu.js"],"names":["goog","provide","require","Blockly","Menu","menuItems_","openingCoords","highlightedItem_","mouseOverHandler_","clickHandler_","mouseEnterHandler_","mouseLeaveHandler_","onKeyDownHandler_","element_","roleName_","prototype","addChild","menuItem","push","render","container","element","document","createElement","className","tabIndex","utils","aria","setRole","i","appendChild","createDom","bindEventWithChecks_","handleMouseOver_","handleClick_","handleMouseEnter_","handleMouseLeave_","handleKeyEvent_","getElement","focus","el","preventScroll","dom","addClass","blur_","blur","removeClass","roleName","dispose","unbindEvent_","getMenuItem_","elem","menuElem","hasClass","parentElement","setHighlighted","item","currentHighlighted","style","scrollIntoContainerView","setState","State","ACTIVEDESCENDANT","getId","highlightNext","index","indexOf","highlightHelper_","highlightPrevious","length","highlightFirst_","highlightLast_","startIndex","delta","isEnabled","e","target","oldCoords","clientX","newCoords","Coordinate","clientY","distance","performAction","shiftKey","ctrlKey","metaKey","altKey","highlighted","keyCode","KeyCodes","ENTER","SPACE","UP","DOWN","PAGE_UP","HOME","PAGE_DOWN","END","preventDefault","stopPropagation","getSize","menuDom","menuSize","height","scrollHeight"],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Blockly menu similar to Closure's goog.ui.Menu\n * @author samelh@google.com (Sam El-Husseini)\n */\n'use strict';\n\ngoog.provide('Blockly.Menu');\n\ngoog.require('Blockly.utils.aria');\ngoog.require('Blockly.utils.Coordinate');\ngoog.require('Blockly.utils.dom');\ngoog.require('Blockly.utils.KeyCodes');\ngoog.require('Blockly.utils.style');\n\n\n/**\n * A basic menu class.\n * @constructor\n */\nBlockly.Menu = function() {\n  /**\n   * Array of menu items.\n   * (Nulls are never in the array, but typing the array as nullable prevents\n   * the compiler from objecting to .indexOf(null))\n   * @type {!Array.<Blockly.MenuItem>}\n   * @private\n   */\n  this.menuItems_ = [];\n\n  /**\n   * Coordinates of the mousedown event that caused this menu to open. Used to\n   * prevent the consequent mouseup event due to a simple click from activating\n   * a menu item immediately.\n   * @type {?Blockly.utils.Coordinate}\n   * @package\n   */\n  this.openingCoords = null;\n\n  /**\n   * This is the element that we will listen to the real focus events on.\n   * A value of null means no menu item is highlighted.\n   * @type {Blockly.MenuItem}\n   * @private\n   */\n  this.highlightedItem_ = null;\n\n  /**\n   * Mouse over event data.\n   * @type {?Blockly.EventData}\n   * @private\n   */\n  this.mouseOverHandler_ = null;\n\n  /**\n   * Click event data.\n   * @type {?Blockly.EventData}\n   * @private\n   */\n  this.clickHandler_ = null;\n\n  /**\n   * Mouse enter event data.\n   * @type {?Blockly.EventData}\n   * @private\n   */\n  this.mouseEnterHandler_ = null;\n\n  /**\n   * Mouse leave event data.\n   * @type {?Blockly.EventData}\n   * @private\n   */\n  this.mouseLeaveHandler_ = null;\n\n  /**\n   * Key down event data.\n   * @type {?Blockly.EventData}\n   * @private\n   */\n  this.onKeyDownHandler_ = null;\n\n  /**\n   * The menu's root DOM element.\n   * @type {Element}\n   * @private\n   */\n  this.element_ = null;\n\n  /**\n   * ARIA name for this menu.\n   * @type {?Blockly.utils.aria.Role}\n   * @private\n   */\n  this.roleName_ = null;\n};\n\n\n/**\n * Add a new menu item to the bottom of this menu.\n * @param {!Blockly.MenuItem} menuItem Menu item to append.\n */\nBlockly.Menu.prototype.addChild = function(menuItem) {\n  this.menuItems_.push(menuItem);\n};\n\n/**\n * Creates the menu DOM.\n * @param {!Element} container Element upon which to append this menu.\n */\nBlockly.Menu.prototype.render = function(container) {\n  var element = /** @type {!HTMLDivElement} */ (document.createElement('div'));\n  // goog-menu is deprecated, use blocklyMenu.  May 2020.\n  element.className = 'blocklyMenu goog-menu blocklyNonSelectable';\n  element.tabIndex = 0;\n  if (this.roleName_) {\n    Blockly.utils.aria.setRole(element, this.roleName_);\n  }\n  this.element_ = element;\n\n  // Add menu items.\n  for (var i = 0, menuItem; (menuItem = this.menuItems_[i]); i++) {\n    element.appendChild(menuItem.createDom());\n  }\n\n  // Add event handlers.\n  this.mouseOverHandler_ = Blockly.bindEventWithChecks_(element,\n      'mouseover', this, this.handleMouseOver_, true);\n  this.clickHandler_ = Blockly.bindEventWithChecks_(element,\n      'click', this, this.handleClick_, true);\n  this.mouseEnterHandler_ = Blockly.bindEventWithChecks_(element,\n      'mouseenter', this, this.handleMouseEnter_, true);\n  this.mouseLeaveHandler_ = Blockly.bindEventWithChecks_(element,\n      'mouseleave', this, this.handleMouseLeave_, true);\n  this.onKeyDownHandler_ = Blockly.bindEventWithChecks_(element,\n      'keydown', this, this.handleKeyEvent_);\n\n  container.appendChild(element);\n};\n\n/**\n * Gets the menu's element.\n * @return {Element} The DOM element.\n * @package\n */\nBlockly.Menu.prototype.getElement = function() {\n  return this.element_;\n};\n\n/**\n * Focus the menu element.\n * @package\n */\nBlockly.Menu.prototype.focus = function() {\n  var el = this.getElement();\n  if (el) {\n    el.focus({preventScroll:true});\n    Blockly.utils.dom.addClass(el, 'blocklyFocused');\n  }\n};\n\n/**\n * Blur the menu element.\n * @private\n */\nBlockly.Menu.prototype.blur_ = function() {\n  var el = this.getElement();\n  if (el) {\n    el.blur();\n    Blockly.utils.dom.removeClass(el, 'blocklyFocused');\n  }\n};\n\n/**\n * Set the menu accessibility role.\n * @param {!Blockly.utils.aria.Role} roleName role name.\n * @package\n */\nBlockly.Menu.prototype.setRole = function(roleName) {\n  this.roleName_ = roleName;\n};\n\n/**\n * Dispose of this menu.\n */\nBlockly.Menu.prototype.dispose = function() {\n  // Remove event handlers.\n  if (this.mouseOverHandler_) {\n    Blockly.unbindEvent_(this.mouseOverHandler_);\n    this.mouseOverHandler_ = null;\n  }\n  if (this.clickHandler_) {\n    Blockly.unbindEvent_(this.clickHandler_);\n    this.clickHandler_ = null;\n  }\n  if (this.mouseEnterHandler_) {\n    Blockly.unbindEvent_(this.mouseEnterHandler_);\n    this.mouseEnterHandler_ = null;\n  }\n  if (this.mouseLeaveHandler_) {\n    Blockly.unbindEvent_(this.mouseLeaveHandler_);\n    this.mouseLeaveHandler_ = null;\n  }\n  if (this.onKeyDownHandler_) {\n    Blockly.unbindEvent_(this.onKeyDownHandler_);\n    this.onKeyDownHandler_ = null;\n  }\n\n  // Remove menu items.\n  for (var i = 0, menuItem; (menuItem = this.menuItems_[i]); i++) {\n    menuItem.dispose();\n  }\n  this.element_ = null;\n};\n\n// Child component management.\n\n/**\n * Returns the child menu item that owns the given DOM element,\n * or null if no such menu item is found.\n * @param {Element} elem DOM element whose owner is to be returned.\n * @return {?Blockly.MenuItem} Menu item for which the DOM element belongs to.\n * @private\n */\nBlockly.Menu.prototype.getMenuItem_ = function(elem) {\n  var menuElem = this.getElement();\n  // Node might be the menu border (resulting in no associated menu item), or\n  // a menu item's div, or some element within the menu item.\n  // Walk up parents until one meets either the menu's root element, or\n  // a menu item's div.\n  while (elem && elem != menuElem) {\n    if (Blockly.utils.dom.hasClass(elem, 'blocklyMenuItem')) {\n      // Having found a menu item's div, locate that menu item in this menu.\n      for (var i = 0, menuItem; (menuItem = this.menuItems_[i]); i++) {\n        if (menuItem.getElement() == elem) {\n          return menuItem;\n        }\n      }\n    }\n    elem = elem.parentElement;\n  }\n  return null;\n};\n\n// Highlight management.\n\n/**\n * Highlights the given menu item, or clears highlighting if null.\n * @param {Blockly.MenuItem} item Item to highlight, or null.\n * @package\n */\nBlockly.Menu.prototype.setHighlighted = function(item) {\n  var currentHighlighted = this.highlightedItem_;\n  if (currentHighlighted) {\n    currentHighlighted.setHighlighted(false);\n    this.highlightedItem_ = null;\n  }\n  if (item) {\n    item.setHighlighted(true);\n    this.highlightedItem_ = item;\n    // Bring the highlighted item into view. This has no effect if the menu is\n    // not scrollable.\n    var el = /** @type {!Element} */ (this.getElement());\n    Blockly.utils.style.scrollIntoContainerView(\n        /** @type {!Element} */ (item.getElement()), el);\n\n    Blockly.utils.aria.setState(el, Blockly.utils.aria.State.ACTIVEDESCENDANT,\n        item.getId());\n  }\n};\n\n/**\n * Highlights the next highlightable item (or the first if nothing is currently\n * highlighted).\n * @package\n */\nBlockly.Menu.prototype.highlightNext = function() {\n  var index = this.menuItems_.indexOf(this.highlightedItem_);\n  this.highlightHelper_(index, 1);\n};\n\n/**\n * Highlights the previous highlightable item (or the last if nothing is\n * currently highlighted).\n * @package\n */\nBlockly.Menu.prototype.highlightPrevious = function() {\n  var index = this.menuItems_.indexOf(this.highlightedItem_);\n  this.highlightHelper_(index < 0 ? this.menuItems_.length : index, -1);\n};\n\n/**\n * Highlights the first highlightable item.\n * @private\n */\nBlockly.Menu.prototype.highlightFirst_ = function() {\n  this.highlightHelper_(-1, 1);\n};\n\n/**\n * Highlights the last highlightable item.\n * @private\n */\nBlockly.Menu.prototype.highlightLast_ = function() {\n  this.highlightHelper_(this.menuItems_.length, -1);\n};\n\n/**\n * Helper function that manages the details of moving the highlight among\n * child menuitems in response to keyboard events.\n * @param {number} startIndex Start index.\n * @param {number} delta Step direction: 1 to go down, -1 to go up.\n * @private\n */\nBlockly.Menu.prototype.highlightHelper_ = function(startIndex, delta) {\n  var index = startIndex + delta;\n  var menuItem;\n  while ((menuItem = this.menuItems_[index])) {\n    if (menuItem.isEnabled()) {\n      this.setHighlighted(menuItem);\n      break;\n    }\n    index += delta;\n  }\n};\n\n// Mouse events.\n\n/**\n * Handles mouseover events. Highlight menuitems as the user hovers over them.\n * @param {!Event} e Mouse event to handle.\n * @private\n */\nBlockly.Menu.prototype.handleMouseOver_ = function(e) {\n  var menuItem = this.getMenuItem_(/** @type {Element} */ (e.target));\n\n  if (menuItem) {\n    if (menuItem.isEnabled()) {\n      if (this.highlightedItem_ != menuItem) {\n        this.setHighlighted(menuItem);\n      }\n    } else {\n      this.setHighlighted(null);\n    }\n  }\n};\n\n/**\n * Handles click events. Pass the event onto the child menuitem to handle.\n * @param {!Event} e Click event to handle.\n * @private\n */\nBlockly.Menu.prototype.handleClick_ = function(e) {\n  var oldCoords = this.openingCoords;\n  // Clear out the saved opening coords immediately so they're not used twice.\n  this.openingCoords = null;\n  if (oldCoords && typeof e.clientX == 'number') {\n    var newCoords = new Blockly.utils.Coordinate(e.clientX, e.clientY);\n    if (Blockly.utils.Coordinate.distance(oldCoords, newCoords) < 1) {\n      // This menu was opened by a mousedown and we're handling the consequent\n      // click event. The coords haven't changed, meaning this was the same\n      // opening event. Don't do the usual behavior because the menu just popped\n      // up under the mouse and the user didn't mean to activate this item.\n      return;\n    }\n  }\n\n  var menuItem = this.getMenuItem_(/** @type {Element} */ (e.target));\n  if (menuItem) {\n    menuItem.performAction();\n  }\n};\n\n/**\n * Handles mouse enter events. Focus the element.\n * @param {Event} _e Mouse event to handle.\n * @private\n */\nBlockly.Menu.prototype.handleMouseEnter_ = function(_e) {\n  this.focus();\n};\n\n/**\n * Handles mouse leave events. Blur and clear highlight.\n * @param {Event} _e Mouse event to handle.\n * @private\n */\nBlockly.Menu.prototype.handleMouseLeave_ = function(_e) {\n  if (this.getElement()) {\n    this.blur_();\n    this.setHighlighted(null);\n  }\n};\n\n// Keyboard events.\n\n/**\n * Attempts to handle a keyboard event, if the menu item is enabled, by calling\n * {@link handleKeyEventInternal_}.\n * @param {!Event} e Key event to handle.\n * @private\n */\nBlockly.Menu.prototype.handleKeyEvent_ = function(e) {\n  if (!this.menuItems_.length) {\n    // Empty menu.\n    return;\n  }\n  if (e.shiftKey || e.ctrlKey || e.metaKey || e.altKey) {\n    // Do not handle the key event if any modifier key is pressed.\n    return;\n  }\n\n  var highlighted = this.highlightedItem_;\n  switch (e.keyCode) {\n    case Blockly.utils.KeyCodes.ENTER:\n    case Blockly.utils.KeyCodes.SPACE:\n      if (highlighted) {\n        highlighted.performAction();\n      }\n      break;\n\n    case Blockly.utils.KeyCodes.UP:\n      this.highlightPrevious();\n      break;\n\n    case Blockly.utils.KeyCodes.DOWN:\n      this.highlightNext();\n      break;\n\n    case Blockly.utils.KeyCodes.PAGE_UP:\n    case Blockly.utils.KeyCodes.HOME:\n      this.highlightFirst_();\n      break;\n\n    case Blockly.utils.KeyCodes.PAGE_DOWN:\n    case Blockly.utils.KeyCodes.END:\n      this.highlightLast_();\n      break;\n\n    default:\n      // Not a key the menu is interested in.\n      return;\n  }\n  // The menu used this key, don't let it have secondary effects.\n  e.preventDefault();\n  e.stopPropagation();\n};\n\n/**\n * Get the size of a rendered menu.\n * @return {!Blockly.utils.Size} Object with width and height properties.\n * @package\n */\nBlockly.Menu.prototype.getSize = function() {\n  var menuDom = this.getElement();\n  var menuSize = Blockly.utils.style.getSize(/** @type {!Element} */ (menuDom));\n  // Recalculate height for the total content, not only box height.\n  menuSize.height = menuDom.scrollHeight;\n  return menuSize;\n};\n"],"file":"menu.min.js"}