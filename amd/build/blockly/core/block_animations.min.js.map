{"version":3,"sources":["../../../src/blockly/core/block_animations.js"],"names":["goog","provide","require","Blockly","blockAnimations","disconnectPid_","disconnectGroup_","disposeUiEffect","block","workspace","svgGroup","getSvgRoot","getAudioManager","play","xy","getSvgXY","clone","cloneNode","translateX_","x","translateY_","y","setAttribute","getParentSvg","appendChild","bBox_","getBBox","disposeUiStep_","RTL","Date","scale","rtl","start","workspaceScale","ms","percent","utils","dom","removeNode","width","height","setTimeout","connectionUiEffect","outputConnection","previousConnection","ripple","createSvgElement","connectionUiStep_","style","opacity","disconnectUiEffect","getHeightWidth","magnitude","Math","atan","PI","disconnectUiStep_","group","skew_","skew","round","sin","translate_","disconnectUiStop","clearTimeout"],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Methods animating a block on connection and disconnection.\n * @author fenichel@google.com (Rachel Fenichel)\n */\n'use strict';\n\ngoog.provide('Blockly.blockAnimations');\n\ngoog.require('Blockly.utils.dom');\n\n\n/**\n * PID of disconnect UI animation.  There can only be one at a time.\n * @type {number}\n * @private\n */\nBlockly.blockAnimations.disconnectPid_ = 0;\n\n/**\n * SVG group of wobbling block.  There can only be one at a time.\n * @type {Element}\n * @private\n */\nBlockly.blockAnimations.disconnectGroup_ = null;\n\n/**\n * Play some UI effects (sound, animation) when disposing of a block.\n * @param {!Blockly.BlockSvg} block The block being disposed of.\n * @package\n */\nBlockly.blockAnimations.disposeUiEffect = function(block) {\n  var workspace = block.workspace;\n  var svgGroup = block.getSvgRoot();\n  workspace.getAudioManager().play('delete');\n\n  var xy = workspace.getSvgXY(svgGroup);\n  // Deeply clone the current block.\n  var clone = svgGroup.cloneNode(true);\n  clone.translateX_ = xy.x;\n  clone.translateY_ = xy.y;\n  clone.setAttribute('transform', 'translate(' + xy.x + ',' + xy.y + ')');\n  workspace.getParentSvg().appendChild(clone);\n  clone.bBox_ = clone.getBBox();\n  // Start the animation.\n  Blockly.blockAnimations.disposeUiStep_(clone, workspace.RTL, new Date,\n      workspace.scale);\n};\n\n/**\n * Animate a cloned block and eventually dispose of it.\n * This is a class method, not an instance method since the original block has\n * been destroyed and is no longer accessible.\n * @param {!Element} clone SVG element to animate and dispose of.\n * @param {boolean} rtl True if RTL, false if LTR.\n * @param {!Date} start Date of animation's start.\n * @param {number} workspaceScale Scale of workspace.\n * @private\n */\nBlockly.blockAnimations.disposeUiStep_ = function(clone, rtl, start,\n    workspaceScale) {\n  var ms = new Date - start;\n  var percent = ms / 150;\n  if (percent > 1) {\n    Blockly.utils.dom.removeNode(clone);\n  } else {\n    var x = clone.translateX_ +\n        (rtl ? -1 : 1) * clone.bBox_.width * workspaceScale / 2 * percent;\n    var y = clone.translateY_ + clone.bBox_.height * workspaceScale * percent;\n    var scale = (1 - percent) * workspaceScale;\n    clone.setAttribute('transform', 'translate(' + x + ',' + y + ')' +\n        ' scale(' + scale + ')');\n    setTimeout(Blockly.blockAnimations.disposeUiStep_, 10, clone, rtl, start,\n        workspaceScale);\n  }\n};\n\n/**\n * Play some UI effects (sound, ripple) after a connection has been established.\n * @param {!Blockly.BlockSvg} block The block being connected.\n * @package\n */\nBlockly.blockAnimations.connectionUiEffect = function(block) {\n  var workspace = block.workspace;\n  var scale = workspace.scale;\n  workspace.getAudioManager().play('click');\n  if (scale < 1) {\n    return;  // Too small to care about visual effects.\n  }\n  // Determine the absolute coordinates of the inferior block.\n  var xy = workspace.getSvgXY(block.getSvgRoot());\n  // Offset the coordinates based on the two connection types, fix scale.\n  if (block.outputConnection) {\n    xy.x += (block.RTL ? 3 : -3) * scale;\n    xy.y += 13 * scale;\n  } else if (block.previousConnection) {\n    xy.x += (block.RTL ? -23 : 23) * scale;\n    xy.y += 3 * scale;\n  }\n  var ripple = Blockly.utils.dom.createSvgElement('circle',\n      {\n        'cx': xy.x,\n        'cy': xy.y,\n        'r': 0,\n        'fill': 'none',\n        'stroke': '#888',\n        'stroke-width': 10\n      },\n      workspace.getParentSvg());\n  // Start the animation.\n  Blockly.blockAnimations.connectionUiStep_(ripple, new Date, scale);\n};\n\n/**\n * Expand a ripple around a connection.\n * @param {!SVGElement} ripple Element to animate.\n * @param {!Date} start Date of animation's start.\n * @param {number} scale Scale of workspace.\n * @private\n */\nBlockly.blockAnimations.connectionUiStep_ = function(ripple, start, scale) {\n  var ms = new Date - start;\n  var percent = ms / 150;\n  if (percent > 1) {\n    Blockly.utils.dom.removeNode(ripple);\n  } else {\n    ripple.setAttribute('r', percent * 25 * scale);\n    ripple.style.opacity = 1 - percent;\n    Blockly.blockAnimations.disconnectPid_ = setTimeout(\n        Blockly.blockAnimations.connectionUiStep_, 10, ripple, start, scale);\n  }\n};\n\n/**\n * Play some UI effects (sound, animation) when disconnecting a block.\n * @param {!Blockly.BlockSvg} block The block being disconnected.\n * @package\n */\nBlockly.blockAnimations.disconnectUiEffect = function(block) {\n  block.workspace.getAudioManager().play('disconnect');\n  if (block.workspace.scale < 1) {\n    return;  // Too small to care about visual effects.\n  }\n  // Horizontal distance for bottom of block to wiggle.\n  var DISPLACEMENT = 10;\n  // Scale magnitude of skew to height of block.\n  var height = block.getHeightWidth().height;\n  var magnitude = Math.atan(DISPLACEMENT / height) / Math.PI * 180;\n  if (!block.RTL) {\n    magnitude *= -1;\n  }\n  // Start the animation.\n  Blockly.blockAnimations.disconnectUiStep_(\n      block.getSvgRoot(), magnitude, new Date);\n};\n/**\n * Animate a brief wiggle of a disconnected block.\n * @param {!SVGElement} group SVG element to animate.\n * @param {number} magnitude Maximum degrees skew (reversed for RTL).\n * @param {!Date} start Date of animation's start.\n * @private\n */\nBlockly.blockAnimations.disconnectUiStep_ = function(group, magnitude, start) {\n  var DURATION = 200;  // Milliseconds.\n  var WIGGLES = 3;  // Half oscillations.\n\n  var ms = new Date - start;\n  var percent = ms / DURATION;\n\n  if (percent > 1) {\n    group.skew_ = '';\n  } else {\n    var skew = Math.round(\n        Math.sin(percent * Math.PI * WIGGLES) * (1 - percent) * magnitude);\n    group.skew_ = 'skewX(' + skew + ')';\n    Blockly.blockAnimations.disconnectGroup_ = group;\n    Blockly.blockAnimations.disconnectPid_ =\n        setTimeout(Blockly.blockAnimations.disconnectUiStep_, 10, group,\n            magnitude, start);\n  }\n  group.setAttribute('transform', group.translate_ + group.skew_);\n};\n\n/**\n * Stop the disconnect UI animation immediately.\n * @package\n */\nBlockly.blockAnimations.disconnectUiStop = function() {\n  if (Blockly.blockAnimations.disconnectGroup_) {\n    clearTimeout(Blockly.blockAnimations.disconnectPid_);\n    var group = Blockly.blockAnimations.disconnectGroup_;\n    group.skew_ = '';\n    group.setAttribute('transform', group.translate_);\n    Blockly.blockAnimations.disconnectGroup_ = null;\n  }\n};\n"],"file":"block_animations.min.js"}