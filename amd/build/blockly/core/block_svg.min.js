'use strict';goog.provide("Blockly.BlockSvg");goog.require("Blockly.ASTNode");goog.require("Blockly.Block");goog.require("Blockly.blockAnimations");goog.require("Blockly.blockRendering.IPathObject");goog.require("Blockly.ContextMenu");goog.require("Blockly.Events");goog.require("Blockly.Events.Ui");goog.require("Blockly.Events.BlockMove");goog.require("Blockly.Msg");goog.require("Blockly.navigation");goog.require("Blockly.RenderedConnection");goog.require("Blockly.TabNavigateCursor");goog.require("Blockly.Tooltip");goog.require("Blockly.Touch");goog.require("Blockly.utils");goog.require("Blockly.utils.Coordinate");goog.require("Blockly.utils.dom");goog.require("Blockly.utils.object");goog.require("Blockly.utils.Rect");goog.requireType("Blockly.IASTNodeLocationSvg");goog.requireType("Blockly.IBoundedElement");goog.requireType("Blockly.ICopyable");Blockly.BlockSvg=function(a,b,c){this.svgGroup_=Blockly.utils.dom.createSvgElement("g",{},null);this.svgGroup_.translate_="";this.style=a.getRenderer().getConstants().getBlockStyle(null);this.pathObject=a.getRenderer().makePathObject(this.svgGroup_,this.style);this.rendered=!1;this.renderIsInProgress_=!1;this.workspace=a;this.outputConnection=null;this.nextConnection=null;this.previousConnection=null;this.useDragSurface_=Blockly.utils.is3dSupported()&&!!a.getBlockDragSurface();var d=this.pathObject.svgPath;d.tooltip=this;Blockly.Tooltip.bindMouseEvents(d);Blockly.BlockSvg.superClass_.constructor.call(this,a,b,c);if(this.svgGroup_.dataset){this.svgGroup_.dataset.id=this.id}};Blockly.utils.object.inherits(Blockly.BlockSvg,Blockly.Block);Blockly.BlockSvg.prototype.height=0;Blockly.BlockSvg.prototype.width=0;Blockly.BlockSvg.prototype.warningTextDb_=null;Blockly.BlockSvg.INLINE=-1;Blockly.BlockSvg.COLLAPSED_WARNING_ID="TEMP_COLLAPSED_WARNING_";Blockly.BlockSvg.prototype.decompose;Blockly.BlockSvg.prototype.compose;Blockly.BlockSvg.prototype.customContextMenu;Blockly.BlockSvg.prototype.renderingDebugger;Blockly.BlockSvg.prototype.initSvg=function(){if(!this.workspace.rendered){throw TypeError("Workspace is headless.")}for(var a=0,b;b=this.inputList[a];a++){b.init()}for(var c=this.getIcons(),a=0;a<c.length;a++){c[a].createIcon()}this.applyColour();this.pathObject.updateMovable(this.isMovable());var d=this.getSvgRoot();if(!this.workspace.options.readOnly&&!this.eventsInit_&&d){Blockly.bindEventWithChecks_(d,"mousedown",this,this.onMouseDown_)}this.eventsInit_=!0;if(!d.parentNode){this.workspace.getCanvas().appendChild(d)}};Blockly.BlockSvg.prototype.getColourSecondary=function(){return this.style.colourSecondary};Blockly.BlockSvg.prototype.getColourTertiary=function(){return this.style.colourTertiary};Blockly.BlockSvg.prototype.getColourShadow=function(){return this.getColourSecondary()};Blockly.BlockSvg.prototype.getColourBorder=function(){var a=this.getColourTertiary();return{colourBorder:a,colourLight:null,colourDark:null}};Blockly.BlockSvg.prototype.select=function(){if(this.isShadow()&&this.getParent()){this.getParent().select();return}if(Blockly.selected==this){return}var a=null;if(Blockly.selected){a=Blockly.selected.id;Blockly.Events.disable();try{Blockly.selected.unselect()}finally{Blockly.Events.enable()}}var b=new Blockly.Events.Ui(null,"selected",a,this.id);b.workspaceId=this.workspace.id;Blockly.Events.fire(b);Blockly.selected=this;this.addSelect()};Blockly.BlockSvg.prototype.unselect=function(){if(Blockly.selected!=this){return}var a=new Blockly.Events.Ui(null,"selected",this.id,null);a.workspaceId=this.workspace.id;Blockly.Events.fire(a);Blockly.selected=null;this.removeSelect()};Blockly.BlockSvg.prototype.mutator=null;Blockly.BlockSvg.prototype.comment=null;Blockly.BlockSvg.prototype.commentIcon_=null;Blockly.BlockSvg.prototype.warning=null;Blockly.BlockSvg.prototype.getIcons=function(){var a=[];if(this.mutator){a.push(this.mutator)}if(this.commentIcon_){a.push(this.commentIcon_)}if(this.warning){a.push(this.warning)}return a};Blockly.BlockSvg.prototype.setParent=function(a){var b=this.parentBlock_;if(a==b){return}Blockly.utils.dom.startTextWidthCache();Blockly.BlockSvg.superClass_.setParent.call(this,a);Blockly.utils.dom.stopTextWidthCache();var c=this.getSvgRoot();if(this.workspace.isClearing||!c){return}var d=this.getRelativeToSurfaceXY();if(a){a.getSvgRoot().appendChild(c);var e=this.getRelativeToSurfaceXY();this.moveConnections(e.x-d.x,e.y-d.y)}else if(b){this.workspace.getCanvas().appendChild(c);this.translate(d.x,d.y)}this.applyColour()};Blockly.BlockSvg.prototype.getRelativeToSurfaceXY=function(){var a=0,b=0,c=this.useDragSurface_?this.workspace.getBlockDragSurface().getGroup():null,d=this.getSvgRoot();if(d){do{var e=Blockly.utils.getRelativeXY(d);a+=e.x;b+=e.y;if(this.useDragSurface_&&this.workspace.getBlockDragSurface().getCurrentBlock()==d){var f=this.workspace.getBlockDragSurface().getSurfaceTranslation();a+=f.x;b+=f.y}d=d.parentNode}while(d&&d!=this.workspace.getCanvas()&&d!=c)}return new Blockly.utils.Coordinate(a,b)};Blockly.BlockSvg.prototype.moveBy=function(a,b){if(this.parentBlock_){throw Error("Block has parent.")}var c=Blockly.Events.isEnabled();if(c){var d=new Blockly.Events.BlockMove(this)}var e=this.getRelativeToSurfaceXY();this.translate(e.x+a,e.y+b);this.moveConnections(a,b);if(c){d.recordNew();Blockly.Events.fire(d)}this.workspace.resizeContents()};Blockly.BlockSvg.prototype.translate=function(a,b){this.getSvgRoot().setAttribute("transform","translate("+a+","+b+")")};Blockly.BlockSvg.prototype.moveToDragSurface=function(){if(!this.useDragSurface_){return}var a=this.getRelativeToSurfaceXY();this.clearTransformAttributes_();this.workspace.getBlockDragSurface().translateSurface(a.x,a.y);var b=this.getSvgRoot();if(b){this.workspace.getBlockDragSurface().setBlocksAndShow(b)}};Blockly.BlockSvg.prototype.moveTo=function(a){var b=this.getRelativeToSurfaceXY();this.moveBy(a.x-b.x,a.y-b.y)};Blockly.BlockSvg.prototype.moveOffDragSurface=function(a){if(!this.useDragSurface_){return}this.translate(a.x,a.y);this.workspace.getBlockDragSurface().clearAndHide(this.workspace.getCanvas())};Blockly.BlockSvg.prototype.moveDuringDrag=function(a){if(this.useDragSurface_){this.workspace.getBlockDragSurface().translateSurface(a.x,a.y)}else{this.svgGroup_.translate_="translate("+a.x+","+a.y+")";this.svgGroup_.setAttribute("transform",this.svgGroup_.translate_+this.svgGroup_.skew_)}};Blockly.BlockSvg.prototype.clearTransformAttributes_=function(){this.getSvgRoot().removeAttribute("transform")};Blockly.BlockSvg.prototype.snapToGrid=function(){if(!this.workspace){return}if(this.workspace.isDragging()){return}if(this.getParent()){return}if(this.isInFlyout){return}var a=this.workspace.getGrid();if(!a||!a.shouldSnap()){return}var b=a.getSpacing(),c=b/2,d=this.getRelativeToSurfaceXY(),e=Math.round((d.x-c)/b)*b+c-d.x,f=Math.round((d.y-c)/b)*b+c-d.y;e=Math.round(e);f=Math.round(f);if(0!=e||0!=f){this.moveBy(e,f)}};Blockly.BlockSvg.prototype.getBoundingRectangle=function(){var a=this.getRelativeToSurfaceXY(),b=this.getHeightWidth(),c,d;if(this.RTL){c=a.x-b.width;d=a.x}else{c=a.x;d=a.x+b.width}return new Blockly.utils.Rect(a.y,a.y+b.height,c,d)};Blockly.BlockSvg.prototype.markDirty=function(){this.pathObject.constants=this.workspace.getRenderer().getConstants();for(var a=0,b;b=this.inputList[a];a++){b.markDirty()}};Blockly.BlockSvg.prototype.setCollapsed=function(a){if(this.collapsed_==a){return}Blockly.BlockSvg.superClass_.setCollapsed.call(this,a);if(!a){this.updateCollapsed_()}else if(this.rendered){this.render()}};Blockly.BlockSvg.prototype.updateCollapsed_=function(){for(var a=this.isCollapsed(),b=Blockly.Block.COLLAPSED_INPUT_NAME,c=Blockly.Block.COLLAPSED_FIELD_NAME,d=0,e;e=this.inputList[d];d++){if(e.name!=b){e.setVisible(!a)}}if(!a){this.removeInput(b);return}for(var f=this.getIcons(),d=0,g;g=f[d];d++){g.setVisible(!1)}var h=this.toString(Blockly.COLLAPSE_CHARS),j=this.getField(c);if(j){j.setValue(h);return}var e=this.getInput(b)||this.appendDummyInput(b);e.appendField(new Blockly.FieldLabel(h),c)};Blockly.BlockSvg.prototype.tab=function(a,b){var c=new Blockly.TabNavigateCursor;c.setCurNode(Blockly.ASTNode.createFieldNode(a));var d=c.getCurNode(),e=b?Blockly.navigation.ACTION_NEXT:Blockly.navigation.ACTION_PREVIOUS;c.onBlocklyAction(e);var f=c.getCurNode();if(f&&f!==d){var g=f.getLocation();g.showEditor();if(this.workspace.keyboardAccessibilityMode){this.workspace.getCursor().setCurNode(f)}}};Blockly.BlockSvg.prototype.onMouseDown_=function(a){var b=this.workspace&&this.workspace.getGesture(a);if(b){b.handleBlockStart(a,this)}};Blockly.BlockSvg.prototype.showHelp=function(){var a="function"==typeof this.helpUrl?this.helpUrl():this.helpUrl;if(a){window.open(a)}};Blockly.BlockSvg.prototype.generateContextMenu=function(){if(this.workspace.options.readOnly||!this.contextMenu){return null}var a=this,b=[];if(!this.isInFlyout){if(this.isDeletable()&&this.isMovable()){b.push(Blockly.ContextMenu.blockDuplicateOption(a))}if(this.workspace.options.comments&&!this.collapsed_&&this.isEditable()){b.push(Blockly.ContextMenu.blockCommentOption(a))}if(this.isMovable()){if(!this.collapsed_){for(var c=1;c<this.inputList.length;c++){if(this.inputList[c-1].type!=Blockly.NEXT_STATEMENT&&this.inputList[c].type!=Blockly.NEXT_STATEMENT){var d={enabled:!0},e=this.getInputsInline();d.text=e?Blockly.Msg.EXTERNAL_INPUTS:Blockly.Msg.INLINE_INPUTS;d.callback=function(){a.setInputsInline(!e)};b.push(d);break}}if(this.workspace.options.collapse){var f={enabled:!0,text:Blockly.Msg.COLLAPSE_BLOCK,callback:function(){a.setCollapsed(!0)}};b.push(f)}}else{if(this.workspace.options.collapse){var g={enabled:!0,text:Blockly.Msg.EXPAND_BLOCK,callback:function(){a.setCollapsed(!1)}};b.push(g)}}}if(this.workspace.options.disable&&this.isEditable()){var h={text:this.isEnabled()?Blockly.Msg.DISABLE_BLOCK:Blockly.Msg.ENABLE_BLOCK,enabled:!this.getInheritedDisabled(),callback:function callback(){var b=Blockly.Events.getGroup();if(!b){Blockly.Events.setGroup(!0)}a.setEnabled(!a.isEnabled());if(!b){Blockly.Events.setGroup(!1)}}};b.push(h)}if(this.isDeletable()){b.push(Blockly.ContextMenu.blockDeleteOption(a))}}b.push(Blockly.ContextMenu.blockHelpOption(a));if(this.customContextMenu){this.customContextMenu(b)}return b};Blockly.BlockSvg.prototype.showContextMenu=function(a){var b=this.generateContextMenu();if(b&&b.length){Blockly.ContextMenu.show(a,b,this.RTL);Blockly.ContextMenu.currentBlock=this}};Blockly.BlockSvg.prototype.moveConnections=function(a,b){if(!this.rendered){return}for(var c=this.getConnections_(!1),d=0;d<c.length;d++){c[d].moveBy(a,b)}for(var e=this.getIcons(),d=0;d<e.length;d++){e[d].computeIconLocation()}for(var d=0;d<this.childBlocks_.length;d++){this.childBlocks_[d].moveConnections(a,b)}};Blockly.BlockSvg.prototype.setDragging=function(a){if(a){var b=this.getSvgRoot();b.translate_="";b.skew_="";Blockly.draggingConnections=Blockly.draggingConnections.concat(this.getConnections_(!0));Blockly.utils.dom.addClass(this.svgGroup_,"blocklyDragging")}else{Blockly.draggingConnections=[];Blockly.utils.dom.removeClass(this.svgGroup_,"blocklyDragging")}for(var c=0;c<this.childBlocks_.length;c++){this.childBlocks_[c].setDragging(a)}};Blockly.BlockSvg.prototype.setMovable=function(a){Blockly.BlockSvg.superClass_.setMovable.call(this,a);this.pathObject.updateMovable(a)};Blockly.BlockSvg.prototype.setEditable=function(a){Blockly.BlockSvg.superClass_.setEditable.call(this,a);for(var b=this.getIcons(),c=0;c<b.length;c++){b[c].updateEditable()}};Blockly.BlockSvg.prototype.setShadow=function(a){Blockly.BlockSvg.superClass_.setShadow.call(this,a);this.applyColour()};Blockly.BlockSvg.prototype.setInsertionMarker=function(a){if(this.isInsertionMarker_==a){return}this.isInsertionMarker_=a;if(this.isInsertionMarker_){this.setColour(this.workspace.getRenderer().getConstants().INSERTION_MARKER_COLOUR);this.pathObject.updateInsertionMarker(!0)}};Blockly.BlockSvg.prototype.getSvgRoot=function(){return this.svgGroup_};Blockly.BlockSvg.prototype.dispose=function(a,b){if(!this.workspace){return}Blockly.Tooltip.dispose();Blockly.Tooltip.unbindMouseEvents(this.pathObject.svgPath);Blockly.utils.dom.startTextWidthCache();var c=this.workspace;if(Blockly.selected==this){this.unselect();this.workspace.cancelCurrentGesture()}if(Blockly.ContextMenu.currentBlock==this){Blockly.ContextMenu.hide()}if(this.workspace.keyboardAccessibilityMode){Blockly.navigation.moveCursorOnBlockDelete(this)}if(b&&this.rendered){this.unplug(a);Blockly.blockAnimations.disposeUiEffect(this)}this.rendered=!1;if(this.warningTextDb_){for(var d in this.warningTextDb_){clearTimeout(this.warningTextDb_[d])}this.warningTextDb_=null}for(var e=this.getIcons(),f=0;f<e.length;f++){e[f].dispose()}Blockly.BlockSvg.superClass_.dispose.call(this,!!a);Blockly.utils.dom.removeNode(this.svgGroup_);c.resizeContents();this.svgGroup_=null;Blockly.utils.dom.stopTextWidthCache()};Blockly.BlockSvg.prototype.toCopyData=function(){var a=Blockly.Xml.blockToDom(this,!0);Blockly.Xml.deleteNext(a);var b=this.getRelativeToSurfaceXY();a.setAttribute("x",this.RTL?-b.x:b.x);a.setAttribute("y",b.y);return{xml:a,source:this.workspace,typeCounts:Blockly.utils.getBlockTypeCounts(this,!0)}};Blockly.BlockSvg.prototype.applyColour=function(){this.pathObject.applyColour(this);for(var a=this.getIcons(),b=0;b<a.length;b++){a[b].applyColour()}for(var c=0,d;d=this.inputList[c];c++){for(var e=0,f;f=d.fieldRow[e];e++){f.applyColour()}}};Blockly.BlockSvg.prototype.updateDisabled=function(){var a=this.getChildren(!1);this.applyColour();for(var b=0,c;c=a[b];b++){c.updateDisabled()}};Blockly.BlockSvg.prototype.getCommentIcon=function(){return this.commentIcon_};Blockly.BlockSvg.prototype.setCommentText=function(a){if(!Blockly.Comment){throw Error("Missing require for Blockly.Comment")}if(this.commentModel.text==a){return}Blockly.BlockSvg.superClass_.setCommentText.call(this,a);var b=null!=a;if(!!this.commentIcon_==b){this.commentIcon_.updateText();return}if(b){this.commentIcon_=new Blockly.Comment(this);this.comment=this.commentIcon_}else{this.commentIcon_.dispose();this.commentIcon_=null;this.comment=null}if(this.rendered){this.render();this.bumpNeighbours()}};Blockly.BlockSvg.prototype.setWarningText=function(a,b){if(!Blockly.Warning){throw Error("Missing require for Blockly.Warning")}if(!this.warningTextDb_){this.warningTextDb_=Object.create(null)}var c=b||"";if(!c){for(var d in this.warningTextDb_){clearTimeout(this.warningTextDb_[d]);delete this.warningTextDb_[d]}}else if(this.warningTextDb_[c]){clearTimeout(this.warningTextDb_[c]);delete this.warningTextDb_[c]}if(this.workspace.isDragging()){var e=this;this.warningTextDb_[c]=setTimeout(function(){if(e.workspace){delete e.warningTextDb_[c];e.setWarningText(a,c)}},100);return}if(this.isInFlyout){a=null}var f=!1;if("string"==typeof a){var g=this.getSurroundParent(),h=null;while(g){if(g.isCollapsed()){h=g}g=g.getSurroundParent()}if(h){h.setWarningText(Blockly.Msg.COLLAPSED_WARNINGS_WARNING,Blockly.BlockSvg.COLLAPSED_WARNING_ID)}if(!this.warning){this.warning=new Blockly.Warning(this);f=!0}this.warning.setText(a,c)}else{if(this.warning&&!c){this.warning.dispose();f=!0}else if(this.warning){var i=this.warning.getText();this.warning.setText("",c);var j=this.warning.getText();if(!j){this.warning.dispose()}f=i!=j}}if(f&&this.rendered){this.render();this.bumpNeighbours()}};Blockly.BlockSvg.prototype.setMutator=function(a){if(this.mutator&&this.mutator!==a){this.mutator.dispose()}if(a){a.setBlock(this);this.mutator=a;a.createIcon()}if(this.rendered){this.render();this.bumpNeighbours()}};Blockly.BlockSvg.prototype.setDisabled=function(a){console.warn("Deprecated call to Blockly.BlockSvg.prototype.setDisabled, use Blockly.BlockSvg.prototype.setEnabled instead.");this.setEnabled(!a)};Blockly.BlockSvg.prototype.setEnabled=function(a){if(this.isEnabled()!=a){Blockly.BlockSvg.superClass_.setEnabled.call(this,a);if(this.rendered&&!this.getInheritedDisabled()){this.updateDisabled()}}};Blockly.BlockSvg.prototype.setHighlighted=function(a){if(!this.rendered){return}this.pathObject.updateHighlighted(a)};Blockly.BlockSvg.prototype.addSelect=function(){this.pathObject.updateSelected(!0)};Blockly.BlockSvg.prototype.removeSelect=function(){this.pathObject.updateSelected(!1)};Blockly.BlockSvg.prototype.setDeleteStyle=function(a){this.pathObject.updateDraggingDelete(a)};Blockly.BlockSvg.prototype.getColour=function(){return this.style.colourPrimary};Blockly.BlockSvg.prototype.setColour=function(a){Blockly.BlockSvg.superClass_.setColour.call(this,a);var b=this.workspace.getRenderer().getConstants().getBlockStyleForColour(this.colour_);this.pathObject.setStyle(b.style);this.style=b.style;this.styleName_=b.name;this.applyColour()};Blockly.BlockSvg.prototype.setStyle=function(a){var b=this.workspace.getRenderer().getConstants().getBlockStyle(a);this.styleName_=a;if(b){this.hat=b.hat;this.pathObject.setStyle(b);this.colour_=b.colourPrimary;this.style=b;this.applyColour()}else{throw Error("Invalid style name: "+a)}};Blockly.BlockSvg.prototype.bringToFront=function(){var a=this;do{var b=a.getSvgRoot(),c=b.parentNode,d=c.childNodes;if(d[d.length-1]!==b){c.appendChild(b)}a=a.getParent()}while(a)};Blockly.BlockSvg.prototype.setPreviousStatement=function(a,b){Blockly.BlockSvg.superClass_.setPreviousStatement.call(this,a,b);if(this.rendered){this.render();this.bumpNeighbours()}};Blockly.BlockSvg.prototype.setNextStatement=function(a,b){Blockly.BlockSvg.superClass_.setNextStatement.call(this,a,b);if(this.rendered){this.render();this.bumpNeighbours()}};Blockly.BlockSvg.prototype.setOutput=function(a,b){Blockly.BlockSvg.superClass_.setOutput.call(this,a,b);if(this.rendered){this.render();this.bumpNeighbours()}};Blockly.BlockSvg.prototype.setInputsInline=function(a){Blockly.BlockSvg.superClass_.setInputsInline.call(this,a);if(this.rendered){this.render();this.bumpNeighbours()}};Blockly.BlockSvg.prototype.removeInput=function(a,b){var c=Blockly.BlockSvg.superClass_.removeInput.call(this,a,b);if(this.rendered){this.render();this.bumpNeighbours()}return c};Blockly.BlockSvg.prototype.moveNumberedInputBefore=function(a,b){Blockly.BlockSvg.superClass_.moveNumberedInputBefore.call(this,a,b);if(this.rendered){this.render();this.bumpNeighbours()}};Blockly.BlockSvg.prototype.appendInput_=function(a,b){var c=Blockly.BlockSvg.superClass_.appendInput_.call(this,a,b);if(this.rendered){this.render();this.bumpNeighbours()}return c};Blockly.BlockSvg.prototype.setConnectionTracking=function(a){if(this.previousConnection){this.previousConnection.setTracking(a)}if(this.outputConnection){this.outputConnection.setTracking(a)}if(this.nextConnection){this.nextConnection.setTracking(a);var b=this.nextConnection.targetBlock();if(b){b.setConnectionTracking(a)}}if(this.collapsed_){return}for(var c=0,d;c<this.inputList.length;c++){d=this.inputList[c].connection;if(d){d.setTracking(a);var e=d.targetBlock();if(e){e.setConnectionTracking(a)}}}};Blockly.BlockSvg.prototype.getConnections_=function(a){var b=[];if(a||this.rendered){if(this.outputConnection){b.push(this.outputConnection)}if(this.previousConnection){b.push(this.previousConnection)}if(this.nextConnection){b.push(this.nextConnection)}if(a||!this.collapsed_){for(var c=0,d;d=this.inputList[c];c++){if(d.connection){b.push(d.connection)}}}}return b};Blockly.BlockSvg.prototype.lastConnectionInStack=function(){return Blockly.BlockSvg.superClass_.lastConnectionInStack.call(this)};Blockly.BlockSvg.prototype.getMatchingConnection=function(a,b){return Blockly.BlockSvg.superClass_.getMatchingConnection.call(this,a,b)};Blockly.BlockSvg.prototype.makeConnection_=function(a){return new Blockly.RenderedConnection(this,a)};Blockly.BlockSvg.prototype.bumpNeighbours=function(){if(!this.workspace){return}if(this.workspace.isDragging()){return}var a=this.getRootBlock();if(a.isInFlyout){return}for(var b=this.getConnections_(!1),c=0,d;d=b[c];c++){if(d.isConnected()&&d.isSuperior()){d.targetBlock().bumpNeighbours()}for(var e=d.neighbours(Blockly.SNAP_RADIUS),f=0,g;g=e[f];f++){if(!d.isConnected()||!g.isConnected()){if(g.getSourceBlock().getRootBlock()!=a){if(d.isSuperior()){g.bumpAwayFrom(d)}else{d.bumpAwayFrom(g)}}}}}};Blockly.BlockSvg.prototype.scheduleSnapAndBump=function(){var a=this,b=Blockly.Events.getGroup();setTimeout(function(){Blockly.Events.setGroup(b);a.snapToGrid();Blockly.Events.setGroup(!1)},Blockly.BUMP_DELAY/2);setTimeout(function(){Blockly.Events.setGroup(b);a.bumpNeighbours();Blockly.Events.setGroup(!1)},Blockly.BUMP_DELAY)};Blockly.BlockSvg.prototype.positionNearConnection=function(a,b){if(a.type==Blockly.NEXT_STATEMENT||a.type==Blockly.INPUT_VALUE){var c=b.x-a.x,d=b.y-a.y;this.moveBy(c,d)}};Blockly.BlockSvg.prototype.getParent=function(){return Blockly.BlockSvg.superClass_.getParent.call(this)};Blockly.BlockSvg.prototype.getRootBlock=function(){return Blockly.BlockSvg.superClass_.getRootBlock.call(this)};Blockly.BlockSvg.prototype.render=function(a){if(this.renderIsInProgress_){return}this.renderIsInProgress_=!0;try{this.rendered=!0;Blockly.utils.dom.startTextWidthCache();if(this.isCollapsed()){this.updateCollapsed_()}this.workspace.getRenderer().render(this);this.updateConnectionLocations_();if(!1!==a){var b=this.getParent();if(b){b.render(!0)}else{this.workspace.resizeContents()}}Blockly.utils.dom.stopTextWidthCache();this.updateMarkers_()}finally{this.renderIsInProgress_=!1}};Blockly.BlockSvg.prototype.updateMarkers_=function(){if(this.workspace.keyboardAccessibilityMode&&this.pathObject.cursorSvg){this.workspace.getCursor().draw()}if(this.workspace.keyboardAccessibilityMode&&this.pathObject.markerSvg){this.workspace.getMarker(Blockly.navigation.MARKER_NAME).draw()}};Blockly.BlockSvg.prototype.updateConnectionLocations_=function(){var a=this.getRelativeToSurfaceXY();if(this.previousConnection){this.previousConnection.moveToOffset(a)}if(this.outputConnection){this.outputConnection.moveToOffset(a)}for(var b=0,c;b<this.inputList.length;b++){c=this.inputList[b].connection;if(c){c.moveToOffset(a);if(c.isConnected()){c.tighten()}}}if(this.nextConnection){this.nextConnection.moveToOffset(a);if(this.nextConnection.isConnected()){this.nextConnection.tighten()}}};Blockly.BlockSvg.prototype.setCursorSvg=function(a){this.pathObject.setCursorSvg(a)};Blockly.BlockSvg.prototype.setMarkerSvg=function(a){this.pathObject.setMarkerSvg(a)};Blockly.BlockSvg.prototype.getHeightWidth=function(){var a=this.height,b=this.width,c=this.getNextBlock();if(c){var d=c.getHeightWidth(),e=this.workspace,f=e.getRenderer().getConstants().NOTCH_HEIGHT;a+=d.height-f;b=Math.max(b,d.width)}return{height:a,width:b}};Blockly.BlockSvg.prototype.fadeForReplacement=function(a){this.pathObject.updateReplacementFade(a)};Blockly.BlockSvg.prototype.highlightShapeForInput=function(a,b){this.pathObject.updateShapeForInputHighlight(a,b)};
//# sourceMappingURL=block_svg.min.js.map
