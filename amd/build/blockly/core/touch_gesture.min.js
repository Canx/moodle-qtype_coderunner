'use strict';goog.provide("Blockly.TouchGesture");goog.require("Blockly.Gesture");goog.require("Blockly.utils");goog.require("Blockly.utils.Coordinate");goog.require("Blockly.utils.object");Blockly.TouchGesture=function(a,b){Blockly.TouchGesture.superClass_.constructor.call(this,a,b);this.isMultiTouch_=!1;this.cachedPoints_=Object.create(null);this.previousScale_=0;this.startDistance_=0;this.onStartWrapper_=null;this.isPinchZoomEnabled_=null};Blockly.utils.object.inherits(Blockly.TouchGesture,Blockly.Gesture);Blockly.TouchGesture.ZOOM_IN_MULTIPLIER=5;Blockly.TouchGesture.ZOOM_OUT_MULTIPLIER=6;Blockly.TouchGesture.prototype.doStart=function(a){this.isPinchZoomEnabled_=this.startWorkspace_.options.zoomOptions&&this.startWorkspace_.options.zoomOptions.pinch;Blockly.TouchGesture.superClass_.doStart.call(this,a);if(!this.isEnding_&&Blockly.Touch.isTouchEvent(a)){this.handleTouchStart(a)}};Blockly.TouchGesture.prototype.bindMouseEvents=function(a){this.onStartWrapper_=Blockly.bindEventWithChecks_(document,"mousedown",null,this.handleStart.bind(this),!0);this.onMoveWrapper_=Blockly.bindEventWithChecks_(document,"mousemove",null,this.handleMove.bind(this),!0);this.onUpWrapper_=Blockly.bindEventWithChecks_(document,"mouseup",null,this.handleUp.bind(this),!0);a.preventDefault();a.stopPropagation()};Blockly.TouchGesture.prototype.handleStart=function(a){if(this.isDragging()){return}if(Blockly.Touch.isTouchEvent(a)){this.handleTouchStart(a);if(this.isMultiTouch()){Blockly.longStop_()}}};Blockly.TouchGesture.prototype.handleMove=function(a){if(this.isDragging()){if(Blockly.Touch.shouldHandleEvent(a)){Blockly.TouchGesture.superClass_.handleMove.call(this,a)}return}if(this.isMultiTouch()){if(Blockly.Touch.isTouchEvent(a)){this.handleTouchMove(a)}Blockly.longStop_()}else{Blockly.TouchGesture.superClass_.handleMove.call(this,a)}};Blockly.TouchGesture.prototype.handleUp=function(a){if(Blockly.Touch.isTouchEvent(a)&&!this.isDragging()){this.handleTouchEnd(a)}if(!this.isMultiTouch()||this.isDragging()){if(!Blockly.Touch.shouldHandleEvent(a)){return}Blockly.TouchGesture.superClass_.handleUp.call(this,a)}else{a.preventDefault();a.stopPropagation();this.dispose()}};Blockly.TouchGesture.prototype.isMultiTouch=function(){return this.isMultiTouch_};Blockly.TouchGesture.prototype.dispose=function(){Blockly.TouchGesture.superClass_.dispose.call(this);if(this.onStartWrapper_){Blockly.unbindEvent_(this.onStartWrapper_)}};Blockly.TouchGesture.prototype.handleTouchStart=function(a){var b=Blockly.Touch.getTouchIdentifierFromEvent(a);this.cachedPoints_[b]=this.getTouchPoint(a);var c=Object.keys(this.cachedPoints_);if(2==c.length){var d=this.cachedPoints_[c[0]],e=this.cachedPoints_[c[1]];this.startDistance_=Blockly.utils.Coordinate.distance(d,e);this.isMultiTouch_=!0;a.preventDefault()}};Blockly.TouchGesture.prototype.handleTouchMove=function(a){var b=Blockly.Touch.getTouchIdentifierFromEvent(a);this.cachedPoints_[b]=this.getTouchPoint(a);var c=Object.keys(this.cachedPoints_);if(this.isPinchZoomEnabled_&&2===c.length){this.handlePinch_(a)}else{Blockly.TouchGesture.superClass_.handleMove.call(this,a)}};Blockly.TouchGesture.prototype.handlePinch_=function(a){var b=Object.keys(this.cachedPoints_),c=this.cachedPoints_[b[0]],d=this.cachedPoints_[b[1]],e=Blockly.utils.Coordinate.distance(c,d),f=e/this.startDistance_;if(0<this.previousScale_&&this.previousScale_<1/0){var g=f-this.previousScale_,h=0<g?g*Blockly.TouchGesture.ZOOM_IN_MULTIPLIER:g*Blockly.TouchGesture.ZOOM_OUT_MULTIPLIER,i=this.startWorkspace_,j=Blockly.utils.mouseToSvg(a,i.getParentSvg(),i.getInverseScreenCTM());i.zoom(j.x,j.y,h)}this.previousScale_=f;a.preventDefault()};Blockly.TouchGesture.prototype.handleTouchEnd=function(a){var b=Blockly.Touch.getTouchIdentifierFromEvent(a);if(this.cachedPoints_[b]){delete this.cachedPoints_[b]}if(2>Object.keys(this.cachedPoints_).length){this.cachedPoints_=Object.create(null);this.previousScale_=0}};Blockly.TouchGesture.prototype.getTouchPoint=function(a){if(!this.startWorkspace_){return null}return new Blockly.utils.Coordinate(a.pageX?a.pageX:a.changedTouches[0].pageX,a.pageY?a.pageY:a.changedTouches[0].pageY)};
//# sourceMappingURL=touch_gesture.min.js.map
