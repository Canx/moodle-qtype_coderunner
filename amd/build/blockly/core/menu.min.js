'use strict';goog.provide("Blockly.Menu");goog.require("Blockly.utils.aria");goog.require("Blockly.utils.Coordinate");goog.require("Blockly.utils.dom");goog.require("Blockly.utils.KeyCodes");goog.require("Blockly.utils.style");Blockly.Menu=function(){this.menuItems_=[];this.openingCoords=null;this.highlightedItem_=null;this.mouseOverHandler_=null;this.clickHandler_=null;this.mouseEnterHandler_=null;this.mouseLeaveHandler_=null;this.onKeyDownHandler_=null;this.element_=null;this.roleName_=null};Blockly.Menu.prototype.addChild=function(a){this.menuItems_.push(a)};Blockly.Menu.prototype.render=function(a){var b=document.createElement("div");b.className="blocklyMenu goog-menu blocklyNonSelectable";b.tabIndex=0;if(this.roleName_){Blockly.utils.aria.setRole(b,this.roleName_)}this.element_=b;for(var c=0,d;d=this.menuItems_[c];c++){b.appendChild(d.createDom())}this.mouseOverHandler_=Blockly.bindEventWithChecks_(b,"mouseover",this,this.handleMouseOver_,!0);this.clickHandler_=Blockly.bindEventWithChecks_(b,"click",this,this.handleClick_,!0);this.mouseEnterHandler_=Blockly.bindEventWithChecks_(b,"mouseenter",this,this.handleMouseEnter_,!0);this.mouseLeaveHandler_=Blockly.bindEventWithChecks_(b,"mouseleave",this,this.handleMouseLeave_,!0);this.onKeyDownHandler_=Blockly.bindEventWithChecks_(b,"keydown",this,this.handleKeyEvent_);a.appendChild(b)};Blockly.Menu.prototype.getElement=function(){return this.element_};Blockly.Menu.prototype.focus=function(){var a=this.getElement();if(a){a.focus({preventScroll:!0});Blockly.utils.dom.addClass(a,"blocklyFocused")}};Blockly.Menu.prototype.blur_=function(){var a=this.getElement();if(a){a.blur();Blockly.utils.dom.removeClass(a,"blocklyFocused")}};Blockly.Menu.prototype.setRole=function(a){this.roleName_=a};Blockly.Menu.prototype.dispose=function(){if(this.mouseOverHandler_){Blockly.unbindEvent_(this.mouseOverHandler_);this.mouseOverHandler_=null}if(this.clickHandler_){Blockly.unbindEvent_(this.clickHandler_);this.clickHandler_=null}if(this.mouseEnterHandler_){Blockly.unbindEvent_(this.mouseEnterHandler_);this.mouseEnterHandler_=null}if(this.mouseLeaveHandler_){Blockly.unbindEvent_(this.mouseLeaveHandler_);this.mouseLeaveHandler_=null}if(this.onKeyDownHandler_){Blockly.unbindEvent_(this.onKeyDownHandler_);this.onKeyDownHandler_=null}for(var a=0,b;b=this.menuItems_[a];a++){b.dispose()}this.element_=null};Blockly.Menu.prototype.getMenuItem_=function(a){var b=this.getElement();while(a&&a!=b){if(Blockly.utils.dom.hasClass(a,"blocklyMenuItem")){for(var c=0,d;d=this.menuItems_[c];c++){if(d.getElement()==a){return d}}}a=a.parentElement}return null};Blockly.Menu.prototype.setHighlighted=function(a){var b=this.highlightedItem_;if(b){b.setHighlighted(!1);this.highlightedItem_=null}if(a){a.setHighlighted(!0);this.highlightedItem_=a;var c=this.getElement();Blockly.utils.style.scrollIntoContainerView(a.getElement(),c);Blockly.utils.aria.setState(c,Blockly.utils.aria.State.ACTIVEDESCENDANT,a.getId())}};Blockly.Menu.prototype.highlightNext=function(){var a=this.menuItems_.indexOf(this.highlightedItem_);this.highlightHelper_(a,1)};Blockly.Menu.prototype.highlightPrevious=function(){var a=this.menuItems_.indexOf(this.highlightedItem_);this.highlightHelper_(0>a?this.menuItems_.length:a,-1)};Blockly.Menu.prototype.highlightFirst_=function(){this.highlightHelper_(-1,1)};Blockly.Menu.prototype.highlightLast_=function(){this.highlightHelper_(this.menuItems_.length,-1)};Blockly.Menu.prototype.highlightHelper_=function(a,b){var c=a+b,d;while(d=this.menuItems_[c]){if(d.isEnabled()){this.setHighlighted(d);break}c+=b}};Blockly.Menu.prototype.handleMouseOver_=function(a){var b=this.getMenuItem_(a.target);if(b){if(b.isEnabled()){if(this.highlightedItem_!=b){this.setHighlighted(b)}}else{this.setHighlighted(null)}}};Blockly.Menu.prototype.handleClick_=function(a){var b=this.openingCoords;this.openingCoords=null;if(b&&"number"==typeof a.clientX){var c=new Blockly.utils.Coordinate(a.clientX,a.clientY);if(1>Blockly.utils.Coordinate.distance(b,c)){return}}var d=this.getMenuItem_(a.target);if(d){d.performAction()}};Blockly.Menu.prototype.handleMouseEnter_=function(){this.focus()};Blockly.Menu.prototype.handleMouseLeave_=function(){if(this.getElement()){this.blur_();this.setHighlighted(null)}};Blockly.Menu.prototype.handleKeyEvent_=function(a){if(!this.menuItems_.length){return}if(a.shiftKey||a.ctrlKey||a.metaKey||a.altKey){return}var b=this.highlightedItem_;switch(a.keyCode){case Blockly.utils.KeyCodes.ENTER:case Blockly.utils.KeyCodes.SPACE:if(b){b.performAction()}break;case Blockly.utils.KeyCodes.UP:this.highlightPrevious();break;case Blockly.utils.KeyCodes.DOWN:this.highlightNext();break;case Blockly.utils.KeyCodes.PAGE_UP:case Blockly.utils.KeyCodes.HOME:this.highlightFirst_();break;case Blockly.utils.KeyCodes.PAGE_DOWN:case Blockly.utils.KeyCodes.END:this.highlightLast_();break;default:return;}a.preventDefault();a.stopPropagation()};Blockly.Menu.prototype.getSize=function(){var a=this.getElement(),b=Blockly.utils.style.getSize(a);b.height=a.scrollHeight;return b};
//# sourceMappingURL=menu.min.js.map
