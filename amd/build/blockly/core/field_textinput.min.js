'use strict';goog.provide("Blockly.FieldTextInput");goog.require("Blockly.Events");goog.require("Blockly.Events.BlockChange");goog.require("Blockly.Field");goog.require("Blockly.fieldRegistry");goog.require("Blockly.Msg");goog.require("Blockly.utils");goog.require("Blockly.utils.aria");goog.require("Blockly.utils.Coordinate");goog.require("Blockly.utils.dom");goog.require("Blockly.utils.KeyCodes");goog.require("Blockly.utils.object");goog.require("Blockly.utils.Size");goog.require("Blockly.utils.userAgent");Blockly.FieldTextInput=function(a,b,c){this.spellcheck_=!0;Blockly.FieldTextInput.superClass_.constructor.call(this,a,b,c);this.htmlInput_=null;this.onKeyDownWrapper_=null;this.onKeyInputWrapper_=null;this.fullBlockClickTarget_=!1;this.workspace_=null};Blockly.utils.object.inherits(Blockly.FieldTextInput,Blockly.Field);Blockly.FieldTextInput.prototype.DEFAULT_VALUE="";Blockly.FieldTextInput.fromJson=function(a){var b=Blockly.utils.replaceMessageReferences(a.text);return new Blockly.FieldTextInput(b,void 0,a)};Blockly.FieldTextInput.prototype.SERIALIZABLE=!0;Blockly.FieldTextInput.BORDERRADIUS=4;Blockly.FieldTextInput.prototype.CURSOR="text";Blockly.FieldTextInput.prototype.configure_=function(a){Blockly.FieldTextInput.superClass_.configure_.call(this,a);if("boolean"==typeof a.spellcheck){this.spellcheck_=a.spellcheck}};Blockly.FieldTextInput.prototype.initView=function(){if(this.getConstants().FULL_BLOCK_FIELDS){for(var a=0,b=0,c=0,d;d=this.sourceBlock_.inputList[c];c++){for(var e=0;d.fieldRow[e];e++){a++}if(d.connection){b++}}this.fullBlockClickTarget_=1>=a&&this.sourceBlock_.outputConnection&&!b}else{this.fullBlockClickTarget_=!1}if(this.fullBlockClickTarget_){this.clickTarget_=this.sourceBlock_.getSvgRoot()}else{this.createBorderRect_()}this.createTextElement_()};Blockly.FieldTextInput.prototype.doClassValidation_=function(a){if(null===a||a===void 0){return null}return a+""};Blockly.FieldTextInput.prototype.doValueInvalid_=function(){if(this.isBeingEdited_){this.isTextValid_=!1;var a=this.value_;this.value_=this.htmlInput_.untypedDefaultValue_;if(this.sourceBlock_&&Blockly.Events.isEnabled()){Blockly.Events.fire(new Blockly.Events.BlockChange(this.sourceBlock_,"field",this.name||null,a,this.value_))}}};Blockly.FieldTextInput.prototype.doValueUpdate_=function(a){this.isTextValid_=!0;this.value_=a;if(!this.isBeingEdited_){this.isDirty_=!0}};Blockly.FieldTextInput.prototype.applyColour=function(){if(this.sourceBlock_&&this.getConstants().FULL_BLOCK_FIELDS){if(this.borderRect_){this.borderRect_.setAttribute("stroke",this.sourceBlock_.style.colourTertiary)}else{this.sourceBlock_.pathObject.svgPath.setAttribute("fill",this.getConstants().FIELD_BORDER_RECT_COLOUR)}}};Blockly.FieldTextInput.prototype.render_=function(){Blockly.FieldTextInput.superClass_.render_.call(this);if(this.isBeingEdited_){this.resizeEditor_();var a=this.htmlInput_;if(!this.isTextValid_){Blockly.utils.dom.addClass(a,"blocklyInvalidInput");Blockly.utils.aria.setState(a,Blockly.utils.aria.State.INVALID,!0)}else{Blockly.utils.dom.removeClass(a,"blocklyInvalidInput");Blockly.utils.aria.setState(a,Blockly.utils.aria.State.INVALID,!1)}}};Blockly.FieldTextInput.prototype.setSpellcheck=function(a){if(a==this.spellcheck_){return}this.spellcheck_=a;if(this.htmlInput_){this.htmlInput_.setAttribute("spellcheck",this.spellcheck_)}};Blockly.FieldTextInput.prototype.showEditor_=function(a,b){this.workspace_=this.sourceBlock_.workspace;var c=b||!1;if(!c&&(Blockly.utils.userAgent.MOBILE||Blockly.utils.userAgent.ANDROID||Blockly.utils.userAgent.IPAD)){this.showPromptEditor_()}else{this.showInlineEditor_(c)}};Blockly.FieldTextInput.prototype.showPromptEditor_=function(){var a=this;Blockly.prompt(Blockly.Msg.CHANGE_VALUE_TITLE,this.getText(),function(b){a.setValue(b)})};Blockly.FieldTextInput.prototype.showInlineEditor_=function(a){Blockly.WidgetDiv.show(this,this.sourceBlock_.RTL,this.widgetDispose_.bind(this));this.htmlInput_=this.widgetCreate_();this.isBeingEdited_=!0;if(!a){this.htmlInput_.focus({preventScroll:!0});this.htmlInput_.select()}};Blockly.FieldTextInput.prototype.widgetCreate_=function(){var a=Blockly.WidgetDiv.DIV;Blockly.utils.dom.addClass(this.getClickTarget_(),"editing");var b=document.createElement("input");b.className="blocklyHtmlInput";b.setAttribute("spellcheck",this.spellcheck_);var c=this.workspace_.getScale(),d=this.getConstants().FIELD_TEXT_FONTSIZE*c+"pt";a.style.fontSize=d;b.style.fontSize=d;var e=Blockly.FieldTextInput.BORDERRADIUS*c+"px";if(this.fullBlockClickTarget_){var f=this.getScaledBBox();e=(f.bottom-f.top)/2+"px";var g=this.sourceBlock_.getParent()?this.sourceBlock_.getParent().style.colourTertiary:this.sourceBlock_.style.colourTertiary;b.style.border=1*c+"px solid "+g;a.style.borderRadius=e;a.style.transition="box-shadow 0.25s ease 0s";if(this.getConstants().FIELD_TEXTINPUT_BOX_SHADOW){a.style.boxShadow="rgba(255, 255, 255, 0.3) 0px 0px 0px "+4*c+"px"}}b.style.borderRadius=e;a.appendChild(b);b.value=b.defaultValue=this.getEditorText_(this.value_);b.untypedDefaultValue_=this.value_;b.oldValue_=null;this.resizeEditor_();this.bindInputEvents_(b);return b};Blockly.FieldTextInput.prototype.widgetDispose_=function(){this.isBeingEdited_=!1;this.isTextValid_=!0;this.forceRerender();if(this.onFinishEditing_){this.onFinishEditing_(this.value_)}this.unbindInputEvents_();var a=Blockly.WidgetDiv.DIV.style;a.width="auto";a.height="auto";a.fontSize="";a.transition="";a.boxShadow="";this.htmlInput_=null;Blockly.utils.dom.removeClass(this.getClickTarget_(),"editing")};Blockly.FieldTextInput.prototype.bindInputEvents_=function(a){this.onKeyDownWrapper_=Blockly.bindEventWithChecks_(a,"keydown",this,this.onHtmlInputKeyDown_);this.onKeyInputWrapper_=Blockly.bindEventWithChecks_(a,"input",this,this.onHtmlInputChange_)};Blockly.FieldTextInput.prototype.unbindInputEvents_=function(){if(this.onKeyDownWrapper_){Blockly.unbindEvent_(this.onKeyDownWrapper_);this.onKeyDownWrapper_=null}if(this.onKeyInputWrapper_){Blockly.unbindEvent_(this.onKeyInputWrapper_);this.onKeyInputWrapper_=null}};Blockly.FieldTextInput.prototype.onHtmlInputKeyDown_=function(a){if(a.keyCode==Blockly.utils.KeyCodes.ENTER){Blockly.WidgetDiv.hide();Blockly.DropDownDiv.hideWithoutAnimation()}else if(a.keyCode==Blockly.utils.KeyCodes.ESC){this.htmlInput_.value=this.htmlInput_.defaultValue;Blockly.WidgetDiv.hide();Blockly.DropDownDiv.hideWithoutAnimation()}else if(a.keyCode==Blockly.utils.KeyCodes.TAB){Blockly.WidgetDiv.hide();Blockly.DropDownDiv.hideWithoutAnimation();this.sourceBlock_.tab(this,!a.shiftKey);a.preventDefault()}};Blockly.FieldTextInput.prototype.onHtmlInputChange_=function(){var a=this.htmlInput_.value;if(a!==this.htmlInput_.oldValue_){this.htmlInput_.oldValue_=a;Blockly.Events.setGroup(!0);var b=this.getValueFromEditorText_(a);this.setValue(b);this.forceRerender();this.resizeEditor_();Blockly.Events.setGroup(!1)}};Blockly.FieldTextInput.prototype.setEditorValue_=function(a){this.isDirty_=!0;if(this.isBeingEdited_){this.htmlInput_.value=this.getEditorText_(a)}this.setValue(a)};Blockly.FieldTextInput.prototype.resizeEditor_=function(){var a=Blockly.WidgetDiv.DIV,b=this.getScaledBBox();a.style.width=b.right-b.left+"px";a.style.height=b.bottom-b.top+"px";var c=this.sourceBlock_.RTL?b.right-a.offsetWidth:b.left,d=new Blockly.utils.Coordinate(c,b.top);a.style.left=d.x+"px";a.style.top=d.y+"px"};Blockly.FieldTextInput.numberValidator=function(a){console.warn("Blockly.FieldTextInput.numberValidator is deprecated. Use Blockly.FieldNumber instead.");if(null===a){return null}a=a+"";a=a.replace(/O/ig,"0");a=a.replace(/,/g,"");var b=+(a||0);return isNaN(b)?null:b+""};Blockly.FieldTextInput.nonnegativeIntegerValidator=function(a){var b=Blockly.FieldTextInput.numberValidator(a);if(b){b=Math.max(0,Math.floor(b))+""}return b};Blockly.FieldTextInput.prototype.isTabNavigable=function(){return!0};Blockly.FieldTextInput.prototype.getText_=function(){if(this.isBeingEdited_&&this.htmlInput_){return this.htmlInput_.value}return null};Blockly.FieldTextInput.prototype.getEditorText_=function(a){return a+""};Blockly.FieldTextInput.prototype.getValueFromEditorText_=function(a){return a};Blockly.fieldRegistry.register("field_input",Blockly.FieldTextInput);
//# sourceMappingURL=field_textinput.min.js.map
