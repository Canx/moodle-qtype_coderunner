'use strict';goog.provide("Blockly.FieldAngle");goog.require("Blockly.Css");goog.require("Blockly.DropDownDiv");goog.require("Blockly.fieldRegistry");goog.require("Blockly.FieldTextInput");goog.require("Blockly.utils.dom");goog.require("Blockly.utils.math");goog.require("Blockly.utils.object");goog.require("Blockly.utils.userAgent");Blockly.FieldAngle=function(a,b,c){this.clockwise_=Blockly.FieldAngle.CLOCKWISE;this.offset_=Blockly.FieldAngle.OFFSET;this.wrap_=Blockly.FieldAngle.WRAP;this.round_=Blockly.FieldAngle.ROUND;Blockly.FieldAngle.superClass_.constructor.call(this,a,b,c);this.gauge_=null;this.line_=null;this.clickWrapper_=null;this.clickSurfaceWrapper_=null;this.moveSurfaceWrapper_=null};Blockly.utils.object.inherits(Blockly.FieldAngle,Blockly.FieldTextInput);Blockly.FieldAngle.prototype.DEFAULT_VALUE=0;Blockly.FieldAngle.fromJson=function(a){return new Blockly.FieldAngle(a.angle,void 0,a)};Blockly.FieldAngle.prototype.SERIALIZABLE=!0;Blockly.FieldAngle.ROUND=15;Blockly.FieldAngle.HALF=50;Blockly.FieldAngle.CLOCKWISE=!1;Blockly.FieldAngle.OFFSET=0;Blockly.FieldAngle.WRAP=360;Blockly.FieldAngle.RADIUS=Blockly.FieldAngle.HALF-1;Blockly.FieldAngle.prototype.configure_=function(a){Blockly.FieldAngle.superClass_.configure_.call(this,a);switch(a.mode){case"compass":this.clockwise_=!0;this.offset_=90;break;case"protractor":this.clockwise_=!1;this.offset_=0;break;}var b=a.clockwise;if("boolean"==typeof b){this.clockwise_=b}var c=a.offset;if(null!=c){c=+c;if(!isNaN(c)){this.offset_=c}}var d=a.wrap;if(null!=d){d=+d;if(!isNaN(d)){this.wrap_=d}}var e=a.round;if(null!=e){e=+e;if(!isNaN(e)){this.round_=e}}};Blockly.FieldAngle.prototype.initView=function(){Blockly.FieldAngle.superClass_.initView.call(this);this.symbol_=Blockly.utils.dom.createSvgElement("tspan",{},null);this.symbol_.appendChild(document.createTextNode("\xB0"));this.textElement_.appendChild(this.symbol_)};Blockly.FieldAngle.prototype.render_=function(){Blockly.FieldAngle.superClass_.render_.call(this);this.updateGraph_()};Blockly.FieldAngle.prototype.showEditor_=function(a){var b=Blockly.utils.userAgent.MOBILE||Blockly.utils.userAgent.ANDROID||Blockly.utils.userAgent.IPAD;Blockly.FieldAngle.superClass_.showEditor_.call(this,a,b);var c=this.dropdownCreate_();Blockly.DropDownDiv.getContentDiv().appendChild(c);Blockly.DropDownDiv.setColour(this.sourceBlock_.style.colourPrimary,this.sourceBlock_.style.colourTertiary);Blockly.DropDownDiv.showPositionedByField(this,this.dropdownDispose_.bind(this));this.updateGraph_()};Blockly.FieldAngle.prototype.dropdownCreate_=function(){var a=Blockly.utils.dom.createSvgElement("svg",{xmlns:Blockly.utils.dom.SVG_NS,"xmlns:html":Blockly.utils.dom.HTML_NS,"xmlns:xlink":Blockly.utils.dom.XLINK_NS,version:"1.1",height:2*Blockly.FieldAngle.HALF+"px",width:2*Blockly.FieldAngle.HALF+"px",style:"touch-action: none"},null),b=Blockly.utils.dom.createSvgElement("circle",{cx:Blockly.FieldAngle.HALF,cy:Blockly.FieldAngle.HALF,r:Blockly.FieldAngle.RADIUS,class:"blocklyAngleCircle"},a);this.gauge_=Blockly.utils.dom.createSvgElement("path",{class:"blocklyAngleGauge"},a);this.line_=Blockly.utils.dom.createSvgElement("line",{x1:Blockly.FieldAngle.HALF,y1:Blockly.FieldAngle.HALF,class:"blocklyAngleLine"},a);for(var c=0;360>c;c+=15){Blockly.utils.dom.createSvgElement("line",{x1:Blockly.FieldAngle.HALF+Blockly.FieldAngle.RADIUS,y1:Blockly.FieldAngle.HALF,x2:Blockly.FieldAngle.HALF+Blockly.FieldAngle.RADIUS-(0==c%45?10:5),y2:Blockly.FieldAngle.HALF,class:"blocklyAngleMarks",transform:"rotate("+c+","+Blockly.FieldAngle.HALF+","+Blockly.FieldAngle.HALF+")"},a)}this.clickWrapper_=Blockly.bindEventWithChecks_(a,"click",this,this.hide_);this.clickSurfaceWrapper_=Blockly.bindEventWithChecks_(b,"click",this,this.onMouseMove_,!0,!0);this.moveSurfaceWrapper_=Blockly.bindEventWithChecks_(b,"mousemove",this,this.onMouseMove_,!0,!0);return a};Blockly.FieldAngle.prototype.dropdownDispose_=function(){if(this.clickWrapper_){Blockly.unbindEvent_(this.clickWrapper_);this.clickWrapper_=null}if(this.clickSurfaceWrapper_){Blockly.unbindEvent_(this.clickSurfaceWrapper_);this.clickSurfaceWrapper_=null}if(this.moveSurfaceWrapper_){Blockly.unbindEvent_(this.moveSurfaceWrapper_);this.moveSurfaceWrapper_=null}this.gauge_=null;this.line_=null};Blockly.FieldAngle.prototype.hide_=function(){Blockly.DropDownDiv.hideIfOwner(this);Blockly.WidgetDiv.hide()};Blockly.FieldAngle.prototype.onMouseMove_=function(a){var b=this.gauge_.ownerSVGElement.getBoundingClientRect(),c=a.clientX-b.left-Blockly.FieldAngle.HALF,d=a.clientY-b.top-Blockly.FieldAngle.HALF,e=Math.atan(-d/c);if(isNaN(e)){return}e=Blockly.utils.math.toDegrees(e);if(0>c){e+=180}else if(0<d){e+=360}if(this.clockwise_){e=this.offset_+360-e}else{e=360-(this.offset_-e)}this.displayMouseOrKeyboardValue_(e)};Blockly.FieldAngle.prototype.displayMouseOrKeyboardValue_=function(a){if(this.round_){a=Math.round(a/this.round_)*this.round_}a=this.wrapValue_(a);if(a!=this.value_){this.setEditorValue_(a)}};Blockly.FieldAngle.prototype.updateGraph_=function(){if(!this.gauge_){return}var a=+this.getText()+this.offset_;a%=360;var b=Blockly.utils.math.toRadians(a),c=["M ",Blockly.FieldAngle.HALF,",",Blockly.FieldAngle.HALF],d=Blockly.FieldAngle.HALF,e=Blockly.FieldAngle.HALF;if(!isNaN(b)){var f=+this.clockwise_,g=Blockly.utils.math.toRadians(this.offset_),h=Math.cos(g)*Blockly.FieldAngle.RADIUS,i=Math.sin(g)*-Blockly.FieldAngle.RADIUS;if(f){b=2*g-b}d+=Math.cos(b)*Blockly.FieldAngle.RADIUS;e-=Math.sin(b)*Blockly.FieldAngle.RADIUS;var j=Math.abs(Math.floor((b-g)/Math.PI)%2);if(f){j=1-j}c.push(" l ",h,",",i," A ",Blockly.FieldAngle.RADIUS,",",Blockly.FieldAngle.RADIUS," 0 ",j," ",f," ",d,",",e," z")}this.gauge_.setAttribute("d",c.join(""));this.line_.setAttribute("x2",d);this.line_.setAttribute("y2",e)};Blockly.FieldAngle.prototype.onHtmlInputKeyDown_=function(a){Blockly.FieldAngle.superClass_.onHtmlInputKeyDown_.call(this,a);var b;if(a.keyCode===Blockly.utils.KeyCodes.LEFT){b=this.sourceBlock_.RTL?1:-1}else if(a.keyCode===Blockly.utils.KeyCodes.RIGHT){b=this.sourceBlock_.RTL?-1:1}else if(a.keyCode===Blockly.utils.KeyCodes.DOWN){b=-1}else if(a.keyCode===Blockly.utils.KeyCodes.UP){b=1}if(b){var c=this.getValue();this.displayMouseOrKeyboardValue_(c+b*this.round_);a.preventDefault();a.stopPropagation()}};Blockly.FieldAngle.prototype.doClassValidation_=function(a){var b=+a;if(isNaN(b)||!isFinite(b)){return null}return this.wrapValue_(b)};Blockly.FieldAngle.prototype.wrapValue_=function(a){a%=360;if(0>a){a+=360}if(a>this.wrap_){a-=360}return a};Blockly.Css.register([".blocklyAngleCircle {","stroke: #444;","stroke-width: 1;","fill: #ddd;","fill-opacity: .8;","}",".blocklyAngleMarks {","stroke: #444;","stroke-width: 1;","}",".blocklyAngleGauge {","fill: #f88;","fill-opacity: .8;","pointer-events: none;","}",".blocklyAngleLine {","stroke: #f00;","stroke-width: 2;","stroke-linecap: round;","pointer-events: none;","}"]);Blockly.fieldRegistry.register("field_angle",Blockly.FieldAngle);
//# sourceMappingURL=field_angle.min.js.map
