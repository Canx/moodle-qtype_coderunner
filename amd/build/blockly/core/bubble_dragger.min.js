'use strict';goog.provide("Blockly.BubbleDragger");goog.require("Blockly.Bubble");goog.require("Blockly.Events");goog.require("Blockly.Events.CommentMove");goog.require("Blockly.utils");goog.require("Blockly.utils.Coordinate");Blockly.BubbleDragger=function(a,b){this.draggingBubble_=a;this.workspace_=b;this.deleteArea_=null;this.wouldDeleteBubble_=!1;this.startXY_=this.draggingBubble_.getRelativeToSurfaceXY();this.dragSurface_=Blockly.utils.is3dSupported()&&!!b.getBlockDragSurface()?b.getBlockDragSurface():null};Blockly.BubbleDragger.prototype.dispose=function(){this.draggingBubble_=null;this.workspace_=null;this.dragSurface_=null};Blockly.BubbleDragger.prototype.startBubbleDrag=function(){if(!Blockly.Events.getGroup()){Blockly.Events.setGroup(!0)}this.workspace_.setResizesEnabled(!1);this.draggingBubble_.setAutoLayout(!1);if(this.dragSurface_){this.moveToDragSurface_()}this.draggingBubble_.setDragging&&this.draggingBubble_.setDragging(!0);var a=this.workspace_.getToolbox();if(a&&"function"==typeof a.addStyle){var b=this.draggingBubble_.isDeletable()?"blocklyToolboxDelete":"blocklyToolboxGrab";a.addStyle(b)}};Blockly.BubbleDragger.prototype.dragBubble=function(a,b){var c=this.pixelsToWorkspaceUnits_(b),d=Blockly.utils.Coordinate.sum(this.startXY_,c);this.draggingBubble_.moveDuringDrag(this.dragSurface_,d);if(this.draggingBubble_.isDeletable()){this.deleteArea_=this.workspace_.isDeleteArea(a);this.updateCursorDuringBubbleDrag_()}};Blockly.BubbleDragger.prototype.maybeDeleteBubble_=function(){var a=this.workspace_.trashcan;if(this.wouldDeleteBubble_){if(a){setTimeout(a.close.bind(a),100)}this.fireMoveEvent_();this.draggingBubble_.dispose(!1,!0)}else if(a){a.close()}return this.wouldDeleteBubble_};Blockly.BubbleDragger.prototype.updateCursorDuringBubbleDrag_=function(){this.wouldDeleteBubble_=this.deleteArea_!=Blockly.DELETE_AREA_NONE;var a=this.workspace_.trashcan;if(this.wouldDeleteBubble_){this.draggingBubble_.setDeleteStyle(!0);if(this.deleteArea_==Blockly.DELETE_AREA_TRASH&&a){a.setOpen(!0)}}else{this.draggingBubble_.setDeleteStyle(!1);if(a){a.setOpen(!1)}}};Blockly.BubbleDragger.prototype.endBubbleDrag=function(a,b){this.dragBubble(a,b);var c=this.pixelsToWorkspaceUnits_(b),d=Blockly.utils.Coordinate.sum(this.startXY_,c);this.draggingBubble_.moveTo(d.x,d.y);var e=this.maybeDeleteBubble_();if(!e){if(this.dragSurface_){this.dragSurface_.clearAndHide(this.workspace_.getBubbleCanvas())}this.draggingBubble_.setDragging&&this.draggingBubble_.setDragging(!1);this.fireMoveEvent_()}this.workspace_.setResizesEnabled(!0);var f=this.workspace_.getToolbox();if(f&&"function"==typeof f.removeStyle){var g=this.draggingBubble_.isDeletable()?"blocklyToolboxDelete":"blocklyToolboxGrab";f.removeStyle(g)}Blockly.Events.setGroup(!1)};Blockly.BubbleDragger.prototype.fireMoveEvent_=function(){if(this.draggingBubble_.isComment){var a=new Blockly.Events.CommentMove(this.draggingBubble_);a.setOldCoordinate(this.startXY_);a.recordNew();Blockly.Events.fire(a)}};Blockly.BubbleDragger.prototype.pixelsToWorkspaceUnits_=function(a){var b=new Blockly.utils.Coordinate(a.x/this.workspace_.scale,a.y/this.workspace_.scale);if(this.workspace_.isMutator){var c=this.workspace_.options.parentWorkspace.scale;b.scale(1/c)}return b};Blockly.BubbleDragger.prototype.moveToDragSurface_=function(){this.draggingBubble_.moveTo(0,0);this.dragSurface_.translateSurface(this.startXY_.x,this.startXY_.y);this.dragSurface_.setBlocksAndShow(this.draggingBubble_.getSvgRoot())};
//# sourceMappingURL=bubble_dragger.min.js.map
