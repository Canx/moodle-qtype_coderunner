'use strict';goog.provide("Blockly.FieldMultilineInput");goog.require("Blockly.Css");goog.require("Blockly.DropDownDiv");goog.require("Blockly.FieldTextInput");goog.require("Blockly.utils");goog.require("Blockly.utils.aria");goog.require("Blockly.utils.Coordinate");goog.require("Blockly.utils.dom");goog.require("Blockly.utils.KeyCodes");goog.require("Blockly.utils.object");goog.require("Blockly.utils.userAgent");Blockly.FieldMultilineInput=function(a,b,c){Blockly.FieldMultilineInput.superClass_.constructor.call(this,a,b,c);this.textGroup_=null};Blockly.utils.object.inherits(Blockly.FieldMultilineInput,Blockly.FieldTextInput);Blockly.FieldMultilineInput.fromJson=function(a){var b=Blockly.utils.replaceMessageReferences(a.text);return new Blockly.FieldMultilineInput(b,void 0,a)};Blockly.FieldMultilineInput.prototype.initView=function(){this.createBorderRect_();this.textGroup_=Blockly.utils.dom.createSvgElement("g",{class:"blocklyEditableText"},this.fieldGroup_)};Blockly.FieldMultilineInput.prototype.getDisplayText_=function(){var a=this.value_;if(!a){return Blockly.Field.NBSP}var b=a.split("\n");a="";for(var c=0,d;c<b.length;c++){d=b[c];if(d.length>this.maxDisplayLength){d=d.substring(0,this.maxDisplayLength-4)+"..."}d=d.replace(/\s/g,Blockly.Field.NBSP);a+=d;if(c!=b.length-1){a+="\n"}}if(this.sourceBlock_.RTL){a+="\u200F"}return a};Blockly.FieldMultilineInput.prototype.render_=function(){var a;while(a=this.textGroup_.firstChild){this.textGroup_.removeChild(a)}for(var b=this.getDisplayText_().split("\n"),c=0,d=0;d<b.length;d++){var e=this.getConstants().FIELD_TEXT_HEIGHT+this.getConstants().FIELD_BORDER_RECT_Y_PADDING,f=Blockly.utils.dom.createSvgElement("text",{class:"blocklyText blocklyMultilineText",x:this.getConstants().FIELD_BORDER_RECT_X_PADDING,y:c+this.getConstants().FIELD_BORDER_RECT_Y_PADDING,dy:this.getConstants().FIELD_TEXT_BASELINE},this.textGroup_);f.appendChild(document.createTextNode(b[d]));c+=e}this.updateSize_();if(this.isBeingEdited_){if(this.sourceBlock_.RTL){setTimeout(this.resizeEditor_.bind(this),0)}else{this.resizeEditor_()}var g=this.htmlInput_;if(!this.isTextValid_){Blockly.utils.dom.addClass(g,"blocklyInvalidInput");Blockly.utils.aria.setState(g,Blockly.utils.aria.State.INVALID,!0)}else{Blockly.utils.dom.removeClass(g,"blocklyInvalidInput");Blockly.utils.aria.setState(g,Blockly.utils.aria.State.INVALID,!1)}}};Blockly.FieldMultilineInput.prototype.updateSize_=function(){for(var a=this.textGroup_.childNodes,b=0,c=0,d=0;d<a.length;d++){var e=a[d],f=Blockly.utils.dom.getTextWidth(e);if(f>b){b=f}c+=this.getConstants().FIELD_TEXT_HEIGHT+(0<d?this.getConstants().FIELD_BORDER_RECT_Y_PADDING:0)}if(this.borderRect_){c+=2*this.getConstants().FIELD_BORDER_RECT_Y_PADDING;b+=2*this.getConstants().FIELD_BORDER_RECT_X_PADDING;this.borderRect_.setAttribute("width",b);this.borderRect_.setAttribute("height",c)}this.size_.width=b;this.size_.height=c;this.positionBorderRect_()};Blockly.FieldMultilineInput.prototype.widgetCreate_=function(){var a=Blockly.WidgetDiv.DIV,b=this.workspace_.getScale(),c=document.createElement("textarea");c.className="blocklyHtmlInput blocklyHtmlTextAreaInput";c.setAttribute("spellcheck",this.spellcheck_);var d=this.getConstants().FIELD_TEXT_FONTSIZE*b+"pt";a.style.fontSize=d;c.style.fontSize=d;var e=Blockly.FieldTextInput.BORDERRADIUS*b+"px";c.style.borderRadius=e;var f=this.getConstants().FIELD_BORDER_RECT_X_PADDING*b,g=this.getConstants().FIELD_BORDER_RECT_Y_PADDING*b/2;c.style.padding=g+"px "+f+"px "+g+"px "+f+"px";var h=this.getConstants().FIELD_TEXT_HEIGHT+this.getConstants().FIELD_BORDER_RECT_Y_PADDING;c.style.lineHeight=h*b+"px";a.appendChild(c);c.value=c.defaultValue=this.getEditorText_(this.value_);c.untypedDefaultValue_=this.value_;c.oldValue_=null;if(Blockly.utils.userAgent.GECKO){setTimeout(this.resizeEditor_.bind(this),0)}else{this.resizeEditor_()}this.bindInputEvents_(c);return c};Blockly.FieldMultilineInput.prototype.onHtmlInputKeyDown_=function(a){if(a.keyCode!==Blockly.utils.KeyCodes.ENTER){Blockly.FieldMultilineInput.superClass_.onHtmlInputKeyDown_.call(this,a)}};Blockly.Css.register([".blocklyHtmlTextAreaInput {","font-family: monospace;","resize: none;","overflow: hidden;","height: 100%;","text-align: left;","}"]);Blockly.fieldRegistry.register("field_multilinetext",Blockly.FieldMultilineInput);
//# sourceMappingURL=field_multilineinput.min.js.map
