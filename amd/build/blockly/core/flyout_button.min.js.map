{"version":3,"sources":["../../../src/blockly/core/flyout_button.js"],"names":["goog","provide","require","Blockly","FlyoutButton","workspace","targetWorkspace","json","isLabel","workspace_","targetWorkspace_","text_","position_","utils","Coordinate","isLabel_","callbackKey_","cssClass_","onMouseUpWrapper_","MARGIN_X","MARGIN_Y","prototype","width","height","createDom","cssClass","svgGroup_","dom","createSvgElement","getCanvas","shadow","rect","svgText","text","replaceMessageReferences","RTL","textContent","svgText_","getThemeManager","subscribe","fontSize","style","getComputedStyle","fontWeight","fontFamily","getFastTextWidthWithSizeString","fontMetrics","measureFontMetrics","setAttribute","baseline","updateTransform_","bindEventWithChecks_","onMouseUp_","show","x","y","moveTo","getPosition","getTargetWorkspace","dispose","unbindEvent_","removeNode","unsubscribe","e","gesture","getGesture","cancel","console","warn","getButtonCallback","Css","register"],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright 2016 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Class for a button in the flyout.\n * @author fenichel@google.com (Rachel Fenichel)\n */\n'use strict';\n\ngoog.provide('Blockly.FlyoutButton');\n\ngoog.require('Blockly.Css');\ngoog.require('Blockly.utils');\ngoog.require('Blockly.utils.Coordinate');\ngoog.require('Blockly.utils.dom');\n\n\n/**\n * Class for a button in the flyout.\n * @param {!Blockly.WorkspaceSvg} workspace The workspace in which to place this\n *     button.\n * @param {!Blockly.WorkspaceSvg} targetWorkspace The flyout's target workspace.\n * @param {!Blockly.utils.toolbox.Button|!Blockly.utils.toolbox.Label} json\n *    The JSON specifying the label/button.\n * @param {boolean} isLabel Whether this button should be styled as a label.\n * @constructor\n * @package\n */\nBlockly.FlyoutButton = function(workspace, targetWorkspace, json, isLabel) {\n  // Labels behave the same as buttons, but are styled differently.\n\n  /**\n   * @type {!Blockly.WorkspaceSvg}\n   * @private\n   */\n  this.workspace_ = workspace;\n\n  /**\n   * @type {!Blockly.WorkspaceSvg}\n   * @private\n   */\n  this.targetWorkspace_ = targetWorkspace;\n\n  /**\n   * @type {string}\n   * @private\n   */\n  this.text_ = json['text'];\n\n  /**\n   * @type {!Blockly.utils.Coordinate}\n   * @private\n   */\n  this.position_ = new Blockly.utils.Coordinate(0, 0);\n\n  /**\n   * Whether this button should be styled as a label.\n   * @type {boolean}\n   * @private\n   */\n  this.isLabel_ = isLabel;\n\n  /**\n   * The key to the function called when this button is clicked.\n   * @type {string}\n   * @private\n   */\n  this.callbackKey_ = json['callbackKey'] ||\n  /* Check the lower case version too to satisfy IE */\n                      json['callbackkey'];\n\n  /**\n   * If specified, a CSS class to add to this button.\n   * @type {?string}\n   * @private\n   */\n  this.cssClass_ = json['web-class'] || null;\n\n  /**\n   * Mouse up event data.\n   * @type {?Blockly.EventData}\n   * @private\n   */\n  this.onMouseUpWrapper_ = null;\n};\n\n/**\n * The horizontal margin around the text in the button.\n */\nBlockly.FlyoutButton.MARGIN_X = 5;\n\n/**\n * The vertical margin around the text in the button.\n */\nBlockly.FlyoutButton.MARGIN_Y = 2;\n\n/**\n * The width of the button's rect.\n * @type {number}\n */\nBlockly.FlyoutButton.prototype.width = 0;\n\n/**\n * The height of the button's rect.\n * @type {number}\n */\nBlockly.FlyoutButton.prototype.height = 0;\n\n/**\n * Create the button elements.\n * @return {!SVGElement} The button's SVG group.\n */\nBlockly.FlyoutButton.prototype.createDom = function() {\n  var cssClass = this.isLabel_ ? 'blocklyFlyoutLabel' : 'blocklyFlyoutButton';\n  if (this.cssClass_) {\n    cssClass += ' ' + this.cssClass_;\n  }\n\n  this.svgGroup_ = Blockly.utils.dom.createSvgElement('g', {'class': cssClass},\n      this.workspace_.getCanvas());\n\n  if (!this.isLabel_) {\n    // Shadow rectangle (light source does not mirror in RTL).\n    var shadow = Blockly.utils.dom.createSvgElement('rect',\n        {\n          'class': 'blocklyFlyoutButtonShadow',\n          'rx': 4, 'ry': 4, 'x': 1, 'y': 1\n        },\n        this.svgGroup_);\n  }\n  // Background rectangle.\n  var rect = Blockly.utils.dom.createSvgElement('rect',\n      {\n        'class': this.isLabel_ ?\n            'blocklyFlyoutLabelBackground' : 'blocklyFlyoutButtonBackground',\n        'rx': 4, 'ry': 4\n      },\n      this.svgGroup_);\n\n  var svgText = Blockly.utils.dom.createSvgElement('text',\n      {\n        'class': this.isLabel_ ? 'blocklyFlyoutLabelText' : 'blocklyText',\n        'x': 0,\n        'y': 0,\n        'text-anchor': 'middle'\n      },\n      this.svgGroup_);\n  var text = Blockly.utils.replaceMessageReferences(this.text_);\n  if (this.workspace_.RTL) {\n    // Force text to be RTL by adding an RLM.\n    text += '\\u200F';\n  }\n  svgText.textContent = text;\n  if (this.isLabel_) {\n    this.svgText_ = svgText;\n    this.workspace_.getThemeManager().subscribe(this.svgText_,\n        'flyoutForegroundColour', 'fill');\n  }\n\n  var fontSize = Blockly.utils.style.getComputedStyle(svgText, 'fontSize');\n  var fontWeight = Blockly.utils.style.getComputedStyle(svgText, 'fontWeight');\n  var fontFamily = Blockly.utils.style.getComputedStyle(svgText, 'fontFamily');\n  this.width = Blockly.utils.dom.getFastTextWidthWithSizeString(svgText,\n      fontSize, fontWeight, fontFamily);\n  var fontMetrics = Blockly.utils.dom.measureFontMetrics(text, fontSize,\n      fontWeight, fontFamily);\n  this.height = fontMetrics.height;\n\n  if (!this.isLabel_) {\n    this.width += 2 * Blockly.FlyoutButton.MARGIN_X;\n    this.height += 2 * Blockly.FlyoutButton.MARGIN_Y;\n    shadow.setAttribute('width', this.width);\n    shadow.setAttribute('height', this.height);\n  }\n  rect.setAttribute('width', this.width);\n  rect.setAttribute('height', this.height);\n\n  svgText.setAttribute('x', this.width / 2);\n  svgText.setAttribute('y', this.height / 2 - fontMetrics.height / 2 +\n      fontMetrics.baseline);\n\n  this.updateTransform_();\n\n  this.onMouseUpWrapper_ = Blockly.bindEventWithChecks_(\n      this.svgGroup_, 'mouseup', this, this.onMouseUp_);\n  return this.svgGroup_;\n};\n\n/**\n * Correctly position the flyout button and make it visible.\n */\nBlockly.FlyoutButton.prototype.show = function() {\n  this.updateTransform_();\n  this.svgGroup_.setAttribute('display', 'block');\n};\n\n/**\n * Update SVG attributes to match internal state.\n * @private\n */\nBlockly.FlyoutButton.prototype.updateTransform_ = function() {\n  this.svgGroup_.setAttribute('transform',\n      'translate(' + this.position_.x + ',' + this.position_.y + ')');\n};\n\n/**\n * Move the button to the given x, y coordinates.\n * @param {number} x The new x coordinate.\n * @param {number} y The new y coordinate.\n */\nBlockly.FlyoutButton.prototype.moveTo = function(x, y) {\n  this.position_.x = x;\n  this.position_.y = y;\n  this.updateTransform_();\n};\n\n/**\n * Location of the button.\n * @return {!Blockly.utils.Coordinate} x, y coordinates.\n * @package\n */\nBlockly.FlyoutButton.prototype.getPosition = function() {\n  return this.position_;\n};\n\n/**\n * Get the button's target workspace.\n * @return {!Blockly.WorkspaceSvg} The target workspace of the flyout where this\n *     button resides.\n */\nBlockly.FlyoutButton.prototype.getTargetWorkspace = function() {\n  return this.targetWorkspace_;\n};\n\n/**\n * Dispose of this button.\n */\nBlockly.FlyoutButton.prototype.dispose = function() {\n  if (this.onMouseUpWrapper_) {\n    Blockly.unbindEvent_(this.onMouseUpWrapper_);\n  }\n  if (this.svgGroup_) {\n    Blockly.utils.dom.removeNode(this.svgGroup_);\n  }\n  if (this.svgText_) {\n    this.workspace_.getThemeManager().unsubscribe(this.svgText_);\n  }\n};\n\n/**\n * Do something when the button is clicked.\n * @param {!Event} e Mouse up event.\n * @private\n */\nBlockly.FlyoutButton.prototype.onMouseUp_ = function(e) {\n  var gesture = this.targetWorkspace_.getGesture(e);\n  if (gesture) {\n    gesture.cancel();\n  }\n\n  if (this.isLabel_ && this.callbackKey_) {\n    console.warn('Labels should not have callbacks. Label text: ' + this.text_);\n  } else if (!this.isLabel_ && !(this.callbackKey_ &&\n      this.targetWorkspace_.getButtonCallback(this.callbackKey_))) {\n    console.warn('Buttons should have callbacks. Button text: ' + this.text_);\n  } else if (!this.isLabel_) {\n    this.targetWorkspace_.getButtonCallback(this.callbackKey_)(this);\n  }\n};\n\n/**\n * CSS for buttons and labels.  See css.js for use.\n */\nBlockly.Css.register([\n  /* eslint-disable indent */\n  '.blocklyFlyoutButton {',\n    'fill: #888;',\n    'cursor: default;',\n  '}',\n\n  '.blocklyFlyoutButtonShadow {',\n    'fill: #666;',\n  '}',\n\n  '.blocklyFlyoutButton:hover {',\n    'fill: #aaa;',\n  '}',\n\n  '.blocklyFlyoutLabel {',\n    'cursor: default;',\n  '}',\n\n  '.blocklyFlyoutLabelBackground {',\n    'opacity: 0;',\n  '}',\n  /* eslint-enable indent */\n]);\n"],"file":"flyout_button.min.js"}