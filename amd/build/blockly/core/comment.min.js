'use strict';goog.provide("Blockly.Comment");goog.require("Blockly.Bubble");goog.require("Blockly.Css");goog.require("Blockly.Events");goog.require("Blockly.Events.BlockChange");goog.require("Blockly.Events.Ui");goog.require("Blockly.Icon");goog.require("Blockly.utils.dom");goog.require("Blockly.utils.object");goog.require("Blockly.utils.userAgent");goog.require("Blockly.Warning");Blockly.Comment=function(a){Blockly.Comment.superClass_.constructor.call(this,a);this.model_=a.commentModel;this.model_.text=this.model_.text||"";this.cachedText_="";this.onMouseUpWrapper_=null;this.onWheelWrapper_=null;this.onChangeWrapper_=null;this.onInputWrapper_=null;this.createIcon()};Blockly.utils.object.inherits(Blockly.Comment,Blockly.Icon);Blockly.Comment.prototype.drawIcon_=function(a){Blockly.utils.dom.createSvgElement("circle",{class:"blocklyIconShape",r:"8",cx:"8",cy:"8"},a);Blockly.utils.dom.createSvgElement("path",{class:"blocklyIconSymbol",d:"m6.8,10h2c0.003,-0.617 0.271,-0.962 0.633,-1.266 2.875,-2.4050.607,-5.534 -3.765,-3.874v1.7c3.12,-1.657 3.698,0.118 2.336,1.25-1.201,0.998 -1.201,1.528 -1.204,2.19z"},a);Blockly.utils.dom.createSvgElement("rect",{class:"blocklyIconSymbol",x:"6.8",y:"10.78",height:"2",width:"2"},a)};Blockly.Comment.prototype.createEditor_=function(){this.foreignObject_=Blockly.utils.dom.createSvgElement("foreignObject",{x:Blockly.Bubble.BORDER_WIDTH,y:Blockly.Bubble.BORDER_WIDTH},null);var a=document.createElementNS(Blockly.utils.dom.HTML_NS,"body");a.setAttribute("xmlns",Blockly.utils.dom.HTML_NS);a.className="blocklyMinimalBody";this.textarea_=document.createElementNS(Blockly.utils.dom.HTML_NS,"textarea");var b=this.textarea_;b.className="blocklyCommentTextarea";b.setAttribute("dir",this.block_.RTL?"RTL":"LTR");b.value=this.model_.text;this.resizeTextarea_();a.appendChild(b);this.foreignObject_.appendChild(a);this.onMouseUpWrapper_=Blockly.bindEventWithChecks_(b,"mouseup",this,this.startEdit_,!0,!0);this.onWheelWrapper_=Blockly.bindEventWithChecks_(b,"wheel",this,function(a){a.stopPropagation()});this.onChangeWrapper_=Blockly.bindEventWithChecks_(b,"change",this,function(){if(this.cachedText_!=this.model_.text){Blockly.Events.fire(new Blockly.Events.BlockChange(this.block_,"comment",null,this.cachedText_,this.model_.text))}});this.onInputWrapper_=Blockly.bindEventWithChecks_(b,"input",this,function(){this.model_.text=b.value});setTimeout(b.focus.bind(b),0);return this.foreignObject_};Blockly.Comment.prototype.updateEditable=function(){Blockly.Comment.superClass_.updateEditable.call(this);if(this.isVisible()){this.disposeBubble_();this.createBubble_()}};Blockly.Comment.prototype.onBubbleResize_=function(){if(!this.isVisible()){return}this.model_.size=this.bubble_.getBubbleSize();this.resizeTextarea_()};Blockly.Comment.prototype.resizeTextarea_=function(){var a=this.model_.size,b=2*Blockly.Bubble.BORDER_WIDTH,c=a.width-b,d=a.height-b;this.foreignObject_.setAttribute("width",c);this.foreignObject_.setAttribute("height",d);this.textarea_.style.width=c-4+"px";this.textarea_.style.height=d-4+"px"};Blockly.Comment.prototype.setVisible=function(a){if(a==this.isVisible()){return}Blockly.Events.fire(new Blockly.Events.Ui(this.block_,"commentOpen",!a,a));this.model_.pinned=a;if(a){this.createBubble_()}else{this.disposeBubble_()}};Blockly.Comment.prototype.createBubble_=function(){if(!this.block_.isEditable()||Blockly.utils.userAgent.IE){this.createNonEditableBubble_()}else{this.createEditableBubble_()}};Blockly.Comment.prototype.createEditableBubble_=function(){this.bubble_=new Blockly.Bubble(this.block_.workspace,this.createEditor_(),this.block_.pathObject.svgPath,this.iconXY_,this.model_.size.width,this.model_.size.height);this.bubble_.setSvgId(this.block_.id);this.bubble_.registerResizeEvent(this.onBubbleResize_.bind(this));this.applyColour()};Blockly.Comment.prototype.createNonEditableBubble_=function(){Blockly.Warning.prototype.createBubble.call(this)};Blockly.Comment.prototype.disposeBubble_=function(){if(this.paragraphElement_){Blockly.Warning.prototype.disposeBubble.call(this);return}if(this.onMouseUpWrapper_){Blockly.unbindEvent_(this.onMouseUpWrapper_);this.onMouseUpWrapper_=null}if(this.onWheelWrapper_){Blockly.unbindEvent_(this.onWheelWrapper_);this.onWheelWrapper_=null}if(this.onChangeWrapper_){Blockly.unbindEvent_(this.onChangeWrapper_);this.onChangeWrapper_=null}if(this.onInputWrapper_){Blockly.unbindEvent_(this.onInputWrapper_);this.onInputWrapper_=null}this.bubble_.dispose();this.bubble_=null;this.textarea_=null;this.foreignObject_=null};Blockly.Comment.prototype.startEdit_=function(){if(this.bubble_.promote()){this.textarea_.focus()}this.cachedText_=this.model_.text};Blockly.Comment.prototype.getBubbleSize=function(){return this.model_.size};Blockly.Comment.prototype.setBubbleSize=function(a,b){if(this.bubble_){this.bubble_.setBubbleSize(a,b)}else{this.model_.size.width=a;this.model_.size.height=b}};Blockly.Comment.prototype.getText=function(){return this.model_.text||""};Blockly.Comment.prototype.setText=function(a){if(this.model_.text==a){return}this.model_.text=a;this.updateText()};Blockly.Comment.prototype.updateText=function(){if(this.textarea_){this.textarea_.value=this.model_.text}else if(this.paragraphElement_){this.paragraphElement_.firstChild.textContent=this.model_.text}};Blockly.Comment.prototype.dispose=function(){this.block_.comment=null;Blockly.Icon.prototype.dispose.call(this)};Blockly.Css.register([".blocklyCommentTextarea {","background-color: #fef49c;","border: 0;","outline: 0;","margin: 0;","padding: 3px;","resize: none;","display: block;","overflow: hidden;","}"]);
//# sourceMappingURL=comment.min.js.map
