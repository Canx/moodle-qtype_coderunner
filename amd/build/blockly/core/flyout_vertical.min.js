'use strict';goog.provide("Blockly.VerticalFlyout");goog.require("Blockly.Block");goog.require("Blockly.Flyout");goog.require("Blockly.Scrollbar");goog.require("Blockly.utils");goog.require("Blockly.utils.object");goog.require("Blockly.utils.Rect");goog.require("Blockly.utils.userAgent");goog.require("Blockly.WidgetDiv");goog.requireType("Blockly.utils.Metrics");Blockly.VerticalFlyout=function(a){Blockly.VerticalFlyout.superClass_.constructor.call(this,a)};Blockly.utils.object.inherits(Blockly.VerticalFlyout,Blockly.Flyout);Blockly.VerticalFlyout.prototype.getMetrics_=function(){if(!this.isVisible()){return null}try{var a=this.workspace_.getCanvas().getBBox()}catch(b){var a={height:0,y:0,width:0,x:0}}var b=this.SCROLLBAR_PADDING,c=this.height_-2*this.SCROLLBAR_PADDING,d=this.width_;if(!this.RTL){d-=this.SCROLLBAR_PADDING}var e={contentHeight:a.height*this.workspace_.scale+2*this.MARGIN,contentWidth:a.width*this.workspace_.scale+2*this.MARGIN,contentTop:a.y,contentLeft:a.x,viewHeight:c,viewWidth:d,viewTop:-this.workspace_.scrollY+a.y,viewLeft:-this.workspace_.scrollX,absoluteTop:b,absoluteLeft:0};return e};Blockly.VerticalFlyout.prototype.setMetrics_=function(a){var b=this.getMetrics_();if(!b){return}if("number"==typeof a.y){this.workspace_.scrollY=-b.contentHeight*a.y}this.workspace_.translate(this.workspace_.scrollX+b.absoluteLeft,this.workspace_.scrollY+b.absoluteTop)};Blockly.VerticalFlyout.prototype.position=function(){if(!this.isVisible()){return}var a=this.targetWorkspace.getMetrics();if(!a){return}this.height_=a.viewHeight;var b=this.width_-this.CORNER_RADIUS,c=a.viewHeight-2*this.CORNER_RADIUS;this.setBackgroundPath_(b,c);if(this.targetWorkspace.toolboxPosition==this.toolboxPosition_){if(a.toolboxWidth){if(this.toolboxPosition_==Blockly.TOOLBOX_AT_LEFT){var d=a.toolboxWidth}else{var d=a.viewWidth-this.width_}}else{if(this.toolboxPosition_==Blockly.TOOLBOX_AT_LEFT){var d=0}else{var d=a.viewWidth}}}else{if(this.toolboxPosition_==Blockly.TOOLBOX_AT_LEFT){var d=0}else{var d=a.viewWidth+a.absoluteLeft-this.width_}}this.positionAt_(this.width_,this.height_,d,0)};Blockly.VerticalFlyout.prototype.setBackgroundPath_=function(a,b){var c=this.toolboxPosition_==Blockly.TOOLBOX_AT_RIGHT,d=a+this.CORNER_RADIUS,e=["M "+(c?d:0)+",0"];e.push("h",c?-a:a);e.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,c?0:1,c?-this.CORNER_RADIUS:this.CORNER_RADIUS,this.CORNER_RADIUS);e.push("v",Math.max(0,b));e.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,c?0:1,c?this.CORNER_RADIUS:-this.CORNER_RADIUS,this.CORNER_RADIUS);e.push("h",c?a:-a);e.push("z");this.svgBackground_.setAttribute("d",e.join(" "))};Blockly.VerticalFlyout.prototype.scrollToStart=function(){this.scrollbar.set(0)};Blockly.VerticalFlyout.prototype.wheel_=function(a){var b=Blockly.utils.getScrollDeltaPixels(a);if(b.y){var c=this.getMetrics_(),d=c.viewTop-c.contentTop+b.y,e=c.contentHeight-c.viewHeight;d=Math.min(d,e);d=Math.max(d,0);this.scrollbar.set(d);Blockly.WidgetDiv.hide();Blockly.DropDownDiv.hideWithoutAnimation()}a.preventDefault();a.stopPropagation()};Blockly.VerticalFlyout.prototype.layout_=function(a,b){this.workspace_.scale=this.targetWorkspace.scale;for(var c=this.MARGIN,d=this.RTL?c:c+this.tabWidth_,e=c,f=0,g;g=a[f];f++){if("block"==g.type){for(var h=g.block,k=h.getDescendants(!1),l=0,m;m=k[l];l++){m.isInFlyout=!0}h.render();var n=h.getSvgRoot(),o=h.getHeightWidth(),p=h.outputConnection?d-this.tabWidth_:d;h.moveBy(p,e);var q=this.createRect_(h,this.RTL?p-o.width:p,e,o,f);this.addBlockListeners_(n,h,q);e+=o.height+b[f]}else if("button"==g.type){this.initFlyoutButton_(g.button,d,e);e+=g.button.height+b[f]}}};Blockly.VerticalFlyout.prototype.isDragTowardWorkspace=function(a){var b=a.x,c=a.y,d=180*(Math.atan2(c,b)/Math.PI),e=this.dragAngleRange_;if(d<e&&d>-e||d<-180+e||d>180-e){return!0}return!1};Blockly.VerticalFlyout.prototype.getClientRect=function(){if(!this.svgGroup_){return null}var a=this.svgGroup_.getBoundingClientRect(),b=1e9,c=a.left;if(this.toolboxPosition_==Blockly.TOOLBOX_AT_LEFT){var d=a.width;return new Blockly.utils.Rect(-b,b,-b,c+d)}else{return new Blockly.utils.Rect(-b,b,c,b)}};Blockly.VerticalFlyout.prototype.reflowInternal_=function(){this.workspace_.scale=this.targetWorkspace.scale;for(var a=0,b=this.workspace_.getTopBlocks(!1),c=0,d,e;d=b[c];c++){e=d.getHeightWidth().width;if(d.outputConnection){e-=this.tabWidth_}a=Math.max(a,e)}for(var c=0,f;f=this.buttons_[c];c++){a=Math.max(a,f.width)}a+=1.5*this.MARGIN+this.tabWidth_;a*=this.workspace_.scale;a+=Blockly.Scrollbar.scrollbarThickness;if(this.width_!=a){for(var c=0,d;d=b[c];c++){if(this.RTL){var g=d.getRelativeToSurfaceXY().x,h=a/this.workspace_.scale-this.MARGIN;if(!d.outputConnection){h-=this.tabWidth_}d.moveBy(h-g,0)}if(d.flyoutRect_){this.moveRectToBlock_(d.flyoutRect_,d)}}if(this.RTL){for(var c=0,f;f=this.buttons_[c];c++){var j=f.getPosition().y,k=a/this.workspace_.scale-f.width-this.MARGIN-this.tabWidth_;f.moveTo(k,j)}}this.width_=a;this.position()}};
//# sourceMappingURL=flyout_vertical.min.js.map
