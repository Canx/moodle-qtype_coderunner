{"version":3,"sources":["../../../src/blockly/core/inject.js"],"names":["goog","provide","require","requireType","Blockly","inject","container","opt_options","checkBlockColourConstants","document","getElementById","querySelector","utils","dom","containsNode","Error","options","Options","subContainer","createElement","className","tabIndex","aria","setState","State","LABEL","Msg","appendChild","svg","createDom_","blockDragSurface","BlockDragSurfaceSvg","workspaceDragSurface","WorkspaceDragSurfaceSvg","workspace","createMainWorkspace_","user","keyMap","setKeyMap","init_","mainWorkspace","svgResize","addEventListener","setAttribute","Component","defaultRightToLeft","RTL","Css","hasCss","pathToMedia","createSvgElement","SVG_NS","HTML_NS","XLINK_NS","defs","rnd","Math","random","substring","gridPattern","Grid","createDom","gridOptions","parentWorkspace","WorkspaceSvg","wsOptions","scale","zoomOptions","startScale","addClass","getInjectionDiv","getRenderer","getClassName","getTheme","hasCategories","languageTree","flyout","addFlyout","insertAfter","hasTrashcan","addTrashcan","controls","addZoomControls","getThemeManager","subscribe","translate","readOnly","isMovable","getWorkspaceMetrics","workspaceMetrics","Object","create","defaultMetrics","getMetrics","viewLeft","viewTop","viewRight","viewWidth","viewBottom","viewHeight","isContentBounded","blocksBoundingBox","getBlocksBoundingBox","contentLeft","left","contentTop","top","contentRight","right","contentBottom","bottom","contentWidth","contentHeight","getObjectMetrics","object","objectMetrics","getBoundingRectangle","height","width","bumpObjects","e","isDragging","Events","BUMP_EVENTS","indexOf","type","metrics","oldGroup","getGroup","setGroup","group","BLOCK_CREATE","BLOCK_MOVE","getBlockById","blockId","getRootBlock","COMMENT_CREATE","COMMENT_MOVE","getCommentById","commentId","topClamp","bottomClamp","max","newYPosition","math","clamp","deltaY","leftClamp","rightClamp","min","newXPosition","deltaX","moveBy","console","log","addChangeListener","WidgetDiv","DropDownDiv","Tooltip","getParentSvg","bindEventWithChecks_","parentNode","isTargetInput","preventDefault","workspaceResizeHandler","window","hideChaff","setResizeHandlerWrapper","bindDocumentEvents_","toolbox","getToolbox","getFlyout","init","show","scrollToStart","verticalSpacing","Scrollbar","scrollbarThickness","trashcan","zoomControls_","moveOptions","scrollbars","scrollbar","ScrollbarPair","resize","setMetrics","x","y","hasSounds","loadSounds_","documentEventsBound_","workspaces","Workspace","getAll","i","updateInverseScreenCTM","onKeyDown","bindEvent_","longStop_","userAgent","IPAD","getMainWorkspace","audioMgr","getAudioManager","load","soundBinds","unbindSounds","length","unbindEvent_","pop","preload","push"],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Functions for injecting Blockly into a web page.\n * @author fraser@google.com (Neil Fraser)\n */\n'use strict';\n\ngoog.provide('Blockly.inject');\n\ngoog.require('Blockly.BlockDragSurfaceSvg');\ngoog.require('Blockly.Component');\ngoog.require('Blockly.Css');\ngoog.require('Blockly.DropDownDiv');\ngoog.require('Blockly.Events');\ngoog.require('Blockly.Grid');\ngoog.require('Blockly.Msg');\ngoog.require('Blockly.Options');\ngoog.require('Blockly.ScrollbarPair');\ngoog.require('Blockly.Tooltip');\ngoog.require('Blockly.user.keyMap');\ngoog.require('Blockly.utils');\ngoog.require('Blockly.utils.dom');\ngoog.require('Blockly.utils.userAgent');\ngoog.require('Blockly.WorkspaceDragSurfaceSvg');\ngoog.require('Blockly.WorkspaceSvg');\n\ngoog.requireType('Blockly.utils.Metrics');\n\n\n/**\n * Inject a Blockly editor into the specified container element (usually a div).\n * @param {Element|string} container Containing element, or its ID,\n *     or a CSS selector.\n * @param {Blockly.BlocklyOptions=} opt_options Optional dictionary of options.\n * @return {!Blockly.WorkspaceSvg} Newly created main workspace.\n */\nBlockly.inject = function(container, opt_options) {\n  Blockly.checkBlockColourConstants();\n\n  if (typeof container == 'string') {\n    container = document.getElementById(container) ||\n        document.querySelector(container);\n  }\n  // Verify that the container is in document.\n  if (!container || !Blockly.utils.dom.containsNode(document, container)) {\n    throw Error('Error: container is not in current document.');\n  }\n  var options = new Blockly.Options(opt_options ||\n    (/** @type {!Blockly.BlocklyOptions} */ ({})));\n  var subContainer = document.createElement('div');\n  subContainer.className = 'injectionDiv';\n  subContainer.tabIndex = 0;\n  Blockly.utils.aria.setState(subContainer,\n      Blockly.utils.aria.State.LABEL, Blockly.Msg['WORKSPACE_ARIA_LABEL']);\n\n  container.appendChild(subContainer);\n  var svg = Blockly.createDom_(subContainer, options);\n\n  // Create surfaces for dragging things. These are optimizations\n  // so that the browser does not repaint during the drag.\n  var blockDragSurface = new Blockly.BlockDragSurfaceSvg(subContainer);\n  var workspaceDragSurface = new Blockly.WorkspaceDragSurfaceSvg(subContainer);\n\n  var workspace = Blockly.createMainWorkspace_(svg, options, blockDragSurface,\n      workspaceDragSurface);\n  Blockly.user.keyMap.setKeyMap(options.keyMap);\n\n  Blockly.init_(workspace);\n\n  // Keep focus on the first workspace so entering keyboard navigation looks correct.\n  Blockly.mainWorkspace = workspace;\n\n  Blockly.svgResize(workspace);\n\n  subContainer.addEventListener('focusin', function() {\n    Blockly.mainWorkspace = workspace;\n  });\n\n  return workspace;\n};\n\n/**\n * Create the SVG image.\n * @param {!Element} container Containing element.\n * @param {!Blockly.Options} options Dictionary of options.\n * @return {!Element} Newly created SVG image.\n * @private\n */\nBlockly.createDom_ = function(container, options) {\n  // Sadly browsers (Chrome vs Firefox) are currently inconsistent in laying\n  // out content in RTL mode.  Therefore Blockly forces the use of LTR,\n  // then manually positions content in RTL as needed.\n  container.setAttribute('dir', 'LTR');\n  // Set the default direction for Components to use.\n  Blockly.Component.defaultRightToLeft = options.RTL;\n\n  // Load CSS.\n  Blockly.Css.inject(options.hasCss, options.pathToMedia);\n\n  // Build the SVG DOM.\n  /*\n  <svg\n    xmlns=\"http://www.w3.org/2000/svg\"\n    xmlns:html=\"http://www.w3.org/1999/xhtml\"\n    xmlns:xlink=\"http://www.w3.org/1999/xlink\"\n    version=\"1.1\"\n    class=\"blocklySvg\">\n    ...\n  </svg>\n  */\n  var svg = Blockly.utils.dom.createSvgElement('svg', {\n    'xmlns': Blockly.utils.dom.SVG_NS,\n    'xmlns:html': Blockly.utils.dom.HTML_NS,\n    'xmlns:xlink': Blockly.utils.dom.XLINK_NS,\n    'version': '1.1',\n    'class': 'blocklySvg',\n    'tabindex': '0'\n  }, container);\n  /*\n  <defs>\n    ... filters go here ...\n  </defs>\n  */\n  var defs = Blockly.utils.dom.createSvgElement('defs', {}, svg);\n  // Each filter/pattern needs a unique ID for the case of multiple Blockly\n  // instances on a page.  Browser behaviour becomes undefined otherwise.\n  // https://neil.fraser.name/news/2015/11/01/\n  var rnd = String(Math.random()).substring(2);\n\n  options.gridPattern = Blockly.Grid.createDom(rnd, options.gridOptions, defs);\n  return svg;\n};\n\n/**\n * Create a main workspace and add it to the SVG.\n * @param {!Element} svg SVG element with pattern defined.\n * @param {!Blockly.Options} options Dictionary of options.\n * @param {!Blockly.BlockDragSurfaceSvg} blockDragSurface Drag surface SVG\n *     for the blocks.\n * @param {!Blockly.WorkspaceDragSurfaceSvg} workspaceDragSurface Drag surface\n *     SVG for the workspace.\n * @return {!Blockly.WorkspaceSvg} Newly created main workspace.\n * @private\n */\nBlockly.createMainWorkspace_ = function(svg, options, blockDragSurface,\n    workspaceDragSurface) {\n  options.parentWorkspace = null;\n  var mainWorkspace =\n      new Blockly.WorkspaceSvg(options, blockDragSurface, workspaceDragSurface);\n  var wsOptions = mainWorkspace.options;\n  mainWorkspace.scale = wsOptions.zoomOptions.startScale;\n  svg.appendChild(mainWorkspace.createDom('blocklyMainBackground'));\n\n  // Set the theme name and renderer name onto the injection div.\n  Blockly.utils.dom.addClass(mainWorkspace.getInjectionDiv(),\n      mainWorkspace.getRenderer().getClassName());\n  Blockly.utils.dom.addClass(mainWorkspace.getInjectionDiv(),\n      mainWorkspace.getTheme().getClassName());\n\n  if (!wsOptions.hasCategories && wsOptions.languageTree) {\n    // Add flyout as an <svg> that is a sibling of the workspace svg.\n    var flyout = mainWorkspace.addFlyout('svg');\n    Blockly.utils.dom.insertAfter(flyout, svg);\n  }\n  if (wsOptions.hasTrashcan) {\n    mainWorkspace.addTrashcan();\n  }\n  if (wsOptions.zoomOptions && wsOptions.zoomOptions.controls) {\n    mainWorkspace.addZoomControls();\n  }\n  // Register the workspace svg as a UI component.\n  mainWorkspace.getThemeManager().subscribe(svg, 'workspaceBackgroundColour',\n      'background-color');\n\n  // A null translation will also apply the correct initial scale.\n  mainWorkspace.translate(0, 0);\n\n  if (!wsOptions.readOnly && !mainWorkspace.isMovable()) {\n    // Helper function for the workspaceChanged callback.\n    // TODO (#2300): Move metrics math back to the WorkspaceSvg.\n    var getWorkspaceMetrics = function() {\n      var workspaceMetrics = Object.create(null);\n      var defaultMetrics = mainWorkspace.getMetrics();\n      var scale = mainWorkspace.scale;\n\n      workspaceMetrics.RTL = mainWorkspace.RTL;\n\n      // Get the view metrics in workspace units.\n      workspaceMetrics.viewLeft = defaultMetrics.viewLeft / scale;\n      workspaceMetrics.viewTop = defaultMetrics.viewTop / scale;\n      workspaceMetrics.viewRight =\n          (defaultMetrics.viewLeft + defaultMetrics.viewWidth) / scale;\n      workspaceMetrics.viewBottom =\n          (defaultMetrics.viewTop + defaultMetrics.viewHeight) / scale;\n\n      // Get the exact content metrics (in workspace units), even if the\n      // content is bounded.\n      if (mainWorkspace.isContentBounded()) {\n        // Already in workspace units, no need to divide by scale.\n        var blocksBoundingBox = mainWorkspace.getBlocksBoundingBox();\n        workspaceMetrics.contentLeft = blocksBoundingBox.left;\n        workspaceMetrics.contentTop = blocksBoundingBox.top;\n        workspaceMetrics.contentRight = blocksBoundingBox.right;\n        workspaceMetrics.contentBottom = blocksBoundingBox.bottom;\n      } else {\n        workspaceMetrics.contentLeft = defaultMetrics.contentLeft / scale;\n        workspaceMetrics.contentTop = defaultMetrics.contentTop / scale;\n        workspaceMetrics.contentRight =\n            (defaultMetrics.contentLeft + defaultMetrics.contentWidth) / scale;\n        workspaceMetrics.contentBottom =\n            (defaultMetrics.contentTop + defaultMetrics.contentHeight) / scale;\n      }\n\n      return workspaceMetrics;\n    };\n\n    var getObjectMetrics = function(object) {\n      var objectMetrics = object.getBoundingRectangle();\n      objectMetrics.height = objectMetrics.bottom - objectMetrics.top;\n      objectMetrics.width = objectMetrics.right - objectMetrics.left;\n      return objectMetrics;\n    };\n\n    var bumpObjects = function(e) {\n      // We always check isMovable_ again because the original\n      // \"not movable\" state of isMovable_ could have been changed.\n      if (!mainWorkspace.isDragging() && !mainWorkspace.isMovable() &&\n          (Blockly.Events.BUMP_EVENTS.indexOf(e.type) != -1)) {\n        var metrics = getWorkspaceMetrics();\n        if (metrics.contentTop < metrics.viewTop ||\n            metrics.contentBottom > metrics.viewBottom ||\n            metrics.contentLeft < metrics.viewLeft ||\n            metrics.contentRight > metrics.viewRight) {\n\n          // Handle undo.\n          var oldGroup = null;\n          if (e) {\n            oldGroup = Blockly.Events.getGroup();\n            Blockly.Events.setGroup(e.group);\n          }\n\n          switch (e.type) {\n            case Blockly.Events.BLOCK_CREATE:\n            case Blockly.Events.BLOCK_MOVE:\n              var object = mainWorkspace.getBlockById(e.blockId);\n              if (object) {\n                object = object.getRootBlock();\n              }\n              break;\n            case Blockly.Events.COMMENT_CREATE:\n            case Blockly.Events.COMMENT_MOVE:\n              var object = mainWorkspace.getCommentById(e.commentId);\n              break;\n          }\n          if (object) {\n            var objectMetrics = getObjectMetrics(object);\n\n            // The idea is to find the region of valid coordinates for the top\n            // left corner of the object, and then clamp the object's\n            // top left corner within that region.\n\n            // The top of the object should always be at or below the top of\n            // the workspace.\n            var topClamp = metrics.viewTop;\n            // The top of the object should ideally be positioned so that\n            // the bottom of the object is not below the bottom of the\n            // workspace.\n            var bottomClamp = metrics.viewBottom - objectMetrics.height;\n            // If the object is taller than the workspace we want to\n            // top-align the block, which means setting the bottom clamp to\n            // match.\n            bottomClamp = Math.max(topClamp, bottomClamp);\n\n            var newYPosition = Blockly.utils.math.clamp(\n                topClamp, objectMetrics.top, bottomClamp);\n            var deltaY = newYPosition - objectMetrics.top;\n\n            // Note: Even in RTL mode the \"anchor\" of the object is the\n            // top-left corner of the object.\n\n            // The left edge of the object should ideally be positioned at\n            // or to the right of the left edge of the workspace.\n            var leftClamp = metrics.viewLeft;\n            // The left edge of the object should ideally be positioned so\n            // that the right of the object is not outside the workspace bounds.\n            var rightClamp = metrics.viewRight - objectMetrics.width;\n            if (metrics.RTL) {\n              // If the object is wider than the workspace and we're in RTL\n              // mode we want to right-align the block, which means setting\n              // the left clamp to match.\n              leftClamp = Math.min(rightClamp, leftClamp);\n            } else {\n              // If the object is wider than the workspace and we're in LTR\n              // mode we want to left-align the block, which means setting\n              // the right clamp to match.\n              rightClamp = Math.max(leftClamp, rightClamp);\n            }\n\n            var newXPosition = Blockly.utils.math.clamp(\n                leftClamp, objectMetrics.left, rightClamp);\n            var deltaX = newXPosition - objectMetrics.left;\n\n            object.moveBy(deltaX, deltaY);\n          }\n          if (e) {\n            if (!e.group && object) {\n              console.log('WARNING: Moved object in bounds but there was no' +\n                  ' event group. This may break undo.');\n            }\n            if (oldGroup !== null) {\n              Blockly.Events.setGroup(oldGroup);\n            }\n          }\n        }\n      }\n    };\n    mainWorkspace.addChangeListener(bumpObjects);\n  }\n\n  // The SVG is now fully assembled.\n  Blockly.svgResize(mainWorkspace);\n  Blockly.WidgetDiv.createDom();\n  Blockly.DropDownDiv.createDom();\n  Blockly.Tooltip.createDom();\n  return mainWorkspace;\n};\n\n/**\n * Initialize Blockly with various handlers.\n * @param {!Blockly.WorkspaceSvg} mainWorkspace Newly created main workspace.\n * @private\n */\nBlockly.init_ = function(mainWorkspace) {\n  var options = mainWorkspace.options;\n  var svg = mainWorkspace.getParentSvg();\n\n  // Suppress the browser's context menu.\n  Blockly.bindEventWithChecks_(\n      /** @type {!Element} */ (svg.parentNode), 'contextmenu', null,\n      function(e) {\n        if (!Blockly.utils.isTargetInput(e)) {\n          e.preventDefault();\n        }\n      });\n\n  var workspaceResizeHandler = Blockly.bindEventWithChecks_(window, 'resize',\n      null,\n      function() {\n        Blockly.hideChaff(true);\n        Blockly.svgResize(mainWorkspace);\n      });\n  mainWorkspace.setResizeHandlerWrapper(workspaceResizeHandler);\n\n  Blockly.inject.bindDocumentEvents_();\n\n  if (options.languageTree) {\n    var toolbox = mainWorkspace.getToolbox();\n    var flyout = mainWorkspace.getFlyout(true);\n    if (toolbox) {\n      toolbox.init();\n    } else if (flyout) {\n      // Build a fixed flyout with the root blocks.\n      flyout.init(mainWorkspace);\n      flyout.show(options.languageTree);\n      flyout.scrollToStart();\n    }\n  }\n\n  var verticalSpacing = Blockly.Scrollbar.scrollbarThickness;\n  if (options.hasTrashcan) {\n    verticalSpacing = mainWorkspace.trashcan.init(verticalSpacing);\n  }\n  if (options.zoomOptions && options.zoomOptions.controls) {\n    mainWorkspace.zoomControls_.init(verticalSpacing);\n  }\n\n  if (options.moveOptions && options.moveOptions.scrollbars) {\n    mainWorkspace.scrollbar = new Blockly.ScrollbarPair(mainWorkspace);\n    mainWorkspace.scrollbar.resize();\n  } else {\n    mainWorkspace.setMetrics({x: 0.5, y: 0.5});\n  }\n\n  // Load the sounds.\n  if (options.hasSounds) {\n    Blockly.inject.loadSounds_(options.pathToMedia, mainWorkspace);\n  }\n};\n\n/**\n * Bind document events, but only once.  Destroying and reinjecting Blockly\n * should not bind again.\n * Bind events for scrolling the workspace.\n * Most of these events should be bound to the SVG's surface.\n * However, 'mouseup' has to be on the whole document so that a block dragged\n * out of bounds and released will know that it has been released.\n * Also, 'keydown' has to be on the whole document since the browser doesn't\n * understand a concept of focus on the SVG image.\n * @private\n */\nBlockly.inject.bindDocumentEvents_ = function() {\n  if (!Blockly.documentEventsBound_) {\n    Blockly.bindEventWithChecks_(document, 'scroll', null, function() {\n      var workspaces = Blockly.Workspace.getAll();\n      for (var i = 0, workspace; (workspace = workspaces[i]); i++) {\n        if (workspace.updateInverseScreenCTM) {\n          workspace.updateInverseScreenCTM();\n        }\n      }\n    });\n    Blockly.bindEventWithChecks_(document, 'keydown', null, Blockly.onKeyDown);\n    // longStop needs to run to stop the context menu from showing up.  It\n    // should run regardless of what other touch event handlers have run.\n    Blockly.bindEvent_(document, 'touchend', null, Blockly.longStop_);\n    Blockly.bindEvent_(document, 'touchcancel', null, Blockly.longStop_);\n    // Some iPad versions don't fire resize after portrait to landscape change.\n    if (Blockly.utils.userAgent.IPAD) {\n      Blockly.bindEventWithChecks_(window, 'orientationchange', document,\n          function() {\n            // TODO (#397): Fix for multiple Blockly workspaces.\n            Blockly.svgResize(/** @type {!Blockly.WorkspaceSvg} */\n                (Blockly.getMainWorkspace()));\n          });\n    }\n  }\n  Blockly.documentEventsBound_ = true;\n};\n\n/**\n * Load sounds for the given workspace.\n * @param {string} pathToMedia The path to the media directory.\n * @param {!Blockly.Workspace} workspace The workspace to load sounds for.\n * @private\n */\nBlockly.inject.loadSounds_ = function(pathToMedia, workspace) {\n  var audioMgr = workspace.getAudioManager();\n  audioMgr.load(\n      [\n        pathToMedia + 'click.mp3',\n        pathToMedia + 'click.wav',\n        pathToMedia + 'click.ogg'\n      ], 'click');\n  audioMgr.load(\n      [\n        pathToMedia + 'disconnect.wav',\n        pathToMedia + 'disconnect.mp3',\n        pathToMedia + 'disconnect.ogg'\n      ], 'disconnect');\n  audioMgr.load(\n      [\n        pathToMedia + 'delete.mp3',\n        pathToMedia + 'delete.ogg',\n        pathToMedia + 'delete.wav'\n      ], 'delete');\n\n  // Bind temporary hooks that preload the sounds.\n  var soundBinds = [];\n  var unbindSounds = function() {\n    while (soundBinds.length) {\n      Blockly.unbindEvent_(soundBinds.pop());\n    }\n    audioMgr.preload();\n  };\n\n  // These are bound on mouse/touch events with Blockly.bindEventWithChecks_, so\n  // they restrict the touch identifier that will be recognized.  But this is\n  // really something that happens on a click, not a drag, so that's not\n  // necessary.\n\n  // Android ignores any sound not loaded as a result of a user action.\n  soundBinds.push(\n      Blockly.bindEventWithChecks_(document, 'mousemove', null, unbindSounds,\n          true));\n  soundBinds.push(\n      Blockly.bindEventWithChecks_(document, 'touchstart', null, unbindSounds,\n          true));\n};\n"],"file":"inject.min.js"}