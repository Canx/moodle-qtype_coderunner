{"version":3,"sources":["../../../src/blockly/core/workspace_comment_render_svg.js"],"names":["goog","provide","require","Blockly","WorkspaceCommentSvg","RESIZE_SIZE","BORDER_RADIUS","TEXTAREA_OFFSET","TOP_OFFSET","prototype","getHeightWidth","width","getWidth","height","getHeight","render","rendered_","size","createEditor_","svgGroup_","appendChild","foreignObject_","svgHandleTarget_","utils","dom","createSvgElement","svgRectTarget_","addResizeDom_","isDeletable","addDeleteDom_","setSize_","textarea_","value","content_","resizeGroup_","bindEventWithChecks_","resizeMouseDown_","deleteGroup_","deleteMouseDown_","deleteMouseOut_","deleteMouseUp_","body","document","createElementNS","HTML_NS","setAttribute","className","textarea","RTL","readOnly","isEditable","e","stopPropagation","setContent","resizeSize","replace","toString","deleteIconBorder_","unbindDragEvents_","isRightButton","workspace","startDrag","Coordinate","width_","height_","onMouseUpWrapper_","resizeMouseUp_","onMouseMoveWrapper_","resizeMouseMove_","hideChaff","addClass","removeClass","dispose","unbindEvent_","Touch","clearTouchIdentifier","autoLayout_","newXY","moveDrag","x","y","resizeComment_","topOffset","textOffset","style","Math","max","svgRect_","disposeInternal_","disposed_","setFocus","comment","focused_","setTimeout","focus","addFocus","blurFocus","blur","removeFocus"],"mappings":"AAUA,aAEAA,IAAI,CAACC,OAAL,CAAa,oCAAb,EAEAD,IAAI,CAACE,OAAL,CAAa,eAAb,EACAF,IAAI,CAACE,OAAL,CAAa,0BAAb,EACAF,IAAI,CAACE,OAAL,CAAa,mBAAb,EASAC,OAAO,CAACC,mBAAR,CAA4BC,WAA5B,CAA0C,CAA1C,CAQAF,OAAO,CAACC,mBAAR,CAA4BE,aAA5B,CAA4C,CAA5C,CAQAH,OAAO,CAACC,mBAAR,CAA4BG,eAA5B,CAA8C,CAA9C,CAQAJ,OAAO,CAACC,mBAAR,CAA4BI,UAA5B,CAAyC,EAAzC,CAQAL,OAAO,CAACC,mBAAR,CAA4BK,SAA5B,CAAsCC,cAAtC,CAAuD,UAAW,CAChE,MAAO,CAAEC,KAAK,CAAE,KAAKC,QAAL,EAAT,CAA0BC,MAAM,CAAE,KAAKC,SAAL,EAAlC,CACR,CAFD,CAQAX,OAAO,CAACC,mBAAR,CAA4BK,SAA5B,CAAsCM,MAAtC,CAA+C,UAAW,CACxD,GAAI,KAAKC,SAAT,CAAoB,CAClB,MACD,CAED,GAAIC,CAAAA,CAAI,CAAG,KAAKP,cAAL,EAAX,CAGA,KAAKQ,aAAL,GACA,KAAKC,SAAL,CAAeC,WAAf,CAA2B,KAAKC,cAAhC,EAEA,KAAKC,gBAAL,CAAwBnB,OAAO,CAACoB,KAAR,CAAcC,GAAd,CAAkBC,gBAAlB,CAAmC,MAAnC,CACpB,CACE,MAAS,4BADX,CAEE,EAAK,CAFP,CAGE,EAAK,CAHP,CADoB,CAAxB,CAMA,KAAKN,SAAL,CAAeC,WAAf,CAA2B,KAAKE,gBAAhC,EACA,KAAKI,cAAL,CAAsBvB,OAAO,CAACoB,KAAR,CAAcC,GAAd,CAAkBC,gBAAlB,CAAmC,MAAnC,CAClB,CACE,MAAS,sBADX,CAEE,EAAK,CAFP,CAGE,EAAK,CAHP,CAIE,GAAMtB,OAAO,CAACC,mBAAR,CAA4BE,aAJpC,CAKE,GAAMH,OAAO,CAACC,mBAAR,CAA4BE,aALpC,CADkB,CAAtB,CAQA,KAAKa,SAAL,CAAeC,WAAf,CAA2B,KAAKM,cAAhC,EAGA,KAAKC,aAAL,GACA,GAAI,KAAKC,WAAL,EAAJ,CAAwB,CAEtB,KAAKC,aAAL,EACD,CAED,KAAKC,QAAL,CAAcb,CAAI,CAACN,KAAnB,CAA0BM,CAAI,CAACJ,MAA/B,EAGA,KAAKkB,SAAL,CAAeC,KAAf,CAAuB,KAAKC,QAA5B,CAEA,KAAKjB,SAAL,IAEA,GAAI,KAAKkB,YAAT,CAAuB,CACrB/B,OAAO,CAACgC,oBAAR,CACI,KAAKD,YADT,CACuB,WADvB,CACoC,IADpC,CAC0C,KAAKE,gBAD/C,CAED,CAED,GAAI,KAAKR,WAAL,EAAJ,CAAwB,CACtBzB,OAAO,CAACgC,oBAAR,CACI,KAAKE,YADT,CACuB,WADvB,CACoC,IADpC,CAC0C,KAAKC,gBAD/C,EAEAnC,OAAO,CAACgC,oBAAR,CACI,KAAKE,YADT,CACuB,UADvB,CACmC,IADnC,CACyC,KAAKE,eAD9C,EAEApC,OAAO,CAACgC,oBAAR,CACI,KAAKE,YADT,CACuB,SADvB,CACkC,IADlC,CACwC,KAAKG,cAD7C,CAED,CACF,CAvDD,CA8DArC,OAAO,CAACC,mBAAR,CAA4BK,SAA5B,CAAsCS,aAAtC,CAAsD,UAAW,CAU/D,KAAKG,cAAL,CAAsBlB,OAAO,CAACoB,KAAR,CAAcC,GAAd,CAAkBC,gBAAlB,CAClB,eADkB,CAElB,CACE,EAAK,CADP,CAEE,EAAKtB,OAAO,CAACC,mBAAR,CAA4BI,UAFnC,CAGE,MAAS,6BAHX,CAFkB,CAOlB,IAPkB,CAAtB,CAQA,GAAIiC,CAAAA,CAAI,CAAGC,QAAQ,CAACC,eAAT,CAAyBxC,OAAO,CAACoB,KAAR,CAAcC,GAAd,CAAkBoB,OAA3C,CAAoD,MAApD,CAAX,CACAH,CAAI,CAACI,YAAL,CAAkB,OAAlB,CAA2B1C,OAAO,CAACoB,KAAR,CAAcC,GAAd,CAAkBoB,OAA7C,EACAH,CAAI,CAACK,SAAL,CAAiB,oBAAjB,CACA,GAAIC,CAAAA,CAAQ,CAAGL,QAAQ,CAACC,eAAT,CAAyBxC,OAAO,CAACoB,KAAR,CAAcC,GAAd,CAAkBoB,OAA3C,CAAoD,UAApD,CAAf,CACAG,CAAQ,CAACD,SAAT,CAAqB,wBAArB,CACAC,CAAQ,CAACF,YAAT,CAAsB,KAAtB,CAA6B,KAAKG,GAAL,CAAW,KAAX,CAAmB,KAAhD,EACAD,CAAQ,CAACE,QAAT,CAAoB,CAAC,KAAKC,UAAL,EAArB,CACAT,CAAI,CAACrB,WAAL,CAAiB2B,CAAjB,EACA,KAAKhB,SAAL,CAAiBgB,CAAjB,CACA,KAAK1B,cAAL,CAAoBD,WAApB,CAAgCqB,CAAhC,EAEAtC,OAAO,CAACgC,oBAAR,CAA6BY,CAA7B,CAAuC,OAAvC,CAAgD,IAAhD,CAAsD,SAASI,CAAT,CAAY,CAChEA,CAAC,CAACC,eAAF,EACD,CAFD,EAGAjD,OAAO,CAACgC,oBAAR,CAA6BY,CAA7B,CAAuC,QAAvC,CAAiD,IAAjD,CAAuD,UAEf,CACtC,KAAKM,UAAL,CAAgBN,CAAQ,CAACf,KAAzB,CACD,CAJD,EAKA,MAAO,MAAKX,cACb,CAtCD,CA4CAlB,OAAO,CAACC,mBAAR,CAA4BK,SAA5B,CAAsCkB,aAAtC,CAAsD,UAAW,CAC/D,KAAKO,YAAL,CAAoB/B,OAAO,CAACoB,KAAR,CAAcC,GAAd,CAAkBC,gBAAlB,CAChB,GADgB,CAEhB,CACE,MAAS,KAAKuB,GAAL,CAAW,iBAAX,CAA+B,iBAD1C,CAFgB,CAKhB,KAAK7B,SALW,CAApB,CAMA,GAAImC,CAAAA,CAAU,CAAGnD,OAAO,CAACC,mBAAR,CAA4BC,WAA7C,CACAF,OAAO,CAACoB,KAAR,CAAcC,GAAd,CAAkBC,gBAAlB,CACI,SADJ,CAEI,CAAC,OAAU,cAAc8B,OAAd,CAAsB,IAAtB,CAA4BD,CAAU,CAACE,QAAX,EAA5B,CAAX,CAFJ,CAGI,KAAKtB,YAHT,EAIA/B,OAAO,CAACoB,KAAR,CAAcC,GAAd,CAAkBC,gBAAlB,CACI,MADJ,CAEI,CACE,MAAS,mBADX,CAEE,GAAM6B,CAAU,CAAG,CAFrB,CAEwB,GAAMA,CAAU,CAAG,CAF3C,CAGE,GAAMA,CAAU,CAAG,CAHrB,CAGwB,GAAMA,CAAU,CAAG,CAH3C,CAFJ,CAMO,KAAKpB,YANZ,EAOA/B,OAAO,CAACoB,KAAR,CAAcC,GAAd,CAAkBC,gBAAlB,CACI,MADJ,CAEI,CACE,MAAS,mBADX,CAEE,GAAmB,CAAb,CAAA6B,CAAU,CAAO,CAFzB,CAE4B,GAAMA,CAAU,CAAG,CAF/C,CAGE,GAAMA,CAAU,CAAG,CAHrB,CAGwB,GAAmB,CAAb,CAAAA,CAAU,CAAO,CAH/C,CAFJ,CAMO,KAAKpB,YANZ,CAOD,CA1BD,CAgCA/B,OAAO,CAACC,mBAAR,CAA4BK,SAA5B,CAAsCoB,aAAtC,CAAsD,UAAW,CAC/D,KAAKQ,YAAL,CAAoBlC,OAAO,CAACoB,KAAR,CAAcC,GAAd,CAAkBC,gBAAlB,CAChB,GADgB,CAEhB,CACE,MAAS,0BADX,CAFgB,CAKhB,KAAKN,SALW,CAApB,CAMA,KAAKsC,iBAAL,CAAyBtD,OAAO,CAACoB,KAAR,CAAcC,GAAd,CAAkBC,gBAAlB,CAAmC,QAAnC,CACrB,CACE,MAAS,wBADX,CAEE,EAAK,GAFP,CAGE,GAAM,KAHR,CAIE,GAAM,KAJR,CADqB,CAOrB,KAAKY,YAPgB,CAAzB,CASAlC,OAAO,CAACoB,KAAR,CAAcC,GAAd,CAAkBC,gBAAlB,CACI,MADJ,CAEI,CACE,GAAM,GADR,CACa,GAAM,IADnB,CAEE,GAAM,IAFR,CAEc,GAAM,GAFpB,CAGE,OAAU,MAHZ,CAIE,eAAgB,GAJlB,CAFJ,CAQI,KAAKY,YART,EASAlC,OAAO,CAACoB,KAAR,CAAcC,GAAd,CAAkBC,gBAAlB,CACI,MADJ,CAEI,CACE,GAAM,GADR,CACa,GAAM,GADnB,CAEE,GAAM,IAFR,CAEc,GAAM,IAFpB,CAGE,OAAU,MAHZ,CAIE,eAAgB,GAJlB,CAFJ,CAQI,KAAKY,YART,CASD,CAlCD,CAyCAlC,OAAO,CAACC,mBAAR,CAA4BK,SAA5B,CAAsC2B,gBAAtC,CAAyD,SAASe,CAAT,CAAY,CACnE,KAAKO,iBAAL,GACA,GAAIvD,OAAO,CAACoB,KAAR,CAAcoC,aAAd,CAA4BR,CAA5B,CAAJ,CAAoC,CAElCA,CAAC,CAACC,eAAF,GACA,MACD,CAED,KAAKQ,SAAL,CAAeC,SAAf,CAAyBV,CAAzB,CAA4B,GAAIhD,CAAAA,OAAO,CAACoB,KAAR,CAAcuC,UAAlB,CAC1B,KAAKF,SAAL,CAAeZ,GAAf,CAAqB,CAAC,KAAKe,MAA3B,CAAoC,KAAKA,MADf,CACuB,KAAKC,OAD5B,CAA5B,EAGA,KAAKC,iBAAL,CAAyB9D,OAAO,CAACgC,oBAAR,CACrBO,QADqB,CACX,SADW,CACA,IADA,CACM,KAAKwB,cADX,CAAzB,CAEA,KAAKC,mBAAL,CAA2BhE,OAAO,CAACgC,oBAAR,CACvBO,QADuB,CACb,WADa,CACA,IADA,CACM,KAAK0B,gBADX,CAA3B,CAEAjE,OAAO,CAACkE,SAAR,GAEAlB,CAAC,CAACC,eAAF,EACD,CAlBD,CAyBAjD,OAAO,CAACC,mBAAR,CAA4BK,SAA5B,CAAsC6B,gBAAtC,CAAyD,SAASa,CAAT,CAAY,CAEnEhD,OAAO,CAACoB,KAAR,CAAcC,GAAd,CAAkB8C,QAAlB,CAC6B,KAAKb,iBADlC,CAEI,8BAFJ,EAIAN,CAAC,CAACC,eAAF,EACD,CAPD,CAcAjD,OAAO,CAACC,mBAAR,CAA4BK,SAA5B,CAAsC8B,eAAtC,CAAwD,UAAa,CAEnEpC,OAAO,CAACoB,KAAR,CAAcC,GAAd,CAAkB+C,WAAlB,CAC6B,KAAKd,iBADlC,CAEI,8BAFJ,CAGD,CALD,CAYAtD,OAAO,CAACC,mBAAR,CAA4BK,SAA5B,CAAsC+B,cAAtC,CAAuD,SAASW,CAAT,CAAY,CAEjE,KAAKqB,OAAL,QAEArB,CAAC,CAACC,eAAF,EACD,CALD,CAWAjD,OAAO,CAACC,mBAAR,CAA4BK,SAA5B,CAAsCiD,iBAAtC,CAA0D,UAAW,CACnE,GAAI,KAAKO,iBAAT,CAA4B,CAC1B9D,OAAO,CAACsE,YAAR,CAAqB,KAAKR,iBAA1B,EACA,KAAKA,iBAAL,CAAyB,IAC1B,CACD,GAAI,KAAKE,mBAAT,CAA8B,CAC5BhE,OAAO,CAACsE,YAAR,CAAqB,KAAKN,mBAA1B,EACA,KAAKA,mBAAL,CAA2B,IAC5B,CACF,CATD,CAgBAhE,OAAO,CAACC,mBAAR,CAA4BK,SAA5B,CAAsCyD,cAAtC,CAAuD,UAAkB,CACvE/D,OAAO,CAACuE,KAAR,CAAcC,oBAAd,GACA,KAAKjB,iBAAL,EACD,CAHD,CAUAvD,OAAO,CAACC,mBAAR,CAA4BK,SAA5B,CAAsC2D,gBAAtC,CAAyD,SAASjB,CAAT,CAAY,CACnE,KAAKyB,WAAL,IACA,GAAIC,CAAAA,CAAK,CAAG,KAAKjB,SAAL,CAAekB,QAAf,CAAwB3B,CAAxB,CAAZ,CACA,KAAKrB,QAAL,CAAc,KAAKkB,GAAL,CAAW,CAAC6B,CAAK,CAACE,CAAlB,CAAsBF,CAAK,CAACE,CAA1C,CAA6CF,CAAK,CAACG,CAAnD,CACD,CAJD,CAWA7E,OAAO,CAACC,mBAAR,CAA4BK,SAA5B,CAAsCwE,cAAtC,CAAuD,UAAW,IAC5DhE,CAAAA,CAAI,CAAG,KAAKP,cAAL,EADqD,CAE5DwE,CAAS,CAAG/E,OAAO,CAACC,mBAAR,CAA4BI,UAFoB,CAG5D2E,CAAU,CAAiD,CAA9C,CAAAhF,OAAO,CAACC,mBAAR,CAA4BG,eAHmB,CAKhE,KAAKc,cAAL,CAAoBwB,YAApB,CAAiC,OAAjC,CAA0C5B,CAAI,CAACN,KAA/C,EACA,KAAKU,cAAL,CAAoBwB,YAApB,CAAiC,QAAjC,CAA2C5B,CAAI,CAACJ,MAAL,CAAcqE,CAAzD,EACA,GAAI,KAAKlC,GAAT,CAAc,CACZ,KAAK3B,cAAL,CAAoBwB,YAApB,CAAiC,GAAjC,CAAsC,CAAC5B,CAAI,CAACN,KAA5C,CACD,CACD,KAAKoB,SAAL,CAAeqD,KAAf,CAAqBzE,KAArB,CAA8BM,CAAI,CAACN,KAAL,CAAawE,CAAd,CAA4B,IAAzD,CACA,KAAKpD,SAAL,CAAeqD,KAAf,CAAqBvE,MAArB,CAA+BI,CAAI,CAACJ,MAAL,CAAcsE,CAAd,CAA2BD,CAA5B,CAAyC,IACxE,CAZD,CAoBA/E,OAAO,CAACC,mBAAR,CAA4BK,SAA5B,CAAsCqB,QAAtC,CAAiD,SAASnB,CAAT,CAAgBE,CAAhB,CAAwB,CAEvEF,CAAK,CAAG0E,IAAI,CAACC,GAAL,CAAS3E,CAAT,CAAgB,EAAhB,CAAR,CACAE,CAAM,CAAGwE,IAAI,CAACC,GAAL,CAASzE,CAAT,CAAiB,GAAKV,OAAO,CAACC,mBAAR,CAA4BI,UAAlD,CAAT,CACA,KAAKuD,MAAL,CAAcpD,CAAd,CACA,KAAKqD,OAAL,CAAenD,CAAf,CACA,KAAK0E,QAAL,CAAc1C,YAAd,CAA2B,OAA3B,CAAoClC,CAApC,EACA,KAAK4E,QAAL,CAAc1C,YAAd,CAA2B,QAA3B,CAAqChC,CAArC,EACA,KAAKa,cAAL,CAAoBmB,YAApB,CAAiC,OAAjC,CAA0ClC,CAA1C,EACA,KAAKe,cAAL,CAAoBmB,YAApB,CAAiC,QAAjC,CAA2ChC,CAA3C,EACA,KAAKS,gBAAL,CAAsBuB,YAAtB,CAAmC,OAAnC,CAA4ClC,CAA5C,EACA,KAAKW,gBAAL,CAAsBuB,YAAtB,CAAmC,QAAnC,CACI1C,OAAO,CAACC,mBAAR,CAA4BI,UADhC,EAEA,GAAI,KAAKwC,GAAT,CAAc,CACZ,KAAKuC,QAAL,CAAc1C,YAAd,CAA2B,WAA3B,CAAwC,aAAxC,EACA,KAAKnB,cAAL,CAAoBmB,YAApB,CAAiC,WAAjC,CAA8C,aAA9C,CACD,CAED,GAAIS,CAAAA,CAAU,CAAGnD,OAAO,CAACC,mBAAR,CAA4BC,WAA7C,CACA,GAAI,KAAK6B,YAAT,CAAuB,CACrB,GAAI,KAAKc,GAAT,CAAc,CAEZ,KAAKd,YAAL,CAAkBW,YAAlB,CAA+B,WAA/B,CAA4C,cACzC,CAAClC,CAAD,CAAS2C,CADgC,EAClB,GADkB,EACXzC,CAAM,CAAGyC,CADE,EACY,eADxD,EAEA,KAAKjB,YAAL,CAAkBQ,YAAlB,CAA+B,WAA/B,CAA4C,cACzC,CAAClC,CAAD,CAAS2C,CADgC,EAClB,GADkB,CACX,CAACA,CADU,CACI,eADhD,CAED,CAND,IAMO,CACL,KAAKpB,YAAL,CAAkBW,YAAlB,CAA+B,WAA/B,CAA4C,cACzClC,CAAK,CAAG2C,CADiC,EACnB,GADmB,EAEzCzC,CAAM,CAAGyC,CAFgC,EAElB,GAF1B,EAGA,KAAKjB,YAAL,CAAkBQ,YAAlB,CAA+B,WAA/B,CAA4C,cACzClC,CAAK,CAAG2C,CADiC,EACnB,GADmB,CAEzC,CAACA,CAFwC,CAE1B,GAFlB,CAGD,CACF,CAGD,KAAK2B,cAAL,EACD,CAtCD,CA4CA9E,OAAO,CAACC,mBAAR,CAA4BK,SAA5B,CAAsC+E,gBAAtC,CAAyD,UAAW,CAClE,KAAKzD,SAAL,CAAiB,IAAjB,CACA,KAAKV,cAAL,CAAsB,IAAtB,CACA,KAAKK,cAAL,CAAsB,IAAtB,CACA,KAAKJ,gBAAL,CAAwB,IAAxB,CACA,KAAKmE,SAAL,GACD,CAND,CAYAtF,OAAO,CAACC,mBAAR,CAA4BK,SAA5B,CAAsCiF,QAAtC,CAAiD,UAAW,CAC1D,GAAIC,CAAAA,CAAO,CAAG,IAAd,CACA,KAAKC,QAAL,IAEAC,UAAU,CAAC,UAAW,CACpB,GAAIF,CAAO,CAACF,SAAZ,CAAuB,CACrB,MACD,CACDE,CAAO,CAAC5D,SAAR,CAAkB+D,KAAlB,GACAH,CAAO,CAACI,QAAR,GACA5F,OAAO,CAACoB,KAAR,CAAcC,GAAd,CAAkB8C,QAAlB,CACIqB,CAAO,CAACjE,cADZ,CAC4B,6BAD5B,EAEAvB,OAAO,CAACoB,KAAR,CAAcC,GAAd,CAAkB8C,QAAlB,CACIqB,CAAO,CAACrE,gBADZ,CAC8B,mCAD9B,CAED,CAVS,CAUP,CAVO,CAWX,CAfD,CAqBAnB,OAAO,CAACC,mBAAR,CAA4BK,SAA5B,CAAsCuF,SAAtC,CAAkD,UAAW,CAC3D,GAAIL,CAAAA,CAAO,CAAG,IAAd,CACA,KAAKC,QAAL,IAEAC,UAAU,CAAC,UAAW,CACpB,GAAIF,CAAO,CAACF,SAAZ,CAAuB,CACrB,MACD,CAEDE,CAAO,CAAC5D,SAAR,CAAkBkE,IAAlB,GACAN,CAAO,CAACO,WAAR,GACA/F,OAAO,CAACoB,KAAR,CAAcC,GAAd,CAAkB+C,WAAlB,CACIoB,CAAO,CAACjE,cADZ,CAC4B,6BAD5B,EAEAvB,OAAO,CAACoB,KAAR,CAAcC,GAAd,CAAkB+C,WAAlB,CACIoB,CAAO,CAACrE,gBADZ,CAC8B,mCAD9B,CAED,CAXS,CAWP,CAXO,CAYX,CAhBD","sourcesContent":["/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Methods for rendering a workspace comment as SVG\n * @author fenichel@google.com (Rachel Fenichel)\n */\n'use strict';\n\ngoog.provide('Blockly.WorkspaceCommentSvg.render');\n\ngoog.require('Blockly.utils');\ngoog.require('Blockly.utils.Coordinate');\ngoog.require('Blockly.utils.dom');\n\n\n/**\n * Size of the resize icon.\n * @type {number}\n * @const\n * @private\n */\nBlockly.WorkspaceCommentSvg.RESIZE_SIZE = 8;\n\n/**\n * Radius of the border around the comment.\n * @type {number}\n * @const\n * @private\n */\nBlockly.WorkspaceCommentSvg.BORDER_RADIUS = 3;\n\n/**\n * Offset from the foreignobject edge to the textarea edge.\n * @type {number}\n * @const\n * @private\n */\nBlockly.WorkspaceCommentSvg.TEXTAREA_OFFSET = 2;\n\n/**\n * Offset from the top to make room for a top bar.\n * @type {number}\n * @const\n * @private\n */\nBlockly.WorkspaceCommentSvg.TOP_OFFSET = 10;\n\n/**\n * Returns a bounding box describing the dimensions of this comment.\n * @return {!{height: number, width: number}} Object with height and width\n *     properties in workspace units.\n * @package\n */\nBlockly.WorkspaceCommentSvg.prototype.getHeightWidth = function() {\n  return { width: this.getWidth(), height: this.getHeight() };\n};\n\n/**\n * Renders the workspace comment.\n * @package\n */\nBlockly.WorkspaceCommentSvg.prototype.render = function() {\n  if (this.rendered_) {\n    return;\n  }\n\n  var size = this.getHeightWidth();\n\n  // Add text area\n  this.createEditor_();\n  this.svgGroup_.appendChild(this.foreignObject_);\n\n  this.svgHandleTarget_ = Blockly.utils.dom.createSvgElement('rect',\n      {\n        'class': 'blocklyCommentHandleTarget',\n        'x': 0,\n        'y': 0\n      });\n  this.svgGroup_.appendChild(this.svgHandleTarget_);\n  this.svgRectTarget_ = Blockly.utils.dom.createSvgElement('rect',\n      {\n        'class': 'blocklyCommentTarget',\n        'x': 0,\n        'y': 0,\n        'rx': Blockly.WorkspaceCommentSvg.BORDER_RADIUS,\n        'ry': Blockly.WorkspaceCommentSvg.BORDER_RADIUS\n      });\n  this.svgGroup_.appendChild(this.svgRectTarget_);\n\n  // Add the resize icon\n  this.addResizeDom_();\n  if (this.isDeletable()) {\n    // Add the delete icon\n    this.addDeleteDom_();\n  }\n\n  this.setSize_(size.width, size.height);\n\n  // Set the content\n  this.textarea_.value = this.content_;\n\n  this.rendered_ = true;\n\n  if (this.resizeGroup_) {\n    Blockly.bindEventWithChecks_(\n        this.resizeGroup_, 'mousedown', this, this.resizeMouseDown_);\n  }\n\n  if (this.isDeletable()) {\n    Blockly.bindEventWithChecks_(\n        this.deleteGroup_, 'mousedown', this, this.deleteMouseDown_);\n    Blockly.bindEventWithChecks_(\n        this.deleteGroup_, 'mouseout', this, this.deleteMouseOut_);\n    Blockly.bindEventWithChecks_(\n        this.deleteGroup_, 'mouseup', this, this.deleteMouseUp_);\n  }\n};\n\n/**\n * Create the text area for the comment.\n * @return {!Element} The top-level node of the editor.\n * @private\n */\nBlockly.WorkspaceCommentSvg.prototype.createEditor_ = function() {\n  /* Create the editor.  Here's the markup that will be generated:\n    <foreignObject class=\"blocklyCommentForeignObject\" x=\"0\" y=\"10\" width=\"164\" height=\"164\">\n      <body xmlns=\"http://www.w3.org/1999/xhtml\" class=\"blocklyMinimalBody\">\n        <textarea xmlns=\"http://www.w3.org/1999/xhtml\"\n            class=\"blocklyCommentTextarea\"\n            style=\"height: 164px; width: 164px;\"></textarea>\n      </body>\n    </foreignObject>\n  */\n  this.foreignObject_ = Blockly.utils.dom.createSvgElement(\n      'foreignObject',\n      {\n        'x': 0,\n        'y': Blockly.WorkspaceCommentSvg.TOP_OFFSET,\n        'class': 'blocklyCommentForeignObject'\n      },\n      null);\n  var body = document.createElementNS(Blockly.utils.dom.HTML_NS, 'body');\n  body.setAttribute('xmlns', Blockly.utils.dom.HTML_NS);\n  body.className = 'blocklyMinimalBody';\n  var textarea = document.createElementNS(Blockly.utils.dom.HTML_NS, 'textarea');\n  textarea.className = 'blocklyCommentTextarea';\n  textarea.setAttribute('dir', this.RTL ? 'RTL' : 'LTR');\n  textarea.readOnly = !this.isEditable();\n  body.appendChild(textarea);\n  this.textarea_ = textarea;\n  this.foreignObject_.appendChild(body);\n  // Don't zoom with mousewheel.\n  Blockly.bindEventWithChecks_(textarea, 'wheel', this, function(e) {\n    e.stopPropagation();\n  });\n  Blockly.bindEventWithChecks_(textarea, 'change', this, function(\n      /* eslint-disable no-unused-vars */ e\n      /* eslint-enable no-unused-vars */) {\n    this.setContent(textarea.value);\n  });\n  return this.foreignObject_;\n};\n\n/**\n * Add the resize icon to the DOM\n * @private\n */\nBlockly.WorkspaceCommentSvg.prototype.addResizeDom_ = function() {\n  this.resizeGroup_ = Blockly.utils.dom.createSvgElement(\n      'g',\n      {\n        'class': this.RTL ? 'blocklyResizeSW' : 'blocklyResizeSE'\n      },\n      this.svgGroup_);\n  var resizeSize = Blockly.WorkspaceCommentSvg.RESIZE_SIZE;\n  Blockly.utils.dom.createSvgElement(\n      'polygon',\n      {'points': '0,x x,x x,0'.replace(/x/g, resizeSize.toString())},\n      this.resizeGroup_);\n  Blockly.utils.dom.createSvgElement(\n      'line',\n      {\n        'class': 'blocklyResizeLine',\n        'x1': resizeSize / 3, 'y1': resizeSize - 1,\n        'x2': resizeSize - 1, 'y2': resizeSize / 3\n      }, this.resizeGroup_);\n  Blockly.utils.dom.createSvgElement(\n      'line',\n      {\n        'class': 'blocklyResizeLine',\n        'x1': resizeSize * 2 / 3, 'y1': resizeSize - 1,\n        'x2': resizeSize - 1, 'y2': resizeSize * 2 / 3\n      }, this.resizeGroup_);\n};\n\n/**\n * Add the delete icon to the DOM\n * @private\n */\nBlockly.WorkspaceCommentSvg.prototype.addDeleteDom_ = function() {\n  this.deleteGroup_ = Blockly.utils.dom.createSvgElement(\n      'g',\n      {\n        'class': 'blocklyCommentDeleteIcon'\n      },\n      this.svgGroup_);\n  this.deleteIconBorder_ = Blockly.utils.dom.createSvgElement('circle',\n      {\n        'class': 'blocklyDeleteIconShape',\n        'r': '7',\n        'cx': '7.5',\n        'cy': '7.5'\n      },\n      this.deleteGroup_);\n  // x icon.\n  Blockly.utils.dom.createSvgElement(\n      'line',\n      {\n        'x1': '5', 'y1': '10',\n        'x2': '10', 'y2': '5',\n        'stroke': '#fff',\n        'stroke-width': '2'\n      },\n      this.deleteGroup_);\n  Blockly.utils.dom.createSvgElement(\n      'line',\n      {\n        'x1': '5', 'y1': '5',\n        'x2': '10', 'y2': '10',\n        'stroke': '#fff',\n        'stroke-width': '2'\n      },\n      this.deleteGroup_);\n};\n\n/**\n * Handle a mouse-down on comment's resize corner.\n * @param {!Event} e Mouse down event.\n * @private\n */\nBlockly.WorkspaceCommentSvg.prototype.resizeMouseDown_ = function(e) {\n  this.unbindDragEvents_();\n  if (Blockly.utils.isRightButton(e)) {\n    // No right-click.\n    e.stopPropagation();\n    return;\n  }\n  // Left-click (or middle click)\n  this.workspace.startDrag(e, new Blockly.utils.Coordinate(\n    this.workspace.RTL ? -this.width_ : this.width_, this.height_));\n\n  this.onMouseUpWrapper_ = Blockly.bindEventWithChecks_(\n      document, 'mouseup', this, this.resizeMouseUp_);\n  this.onMouseMoveWrapper_ = Blockly.bindEventWithChecks_(\n      document, 'mousemove', this, this.resizeMouseMove_);\n  Blockly.hideChaff();\n  // This event has been handled.  No need to bubble up to the document.\n  e.stopPropagation();\n};\n\n/**\n * Handle a mouse-down on comment's delete icon.\n * @param {!Event} e Mouse down event.\n * @private\n */\nBlockly.WorkspaceCommentSvg.prototype.deleteMouseDown_ = function(e) {\n  // Highlight the delete icon.\n  Blockly.utils.dom.addClass(\n      /** @type {!Element} */ (this.deleteIconBorder_),\n      'blocklyDeleteIconHighlighted');\n  // This event has been handled.  No need to bubble up to the document.\n  e.stopPropagation();\n};\n\n/**\n * Handle a mouse-out on comment's delete icon.\n * @param {!Event} _e Mouse out event.\n * @private\n */\nBlockly.WorkspaceCommentSvg.prototype.deleteMouseOut_ = function(_e) {\n  // Restore highlight on the delete icon.\n  Blockly.utils.dom.removeClass(\n      /** @type {!Element} */ (this.deleteIconBorder_),\n      'blocklyDeleteIconHighlighted');\n};\n\n/**\n * Handle a mouse-up on comment's delete icon.\n * @param {!Event} e Mouse up event.\n * @private\n */\nBlockly.WorkspaceCommentSvg.prototype.deleteMouseUp_ = function(e) {\n  // Delete this comment.\n  this.dispose(true, true);\n  // This event has been handled.  No need to bubble up to the document.\n  e.stopPropagation();\n};\n\n/**\n * Stop binding to the global mouseup and mousemove events.\n * @private\n */\nBlockly.WorkspaceCommentSvg.prototype.unbindDragEvents_ = function() {\n  if (this.onMouseUpWrapper_) {\n    Blockly.unbindEvent_(this.onMouseUpWrapper_);\n    this.onMouseUpWrapper_ = null;\n  }\n  if (this.onMouseMoveWrapper_) {\n    Blockly.unbindEvent_(this.onMouseMoveWrapper_);\n    this.onMouseMoveWrapper_ = null;\n  }\n};\n\n/**\n * Handle a mouse-up event while dragging a comment's border or resize handle.\n * @param {!Event} e Mouse up event.\n * @private\n */\nBlockly.WorkspaceCommentSvg.prototype.resizeMouseUp_ = function(/* e */) {\n  Blockly.Touch.clearTouchIdentifier();\n  this.unbindDragEvents_();\n};\n\n/**\n * Resize this comment to follow the mouse.\n * @param {!Event} e Mouse move event.\n * @private\n */\nBlockly.WorkspaceCommentSvg.prototype.resizeMouseMove_ = function(e) {\n  this.autoLayout_ = false;\n  var newXY = this.workspace.moveDrag(e);\n  this.setSize_(this.RTL ? -newXY.x : newXY.x, newXY.y);\n};\n\n/**\n * Callback function triggered when the comment has resized.\n * Resize the text area accordingly.\n * @private\n */\nBlockly.WorkspaceCommentSvg.prototype.resizeComment_ = function() {\n  var size = this.getHeightWidth();\n  var topOffset = Blockly.WorkspaceCommentSvg.TOP_OFFSET;\n  var textOffset = Blockly.WorkspaceCommentSvg.TEXTAREA_OFFSET * 2;\n\n  this.foreignObject_.setAttribute('width', size.width);\n  this.foreignObject_.setAttribute('height', size.height - topOffset);\n  if (this.RTL) {\n    this.foreignObject_.setAttribute('x', -size.width);\n  }\n  this.textarea_.style.width = (size.width - textOffset) + 'px';\n  this.textarea_.style.height = (size.height - textOffset - topOffset) + 'px';\n};\n\n/**\n * Set size\n * @param {number} width width of the container\n * @param {number} height height of the container\n * @private\n */\nBlockly.WorkspaceCommentSvg.prototype.setSize_ = function(width, height) {\n  // Minimum size of a comment.\n  width = Math.max(width, 45);\n  height = Math.max(height, 20 + Blockly.WorkspaceCommentSvg.TOP_OFFSET);\n  this.width_ = width;\n  this.height_ = height;\n  this.svgRect_.setAttribute('width', width);\n  this.svgRect_.setAttribute('height', height);\n  this.svgRectTarget_.setAttribute('width', width);\n  this.svgRectTarget_.setAttribute('height', height);\n  this.svgHandleTarget_.setAttribute('width', width);\n  this.svgHandleTarget_.setAttribute('height',\n      Blockly.WorkspaceCommentSvg.TOP_OFFSET);\n  if (this.RTL) {\n    this.svgRect_.setAttribute('transform', 'scale(-1 1)');\n    this.svgRectTarget_.setAttribute('transform', 'scale(-1 1)');\n  }\n\n  var resizeSize = Blockly.WorkspaceCommentSvg.RESIZE_SIZE;\n  if (this.resizeGroup_) {\n    if (this.RTL) {\n      // Mirror the resize group.\n      this.resizeGroup_.setAttribute('transform', 'translate(' +\n        (-width + resizeSize) + ',' + (height - resizeSize) + ') scale(-1 1)');\n      this.deleteGroup_.setAttribute('transform', 'translate(' +\n        (-width + resizeSize) + ',' + (-resizeSize) + ') scale(-1 1)');\n    } else {\n      this.resizeGroup_.setAttribute('transform', 'translate(' +\n        (width - resizeSize) + ',' +\n        (height - resizeSize) + ')');\n      this.deleteGroup_.setAttribute('transform', 'translate(' +\n        (width - resizeSize) + ',' +\n        (-resizeSize) + ')');\n    }\n  }\n\n  // Allow the contents to resize.\n  this.resizeComment_();\n};\n\n/**\n * Dispose of any rendered comment components.\n * @private\n */\nBlockly.WorkspaceCommentSvg.prototype.disposeInternal_ = function() {\n  this.textarea_ = null;\n  this.foreignObject_ = null;\n  this.svgRectTarget_ = null;\n  this.svgHandleTarget_ = null;\n  this.disposed_ = true;\n};\n\n/**\n * Set the focus on the text area.\n * @package\n */\nBlockly.WorkspaceCommentSvg.prototype.setFocus = function() {\n  var comment = this;\n  this.focused_ = true;\n  // Defer CSS changes.\n  setTimeout(function() {\n    if (comment.disposed_) {\n      return;\n    }\n    comment.textarea_.focus();\n    comment.addFocus();\n    Blockly.utils.dom.addClass(\n        comment.svgRectTarget_, 'blocklyCommentTargetFocused');\n    Blockly.utils.dom.addClass(\n        comment.svgHandleTarget_, 'blocklyCommentHandleTargetFocused');\n  }, 0);\n};\n\n/**\n * Remove focus from the text area.\n * @package\n */\nBlockly.WorkspaceCommentSvg.prototype.blurFocus = function() {\n  var comment = this;\n  this.focused_ = false;\n  // Defer CSS changes.\n  setTimeout(function() {\n    if (comment.disposed_) {\n      return;\n    }\n\n    comment.textarea_.blur();\n    comment.removeFocus();\n    Blockly.utils.dom.removeClass(\n        comment.svgRectTarget_, 'blocklyCommentTargetFocused');\n    Blockly.utils.dom.removeClass(\n        comment.svgHandleTarget_, 'blocklyCommentHandleTargetFocused');\n  }, 0);\n};\n"],"file":"workspace_comment_render_svg.min.js"}