{"version":3,"sources":["../../../src/blockly/core/warning.js"],"names":["goog","provide","require","Blockly","Warning","block","superClass_","constructor","call","createIcon","text_","utils","object","inherits","Icon","prototype","collapseHidden","drawIcon_","group","dom","createSvgElement","textToDom_","text","paragraph","Bubble","BORDER_WIDTH","lines","split","i","length","tspanElement","textNode","document","createTextNode","appendChild","setVisible","visible","isVisible","Events","fire","Ui","block_","createBubble","disposeBubble","paragraphElement_","getText","bubble_","workspace","pathObject","svgPath","iconXY_","setSvgId","id","RTL","maxWidth","getBBox","width","textElement","childNodes","setAttribute","applyColour","dispose","body_","setText","allWarnings","push","join","warning"],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Object representing a warning.\n * @author fraser@google.com (Neil Fraser)\n */\n'use strict';\n\ngoog.provide('Blockly.Warning');\n\ngoog.require('Blockly.Bubble');\ngoog.require('Blockly.Events');\ngoog.require('Blockly.Events.Ui');\ngoog.require('Blockly.Icon');\ngoog.require('Blockly.utils.dom');\ngoog.require('Blockly.utils.object');\n\n\n/**\n * Class for a warning.\n * @param {!Blockly.Block} block The block associated with this warning.\n * @extends {Blockly.Icon}\n * @constructor\n */\nBlockly.Warning = function(block) {\n  Blockly.Warning.superClass_.constructor.call(this, block);\n  this.createIcon();\n  // The text_ object can contain multiple warnings.\n  this.text_ = {};\n};\nBlockly.utils.object.inherits(Blockly.Warning, Blockly.Icon);\n\n/**\n * Does this icon get hidden when the block is collapsed.\n */\nBlockly.Warning.prototype.collapseHidden = false;\n\n/**\n * Draw the warning icon.\n * @param {!Element} group The icon group.\n * @protected\n */\nBlockly.Warning.prototype.drawIcon_ = function(group) {\n  // Triangle with rounded corners.\n  Blockly.utils.dom.createSvgElement('path',\n      {\n        'class': 'blocklyIconShape',\n        'd': 'M2,15Q-1,15 0.5,12L6.5,1.7Q8,-1 9.5,1.7L15.5,12Q17,15 14,15z'\n      },\n      group);\n  // Can't use a real '!' text character since different browsers and operating\n  // systems render it differently.\n  // Body of exclamation point.\n  Blockly.utils.dom.createSvgElement('path',\n      {\n        'class': 'blocklyIconSymbol',\n        'd': 'm7,4.8v3.16l0.27,2.27h1.46l0.27,-2.27v-3.16z'\n      },\n      group);\n  // Dot of exclamation point.\n  Blockly.utils.dom.createSvgElement('rect',\n      {\n        'class': 'blocklyIconSymbol',\n        'x': '7', 'y': '11', 'height': '2', 'width': '2'\n      },\n      group);\n};\n\n/**\n * Create the text for the warning's bubble.\n * @param {string} text The text to display.\n * @return {!SVGTextElement} The top-level node of the text.\n * @private\n */\nBlockly.Warning.textToDom_ = function(text) {\n  var paragraph = /** @type {!SVGTextElement} */\n      (Blockly.utils.dom.createSvgElement(\n          'text',\n          {\n            'class': 'blocklyText blocklyBubbleText blocklyNoPointerEvents',\n            'y': Blockly.Bubble.BORDER_WIDTH\n          },\n          null)\n      );\n  var lines = text.split('\\n');\n  for (var i = 0; i < lines.length; i++) {\n    var tspanElement = Blockly.utils.dom.createSvgElement('tspan',\n        {'dy': '1em', 'x': Blockly.Bubble.BORDER_WIDTH}, paragraph);\n    var textNode = document.createTextNode(lines[i]);\n    tspanElement.appendChild(textNode);\n  }\n  return paragraph;\n};\n\n/**\n * Show or hide the warning bubble.\n * @param {boolean} visible True if the bubble should be visible.\n */\nBlockly.Warning.prototype.setVisible = function(visible) {\n  if (visible == this.isVisible()) {\n    return;\n  }\n  Blockly.Events.fire(\n      new Blockly.Events.Ui(this.block_, 'warningOpen', !visible, visible));\n  if (visible) {\n    this.createBubble();\n  } else {\n    this.disposeBubble();\n  }\n};\n\n/**\n * Show the bubble.\n * @package\n */\nBlockly.Warning.prototype.createBubble = function() {\n  // TODO (#2943): This is package because comments steal this UI for\n  //  non-editable comments, but really this should be private.\n  this.paragraphElement_ = Blockly.Warning.textToDom_(this.getText());\n  this.bubble_ = new Blockly.Bubble(\n      /** @type {!Blockly.WorkspaceSvg} */ (this.block_.workspace),\n      this.paragraphElement_, this.block_.pathObject.svgPath,\n      /** @type {!Blockly.utils.Coordinate} */ (this.iconXY_), null, null);\n  // Expose this warning's block's ID on its top-level SVG group.\n  this.bubble_.setSvgId(this.block_.id);\n  if (this.block_.RTL) {\n    // Right-align the paragraph.\n    // This cannot be done until the bubble is rendered on screen.\n    var maxWidth = this.paragraphElement_.getBBox().width;\n    for (var i = 0, textElement;\n      (textElement = this.paragraphElement_.childNodes[i]); i++) {\n\n      textElement.setAttribute('text-anchor', 'end');\n      textElement.setAttribute('x', maxWidth + Blockly.Bubble.BORDER_WIDTH);\n    }\n  }\n  this.applyColour();\n};\n\n/**\n * Dispose of the bubble and references to it.\n * @package\n */\nBlockly.Warning.prototype.disposeBubble = function() {\n  // TODO (#2943): This is package because comments steal this UI for\n  //  non-editable comments, but really this should be private.\n  this.bubble_.dispose();\n  this.bubble_ = null;\n  this.body_ = null;\n  this.paragraphElement_ = null;\n};\n\n/**\n * Set this warning's text.\n * @param {string} text Warning text (or '' to delete). This supports\n *    linebreaks.\n * @param {string} id An ID for this text entry to be able to maintain\n *     multiple warnings.\n */\nBlockly.Warning.prototype.setText = function(text, id) {\n  if (this.text_[id] == text) {\n    return;\n  }\n  if (text) {\n    this.text_[id] = text;\n  } else {\n    delete this.text_[id];\n  }\n  if (this.isVisible()) {\n    this.setVisible(false);\n    this.setVisible(true);\n  }\n};\n\n/**\n * Get this warning's texts.\n * @return {string} All texts concatenated into one string.\n */\nBlockly.Warning.prototype.getText = function() {\n  var allWarnings = [];\n  for (var id in this.text_) {\n    allWarnings.push(this.text_[id]);\n  }\n  return allWarnings.join('\\n');\n};\n\n/**\n * Dispose of this warning.\n */\nBlockly.Warning.prototype.dispose = function() {\n  this.block_.warning = null;\n  Blockly.Icon.prototype.dispose.call(this);\n};\n"],"file":"warning.min.js"}