{"version":3,"sources":["../../../src/blockly/core/contextmenu.js"],"names":["goog","provide","require","Blockly","ContextMenu","currentBlock","menu_","show","e","options","rtl","WidgetDiv","dispose","length","hide","menu","populate_","position_","setTimeout","focus","Menu","setRole","utils","aria","Role","MENU","i","option","menuItem","MenuItem","text","setRightToLeft","MENUITEM","addChild","setEnabled","enabled","actionHandler","callback","onAction","viewportBBox","getViewportBBox","anchorBBox","Rect","clientY","top","clientX","left","createWidget_","menuSize","getSize","width","right","positionWithAnchor","div","DIV","render","menuDom","getElement","dom","addClass","bindEventWithChecks_","noEvent","hideIfOwner","callbackFactory","block","xml","Events","disable","newBlock","Xml","domToBlock","workspace","xy","getRelativeToSurfaceXY","RTL","x","SNAP_RADIUS","y","moveBy","enable","isEnabled","isShadow","fire","BlockCreate","select","blockDeleteOption","descendantCount","getDescendants","nextBlock","getNextBlock","deleteOption","Msg","replace","setGroup","blockHelpOption","url","helpUrl","helpOption","showHelp","blockDuplicateOption","isDuplicatable","duplicateOption","duplicate","blockCommentOption","commentOption","userAgent","IE","getCommentIcon","setCommentText","commentDeleteOption","comment","commentDuplicateOption","workspaceCommentOption","ws","WorkspaceCommentSvg","Error","addWsComment","DEFAULT_SIZE","injectionDiv","getInjectionDiv","boundingRect","getBoundingClientRect","clientOffsetPixels","Coordinate","mainOffsetPixels","getOriginOffsetInPixels","finalOffset","difference","scale","commentX","commentY","rendered","initSvg","wsCommentOption"],"mappings":"AAUA,aAMAA,IAAI,CAACC,OAAL,CAAa,qBAAb,EAEAD,IAAI,CAACE,OAAL,CAAa,gBAAb,EACAF,IAAI,CAACE,OAAL,CAAa,4BAAb,EACAF,IAAI,CAACE,OAAL,CAAa,cAAb,EACAF,IAAI,CAACE,OAAL,CAAa,kBAAb,EACAF,IAAI,CAACE,OAAL,CAAa,aAAb,EACAF,IAAI,CAACE,OAAL,CAAa,eAAb,EACAF,IAAI,CAACE,OAAL,CAAa,0BAAb,EACAF,IAAI,CAACE,OAAL,CAAa,mBAAb,EACAF,IAAI,CAACE,OAAL,CAAa,oBAAb,EACAF,IAAI,CAACE,OAAL,CAAa,yBAAb,EACAF,IAAI,CAACE,OAAL,CAAa,aAAb,EAOAC,OAAO,CAACC,WAAR,CAAoBC,YAApB,CAAmC,IAAnC,CAOAF,OAAO,CAACC,WAAR,CAAoBE,KAApB,CAA4B,IAA5B,CAQAH,OAAO,CAACC,WAAR,CAAoBG,IAApB,CAA2B,SAASC,CAAT,CAAYC,CAAZ,CAAqBC,CAArB,CAA0B,CACnDP,OAAO,CAACQ,SAAR,CAAkBJ,IAAlB,CAAuBJ,OAAO,CAACC,WAA/B,CAA4CM,CAA5C,CAAiDP,OAAO,CAACC,WAAR,CAAoBQ,OAArE,EACA,GAAI,CAACH,CAAO,CAACI,MAAb,CAAqB,CACnBV,OAAO,CAACC,WAAR,CAAoBU,IAApB,GACA,MACD,CACD,GAAIC,CAAAA,CAAI,CAAGZ,OAAO,CAACC,WAAR,CAAoBY,SAApB,CAA8BP,CAA9B,CAAuCC,CAAvC,CAAX,CACAP,OAAO,CAACC,WAAR,CAAoBE,KAApB,CAA4BS,CAA5B,CAEAZ,OAAO,CAACC,WAAR,CAAoBa,SAApB,CAA8BF,CAA9B,CAAoCP,CAApC,CAAuCE,CAAvC,EAGAQ,UAAU,CAAC,UAAW,CAACH,CAAI,CAACI,KAAL,EAAc,CAA3B,CAA6B,CAA7B,CAAV,CACAhB,OAAO,CAACC,WAAR,CAAoBC,YAApB,CAAmC,IACpC,CAdD,CAuBAF,OAAO,CAACC,WAAR,CAAoBY,SAApB,CAAgC,SAASP,CAAT,CAAkBC,CAAlB,CAAuB,CAMrD,GAAIK,CAAAA,CAAI,CAAG,GAAIZ,CAAAA,OAAO,CAACiB,IAAvB,CACAL,CAAI,CAACM,OAAL,CAAalB,OAAO,CAACmB,KAAR,CAAcC,IAAd,CAAmBC,IAAnB,CAAwBC,IAArC,EACA,IAAK,GAAIC,CAAAA,CAAC,CAAG,CAAR,CAAWC,CAAX,CACCC,CADN,CAAyBD,CAAM,CAAGlB,CAAO,CAACiB,CAAD,CAAzC,CAA+CA,CAAC,EAAhD,CAAoD,CAC9CE,CAD8C,CACnC,GAAIzB,CAAAA,OAAO,CAAC0B,QAAZ,CAAqBF,CAAM,CAACG,IAA5B,CADmC,CAElDF,CAAQ,CAACG,cAAT,CAAwBrB,CAAxB,EACAkB,CAAQ,CAACP,OAAT,CAAiBlB,OAAO,CAACmB,KAAR,CAAcC,IAAd,CAAmBC,IAAnB,CAAwBQ,QAAzC,EACAjB,CAAI,CAACkB,QAAL,CAAcL,CAAd,EACAA,CAAQ,CAACM,UAAT,CAAoBP,CAAM,CAACQ,OAA3B,EACA,GAAIR,CAAM,CAACQ,OAAX,CAAoB,CAClB,GAAIC,CAAAA,CAAa,CAAG,UAAoB,CACtC,GAAIT,CAAAA,CAAM,CAAG,IAAb,CACAxB,OAAO,CAACC,WAAR,CAAoBU,IAApB,GACAa,CAAM,CAACU,QAAP,EACD,CAJD,CAKAT,CAAQ,CAACU,QAAT,CAAkBF,CAAlB,CAAiCT,CAAjC,CACD,CACF,CACD,MAAOZ,CAAAA,CACR,CAxBD,CAkCAZ,OAAO,CAACC,WAAR,CAAoBa,SAApB,CAAgC,SAASF,CAAT,CAAeP,CAAf,CAAkBE,CAAlB,CAAuB,IAEjD6B,CAAAA,CAAY,CAAGpC,OAAO,CAACmB,KAAR,CAAckB,eAAd,EAFkC,CAKjDC,CAAU,CAAG,GAAItC,CAAAA,OAAO,CAACmB,KAAR,CAAcoB,IAAlB,CACblC,CAAC,CAACmC,OAAF,CAAYJ,CAAY,CAACK,GADZ,CAEbpC,CAAC,CAACmC,OAAF,CAAYJ,CAAY,CAACK,GAFZ,CAGbpC,CAAC,CAACqC,OAAF,CAAYN,CAAY,CAACO,IAHZ,CAIbtC,CAAC,CAACqC,OAAF,CAAYN,CAAY,CAACO,IAJZ,CALoC,CAYrD3C,OAAO,CAACC,WAAR,CAAoB2C,aAApB,CAAkChC,CAAlC,EACA,GAAIiC,CAAAA,CAAQ,CAAGjC,CAAI,CAACkC,OAAL,EAAf,CAEA,GAAIvC,CAAJ,CAAS,CACP+B,CAAU,CAACK,IAAX,EAAmBE,CAAQ,CAACE,KAA5B,CACAT,CAAU,CAACU,KAAX,EAAoBH,CAAQ,CAACE,KAA7B,CACAX,CAAY,CAACO,IAAb,EAAqBE,CAAQ,CAACE,KAA9B,CACAX,CAAY,CAACY,KAAb,EAAsBH,CAAQ,CAACE,KAChC,CAED/C,OAAO,CAACQ,SAAR,CAAkByC,kBAAlB,CAAqCb,CAArC,CAAmDE,CAAnD,CAA+DO,CAA/D,CAAyEtC,CAAzE,EAIAK,CAAI,CAACI,KAAL,EACD,CA3BD,CAkCAhB,OAAO,CAACC,WAAR,CAAoB2C,aAApB,CAAoC,SAAShC,CAAT,CAAe,CACjD,GAAIsC,CAAAA,CAAG,CAAGlD,OAAO,CAACQ,SAAR,CAAkB2C,GAA5B,CACAvC,CAAI,CAACwC,MAAL,CAAYF,CAAZ,EACA,GAAIG,CAAAA,CAAO,CAAGzC,CAAI,CAAC0C,UAAL,EAAd,CACAtD,OAAO,CAACmB,KAAR,CAAcoC,GAAd,CAAkBC,QAAlB,CAC6BH,CAD7B,CACuC,oBADvC,EAGArD,OAAO,CAACyD,oBAAR,CAA0DJ,CAA1D,CACI,aADJ,CACmB,IADnB,CACyBrD,OAAO,CAACmB,KAAR,CAAcuC,OADvC,EAGA9C,CAAI,CAACI,KAAL,EACD,CAXD,CAgBAhB,OAAO,CAACC,WAAR,CAAoBU,IAApB,CAA2B,UAAW,CACpCX,OAAO,CAACQ,SAAR,CAAkBmD,WAAlB,CAA8B3D,OAAO,CAACC,WAAtC,EACAD,OAAO,CAACC,WAAR,CAAoBC,YAApB,CAAmC,IACpC,CAHD,CAQAF,OAAO,CAACC,WAAR,CAAoBQ,OAApB,CAA8B,UAAW,CACvC,GAAIT,OAAO,CAACC,WAAR,CAAoBE,KAAxB,CAA+B,CAC7BH,OAAO,CAACC,WAAR,CAAoBE,KAApB,CAA0BM,OAA1B,GACAT,OAAO,CAACC,WAAR,CAAoBE,KAApB,CAA4B,IAC7B,CACF,CALD,CAcAH,OAAO,CAACC,WAAR,CAAoB2D,eAApB,CAAsC,SAASC,CAAT,CAAgBC,CAAhB,CAAqB,CACzD,MAAO,WAAW,CAChB9D,OAAO,CAAC+D,MAAR,CAAeC,OAAf,GACA,GAAI,IACEC,CAAAA,CAAQ,CAAGjE,OAAO,CAACkE,GAAR,CAAYC,UAAZ,CAAuBL,CAAvB,CAA4BD,CAAK,CAACO,SAAlC,CADb,CAGEC,CAAE,CAAGR,CAAK,CAACS,sBAAN,EAHP,CAIF,GAAIT,CAAK,CAACU,GAAV,CAAe,CACbF,CAAE,CAACG,CAAH,EAAQxE,OAAO,CAACyE,WACjB,CAFD,IAEO,CACLJ,CAAE,CAACG,CAAH,EAAQxE,OAAO,CAACyE,WACjB,CACDJ,CAAE,CAACK,CAAH,EAA8B,CAAtB,CAAA1E,OAAO,CAACyE,WAAhB,CACAR,CAAQ,CAACU,MAAT,CAAgBN,CAAE,CAACG,CAAnB,CAAsBH,CAAE,CAACK,CAAzB,CACD,CAXD,OAWU,CACR1E,OAAO,CAAC+D,MAAR,CAAea,MAAf,EACD,CACD,GAAI5E,OAAO,CAAC+D,MAAR,CAAec,SAAf,IAA8B,CAACZ,CAAQ,CAACa,QAAT,EAAnC,CAAwD,CACtD9E,OAAO,CAAC+D,MAAR,CAAegB,IAAf,CAAoB,GAAI/E,CAAAA,OAAO,CAAC+D,MAAR,CAAeiB,WAAnB,CAA+Bf,CAA/B,CAApB,CACD,CACDA,CAAQ,CAACgB,MAAT,EACD,CACF,CAtBD,CAgCAjF,OAAO,CAACC,WAAR,CAAoBiF,iBAApB,CAAwC,SAASrB,CAAT,CAAgB,IAGlDsB,CAAAA,CAAe,CAAGtB,CAAK,CAACuB,cAAN,KAA4B1E,MAHI,CAIlD2E,CAAS,CAAGxB,CAAK,CAACyB,YAAN,EAJsC,CAKtD,GAAID,CAAJ,CAAe,CAEbF,CAAe,EAAIE,CAAS,CAACD,cAAV,KAAgC1E,MACpD,CACD,GAAI6E,CAAAA,CAAY,CAAG,CACjB5D,IAAI,CAAqB,CAAnB,EAAAwD,CAAe,CAAQnF,OAAO,CAACwF,GAAR,aAAR,CACjBxF,OAAO,CAACwF,GAAR,iBAA+BC,OAA/B,CAAuC,IAAvC,CAAoDN,CAApD,IAFa,CAGjBnD,OAAO,GAHU,CAIjBE,QAAQ,CAAE,mBAAW,CACnBlC,OAAO,CAAC+D,MAAR,CAAe2B,QAAf,KACA7B,CAAK,CAACpD,OAAN,QACAT,OAAO,CAAC+D,MAAR,CAAe2B,QAAf,IACD,CARgB,CAAnB,CAUA,MAAOH,CAAAA,CACR,CApBD,CA4BAvF,OAAO,CAACC,WAAR,CAAoB0F,eAApB,CAAsC,SAAS9B,CAAT,CAAgB,IAChD+B,CAAAA,CAAG,CAA4B,UAAxB,QAAO/B,CAAAA,CAAK,CAACgC,OAAd,CACNhC,CAAK,CAACgC,OAAN,EADM,CACYhC,CAAK,CAACgC,OAFwB,CAGhDC,CAAU,CAAG,CACf9D,OAAO,CAAE,CAAC,CAAC4D,CADI,CAEfjE,IAAI,CAAE3B,OAAO,CAACwF,GAAR,KAFS,CAGftD,QAAQ,CAAE,mBAAW,CACnB2B,CAAK,CAACkC,QAAN,EACD,CALc,CAHmC,CAUpD,MAAOD,CAAAA,CACR,CAXD,CAmBA9F,OAAO,CAACC,WAAR,CAAoB+F,oBAApB,CAA2C,SAASnC,CAAT,CAAgB,IACrD7B,CAAAA,CAAO,CAAG6B,CAAK,CAACoC,cAAN,EAD2C,CAErDC,CAAe,CAAG,CACpBvE,IAAI,CAAE3B,OAAO,CAACwF,GAAR,gBADc,CAEpBxD,OAAO,CAAEA,CAFW,CAGpBE,QAAQ,CAAE,mBAAW,CACnBlC,OAAO,CAACmG,SAAR,CAAkBtC,CAAlB,CACD,CALmB,CAFmC,CASzD,MAAOqC,CAAAA,CACR,CAVD,CAmBAlG,OAAO,CAACC,WAAR,CAAoBmG,kBAApB,CAAyC,SAASvC,CAAT,CAAgB,CACvD,GAAIwC,CAAAA,CAAa,CAAG,CAClBrE,OAAO,CAAE,CAAChC,OAAO,CAACmB,KAAR,CAAcmF,SAAd,CAAwBC,EADhB,CAApB,CAIA,GAAI1C,CAAK,CAAC2C,cAAN,EAAJ,CAA4B,CAC1BH,CAAa,CAAC1E,IAAd,CAAqB3B,OAAO,CAACwF,GAAR,eAArB,CACAa,CAAa,CAACnE,QAAd,CAAyB,UAAW,CAClC2B,CAAK,CAAC4C,cAAN,CAAqB,IAArB,CACD,CACF,CALD,IAKO,CAELJ,CAAa,CAAC1E,IAAd,CAAqB3B,OAAO,CAACwF,GAAR,YAArB,CACAa,CAAa,CAACnE,QAAd,CAAyB,UAAW,CAClC2B,CAAK,CAAC4C,cAAN,CAAqB,EAArB,CACD,CACF,CACD,MAAOJ,CAAAA,CACR,CAlBD,CA2BArG,OAAO,CAACC,WAAR,CAAoByG,mBAApB,CAA0C,SAASC,CAAT,CAAkB,CAC1D,GAAIpB,CAAAA,CAAY,CAAG,CACjB5D,IAAI,CAAE3B,OAAO,CAACwF,GAAR,eADW,CAEjBxD,OAAO,GAFU,CAGjBE,QAAQ,CAAE,mBAAW,CACnBlC,OAAO,CAAC+D,MAAR,CAAe2B,QAAf,KACAiB,CAAO,CAAClG,OAAR,QACAT,OAAO,CAAC+D,MAAR,CAAe2B,QAAf,IACD,CAPgB,CAAnB,CASA,MAAOH,CAAAA,CACR,CAXD,CAoBAvF,OAAO,CAACC,WAAR,CAAoB2G,sBAApB,CAA6C,SAASD,CAAT,CAAkB,CAC7D,GAAIT,CAAAA,CAAe,CAAG,CACpBvE,IAAI,CAAE3B,OAAO,CAACwF,GAAR,kBADc,CAEpBxD,OAAO,GAFa,CAGpBE,QAAQ,CAAE,mBAAW,CACnBlC,OAAO,CAACmG,SAAR,CAAkBQ,CAAlB,CACD,CALmB,CAAtB,CAOA,MAAOT,CAAAA,CACR,CATD,CAqBAlG,OAAO,CAACC,WAAR,CAAoB4G,sBAApB,CAA6C,SAASC,CAAT,CAAazG,CAAb,CAAgB,CAC3D,GAAI,CAACL,OAAO,CAAC+G,mBAAb,CAAkC,CAChC,KAAMC,CAAAA,KAAK,CAAC,iDAAD,CACZ,CAH0D,GAMvDC,CAAAA,CAAY,CAAG,UAAW,IACxBN,CAAAA,CAAO,CAAG,GAAI3G,CAAAA,OAAO,CAAC+G,mBAAZ,CACVD,CADU,CACN9G,OAAO,CAACwF,GAAR,+BADM,CAEVxF,OAAO,CAAC+G,mBAAR,CAA4BG,YAFlB,CAGVlH,OAAO,CAAC+G,mBAAR,CAA4BG,YAHlB,CADc,CAMxBC,CAAY,CAAGL,CAAE,CAACM,eAAH,EANS,CAUxBC,CAAY,CAAGF,CAAY,CAACG,qBAAb,EAVS,CAaxBC,CAAkB,CAAG,GAAIvH,CAAAA,OAAO,CAACmB,KAAR,CAAcqG,UAAlB,CACrBnH,CAAC,CAACqC,OAAF,CAAY2E,CAAY,CAAC1E,IADJ,CACUtC,CAAC,CAACmC,OAAF,CAAY6E,CAAY,CAAC5E,GADnC,CAbG,CAkBxBgF,CAAgB,CAAGX,CAAE,CAACY,uBAAH,EAlBK,CAsBxBC,CAAW,CAAG3H,OAAO,CAACmB,KAAR,CAAcqG,UAAd,CAAyBI,UAAzB,CAAoCL,CAApC,CACdE,CADc,CAtBU,CAyB5BE,CAAW,CAACE,KAAZ,CAAkB,EAAIf,CAAE,CAACe,KAAzB,EAzB4B,GA2BxBC,CAAAA,CAAQ,CAAGH,CAAW,CAACnD,CA3BC,CA4BxBuD,CAAQ,CAAGJ,CAAW,CAACjD,CA5BC,CA6B5BiC,CAAO,CAAChC,MAAR,CAAemD,CAAf,CAAyBC,CAAzB,EACA,GAAIjB,CAAE,CAACkB,QAAP,CAAiB,CACfrB,CAAO,CAACsB,OAAR,GACAtB,CAAO,CAACvD,MAAR,GACAuD,CAAO,CAAC1B,MAAR,EACD,CACF,CAzC0D,CA2CvDiD,CAAe,CAAG,CAGpBlG,OAAO,CAAE,CAAChC,OAAO,CAACmB,KAAR,CAAcmF,SAAd,CAAwBC,EAHd,CA3CqC,CAgD3D2B,CAAe,CAACvG,IAAhB,CAAuB3B,OAAO,CAACwF,GAAR,YAAvB,CACA0C,CAAe,CAAChG,QAAhB,CAA2B,UAAW,CACpC+E,CAAY,EACb,CAFD,CAGA,MAAOiB,CAAAA,CACR,CArDD","sourcesContent":["/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Functionality for the right-click context menus.\n * @author fraser@google.com (Neil Fraser)\n */\n'use strict';\n\n/**\n * @name Blockly.ContextMenu\n * @namespace\n */\ngoog.provide('Blockly.ContextMenu');\n\ngoog.require('Blockly.Events');\ngoog.require('Blockly.Events.BlockCreate');\ngoog.require('Blockly.Menu');\ngoog.require('Blockly.MenuItem');\ngoog.require('Blockly.Msg');\ngoog.require('Blockly.utils');\ngoog.require('Blockly.utils.Coordinate');\ngoog.require('Blockly.utils.dom');\ngoog.require('Blockly.utils.Rect');\ngoog.require('Blockly.utils.userAgent');\ngoog.require('Blockly.Xml');\n\n\n/**\n * Which block is the context menu attached to?\n * @type {Blockly.Block}\n */\nBlockly.ContextMenu.currentBlock = null;\n\n/**\n * Menu object.\n * @type {Blockly.Menu}\n * @private\n */\nBlockly.ContextMenu.menu_ = null;\n\n/**\n * Construct the menu based on the list of options and show the menu.\n * @param {!Event} e Mouse event.\n * @param {!Array.<!Object>} options Array of menu options.\n * @param {boolean} rtl True if RTL, false if LTR.\n */\nBlockly.ContextMenu.show = function(e, options, rtl) {\n  Blockly.WidgetDiv.show(Blockly.ContextMenu, rtl, Blockly.ContextMenu.dispose);\n  if (!options.length) {\n    Blockly.ContextMenu.hide();\n    return;\n  }\n  var menu = Blockly.ContextMenu.populate_(options, rtl);\n  Blockly.ContextMenu.menu_ = menu;\n\n  Blockly.ContextMenu.position_(menu, e, rtl);\n  // 1ms delay is required for focusing on context menus because some other\n  // mouse event is still waiting in the queue and clears focus.\n  setTimeout(function() {menu.focus();}, 1);\n  Blockly.ContextMenu.currentBlock = null;  // May be set by Blockly.Block.\n};\n\n/**\n * Create the context menu object and populate it with the given options.\n * @param {!Array.<!Object>} options Array of menu options.\n * @param {boolean} rtl True if RTL, false if LTR.\n * @return {!Blockly.Menu} The menu that will be shown on right click.\n * @private\n */\nBlockly.ContextMenu.populate_ = function(options, rtl) {\n  /* Here's what one option object looks like:\n    {text: 'Make It So',\n     enabled: true,\n     callback: Blockly.MakeItSo}\n  */\n  var menu = new Blockly.Menu();\n  menu.setRole(Blockly.utils.aria.Role.MENU);\n  for (var i = 0, option; (option = options[i]); i++) {\n    var menuItem = new Blockly.MenuItem(option.text);\n    menuItem.setRightToLeft(rtl);\n    menuItem.setRole(Blockly.utils.aria.Role.MENUITEM);\n    menu.addChild(menuItem);\n    menuItem.setEnabled(option.enabled);\n    if (option.enabled) {\n      var actionHandler = function(_menuItem) {\n        var option = this;\n        Blockly.ContextMenu.hide();\n        option.callback();\n      };\n      menuItem.onAction(actionHandler, option);\n    }\n  }\n  return menu;\n};\n\n/**\n * Add the menu to the page and position it correctly.\n * @param {!Blockly.Menu} menu The menu to add and position.\n * @param {!Event} e Mouse event for the right click that is making the context\n *     menu appear.\n * @param {boolean} rtl True if RTL, false if LTR.\n * @private\n */\nBlockly.ContextMenu.position_ = function(menu, e, rtl) {\n  // Record windowSize and scrollOffset before adding menu.\n  var viewportBBox = Blockly.utils.getViewportBBox();\n  // This one is just a point, but we'll pretend that it's a rect so we can use\n  // some helper functions.\n  var anchorBBox = new Blockly.utils.Rect(\n      e.clientY + viewportBBox.top,\n      e.clientY + viewportBBox.top,\n      e.clientX + viewportBBox.left,\n      e.clientX + viewportBBox.left\n  );\n\n  Blockly.ContextMenu.createWidget_(menu);\n  var menuSize = menu.getSize();\n\n  if (rtl) {\n    anchorBBox.left += menuSize.width;\n    anchorBBox.right += menuSize.width;\n    viewportBBox.left += menuSize.width;\n    viewportBBox.right += menuSize.width;\n  }\n\n  Blockly.WidgetDiv.positionWithAnchor(viewportBBox, anchorBBox, menuSize, rtl);\n  // Calling menuDom.focus() has to wait until after the menu has been placed\n  // correctly.  Otherwise it will cause a page scroll to get the misplaced menu\n  // in view.  See issue #1329.\n  menu.focus();\n};\n\n/**\n * Create and render the menu widget inside Blockly's widget div.\n * @param {!Blockly.Menu} menu The menu to add to the widget div.\n * @private\n */\nBlockly.ContextMenu.createWidget_ = function(menu) {\n  var div = Blockly.WidgetDiv.DIV;\n  menu.render(div);\n  var menuDom = menu.getElement();\n  Blockly.utils.dom.addClass(\n      /** @type {!Element} */ (menuDom), 'blocklyContextMenu');\n  // Prevent system context menu when right-clicking a Blockly context menu.\n  Blockly.bindEventWithChecks_(/** @type {!EventTarget} */ (menuDom),\n      'contextmenu', null, Blockly.utils.noEvent);\n  // Focus only after the initial render to avoid issue #1329.\n  menu.focus();\n};\n\n/**\n * Hide the context menu.\n */\nBlockly.ContextMenu.hide = function() {\n  Blockly.WidgetDiv.hideIfOwner(Blockly.ContextMenu);\n  Blockly.ContextMenu.currentBlock = null;\n};\n\n/**\n * Dispose of the menu.\n */\nBlockly.ContextMenu.dispose = function() {\n  if (Blockly.ContextMenu.menu_) {\n    Blockly.ContextMenu.menu_.dispose();\n    Blockly.ContextMenu.menu_ = null;\n  }\n};\n\n/**\n * Create a callback function that creates and configures a block,\n *   then places the new block next to the original.\n * @param {!Blockly.Block} block Original block.\n * @param {!Element} xml XML representation of new block.\n * @return {!Function} Function that creates a block.\n */\nBlockly.ContextMenu.callbackFactory = function(block, xml) {\n  return function() {\n    Blockly.Events.disable();\n    try {\n      var newBlock = Blockly.Xml.domToBlock(xml, block.workspace);\n      // Move the new block next to the old block.\n      var xy = block.getRelativeToSurfaceXY();\n      if (block.RTL) {\n        xy.x -= Blockly.SNAP_RADIUS;\n      } else {\n        xy.x += Blockly.SNAP_RADIUS;\n      }\n      xy.y += Blockly.SNAP_RADIUS * 2;\n      newBlock.moveBy(xy.x, xy.y);\n    } finally {\n      Blockly.Events.enable();\n    }\n    if (Blockly.Events.isEnabled() && !newBlock.isShadow()) {\n      Blockly.Events.fire(new Blockly.Events.BlockCreate(newBlock));\n    }\n    newBlock.select();\n  };\n};\n\n// Helper functions for creating context menu options.\n\n/**\n * Make a context menu option for deleting the current block.\n * @param {!Blockly.BlockSvg} block The block where the right-click originated.\n * @return {!Object} A menu option, containing text, enabled, and a callback.\n * @package\n */\nBlockly.ContextMenu.blockDeleteOption = function(block) {\n  // Option to delete this block but not blocks lower in the stack.\n  // Count the number of blocks that are nested in this block.\n  var descendantCount = block.getDescendants(false).length;\n  var nextBlock = block.getNextBlock();\n  if (nextBlock) {\n    // Blocks in the current stack would survive this block's deletion.\n    descendantCount -= nextBlock.getDescendants(false).length;\n  }\n  var deleteOption = {\n    text: descendantCount == 1 ? Blockly.Msg['DELETE_BLOCK'] :\n        Blockly.Msg['DELETE_X_BLOCKS'].replace('%1', String(descendantCount)),\n    enabled: true,\n    callback: function() {\n      Blockly.Events.setGroup(true);\n      block.dispose(true, true);\n      Blockly.Events.setGroup(false);\n    }\n  };\n  return deleteOption;\n};\n\n/**\n * Make a context menu option for showing help for the current block.\n * @param {!Blockly.BlockSvg} block The block where the right-click originated.\n * @return {!Object} A menu option, containing text, enabled, and a callback.\n * @package\n */\nBlockly.ContextMenu.blockHelpOption = function(block) {\n  var url = (typeof block.helpUrl == 'function') ?\n      block.helpUrl() : block.helpUrl;\n  var helpOption = {\n    enabled: !!url,\n    text: Blockly.Msg['HELP'],\n    callback: function() {\n      block.showHelp();\n    }\n  };\n  return helpOption;\n};\n\n/**\n * Make a context menu option for duplicating the current block.\n * @param {!Blockly.BlockSvg} block The block where the right-click originated.\n * @return {!Object} A menu option, containing text, enabled, and a callback.\n * @package\n */\nBlockly.ContextMenu.blockDuplicateOption = function(block) {\n  var enabled = block.isDuplicatable();\n  var duplicateOption = {\n    text: Blockly.Msg['DUPLICATE_BLOCK'],\n    enabled: enabled,\n    callback: function() {\n      Blockly.duplicate(block);\n    }\n  };\n  return duplicateOption;\n};\n\n/**\n * Make a context menu option for adding or removing comments on the current\n * block.\n * @param {!Blockly.BlockSvg} block The block where the right-click originated.\n * @return {!Object} A menu option, containing text, enabled, and a callback.\n * @package\n */\nBlockly.ContextMenu.blockCommentOption = function(block) {\n  var commentOption = {\n    enabled: !Blockly.utils.userAgent.IE\n  };\n  // If there's already a comment, add an option to delete it.\n  if (block.getCommentIcon()) {\n    commentOption.text = Blockly.Msg['REMOVE_COMMENT'];\n    commentOption.callback = function() {\n      block.setCommentText(null);\n    };\n  } else {\n    // If there's no comment, add an option to create a comment.\n    commentOption.text = Blockly.Msg['ADD_COMMENT'];\n    commentOption.callback = function() {\n      block.setCommentText('');\n    };\n  }\n  return commentOption;\n};\n\n/**\n * Make a context menu option for deleting the current workspace comment.\n * @param {!Blockly.WorkspaceCommentSvg} comment The workspace comment where the\n *     right-click originated.\n * @return {!Object} A menu option, containing text, enabled, and a callback.\n * @package\n */\nBlockly.ContextMenu.commentDeleteOption = function(comment) {\n  var deleteOption = {\n    text: Blockly.Msg['REMOVE_COMMENT'],\n    enabled: true,\n    callback: function() {\n      Blockly.Events.setGroup(true);\n      comment.dispose(true, true);\n      Blockly.Events.setGroup(false);\n    }\n  };\n  return deleteOption;\n};\n\n/**\n * Make a context menu option for duplicating the current workspace comment.\n * @param {!Blockly.WorkspaceCommentSvg} comment The workspace comment where the\n *     right-click originated.\n * @return {!Object} A menu option, containing text, enabled, and a callback.\n * @package\n */\nBlockly.ContextMenu.commentDuplicateOption = function(comment) {\n  var duplicateOption = {\n    text: Blockly.Msg['DUPLICATE_COMMENT'],\n    enabled: true,\n    callback: function() {\n      Blockly.duplicate(comment);\n    }\n  };\n  return duplicateOption;\n};\n\n/**\n * Make a context menu option for adding a comment on the workspace.\n * @param {!Blockly.WorkspaceSvg} ws The workspace where the right-click\n *     originated.\n * @param {!Event} e The right-click mouse event.\n * @return {!Object} A menu option, containing text, enabled, and a callback.\n * @package\n * @suppress {strictModuleDepCheck,checkTypes} Suppress checks while workspace\n *     comments are not bundled in.\n */\nBlockly.ContextMenu.workspaceCommentOption = function(ws, e) {\n  if (!Blockly.WorkspaceCommentSvg) {\n    throw Error('Missing require for Blockly.WorkspaceCommentSvg');\n  }\n  // Helper function to create and position a comment correctly based on the\n  // location of the mouse event.\n  var addWsComment = function() {\n    var comment = new Blockly.WorkspaceCommentSvg(\n        ws, Blockly.Msg['WORKSPACE_COMMENT_DEFAULT_TEXT'],\n        Blockly.WorkspaceCommentSvg.DEFAULT_SIZE,\n        Blockly.WorkspaceCommentSvg.DEFAULT_SIZE);\n\n    var injectionDiv = ws.getInjectionDiv();\n    // Bounding rect coordinates are in client coordinates, meaning that they\n    // are in pixels relative to the upper left corner of the visible browser\n    // window.  These coordinates change when you scroll the browser window.\n    var boundingRect = injectionDiv.getBoundingClientRect();\n\n    // The client coordinates offset by the injection div's upper left corner.\n    var clientOffsetPixels = new Blockly.utils.Coordinate(\n        e.clientX - boundingRect.left, e.clientY - boundingRect.top);\n\n    // The offset in pixels between the main workspace's origin and the upper\n    // left corner of the injection div.\n    var mainOffsetPixels = ws.getOriginOffsetInPixels();\n\n    // The position of the new comment in pixels relative to the origin of the\n    // main workspace.\n    var finalOffset = Blockly.utils.Coordinate.difference(clientOffsetPixels,\n        mainOffsetPixels);\n    // The position of the new comment in main workspace coordinates.\n    finalOffset.scale(1 / ws.scale);\n\n    var commentX = finalOffset.x;\n    var commentY = finalOffset.y;\n    comment.moveBy(commentX, commentY);\n    if (ws.rendered) {\n      comment.initSvg();\n      comment.render();\n      comment.select();\n    }\n  };\n\n  var wsCommentOption = {\n    // Foreign objects don't work in IE.  Don't let the user create comments\n    // that they won't be able to edit.\n    enabled: !Blockly.utils.userAgent.IE\n  };\n  wsCommentOption.text = Blockly.Msg['ADD_COMMENT'];\n  wsCommentOption.callback = function() {\n    addWsComment();\n  };\n  return wsCommentOption;\n};\n"],"file":"contextmenu.min.js"}