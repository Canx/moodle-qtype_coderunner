'use strict';goog.provide("Blockly.tree.BaseNode");goog.require("Blockly.Component");goog.require("Blockly.utils.aria");goog.require("Blockly.utils.object");goog.require("Blockly.utils.KeyCodes");goog.require("Blockly.utils.style");Blockly.tree.BaseNode=function(a,b){Blockly.Component.call(this);this.content=a;this.iconClass;this.expandedIconClass;this.config_=b;this.tree;this.previousSibling_;this.nextSibling_;this.selected_=!1;this.expanded_=!1;this.depth_=-1};Blockly.utils.object.inherits(Blockly.tree.BaseNode,Blockly.Component);Blockly.tree.BaseNode.Config;Blockly.tree.BaseNode.allNodes={};Blockly.tree.BaseNode.prototype.disposeInternal=function(){Blockly.tree.BaseNode.superClass_.disposeInternal.call(this);if(this.tree){this.tree=null}this.setElementInternal(null)};Blockly.tree.BaseNode.prototype.initAccessibility=function(){var a=this.getElement();if(a){var b=this.getLabelElement();if(b&&!b.id){b.id=this.getId()+".label"}Blockly.utils.aria.setRole(a,Blockly.utils.aria.Role.TREEITEM);Blockly.utils.aria.setState(a,Blockly.utils.aria.State.SELECTED,!1);Blockly.utils.aria.setState(a,Blockly.utils.aria.State.LEVEL,this.getDepth());if(b){Blockly.utils.aria.setState(a,Blockly.utils.aria.State.LABELLEDBY,b.id)}var c=this.getIconElement();if(c){Blockly.utils.aria.setRole(c,Blockly.utils.aria.Role.PRESENTATION)}var d=this.getChildrenElement();if(d){Blockly.utils.aria.setRole(d,Blockly.utils.aria.Role.GROUP);if(d.hasChildNodes()){Blockly.utils.aria.setState(a,Blockly.utils.aria.State.EXPANDED,!1);for(var e=this.getChildCount(),f=1,g;f<=e;f++){g=this.getChildAt(f-1).getElement();Blockly.utils.aria.setState(g,Blockly.utils.aria.State.SETSIZE,e);Blockly.utils.aria.setState(g,Blockly.utils.aria.State.POSINSET,f)}}}}};Blockly.tree.BaseNode.prototype.createDom=function(){var a=document.createElement("div");a.appendChild(this.toDom());this.setElementInternal(a)};Blockly.tree.BaseNode.prototype.enterDocument=function(){Blockly.tree.BaseNode.superClass_.enterDocument.call(this);Blockly.tree.BaseNode.allNodes[this.getId()]=this;this.initAccessibility()};Blockly.tree.BaseNode.prototype.exitDocument=function(){Blockly.tree.BaseNode.superClass_.exitDocument.call(this);delete Blockly.tree.BaseNode.allNodes[this.getId()]};Blockly.tree.BaseNode.prototype.addChildAt=function(a,b){a=a;var c=this.getChildAt(b-1),d=this.getChildAt(b);Blockly.tree.BaseNode.superClass_.addChildAt.call(this,a,b);a.previousSibling_=c;a.nextSibling_=d;if(c){c.nextSibling_=a}if(d){d.previousSibling_=a}var e=this.getTree();if(e){a.setTreeInternal(e)}a.setDepth_(this.getDepth()+1);var f=this.getElement();if(f){this.updateExpandIcon();Blockly.utils.aria.setState(f,Blockly.utils.aria.State.EXPANDED,this.expanded_);if(this.expanded_){var g=this.getChildrenElement();if(!a.getElement()){a.createDom()}var h=a.getElement(),i=d&&d.getElement();g.insertBefore(h,i);if(this.isInDocument()){a.enterDocument()}if(!d){if(c){c.updateExpandIcon()}else{Blockly.utils.style.setElementShown(g,!0);this.setExpanded(this.expanded_)}}}}};Blockly.tree.BaseNode.prototype.add=function(a){if(a.getParent()){throw Error(Blockly.Component.Error.PARENT_UNABLE_TO_BE_SET)}this.addChildAt(a,this.getChildCount())};Blockly.tree.BaseNode.prototype.getTree=function(){return null};Blockly.tree.BaseNode.prototype.getDepth=function(){var a=this.depth_;if(0>a){var b=this.getParent();if(b){a=b.getDepth()+1}else{a=0}this.setDepth_(a)}return a};Blockly.tree.BaseNode.prototype.setDepth_=function(a){if(a!=this.depth_){this.depth_=a;var b=this.getRowElement();if(b){var c=this.getPixelIndent_()+"px";if(this.rightToLeft_){b.style.paddingRight=c}else{b.style.paddingLeft=c}}this.forEachChild(function(b){b.setDepth_(a+1)})}};Blockly.tree.BaseNode.prototype.contains=function(a){while(a){if(a==this){return!0}a=a.getParent()}return!1};Blockly.tree.BaseNode.prototype.getChildAt;Blockly.tree.BaseNode.prototype.getChildren=function(){var a=[];this.forEachChild(function(b){a.push(b)});return a};Blockly.tree.BaseNode.prototype.getParent=function(){return Blockly.tree.BaseNode.superClass_.getParent.call(this)};Blockly.tree.BaseNode.prototype.getPreviousSibling=function(){return this.previousSibling_};Blockly.tree.BaseNode.prototype.getNextSibling=function(){return this.nextSibling_};Blockly.tree.BaseNode.prototype.isLastSibling=function(){return!this.nextSibling_};Blockly.tree.BaseNode.prototype.isSelected=function(){return this.selected_};Blockly.tree.BaseNode.prototype.select=function(){var a=this.getTree();if(a){a.setSelectedItem(this)}};Blockly.tree.BaseNode.prototype.setSelected=function(a){if(this.selected_==a){return}this.selected_=a;this.updateRow();var b=this.getElement();if(b){Blockly.utils.aria.setState(b,Blockly.utils.aria.State.SELECTED,a);if(a){var c=this.getTree().getElement();Blockly.utils.aria.setState(c,Blockly.utils.aria.State.ACTIVEDESCENDANT,this.getId())}}};Blockly.tree.BaseNode.prototype.setExpanded=function(a){var b=a!=this.expanded_,c;this.expanded_=a;var d=this.getTree(),e=this.getElement();if(this.hasChildren()){if(!a&&d&&this.contains(d.getSelectedItem())){this.select()}if(e){c=this.getChildrenElement();if(c){Blockly.utils.style.setElementShown(c,a);Blockly.utils.aria.setState(e,Blockly.utils.aria.State.EXPANDED,a);if(a&&this.isInDocument()&&!c.hasChildNodes()){this.forEachChild(function(a){c.appendChild(a.toDom())});this.forEachChild(function(a){a.enterDocument()})}}this.updateExpandIcon()}}else{c=this.getChildrenElement();if(c){Blockly.utils.style.setElementShown(c,!1)}}if(e){this.updateIcon_()}if(b){if(a){this.doNodeExpanded()}else{this.doNodeCollapsed()}}};Blockly.tree.BaseNode.prototype.doNodeExpanded=function(){};Blockly.tree.BaseNode.prototype.doNodeCollapsed=function(){};Blockly.tree.BaseNode.prototype.toggle=function(){this.setExpanded(!this.expanded_)};Blockly.tree.BaseNode.prototype.toDom=function(){var a=this.expanded_&&this.hasChildren(),b=document.createElement("div");b.style.backgroundPosition=this.getBackgroundPosition();if(!a){b.style.display="none"}if(a){this.forEachChild(function(a){b.appendChild(a.toDom())})}var c=document.createElement("div");c.id=this.getId();c.appendChild(this.getRowDom());c.appendChild(b);return c};Blockly.tree.BaseNode.prototype.getPixelIndent_=function(){return Math.max(0,(this.getDepth()-1)*this.config_.indentWidth)};Blockly.tree.BaseNode.prototype.getRowDom=function(){var a=document.createElement("div");a.className=this.getRowClassName();a.style["padding-"+(this.rightToLeft_?"right":"left")]=this.getPixelIndent_()+"px";a.appendChild(this.getIconDom());a.appendChild(this.getLabelDom());return a};Blockly.tree.BaseNode.prototype.getRowClassName=function(){var a="";if(this.isSelected()){a=" "+(this.config_.cssSelectedRow||"")}return this.config_.cssTreeRow+a};Blockly.tree.BaseNode.prototype.getLabelDom=function(){var a=document.createElement("span");a.className=this.config_.cssItemLabel||"";a.textContent=this.content;return a};Blockly.tree.BaseNode.prototype.getIconDom=function(){var a=document.createElement("span");a.style.display="inline-block";a.className=this.getCalculatedIconClass();return a};Blockly.tree.BaseNode.prototype.getCalculatedIconClass=function(){throw Error(Blockly.Component.Error.ABSTRACT_METHOD)};Blockly.tree.BaseNode.prototype.getBackgroundPosition=function(){return(this.isLastSibling()?"-100":(this.getDepth()-1)*this.config_.indentWidth)+"px 0"};Blockly.tree.BaseNode.prototype.getElement=function(){var a=Blockly.tree.BaseNode.superClass_.getElement.call(this);if(!a){a=document.getElementById(this.getId());this.setElementInternal(a)}return a};Blockly.tree.BaseNode.prototype.getRowElement=function(){var a=this.getElement();return a?a.firstChild:null};Blockly.tree.BaseNode.prototype.getIconElement=function(){var a=this.getRowElement();return a?a.firstChild:null};Blockly.tree.BaseNode.prototype.getLabelElement=function(){var a=this.getRowElement();return a&&a.lastChild?a.lastChild.previousSibling:null};Blockly.tree.BaseNode.prototype.getChildrenElement=function(){var a=this.getElement();return a?a.lastChild:null};Blockly.tree.BaseNode.prototype.updateRow=function(){var a=this.getRowElement();if(a){a.className=this.getRowClassName()}};Blockly.tree.BaseNode.prototype.updateExpandIcon=function(){var a=this.getChildrenElement();if(a){a.style.backgroundPosition=this.getBackgroundPosition()}};Blockly.tree.BaseNode.prototype.updateIcon_=function(){this.getIconElement().className=this.getCalculatedIconClass()};Blockly.tree.BaseNode.prototype.onClick_=function(a){a.preventDefault()};Blockly.tree.BaseNode.prototype.onKeyDown=function(a){var b=!0;switch(a.keyCode){case Blockly.utils.KeyCodes.RIGHT:b=this.selectChild();break;case Blockly.utils.KeyCodes.LEFT:b=this.selectParent();break;case Blockly.utils.KeyCodes.DOWN:b=this.selectNext();break;case Blockly.utils.KeyCodes.UP:b=this.selectPrevious();break;case Blockly.utils.KeyCodes.ENTER:case Blockly.utils.KeyCodes.SPACE:this.toggle();b=!0;break;default:b=!1;}if(b){a.preventDefault()}return b};Blockly.tree.BaseNode.prototype.selectNext=function(){var a=this.getNextShownNode();if(a){a.select()}return!0};Blockly.tree.BaseNode.prototype.selectPrevious=function(){var a=this.getPreviousShownNode();if(a){a.select()}return!0};Blockly.tree.BaseNode.prototype.selectParent=function(){if(this.hasChildren()&&this.expanded_){this.setExpanded(!1)}else{var a=this.getParent(),b=this.getTree();if(a&&a!=b){a.select()}}return!0};Blockly.tree.BaseNode.prototype.selectChild=function(){if(this.hasChildren()){if(!this.expanded_){this.setExpanded(!0)}else{this.getChildAt(0).select()}return!0}return!1};Blockly.tree.BaseNode.prototype.getLastShownDescendant=function(){if(!this.expanded_||!this.hasChildren()){return this}return this.getChildAt(this.getChildCount()-1).getLastShownDescendant()};Blockly.tree.BaseNode.prototype.getNextShownNode=function(){if(this.hasChildren()&&this.expanded_){return this.getChildAt(0)}var a=this,b;while(a!=this.getTree()){b=a.getNextSibling();if(null!=b){return b}a=a.getParent()}return null};Blockly.tree.BaseNode.prototype.getPreviousShownNode=function(){var a=this.getPreviousSibling();if(null!=a){return a.getLastShownDescendant()}var b=this.getParent(),c=this.getTree();if(b==c){return null}if(this==c){return null}return b};Blockly.tree.BaseNode.prototype.setTreeInternal=function(a){if(this.tree!=a){this.tree=a;this.forEachChild(function(b){b.setTreeInternal(a)})}};
//# sourceMappingURL=basenode.min.js.map
