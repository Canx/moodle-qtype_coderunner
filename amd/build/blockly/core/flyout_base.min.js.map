{"version":3,"sources":["../../../src/blockly/core/flyout_base.js"],"names":["goog","provide","require","requireType","Blockly","Flyout","workspaceOptions","getMetrics","getMetrics_","bind","setMetrics","setMetrics_","workspace_","WorkspaceSvg","isFlyout","setVisible","isVisible_","RTL","horizontalLayout","toolboxPosition_","toolboxPosition","eventWrappers_","mats_","buttons_","listeners_","permanentlyDisabled_","tabWidth_","getRenderer","getConstants","TAB_WIDTH","targetWorkspace","prototype","autoClose","containerVisible_","CORNER_RADIUS","MARGIN","GAP_X","GAP_Y","SCROLLBAR_PADDING","width_","height_","dragAngleRange_","createDom","tagName","svgGroup_","utils","dom","createSvgElement","svgBackground_","appendChild","getThemeManager","subscribe","getMarkerManager","setCursor","FlyoutCursor","init","scrollbar","Scrollbar","hide","Array","push","apply","bindEventWithChecks_","wheel_","filterWrapper_","filterForCapacity_","addChangeListener","onMouseDown_","getGesture","setVariableMap","getVariableMap","createPotentialVariableMap","dispose","unbindEvent_","removeChangeListener","unsubscribe","removeNode","getWidth","getHeight","getWorkspace","isVisible","visible","visibilityChanged","updateDisplay_","setContainerVisible","show","style","display","positionAt_","width","height","x","y","setAttribute","transform","setCssTransform","setOrigin","resize","setPosition","position","i","listen","length","reflowWrapper_","flyoutDef","setResizesEnabled","clearOldBlocks_","fnToApply","getToolboxCategoryCallback","TypeError","isArray","parsedContent","toolbox","convertToolboxToJSON","flyoutInfo","createFlyoutInfo_","layout_","contents","gaps","deselectAll","topBlocks","getTopBlocks","block","removeSelect","reflow","defaultGap","contentInfo","toUpperCase","blockInfo","blockXml","getBlockXml_","createBlock_","gap","parseInt","getAttribute","isNaN","type","sepInfo","addSeparatorGap_","labelInfo","label","createButton_","button","buttonInfo","btnInfo","isLabel","FlyoutButton","Error","curButton","curBlock","Xml","domToBlock","isEnabled","blockElement","textToDom","xml","createElement","newGap","oldBlocks","workspace","j","rect","Tooltip","unbindMouseEvents","getPotentialVariableMap","clear","addBlockListeners_","root","blockMouseDown_","bindEvent_","addSelect","flyout","e","gesture","setStartBlock","handleFlyoutStart","isBlockCreatable_","createBlock","originalBlock","newBlock","Events","disable","variablesBeforeCreation","getAllVariables","placeNewBlock_","hideChaff","enable","newVariables","Variables","getAddedVariables","setGroup","fire","Create","thisVariable","VarCreate","initFlyoutButton_","buttonSvg","moveTo","createRect_","blockHW","index","tooltip","bindMouseEvents","getCanvas","insertBefore","getSvgRoot","flyoutRect_","moveRectToBlock_","getHeightWidth","blockXY","getRelativeToSurfaceXY","blocks","indexOf","isCapacityAvailable","getBlockTypeCounts","setEnabled","getNextBlock","reflowInternal_","isScrollable","oldBlock","svgRootOld","blockToDom","svgRootNew","mainOffsetPixels","getOriginOffsetInPixels","flyoutOffsetPixels","oldBlockPos","scale","oldBlockOffsetPixels","Coordinate","sum","finalOffset","difference","moveBy","onBlocklyAction","action","cursor","getCursor","getClientRect","isDragTowardWorkspace"],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Flyout tray containing blocks which may be created.\n * @author fraser@google.com (Neil Fraser)\n */\n'use strict';\n\ngoog.provide('Blockly.Flyout');\n\ngoog.require('Blockly.Block');\ngoog.require('Blockly.blockRendering');\ngoog.require('Blockly.Events');\ngoog.require('Blockly.Events.BlockCreate');\ngoog.require('Blockly.Events.VarCreate');\ngoog.require('Blockly.FlyoutCursor');\ngoog.require('Blockly.Gesture');\ngoog.require('Blockly.Marker');\ngoog.require('Blockly.Scrollbar');\ngoog.require('Blockly.Tooltip');\ngoog.require('Blockly.Touch');\ngoog.require('Blockly.utils');\ngoog.require('Blockly.utils.Coordinate');\ngoog.require('Blockly.utils.dom');\ngoog.require('Blockly.WorkspaceSvg');\ngoog.require('Blockly.Xml');\n\ngoog.requireType('Blockly.IBlocklyActionable');\ngoog.requireType('Blockly.IDeleteArea');\ngoog.requireType('Blockly.utils.Metrics');\n\n\n/**\n * Class for a flyout.\n * @param {!Blockly.Options} workspaceOptions Dictionary of options for the\n *     workspace.\n * @constructor\n * @abstract\n * @implements {Blockly.IBlocklyActionable}\n * @implements {Blockly.IDeleteArea}\n */\nBlockly.Flyout = function(workspaceOptions) {\n  workspaceOptions.getMetrics =\n    /** @type {function():!Blockly.utils.Metrics} */ (\n      this.getMetrics_.bind(this));\n  workspaceOptions.setMetrics = this.setMetrics_.bind(this);\n\n  /**\n   * @type {!Blockly.WorkspaceSvg}\n   * @protected\n   */\n  this.workspace_ = new Blockly.WorkspaceSvg(workspaceOptions);\n  this.workspace_.isFlyout = true;\n  // Keep the workspace visibility consistent with the flyout's visibility.\n  this.workspace_.setVisible(this.isVisible_);\n\n  /**\n   * Is RTL vs LTR.\n   * @type {boolean}\n   */\n  this.RTL = !!workspaceOptions.RTL;\n\n  /**\n   * Whether the flyout should be laid out horizontally or not.\n   * @type {boolean}\n   * @package\n   */\n  this.horizontalLayout = false;\n\n  /**\n   * Position of the toolbox and flyout relative to the workspace.\n   * @type {number}\n   * @protected\n   */\n  this.toolboxPosition_ = workspaceOptions.toolboxPosition;\n\n  /**\n   * Opaque data that can be passed to Blockly.unbindEvent_.\n   * @type {!Array.<!Array>}\n   * @private\n   */\n  this.eventWrappers_ = [];\n\n  /**\n   * List of background mats that lurk behind each block to catch clicks\n   * landing in the blocks' lakes and bays.\n   * @type {!Array.<!SVGElement>}\n   * @private\n   */\n  this.mats_ = [];\n\n  /**\n   * List of visible buttons.\n   * @type {!Array.<!Blockly.FlyoutButton>}\n   * @protected\n   */\n  this.buttons_ = [];\n\n  /**\n   * List of event listeners.\n   * @type {!Array.<!Array>}\n   * @private\n   */\n  this.listeners_ = [];\n\n  /**\n   * List of blocks that should always be disabled.\n   * @type {!Array.<!Blockly.Block>}\n   * @private\n   */\n  this.permanentlyDisabled_ = [];\n\n  /**\n   * Width of output tab.\n   * @type {number}\n   * @protected\n   * @const\n   */\n  this.tabWidth_ = this.workspace_.getRenderer().getConstants().TAB_WIDTH;\n\n  /**\n   * The target workspace\n   * @type {?Blockly.WorkspaceSvg}\n   * @package\n   */\n  this.targetWorkspace = null;\n};\n\n/**\n * Does the flyout automatically close when a block is created?\n * @type {boolean}\n */\nBlockly.Flyout.prototype.autoClose = true;\n\n/**\n * Whether the flyout is visible.\n * @type {boolean}\n * @private\n */\nBlockly.Flyout.prototype.isVisible_ = false;\n\n/**\n * Whether the workspace containing this flyout is visible.\n * @type {boolean}\n * @private\n */\nBlockly.Flyout.prototype.containerVisible_ = true;\n\n/**\n * Corner radius of the flyout background.\n * @type {number}\n * @const\n */\nBlockly.Flyout.prototype.CORNER_RADIUS = 8;\n\n/**\n * Margin around the edges of the blocks in the flyout.\n * @type {number}\n * @const\n */\nBlockly.Flyout.prototype.MARGIN = Blockly.Flyout.prototype.CORNER_RADIUS;\n\n// TODO: Move GAP_X and GAP_Y to their appropriate files.\n\n/**\n * Gap between items in horizontal flyouts. Can be overridden with the \"sep\"\n * element.\n * @const {number}\n */\nBlockly.Flyout.prototype.GAP_X = Blockly.Flyout.prototype.MARGIN * 3;\n\n/**\n * Gap between items in vertical flyouts. Can be overridden with the \"sep\"\n * element.\n * @const {number}\n */\nBlockly.Flyout.prototype.GAP_Y = Blockly.Flyout.prototype.MARGIN * 3;\n\n/**\n * Top/bottom padding between scrollbar and edge of flyout background.\n * @type {number}\n * @const\n */\nBlockly.Flyout.prototype.SCROLLBAR_PADDING = 2;\n\n/**\n * Width of flyout.\n * @type {number}\n * @protected\n */\nBlockly.Flyout.prototype.width_ = 0;\n\n/**\n * Height of flyout.\n * @type {number}\n * @protected\n */\nBlockly.Flyout.prototype.height_ = 0;\n\n/**\n * Range of a drag angle from a flyout considered \"dragging toward workspace\".\n * Drags that are within the bounds of this many degrees from the orthogonal\n * line to the flyout edge are considered to be \"drags toward the workspace\".\n * Example:\n * Flyout                                                  Edge   Workspace\n * [block] /  <-within this angle, drags \"toward workspace\" |\n * [block] ---- orthogonal to flyout boundary ----          |\n * [block] \\                                                |\n * The angle is given in degrees from the orthogonal.\n *\n * This is used to know when to create a new block and when to scroll the\n * flyout. Setting it to 360 means that all drags create a new block.\n * @type {number}\n * @protected\n*/\nBlockly.Flyout.prototype.dragAngleRange_ = 70;\n\n/**\n * Creates the flyout's DOM.  Only needs to be called once.  The flyout can\n * either exist as its own svg element or be a g element nested inside a\n * separate svg element.\n * @param {string} tagName The type of tag to put the flyout in. This\n *     should be <svg> or <g>.\n * @return {!SVGElement} The flyout's SVG group.\n */\nBlockly.Flyout.prototype.createDom = function(tagName) {\n  /*\n  <svg | g>\n    <path class=\"blocklyFlyoutBackground\"/>\n    <g class=\"blocklyFlyout\"></g>\n  </ svg | g>\n  */\n  // Setting style to display:none to start. The toolbox and flyout\n  // hide/show code will set up proper visibility and size later.\n  this.svgGroup_ = Blockly.utils.dom.createSvgElement(tagName,\n      {'class': 'blocklyFlyout', 'style': 'display: none'}, null);\n  this.svgBackground_ = Blockly.utils.dom.createSvgElement('path',\n      {'class': 'blocklyFlyoutBackground'}, this.svgGroup_);\n  this.svgGroup_.appendChild(this.workspace_.createDom());\n  this.workspace_.getThemeManager().subscribe(\n      this.svgBackground_, 'flyoutBackgroundColour', 'fill');\n  this.workspace_.getThemeManager().subscribe(\n      this.svgBackground_, 'flyoutOpacity', 'fill-opacity');\n  this.workspace_.getMarkerManager().setCursor(new Blockly.FlyoutCursor());\n  return this.svgGroup_;\n};\n\n/**\n * Initializes the flyout.\n * @param {!Blockly.WorkspaceSvg} targetWorkspace The workspace in which to\n *     create new blocks.\n */\nBlockly.Flyout.prototype.init = function(targetWorkspace) {\n  this.targetWorkspace = targetWorkspace;\n  this.workspace_.targetWorkspace = targetWorkspace;\n\n  /**\n   * @type {!Blockly.Scrollbar}\n   * @package\n   */\n  this.scrollbar = new Blockly.Scrollbar(this.workspace_,\n      this.horizontalLayout, false, 'blocklyFlyoutScrollbar');\n\n  this.hide();\n\n  Array.prototype.push.apply(this.eventWrappers_,\n      Blockly.bindEventWithChecks_(this.svgGroup_, 'wheel', this, this.wheel_));\n  if (!this.autoClose) {\n    this.filterWrapper_ = this.filterForCapacity_.bind(this);\n    this.targetWorkspace.addChangeListener(this.filterWrapper_);\n  }\n\n  // Dragging the flyout up and down.\n  Array.prototype.push.apply(this.eventWrappers_,\n      Blockly.bindEventWithChecks_(\n          this.svgBackground_, 'mousedown', this, this.onMouseDown_));\n\n  // A flyout connected to a workspace doesn't have its own current gesture.\n  this.workspace_.getGesture =\n      this.targetWorkspace.getGesture.bind(this.targetWorkspace);\n\n  // Get variables from the main workspace rather than the target workspace.\n  this.workspace_.setVariableMap(this.targetWorkspace.getVariableMap());\n\n  this.workspace_.createPotentialVariableMap();\n};\n\n/**\n * Dispose of this flyout.\n * Unlink from all DOM elements to prevent memory leaks.\n * @suppress {checkTypes}\n */\nBlockly.Flyout.prototype.dispose = function() {\n  this.hide();\n  Blockly.unbindEvent_(this.eventWrappers_);\n  if (this.filterWrapper_) {\n    this.targetWorkspace.removeChangeListener(this.filterWrapper_);\n    this.filterWrapper_ = null;\n  }\n  if (this.scrollbar) {\n    this.scrollbar.dispose();\n    this.scrollbar = null;\n  }\n  if (this.workspace_) {\n    this.workspace_.getThemeManager().unsubscribe(this.svgBackground_);\n    this.workspace_.targetWorkspace = null;\n    this.workspace_.dispose();\n    this.workspace_ = null;\n  }\n  if (this.svgGroup_) {\n    Blockly.utils.dom.removeNode(this.svgGroup_);\n    this.svgGroup_ = null;\n  }\n  this.svgBackground_ = null;\n  this.targetWorkspace = null;\n};\n\n/**\n * Get the width of the flyout.\n * @return {number} The width of the flyout.\n */\nBlockly.Flyout.prototype.getWidth = function() {\n  return this.width_;\n};\n\n/**\n * Get the height of the flyout.\n * @return {number} The width of the flyout.\n */\nBlockly.Flyout.prototype.getHeight = function() {\n  return this.height_;\n};\n\n/**\n * Get the workspace inside the flyout.\n * @return {!Blockly.WorkspaceSvg} The workspace inside the flyout.\n * @package\n */\nBlockly.Flyout.prototype.getWorkspace = function() {\n  return this.workspace_;\n};\n\n/**\n * Is the flyout visible?\n * @return {boolean} True if visible.\n */\nBlockly.Flyout.prototype.isVisible = function() {\n  return this.isVisible_;\n};\n\n/**\n * Set whether the flyout is visible. A value of true does not necessarily mean\n * that the flyout is shown. It could be hidden because its container is hidden.\n * @param {boolean} visible True if visible.\n */\nBlockly.Flyout.prototype.setVisible = function(visible) {\n  var visibilityChanged = (visible != this.isVisible());\n\n  this.isVisible_ = visible;\n  if (visibilityChanged) {\n    this.updateDisplay_();\n  }\n};\n\n/**\n * Set whether this flyout's container is visible.\n * @param {boolean} visible Whether the container is visible.\n */\nBlockly.Flyout.prototype.setContainerVisible = function(visible) {\n  var visibilityChanged = (visible != this.containerVisible_);\n  this.containerVisible_ = visible;\n  if (visibilityChanged) {\n    this.updateDisplay_();\n  }\n};\n\n/**\n * Update the display property of the flyout based whether it thinks it should\n * be visible and whether its containing workspace is visible.\n * @private\n */\nBlockly.Flyout.prototype.updateDisplay_ = function() {\n  var show = true;\n  if (!this.containerVisible_) {\n    show = false;\n  } else {\n    show = this.isVisible();\n  }\n  this.svgGroup_.style.display = show ? 'block' : 'none';\n  // Update the scrollbar's visibility too since it should mimic the\n  // flyout's visibility.\n  this.scrollbar.setContainerVisible(show);\n};\n\n/**\n * Update the view based on coordinates calculated in position().\n * @param {number} width The computed width of the flyout's SVG group\n * @param {number} height The computed height of the flyout's SVG group.\n * @param {number} x The computed x origin of the flyout's SVG group.\n * @param {number} y The computed y origin of the flyout's SVG group.\n * @protected\n */\nBlockly.Flyout.prototype.positionAt_ = function(width, height, x, y) {\n  this.svgGroup_.setAttribute(\"width\", width);\n  this.svgGroup_.setAttribute(\"height\", height);\n  if (this.svgGroup_.tagName == 'svg') {\n    var transform = 'translate(' + x + 'px,' + y + 'px)';\n    Blockly.utils.dom.setCssTransform(this.svgGroup_, transform);\n  } else {\n    // IE and Edge don't support CSS transforms on SVG elements so\n    // it's important to set the transform on the SVG element itself\n    var transform = 'translate(' + x + ',' + y + ')';\n    this.svgGroup_.setAttribute(\"transform\", transform);\n  }\n\n  // Update the scrollbar (if one exists).\n  if (this.scrollbar) {\n    // Set the scrollbars origin to be the top left of the flyout.\n    this.scrollbar.setOrigin(x, y);\n    this.scrollbar.resize();\n    // Set the position again so that if the metrics were the same (and the\n    // resize failed) our position is still updated.\n    this.scrollbar.setPosition(\n        this.scrollbar.position.x, this.scrollbar.position.y);\n  }\n};\n\n/**\n * Hide and empty the flyout.\n */\nBlockly.Flyout.prototype.hide = function() {\n  if (!this.isVisible()) {\n    return;\n  }\n  this.setVisible(false);\n  // Delete all the event listeners.\n  for (var i = 0, listen; (listen = this.listeners_[i]); i++) {\n    Blockly.unbindEvent_(listen);\n  }\n  this.listeners_.length = 0;\n  if (this.reflowWrapper_) {\n    this.workspace_.removeChangeListener(this.reflowWrapper_);\n    this.reflowWrapper_ = null;\n  }\n  // Do NOT delete the blocks here.  Wait until Flyout.show.\n  // https://neil.fraser.name/news/2014/08/09/\n};\n\n/**\n * Show and populate the flyout.\n * @param {!Blockly.utils.toolbox.ToolboxDefinition|string} flyoutDef\n *    List of contents to display in the flyout as an array of xml an\n *    array of Nodes, a NodeList or a string with the name of the dynamic category.\n *    Variables and procedures have a custom set of blocks.\n */\nBlockly.Flyout.prototype.show = function(flyoutDef) {\n  this.workspace_.setResizesEnabled(false);\n  this.hide();\n  this.clearOldBlocks_();\n\n  // Handle dynamic categories, represented by a name instead of a list.\n  // Look up the correct category generation function and call that to get a\n  // valid XML list.\n  if (typeof flyoutDef == 'string') {\n    var fnToApply = this.workspace_.targetWorkspace.getToolboxCategoryCallback(\n        flyoutDef);\n    if (typeof fnToApply != 'function') {\n      throw TypeError('Couldn\\'t find a callback function when opening' +\n          ' a toolbox category.');\n    }\n    flyoutDef = fnToApply(this.workspace_.targetWorkspace);\n    if (!Array.isArray(flyoutDef)) {\n      throw TypeError('Result of toolbox category callback must be an array.');\n    }\n  }\n  this.setVisible(true);\n  \n  // Parse the Array or NodeList passed in into an Array of\n  // Blockly.utils.toolbox.Toolbox.\n  var parsedContent = Blockly.utils.toolbox.convertToolboxToJSON(flyoutDef);\n  var flyoutInfo =\n    /** @type {{contents:!Array.<!Object>, gaps:!Array.<number>}} */ (\n      this.createFlyoutInfo_(parsedContent));\n\n  this.layout_(flyoutInfo.contents, flyoutInfo.gaps);\n\n  // IE 11 is an incompetent browser that fails to fire mouseout events.\n  // When the mouse is over the background, deselect all blocks.\n  var deselectAll = function() {\n    var topBlocks = this.workspace_.getTopBlocks(false);\n    for (var i = 0, block; (block = topBlocks[i]); i++) {\n      block.removeSelect();\n    }\n  };\n\n  this.listeners_.push(Blockly.bindEventWithChecks_(this.svgBackground_,\n      'mouseover', this, deselectAll));\n\n  if (this.horizontalLayout) {\n    this.height_ = 0;\n  } else {\n    this.width_ = 0;\n  }\n  this.workspace_.setResizesEnabled(true);\n  this.reflow();\n\n  this.filterForCapacity_();\n\n  // Correctly position the flyout's scrollbar when it opens.\n  this.position();\n\n  this.reflowWrapper_ = this.reflow.bind(this);\n  this.workspace_.addChangeListener(this.reflowWrapper_);\n};\n\n/**\n * Create the contents array and gaps array necessary to create the layout for\n * the flyout.\n * @param {Array.<Blockly.utils.toolbox.Toolbox>} parsedContent The array\n *   of objects to show in the flyout.\n * @return {{contents:Array.<Object>, gaps:Array.<number>}} The list of contents\n *   and gaps needed to lay out the flyout.\n * @private\n */\nBlockly.Flyout.prototype.createFlyoutInfo_ = function(parsedContent) {\n  var contents = [];\n  var gaps = [];\n  this.permanentlyDisabled_.length = 0;\n  var defaultGap = this.horizontalLayout ? this.GAP_X : this.GAP_Y;\n  for (var i = 0, contentInfo; (contentInfo = parsedContent[i]); i++) {\n    switch (contentInfo['kind'].toUpperCase()) {\n      case 'BLOCK':\n        var blockInfo = /** @type {Blockly.utils.toolbox.Block} */ (contentInfo);\n        var blockXml = this.getBlockXml_(blockInfo);\n        var block = this.createBlock_(blockXml);\n        // This is a deprecated method for adding gap to a block.\n        // <block type=\"math_arithmetic\" gap=\"8\"></block>\n        var gap = parseInt(blockInfo['gap'] || blockXml.getAttribute('gap'), 10);\n        gaps.push(isNaN(gap) ? defaultGap : gap);\n        contents.push({type: 'block', block: block});\n        break;\n      case 'SEP':\n        var sepInfo = /** @type {Blockly.utils.toolbox.Separator} */ (contentInfo);\n        this.addSeparatorGap_(sepInfo, gaps, defaultGap);\n        break;\n      case 'LABEL':\n        var labelInfo = /** @type {Blockly.utils.toolbox.Label} */ (contentInfo);\n        // A label is a button with different styling.\n        // Rename this function.\n        var label = this.createButton_(labelInfo, /** isLabel */ true);\n        contents.push({type: 'button', button: label});\n        gaps.push(defaultGap);\n        break;\n      case 'BUTTON':\n        var buttonInfo = /** @type {Blockly.utils.toolbox.Button} */ (contentInfo);\n        var button = this.createButton_(buttonInfo, /** isLabel */ false);\n        contents.push({type: 'button', button: button});\n        gaps.push(defaultGap);\n        break;\n    }\n  }\n  return {contents: contents, gaps: gaps};\n};\n\n/**\n * Creates a flyout button or a flyout label.\n * @param {!Blockly.utils.toolbox.Button|!Blockly.utils.toolbox.Label} btnInfo\n *    The object holding information about a button or a label.\n * @param {boolean} isLabel True if the button is a label, false otherwise.\n * @return {!Blockly.FlyoutButton} The object used to display the button in the\n *    flyout.\n * @private\n */\nBlockly.Flyout.prototype.createButton_ = function(btnInfo, isLabel) {\n  if (!Blockly.FlyoutButton) {\n    throw Error('Missing require for Blockly.FlyoutButton');\n  }\n  var curButton = new Blockly.FlyoutButton(this.workspace_,\n      /** @type {!Blockly.WorkspaceSvg} */ (this.targetWorkspace), btnInfo,\n      isLabel);\n  return curButton;\n};\n\n/**\n * Create a block from the xml and permanently disable any blocks that were\n * defined as disabled.\n * @param {!Element} blockXml The xml of the block.\n * @return {!Blockly.BlockSvg} The block created from the blockXml.\n * @private\n */\nBlockly.Flyout.prototype.createBlock_ = function(blockXml) {\n  var curBlock = /** @type {!Blockly.BlockSvg} */ (\n    Blockly.Xml.domToBlock(blockXml, this.workspace_));\n  if (!curBlock.isEnabled()) {\n    // Record blocks that were initially disabled.\n    // Do not enable these blocks as a result of capacity filtering.\n    this.permanentlyDisabled_.push(curBlock);\n  }\n  return curBlock;\n};\n\n/**\n * Get the xml from the block info object.\n * @param {!Blockly.utils.toolbox.Block}  blockInfo The object holding\n *    information about a block.\n * @return {!Element} The xml for the block.\n * @throws {Error} if the xml is not a valid block definition.\n * @private\n */\nBlockly.Flyout.prototype.getBlockXml_ = function(blockInfo) {\n  var blockElement = null;\n  var blockXml = blockInfo['blockxml'];\n\n  if (blockXml && typeof blockXml != 'string') {\n    blockElement = blockXml;\n  } else if (blockXml && typeof blockXml == 'string') {\n    blockElement = Blockly.Xml.textToDom(blockXml);\n  } else if (blockInfo['type']) {\n    blockElement = Blockly.utils.xml.createElement('xml');\n    blockElement.setAttribute('type', blockInfo['type']);\n    blockElement.setAttribute('disabled', blockInfo['disabled']);\n  }\n\n  if (!blockElement) {\n    throw Error('Error: Invalid block definition. Block definition must have blockxml or type.');\n  }\n  return blockElement;\n};\n\n/**\n * Add the necessary gap in the flyout for a separator.\n * @param {!Blockly.utils.toolbox.Separator} sepInfo The object holding\n *    information about a separator.\n * @param {!Array.<number>} gaps The list gaps between items in the flyout.\n * @param {number} defaultGap The default gap between the button and next element.\n * @private\n */\nBlockly.Flyout.prototype.addSeparatorGap_ = function(sepInfo, gaps, defaultGap) {\n  // Change the gap between two toolbox elements.\n  // <sep gap=\"36\"></sep>\n  // The default gap is 24, can be set larger or smaller.\n  // This overwrites the gap attribute on the previous element.\n  var newGap = parseInt(sepInfo['gap'], 10);\n  // Ignore gaps before the first block.\n  if (!isNaN(newGap) && gaps.length > 0) {\n    gaps[gaps.length - 1] = newGap;\n  } else {\n    gaps.push(defaultGap);\n  }\n};\n\n/**\n * Delete blocks, mats and buttons from a previous showing of the flyout.\n * @private\n */\nBlockly.Flyout.prototype.clearOldBlocks_ = function() {\n  // Delete any blocks from a previous showing.\n  var oldBlocks = this.workspace_.getTopBlocks(false);\n  for (var i = 0, block; (block = oldBlocks[i]); i++) {\n    if (block.workspace == this.workspace_) {\n      block.dispose(false, false);\n    }\n  }\n  // Delete any mats from a previous showing.\n  for (var j = 0; j < this.mats_.length; j++) {\n    var rect = this.mats_[j];\n    if (rect) {\n      Blockly.Tooltip.unbindMouseEvents(rect);\n      Blockly.utils.dom.removeNode(rect);\n    }\n  }\n  this.mats_.length = 0;\n  // Delete any buttons from a previous showing.\n  for (var i = 0, button; (button = this.buttons_[i]); i++) {\n    button.dispose();\n  }\n  this.buttons_.length = 0;\n\n  // Clear potential variables from the previous showing.\n  this.workspace_.getPotentialVariableMap().clear();\n};\n\n/**\n * Add listeners to a block that has been added to the flyout.\n * @param {!SVGElement} root The root node of the SVG group the block is in.\n * @param {!Blockly.BlockSvg} block The block to add listeners for.\n * @param {!SVGElement} rect The invisible rectangle under the block that acts\n *     as a mat for that block.\n * @protected\n */\nBlockly.Flyout.prototype.addBlockListeners_ = function(root, block, rect) {\n  this.listeners_.push(Blockly.bindEventWithChecks_(root, 'mousedown', null,\n      this.blockMouseDown_(block)));\n  this.listeners_.push(Blockly.bindEventWithChecks_(rect, 'mousedown', null,\n      this.blockMouseDown_(block)));\n  this.listeners_.push(Blockly.bindEvent_(root, 'mouseenter', block,\n      block.addSelect));\n  this.listeners_.push(Blockly.bindEvent_(root, 'mouseleave', block,\n      block.removeSelect));\n  this.listeners_.push(Blockly.bindEvent_(rect, 'mouseenter', block,\n      block.addSelect));\n  this.listeners_.push(Blockly.bindEvent_(rect, 'mouseleave', block,\n      block.removeSelect));\n};\n\n/**\n * Handle a mouse-down on an SVG block in a non-closing flyout.\n * @param {!Blockly.BlockSvg} block The flyout block to copy.\n * @return {!Function} Function to call when block is clicked.\n * @private\n */\nBlockly.Flyout.prototype.blockMouseDown_ = function(block) {\n  var flyout = this;\n  return function(e) {\n    var gesture = flyout.targetWorkspace.getGesture(e);\n    if (gesture) {\n      gesture.setStartBlock(block);\n      gesture.handleFlyoutStart(e, flyout);\n    }\n  };\n};\n\n/**\n * Mouse down on the flyout background.  Start a vertical scroll drag.\n * @param {!Event} e Mouse down event.\n * @private\n */\nBlockly.Flyout.prototype.onMouseDown_ = function(e) {\n  var gesture = this.targetWorkspace.getGesture(e);\n  if (gesture) {\n    gesture.handleFlyoutStart(e, this);\n  }\n};\n\n/**\n * Does this flyout allow you to create a new instance of the given block?\n * Used for deciding if a block can be \"dragged out of\" the flyout.\n * @param {!Blockly.BlockSvg} block The block to copy from the flyout.\n * @return {boolean} True if you can create a new instance of the block, false\n *    otherwise.\n * @package\n */\nBlockly.Flyout.prototype.isBlockCreatable_ = function(block) {\n  return block.isEnabled();\n};\n\n/**\n * Create a copy of this block on the workspace.\n * @param {!Blockly.BlockSvg} originalBlock The block to copy from the flyout.\n * @return {!Blockly.BlockSvg} The newly created block.\n * @throws {Error} if something went wrong with deserialization.\n * @package\n */\nBlockly.Flyout.prototype.createBlock = function(originalBlock) {\n  var newBlock = null;\n  Blockly.Events.disable();\n  var variablesBeforeCreation = this.targetWorkspace.getAllVariables();\n  this.targetWorkspace.setResizesEnabled(false);\n  try {\n    newBlock = this.placeNewBlock_(originalBlock);\n    // Close the flyout.\n    Blockly.hideChaff();\n  } finally {\n    Blockly.Events.enable();\n  }\n\n  var newVariables = Blockly.Variables.getAddedVariables(this.targetWorkspace,\n      variablesBeforeCreation);\n\n  if (Blockly.Events.isEnabled()) {\n    Blockly.Events.setGroup(true);\n    Blockly.Events.fire(new Blockly.Events.Create(newBlock));\n    // Fire a VarCreate event for each (if any) new variable created.\n    for (var i = 0; i < newVariables.length; i++) {\n      var thisVariable = newVariables[i];\n      Blockly.Events.fire(new Blockly.Events.VarCreate(thisVariable));\n    }\n  }\n  if (this.autoClose) {\n    this.hide();\n  } else {\n    this.filterForCapacity_();\n  }\n  return newBlock;\n};\n\n/**\n * Initialize the given button: move it to the correct location,\n * add listeners, etc.\n * @param {!Blockly.FlyoutButton} button The button to initialize and place.\n * @param {number} x The x position of the cursor during this layout pass.\n * @param {number} y The y position of the cursor during this layout pass.\n * @protected\n */\nBlockly.Flyout.prototype.initFlyoutButton_ = function(button, x, y) {\n  var buttonSvg = button.createDom();\n  button.moveTo(x, y);\n  button.show();\n  // Clicking on a flyout button or label is a lot like clicking on the\n  // flyout background.\n  this.listeners_.push(\n      Blockly.bindEventWithChecks_(\n          buttonSvg, 'mousedown', this, this.onMouseDown_));\n\n  this.buttons_.push(button);\n};\n\n/**\n * Create and place a rectangle corresponding to the given block.\n * @param {!Blockly.BlockSvg} block The block to associate the rect to.\n * @param {number} x The x position of the cursor during this layout pass.\n * @param {number} y The y position of the cursor during this layout pass.\n * @param {!{height: number, width: number}} blockHW The height and width of the\n *     block.\n * @param {number} index The index into the mats list where this rect should be\n *     placed.\n * @return {!SVGElement} Newly created SVG element for the rectangle behind the\n *     block.\n * @protected\n */\nBlockly.Flyout.prototype.createRect_ = function(block, x, y, blockHW, index) {\n  // Create an invisible rectangle under the block to act as a button.  Just\n  // using the block as a button is poor, since blocks have holes in them.\n  var rect = Blockly.utils.dom.createSvgElement('rect',\n      {\n        'fill-opacity': 0,\n        'x': x,\n        'y': y,\n        'height': blockHW.height,\n        'width': blockHW.width\n      }, null);\n  rect.tooltip = block;\n  Blockly.Tooltip.bindMouseEvents(rect);\n  // Add the rectangles under the blocks, so that the blocks' tooltips work.\n  this.workspace_.getCanvas().insertBefore(rect, block.getSvgRoot());\n\n  block.flyoutRect_ = rect;\n  this.mats_[index] = rect;\n  return rect;\n};\n\n/**\n * Move a rectangle to sit exactly behind a block, taking into account tabs,\n * hats, and any other protrusions we invent.\n * @param {!SVGElement} rect The rectangle to move directly behind the block.\n * @param {!Blockly.BlockSvg} block The block the rectangle should be behind.\n * @protected\n */\nBlockly.Flyout.prototype.moveRectToBlock_ = function(rect, block) {\n  var blockHW = block.getHeightWidth();\n  rect.setAttribute('width', blockHW.width);\n  rect.setAttribute('height', blockHW.height);\n\n  var blockXY = block.getRelativeToSurfaceXY();\n  rect.setAttribute('y', blockXY.y);\n  rect.setAttribute('x', this.RTL ? blockXY.x - blockHW.width : blockXY.x);\n};\n\n/**\n * Filter the blocks on the flyout to disable the ones that are above the\n * capacity limit.  For instance, if the user may only place two more blocks on\n * the workspace, an \"a + b\" block that has two shadow blocks would be disabled.\n * @private\n */\nBlockly.Flyout.prototype.filterForCapacity_ = function() {\n  var blocks = this.workspace_.getTopBlocks(false);\n  for (var i = 0, block; (block = blocks[i]); i++) {\n    if (this.permanentlyDisabled_.indexOf(block) == -1) {\n      var enable = this.targetWorkspace\n          .isCapacityAvailable(Blockly.utils.getBlockTypeCounts(block));\n      while (block) {\n        block.setEnabled(enable);\n        block = block.getNextBlock();\n      }\n    }\n  }\n};\n\n/**\n * Reflow blocks and their mats.\n */\nBlockly.Flyout.prototype.reflow = function() {\n  if (this.reflowWrapper_) {\n    this.workspace_.removeChangeListener(this.reflowWrapper_);\n  }\n  this.reflowInternal_();\n  if (this.reflowWrapper_) {\n    this.workspace_.addChangeListener(this.reflowWrapper_);\n  }\n};\n\n/**\n * @return {boolean} True if this flyout may be scrolled with a scrollbar or by\n *     dragging.\n * @package\n */\nBlockly.Flyout.prototype.isScrollable = function() {\n  return this.scrollbar ? this.scrollbar.isVisible() : false;\n};\n\n/**\n * Copy a block from the flyout to the workspace and position it correctly.\n * @param {!Blockly.BlockSvg} oldBlock The flyout block to copy.\n * @return {!Blockly.BlockSvg} The new block in the main workspace.\n * @private\n */\nBlockly.Flyout.prototype.placeNewBlock_ = function(oldBlock) {\n  var targetWorkspace = this.targetWorkspace;\n  var svgRootOld = oldBlock.getSvgRoot();\n  if (!svgRootOld) {\n    throw Error('oldBlock is not rendered.');\n  }\n\n  // Create the new block by cloning the block in the flyout (via XML).\n  var xml = Blockly.Xml.blockToDom(oldBlock, true);\n  // The target workspace would normally resize during domToBlock, which will\n  // lead to weird jumps.  Save it for terminateDrag.\n  targetWorkspace.setResizesEnabled(false);\n\n  // Using domToBlock instead of domToWorkspace means that the new block will be\n  // placed at position (0, 0) in main workspace units.\n  var block = /** @type {!Blockly.BlockSvg} */\n      (Blockly.Xml.domToBlock(xml, targetWorkspace));\n  var svgRootNew = block.getSvgRoot();\n  if (!svgRootNew) {\n    throw Error('block is not rendered.');\n  }\n\n  // The offset in pixels between the main workspace's origin and the upper left\n  // corner of the injection div.\n  var mainOffsetPixels = targetWorkspace.getOriginOffsetInPixels();\n\n  // The offset in pixels between the flyout workspace's origin and the upper\n  // left corner of the injection div.\n  var flyoutOffsetPixels = this.workspace_.getOriginOffsetInPixels();\n\n  // The position of the old block in flyout workspace coordinates.\n  var oldBlockPos = oldBlock.getRelativeToSurfaceXY();\n  // The position of the old block in pixels relative to the flyout\n  // workspace's origin.\n  oldBlockPos.scale(this.workspace_.scale);\n\n  // The position of the old block in pixels relative to the upper left corner\n  // of the injection div.\n  var oldBlockOffsetPixels = Blockly.utils.Coordinate.sum(flyoutOffsetPixels,\n      oldBlockPos);\n\n  // The position of the old block in pixels relative to the origin of the\n  // main workspace.\n  var finalOffset = Blockly.utils.Coordinate.difference(oldBlockOffsetPixels,\n      mainOffsetPixels);\n  // The position of the old block in main workspace coordinates.\n  finalOffset.scale(1 / targetWorkspace.scale);\n\n  block.moveBy(finalOffset.x, finalOffset.y);\n  return block;\n};\n\n/**\n * Handles the given action.\n * This is only triggered when keyboard accessibility mode is enabled.\n * @param {!Blockly.Action} action The action to be handled.\n * @return {boolean} True if the flyout handled the action, false otherwise.\n * @package\n */\nBlockly.Flyout.prototype.onBlocklyAction = function(action) {\n  var cursor = this.workspace_.getCursor();\n  return cursor.onBlocklyAction(action);\n};\n\n/**\n * Return the deletion rectangle for this flyout in viewport coordinates.\n * @return {Blockly.utils.Rect} Rectangle in which to delete.\n */\nBlockly.Flyout.prototype.getClientRect;\n\n/**\n * Position the flyout.\n * @return {void}\n */\nBlockly.Flyout.prototype.position;\n\n/**\n * Determine if a drag delta is toward the workspace, based on the position\n * and orientation of the flyout. This is used in determineDragIntention_ to\n * determine if a new block should be created or if the flyout should scroll.\n * @param {!Blockly.utils.Coordinate} currentDragDeltaXY How far the pointer has\n *     moved from the position at mouse down, in pixel units.\n * @return {boolean} True if the drag is toward the workspace.\n * @package\n */\nBlockly.Flyout.prototype.isDragTowardWorkspace;\n\n/**\n * Return an object with all the metrics required to size scrollbars for the\n * flyout.\n * @return {Blockly.utils.Metrics} Contains size and position metrics of the\n *     flyout.\n * @protected\n */\nBlockly.Flyout.prototype.getMetrics_;\n\n/**\n * Sets the translation of the flyout to match the scrollbars.\n * @param {!{x:number,y:number}} xyRatio Contains a y property which is a float\n *     between 0 and 1 specifying the degree of scrolling and a\n *     similar x property.\n * @protected\n */\nBlockly.Flyout.prototype.setMetrics_;\n\n/**\n * Lay out the blocks in the flyout.\n * @param {!Array.<!Object>} contents The blocks and buttons to lay out.\n * @param {!Array.<number>} gaps The visible gaps between blocks.\n * @protected\n */\nBlockly.Flyout.prototype.layout_;\n\n/**\n * Scroll the flyout.\n * @param {!Event} e Mouse wheel scroll event.\n * @protected\n */\nBlockly.Flyout.prototype.wheel_;\n\n/**\n * Compute height of flyout.  Position mat under each block.\n * For RTL: Lay out the blocks right-aligned.\n * @return {void}\n * @protected\n */\nBlockly.Flyout.prototype.reflowInternal_;\n"],"file":"flyout_base.min.js"}