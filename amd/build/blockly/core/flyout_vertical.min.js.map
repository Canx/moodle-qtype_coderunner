{"version":3,"sources":["../../../src/blockly/core/flyout_vertical.js"],"names":["goog","provide","require","requireType","Blockly","VerticalFlyout","workspaceOptions","superClass_","constructor","call","utils","object","inherits","Flyout","prototype","getMetrics_","isVisible","optionBox","workspace_","getCanvas","getBBox","e","height","y","width","x","absoluteTop","SCROLLBAR_PADDING","viewHeight","height_","viewWidth","width_","RTL","metrics","contentHeight","scale","MARGIN","contentWidth","contentTop","contentLeft","viewTop","scrollY","viewLeft","scrollX","absoluteLeft","setMetrics_","xyRatio","translate","position","targetWorkspaceMetrics","targetWorkspace","getMetrics","edgeWidth","CORNER_RADIUS","edgeHeight","setBackgroundPath_","toolboxPosition","toolboxPosition_","toolboxWidth","TOOLBOX_AT_LEFT","positionAt_","atRight","TOOLBOX_AT_RIGHT","totalWidth","path","push","Math","max","svgBackground_","setAttribute","join","scrollToStart","scrollbar","set","wheel_","scrollDelta","getScrollDeltaPixels","pos","limit","min","WidgetDiv","hide","DropDownDiv","hideWithoutAnimation","preventDefault","stopPropagation","layout_","contents","gaps","margin","cursorX","tabWidth_","cursorY","i","item","type","block","allBlocks","getDescendants","j","child","isInFlyout","render","root","getSvgRoot","blockHW","getHeightWidth","moveX","outputConnection","moveBy","rect","createRect_","addBlockListeners_","initFlyoutButton_","button","isDragTowardWorkspace","currentDragDeltaXY","dx","dy","dragDirection","atan2","PI","range","dragAngleRange_","getClientRect","svgGroup_","flyoutRect","getBoundingClientRect","BIG_NUM","left","Rect","reflowInternal_","flyoutWidth","blocks","getTopBlocks","buttons_","Scrollbar","scrollbarThickness","oldX","getRelativeToSurfaceXY","newX","flyoutRect_","moveRectToBlock_","getPosition","moveTo"],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Layout code for a vertical variant of the flyout.\n * @author fenichel@google.com (Rachel Fenichel)\n */\n'use strict';\n\ngoog.provide('Blockly.VerticalFlyout');\n\ngoog.require('Blockly.Block');\ngoog.require('Blockly.Flyout');\ngoog.require('Blockly.Scrollbar');\ngoog.require('Blockly.utils');\ngoog.require('Blockly.utils.object');\ngoog.require('Blockly.utils.Rect');\ngoog.require('Blockly.utils.userAgent');\ngoog.require('Blockly.WidgetDiv');\n\ngoog.requireType('Blockly.utils.Metrics');\n\n\n/**\n * Class for a flyout.\n * @param {!Blockly.Options} workspaceOptions Dictionary of options for the\n *     workspace.\n * @extends {Blockly.Flyout}\n * @constructor\n */\nBlockly.VerticalFlyout = function(workspaceOptions) {\n  Blockly.VerticalFlyout.superClass_.constructor.call(this, workspaceOptions);\n};\nBlockly.utils.object.inherits(Blockly.VerticalFlyout, Blockly.Flyout);\n\n/**\n * Return an object with all the metrics required to size scrollbars for the\n * flyout.  The following properties are computed:\n * .viewHeight: Height of the visible rectangle,\n * .viewWidth: Width of the visible rectangle,\n * .contentHeight: Height of the contents,\n * .contentWidth: Width of the contents,\n * .viewTop: Offset of top edge of visible rectangle from parent,\n * .contentTop: Offset of the top-most content from the y=0 coordinate,\n * .absoluteTop: Top-edge of view.\n * .viewLeft: Offset of the left edge of visible rectangle from parent,\n * .contentLeft: Offset of the left-most content from the x=0 coordinate,\n * .absoluteLeft: Left-edge of view.\n * @return {Blockly.utils.Metrics} Contains size and position metrics of the\n *     flyout.\n * @protected\n */\nBlockly.VerticalFlyout.prototype.getMetrics_ = function() {\n  if (!this.isVisible()) {\n    // Flyout is hidden.\n    return null;\n  }\n\n  try {\n    var optionBox = this.workspace_.getCanvas().getBBox();\n  } catch (e) {\n    // Firefox has trouble with hidden elements (Bug 528969).\n    var optionBox = {height: 0, y: 0, width: 0, x: 0};\n  }\n\n  // Padding for the end of the scrollbar.\n  var absoluteTop = this.SCROLLBAR_PADDING;\n  var absoluteLeft = 0;\n\n  var viewHeight = this.height_ - 2 * this.SCROLLBAR_PADDING;\n  var viewWidth = this.width_;\n  if (!this.RTL) {\n    viewWidth -= this.SCROLLBAR_PADDING;\n  }\n\n  var metrics = {\n    contentHeight: optionBox.height * this.workspace_.scale + 2 * this.MARGIN,\n    contentWidth: optionBox.width * this.workspace_.scale + 2 * this.MARGIN,\n    contentTop: optionBox.y,\n    contentLeft: optionBox.x,\n\n    viewHeight: viewHeight,\n    viewWidth: viewWidth,\n    viewTop: -this.workspace_.scrollY + optionBox.y,\n    viewLeft: -this.workspace_.scrollX,\n\n    absoluteTop: absoluteTop,\n    absoluteLeft: absoluteLeft\n  };\n  return metrics;\n};\n\n/**\n * Sets the translation of the flyout to match the scrollbars.\n * @param {!{x:number,y:number}} xyRatio Contains a y property which is a float\n *     between 0 and 1 specifying the degree of scrolling and a\n *     similar x property.\n * @protected\n */\nBlockly.VerticalFlyout.prototype.setMetrics_ = function(xyRatio) {\n  var metrics = this.getMetrics_();\n  // This is a fix to an apparent race condition.\n  if (!metrics) {\n    return;\n  }\n  if (typeof xyRatio.y == 'number') {\n    this.workspace_.scrollY = -metrics.contentHeight * xyRatio.y;\n  }\n  this.workspace_.translate(this.workspace_.scrollX + metrics.absoluteLeft,\n      this.workspace_.scrollY + metrics.absoluteTop);\n};\n\n/**\n * Move the flyout to the edge of the workspace.\n */\nBlockly.VerticalFlyout.prototype.position = function() {\n  if (!this.isVisible()) {\n    return;\n  }\n  var targetWorkspaceMetrics = this.targetWorkspace.getMetrics();\n  if (!targetWorkspaceMetrics) {\n    // Hidden components will return null.\n    return;\n  }\n  // Record the height for Blockly.Flyout.getMetrics_\n  this.height_ = targetWorkspaceMetrics.viewHeight;\n\n  var edgeWidth = this.width_ - this.CORNER_RADIUS;\n  var edgeHeight = targetWorkspaceMetrics.viewHeight - 2 * this.CORNER_RADIUS;\n  this.setBackgroundPath_(edgeWidth, edgeHeight);\n\n  // Y is always 0 since this is a vertical flyout.\n  var y = 0;\n  // If this flyout is the toolbox flyout.\n  if (this.targetWorkspace.toolboxPosition == this.toolboxPosition_) {\n    // If there is a category toolbox.\n    if (targetWorkspaceMetrics.toolboxWidth) {\n      if (this.toolboxPosition_ == Blockly.TOOLBOX_AT_LEFT) {\n        var x = targetWorkspaceMetrics.toolboxWidth;\n      } else {\n        var x = targetWorkspaceMetrics.viewWidth - this.width_;\n      }\n    } else {\n      if (this.toolboxPosition_ == Blockly.TOOLBOX_AT_LEFT) {\n        var x = 0;\n      } else {\n        var x = targetWorkspaceMetrics.viewWidth;\n      }\n    }\n  } else {\n    if (this.toolboxPosition_ == Blockly.TOOLBOX_AT_LEFT) {\n      var x = 0;\n    } else {\n      // Because the anchor point of the flyout is on the left, but we want\n      // to align the right edge of the flyout with the right edge of the\n      // blocklyDiv, we calculate the full width of the div minus the width\n      // of the flyout.\n      var x = targetWorkspaceMetrics.viewWidth +\n          targetWorkspaceMetrics.absoluteLeft - this.width_;\n    }\n  }\n  this.positionAt_(this.width_, this.height_, x, y);\n};\n\n/**\n * Create and set the path for the visible boundaries of the flyout.\n * @param {number} width The width of the flyout, not including the\n *     rounded corners.\n * @param {number} height The height of the flyout, not including\n *     rounded corners.\n * @private\n */\nBlockly.VerticalFlyout.prototype.setBackgroundPath_ = function(width, height) {\n  var atRight = this.toolboxPosition_ == Blockly.TOOLBOX_AT_RIGHT;\n  var totalWidth = width + this.CORNER_RADIUS;\n\n  // Decide whether to start on the left or right.\n  var path = ['M ' + (atRight ? totalWidth : 0) + ',0'];\n  // Top.\n  path.push('h', atRight ? -width : width);\n  // Rounded corner.\n  path.push('a', this.CORNER_RADIUS, this.CORNER_RADIUS, 0, 0,\n      atRight ? 0 : 1,\n      atRight ? -this.CORNER_RADIUS : this.CORNER_RADIUS,\n      this.CORNER_RADIUS);\n  // Side closest to workspace.\n  path.push('v', Math.max(0, height));\n  // Rounded corner.\n  path.push('a', this.CORNER_RADIUS, this.CORNER_RADIUS, 0, 0,\n      atRight ? 0 : 1,\n      atRight ? this.CORNER_RADIUS : -this.CORNER_RADIUS,\n      this.CORNER_RADIUS);\n  // Bottom.\n  path.push('h', atRight ? width : -width);\n  path.push('z');\n  this.svgBackground_.setAttribute('d', path.join(' '));\n};\n\n/**\n * Scroll the flyout to the top.\n */\nBlockly.VerticalFlyout.prototype.scrollToStart = function() {\n  this.scrollbar.set(0);\n};\n\n/**\n * Scroll the flyout.\n * @param {!Event} e Mouse wheel scroll event.\n * @protected\n */\nBlockly.VerticalFlyout.prototype.wheel_ = function(e) {\n  var scrollDelta = Blockly.utils.getScrollDeltaPixels(e);\n\n  if (scrollDelta.y) {\n    var metrics = this.getMetrics_();\n    var pos = (metrics.viewTop - metrics.contentTop) + scrollDelta.y;\n    var limit = metrics.contentHeight - metrics.viewHeight;\n    pos = Math.min(pos, limit);\n    pos = Math.max(pos, 0);\n    this.scrollbar.set(pos);\n    // When the flyout moves from a wheel event, hide WidgetDiv and DropDownDiv.\n    Blockly.WidgetDiv.hide();\n    Blockly.DropDownDiv.hideWithoutAnimation();\n  }\n\n  // Don't scroll the page.\n  e.preventDefault();\n  // Don't propagate mousewheel event (zooming).\n  e.stopPropagation();\n};\n\n/**\n * Lay out the blocks in the flyout.\n * @param {!Array.<!Object>} contents The blocks and buttons to lay out.\n * @param {!Array.<number>} gaps The visible gaps between blocks.\n * @protected\n */\nBlockly.VerticalFlyout.prototype.layout_ = function(contents, gaps) {\n  this.workspace_.scale = this.targetWorkspace.scale;\n  var margin = this.MARGIN;\n  var cursorX = this.RTL ? margin : margin + this.tabWidth_;\n  var cursorY = margin;\n\n  for (var i = 0, item; (item = contents[i]); i++) {\n    if (item.type == 'block') {\n      var block = item.block;\n      var allBlocks = block.getDescendants(false);\n      for (var j = 0, child; (child = allBlocks[j]); j++) {\n        // Mark blocks as being inside a flyout.  This is used to detect and\n        // prevent the closure of the flyout if the user right-clicks on such a\n        // block.\n        child.isInFlyout = true;\n      }\n      block.render();\n      var root = block.getSvgRoot();\n      var blockHW = block.getHeightWidth();\n      var moveX = block.outputConnection ? cursorX - this.tabWidth_ : cursorX;\n      block.moveBy(moveX, cursorY);\n\n      var rect = this.createRect_(block,\n          this.RTL ? moveX - blockHW.width : moveX, cursorY, blockHW, i);\n\n      this.addBlockListeners_(root, block, rect);\n\n      cursorY += blockHW.height + gaps[i];\n    } else if (item.type == 'button') {\n      this.initFlyoutButton_(item.button, cursorX, cursorY);\n      cursorY += item.button.height + gaps[i];\n    }\n  }\n};\n\n/**\n * Determine if a drag delta is toward the workspace, based on the position\n * and orientation of the flyout. This is used in determineDragIntention_ to\n * determine if a new block should be created or if the flyout should scroll.\n * @param {!Blockly.utils.Coordinate} currentDragDeltaXY How far the pointer has\n *     moved from the position at mouse down, in pixel units.\n * @return {boolean} True if the drag is toward the workspace.\n * @package\n */\nBlockly.VerticalFlyout.prototype.isDragTowardWorkspace = function(\n    currentDragDeltaXY) {\n  var dx = currentDragDeltaXY.x;\n  var dy = currentDragDeltaXY.y;\n  // Direction goes from -180 to 180, with 0 toward the right and 90 on top.\n  var dragDirection = Math.atan2(dy, dx) / Math.PI * 180;\n\n  var range = this.dragAngleRange_;\n  // Check for left or right dragging.\n  if ((dragDirection < range && dragDirection > -range) ||\n      (dragDirection < -180 + range || dragDirection > 180 - range)) {\n    return true;\n  }\n  return false;\n};\n\n/**\n * Return the deletion rectangle for this flyout in viewport coordinates.\n * @return {Blockly.utils.Rect} Rectangle in which to delete.\n */\nBlockly.VerticalFlyout.prototype.getClientRect = function() {\n  if (!this.svgGroup_) {\n    return null;\n  }\n\n  var flyoutRect = this.svgGroup_.getBoundingClientRect();\n  // BIG_NUM is offscreen padding so that blocks dragged beyond the shown flyout\n  // area are still deleted.  Must be larger than the largest screen size,\n  // but be smaller than half Number.MAX_SAFE_INTEGER (not available on IE).\n  var BIG_NUM = 1000000000;\n  var left = flyoutRect.left;\n\n  if (this.toolboxPosition_ == Blockly.TOOLBOX_AT_LEFT) {\n    var width = flyoutRect.width;\n    return new Blockly.utils.Rect(-BIG_NUM, BIG_NUM, -BIG_NUM, left + width);\n  } else {  // Right\n    return new Blockly.utils.Rect(-BIG_NUM, BIG_NUM, left, BIG_NUM);\n  }\n};\n\n/**\n * Compute width of flyout.  Position mat under each block.\n * For RTL: Lay out the blocks and buttons to be right-aligned.\n * @protected\n */\nBlockly.VerticalFlyout.prototype.reflowInternal_ = function() {\n  this.workspace_.scale = this.targetWorkspace.scale;\n  var flyoutWidth = 0;\n  var blocks = this.workspace_.getTopBlocks(false);\n  for (var i = 0, block; (block = blocks[i]); i++) {\n    var width = block.getHeightWidth().width;\n    if (block.outputConnection) {\n      width -= this.tabWidth_;\n    }\n    flyoutWidth = Math.max(flyoutWidth, width);\n  }\n  for (var i = 0, button; (button = this.buttons_[i]); i++) {\n    flyoutWidth = Math.max(flyoutWidth, button.width);\n  }\n  flyoutWidth += this.MARGIN * 1.5 + this.tabWidth_;\n  flyoutWidth *= this.workspace_.scale;\n  flyoutWidth += Blockly.Scrollbar.scrollbarThickness;\n\n  if (this.width_ != flyoutWidth) {\n    for (var i = 0, block; (block = blocks[i]); i++) {\n      if (this.RTL) {\n        // With the flyoutWidth known, right-align the blocks.\n        var oldX = block.getRelativeToSurfaceXY().x;\n        var newX = flyoutWidth / this.workspace_.scale - this.MARGIN;\n        if (!block.outputConnection) {\n          newX -= this.tabWidth_;\n        }\n        block.moveBy(newX - oldX, 0);\n      }\n      if (block.flyoutRect_) {\n        this.moveRectToBlock_(block.flyoutRect_, block);\n      }\n    }\n    if (this.RTL) {\n      // With the flyoutWidth known, right-align the buttons.\n      for (var i = 0, button; (button = this.buttons_[i]); i++) {\n        var y = button.getPosition().y;\n        var x = flyoutWidth / this.workspace_.scale - button.width -\n            this.MARGIN - this.tabWidth_;\n        button.moveTo(x, y);\n      }\n    }\n    // Record the width for .getMetrics_ and .position.\n    this.width_ = flyoutWidth;\n    this.position();\n  }\n};\n"],"file":"flyout_vertical.min.js"}