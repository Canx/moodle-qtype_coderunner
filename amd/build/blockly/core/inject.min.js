'use strict';goog.provide("Blockly.inject");goog.require("Blockly.BlockDragSurfaceSvg");goog.require("Blockly.Component");goog.require("Blockly.Css");goog.require("Blockly.DropDownDiv");goog.require("Blockly.Events");goog.require("Blockly.Grid");goog.require("Blockly.Msg");goog.require("Blockly.Options");goog.require("Blockly.ScrollbarPair");goog.require("Blockly.Tooltip");goog.require("Blockly.user.keyMap");goog.require("Blockly.utils");goog.require("Blockly.utils.dom");goog.require("Blockly.utils.userAgent");goog.require("Blockly.WorkspaceDragSurfaceSvg");goog.require("Blockly.WorkspaceSvg");goog.requireType("Blockly.utils.Metrics");Blockly.inject=function(a,b){Blockly.checkBlockColourConstants();if("string"==typeof a){a=document.getElementById(a)||document.querySelector(a)}if(!a||!Blockly.utils.dom.containsNode(document,a)){throw Error("Error: container is not in current document.")}var c=new Blockly.Options(b||{}),d=document.createElement("div");d.className="injectionDiv";d.tabIndex=0;Blockly.utils.aria.setState(d,Blockly.utils.aria.State.LABEL,Blockly.Msg.WORKSPACE_ARIA_LABEL);a.appendChild(d);var e=Blockly.createDom_(d,c),f=new Blockly.BlockDragSurfaceSvg(d),g=new Blockly.WorkspaceDragSurfaceSvg(d),h=Blockly.createMainWorkspace_(e,c,f,g);Blockly.user.keyMap.setKeyMap(c.keyMap);Blockly.init_(h);Blockly.mainWorkspace=h;Blockly.svgResize(h);d.addEventListener("focusin",function(){Blockly.mainWorkspace=h});return h};Blockly.createDom_=function(a,b){a.setAttribute("dir","LTR");Blockly.Component.defaultRightToLeft=b.RTL;Blockly.Css.inject(b.hasCss,b.pathToMedia);var c=Blockly.utils.dom.createSvgElement("svg",{xmlns:Blockly.utils.dom.SVG_NS,"xmlns:html":Blockly.utils.dom.HTML_NS,"xmlns:xlink":Blockly.utils.dom.XLINK_NS,version:"1.1",class:"blocklySvg",tabindex:"0"},a),d=Blockly.utils.dom.createSvgElement("defs",{},c),e=(Math.random()+"").substring(2);b.gridPattern=Blockly.Grid.createDom(e,b.gridOptions,d);return c};Blockly.createMainWorkspace_=function(a,b,c,d){b.parentWorkspace=null;var f=new Blockly.WorkspaceSvg(b,c,d),g=f.options;f.scale=g.zoomOptions.startScale;a.appendChild(f.createDom("blocklyMainBackground"));Blockly.utils.dom.addClass(f.getInjectionDiv(),f.getRenderer().getClassName());Blockly.utils.dom.addClass(f.getInjectionDiv(),f.getTheme().getClassName());if(!g.hasCategories&&g.languageTree){var h=f.addFlyout("svg");Blockly.utils.dom.insertAfter(h,a)}if(g.hasTrashcan){f.addTrashcan()}if(g.zoomOptions&&g.zoomOptions.controls){f.addZoomControls()}f.getThemeManager().subscribe(a,"workspaceBackgroundColour","background-color");f.translate(0,0);if(!g.readOnly&&!f.isMovable()){var i=function(){var a=Object.create(null),b=f.getMetrics(),c=f.scale;a.RTL=f.RTL;a.viewLeft=b.viewLeft/c;a.viewTop=b.viewTop/c;a.viewRight=(b.viewLeft+b.viewWidth)/c;a.viewBottom=(b.viewTop+b.viewHeight)/c;if(f.isContentBounded()){var d=f.getBlocksBoundingBox();a.contentLeft=d.left;a.contentTop=d.top;a.contentRight=d.right;a.contentBottom=d.bottom}else{a.contentLeft=b.contentLeft/c;a.contentTop=b.contentTop/c;a.contentRight=(b.contentLeft+b.contentWidth)/c;a.contentBottom=(b.contentTop+b.contentHeight)/c}return a},j=function(a){var b=a.getBoundingRectangle();b.height=b.bottom-b.top;b.width=b.right-b.left;return b},k=function(a){if(!f.isDragging()&&!f.isMovable()&&-1!=Blockly.Events.BUMP_EVENTS.indexOf(a.type)){var b=i();if(b.contentTop<b.viewTop||b.contentBottom>b.viewBottom||b.contentLeft<b.viewLeft||b.contentRight>b.viewRight){var c=null;if(a){c=Blockly.Events.getGroup();Blockly.Events.setGroup(a.group)}switch(a.type){case Blockly.Events.BLOCK_CREATE:case Blockly.Events.BLOCK_MOVE:var d=f.getBlockById(a.blockId);if(d){d=d.getRootBlock()}break;case Blockly.Events.COMMENT_CREATE:case Blockly.Events.COMMENT_MOVE:var d=f.getCommentById(a.commentId);break;}if(d){var e=j(d),g=b.viewTop,h=b.viewBottom-e.height;h=Math.max(g,h);var k=Blockly.utils.math.clamp(g,e.top,h),l=k-e.top,m=b.viewLeft,n=b.viewRight-e.width;if(b.RTL){m=Math.min(n,m)}else{n=Math.max(m,n)}var o=Blockly.utils.math.clamp(m,e.left,n),p=o-e.left;d.moveBy(p,l)}if(a){if(!a.group&&d){console.log("WARNING: Moved object in bounds but there was no event group. This may break undo.")}if(null!==c){Blockly.Events.setGroup(c)}}}}};f.addChangeListener(k)}Blockly.svgResize(f);Blockly.WidgetDiv.createDom();Blockly.DropDownDiv.createDom();Blockly.Tooltip.createDom();return f};Blockly.init_=function(a){var b=a.options,c=a.getParentSvg();Blockly.bindEventWithChecks_(c.parentNode,"contextmenu",null,function(a){if(!Blockly.utils.isTargetInput(a)){a.preventDefault()}});var d=Blockly.bindEventWithChecks_(window,"resize",null,function(){Blockly.hideChaff(!0);Blockly.svgResize(a)});a.setResizeHandlerWrapper(d);Blockly.inject.bindDocumentEvents_();if(b.languageTree){var e=a.getToolbox(),f=a.getFlyout(!0);if(e){e.init()}else if(f){f.init(a);f.show(b.languageTree);f.scrollToStart()}}var g=Blockly.Scrollbar.scrollbarThickness;if(b.hasTrashcan){g=a.trashcan.init(g)}if(b.zoomOptions&&b.zoomOptions.controls){a.zoomControls_.init(g)}if(b.moveOptions&&b.moveOptions.scrollbars){a.scrollbar=new Blockly.ScrollbarPair(a);a.scrollbar.resize()}else{a.setMetrics({x:.5,y:.5})}if(b.hasSounds){Blockly.inject.loadSounds_(b.pathToMedia,a)}};Blockly.inject.bindDocumentEvents_=function(){if(!Blockly.documentEventsBound_){Blockly.bindEventWithChecks_(document,"scroll",null,function(){for(var a=Blockly.Workspace.getAll(),b=0,c;c=a[b];b++){if(c.updateInverseScreenCTM){c.updateInverseScreenCTM()}}});Blockly.bindEventWithChecks_(document,"keydown",null,Blockly.onKeyDown);Blockly.bindEvent_(document,"touchend",null,Blockly.longStop_);Blockly.bindEvent_(document,"touchcancel",null,Blockly.longStop_);if(Blockly.utils.userAgent.IPAD){Blockly.bindEventWithChecks_(window,"orientationchange",document,function(){Blockly.svgResize(Blockly.getMainWorkspace())})}}Blockly.documentEventsBound_=!0};Blockly.inject.loadSounds_=function(a,b){var c=b.getAudioManager();c.load([a+"click.mp3",a+"click.wav",a+"click.ogg"],"click");c.load([a+"disconnect.wav",a+"disconnect.mp3",a+"disconnect.ogg"],"disconnect");c.load([a+"delete.mp3",a+"delete.ogg",a+"delete.wav"],"delete");var d=[],e=function(){while(d.length){Blockly.unbindEvent_(d.pop())}c.preload()};d.push(Blockly.bindEventWithChecks_(document,"mousemove",null,e,!0));d.push(Blockly.bindEventWithChecks_(document,"touchstart",null,e,!0))};
//# sourceMappingURL=inject.min.js.map
