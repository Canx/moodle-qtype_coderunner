{"version":3,"sources":["../../../src/blockly/core/bubble.js"],"names":["goog","provide","require","requireType","Blockly","Bubble","workspace","content","shape","anchorXY","bubbleWidth","bubbleHeight","workspace_","content_","shape_","resizeCallback_","moveCallback_","onMouseDownBubbleWrapper_","onMouseDownResizeWrapper_","disposed","angle","ARROW_ANGLE","RTL","arrow_radians_","utils","math","toRadians","canvas","getBubbleCanvas","appendChild","createDom_","setAnchorLocation","bBox","getBBox","width","BORDER_WIDTH","height","setBubbleSize","positionBubble_","renderArrow_","rendered_","ARROW_THICKNESS","ARROW_BEND","ANCHOR_RADIUS","onMouseUpWrapper_","onMouseMoveWrapper_","unbindDragEvents_","unbindEvent_","bubbleMouseUp_","Touch","clearTouchIdentifier","prototype","anchorXY_","relativeLeft_","relativeTop_","width_","height_","autoLayout_","hasResize","bubbleGroup_","dom","createSvgElement","filter","getRenderer","getConstants","embossFilterId","userAgent","JAVA_FX","bubbleEmboss","bubbleArrow_","bubbleBack_","resizeGroup_","resizeSize","replace","toString","options","readOnly","bindEventWithChecks_","bubbleMouseDown_","resizeMouseDown_","getSvgRoot","setSvgId","id","dataset","e","gesture","getGesture","handleBubbleStart","showContextMenu","isDeletable","promote","isRightButton","stopPropagation","startDrag","Coordinate","document","resizeMouseMove_","hideChaff","newXY","moveDrag","x","y","registerResizeEvent","callback","registerMoveEvent","svgGroup","parentNode","lastChild","xy","layoutBubble_","metrics","getMetrics","viewLeft","scale","viewWidth","viewTop","viewHeight","optimalLeft","getOptimalRelativeLeft_","optimalTop","getOptimalRelativeTop_","bbox","topPosition","MIN_BLOCK_HEIGHT","startPosition","endPosition","bottomPosition","closerPosition","fartherPosition","topPositionOverlap","getOverlap_","startPositionOverlap","closerPositionOverlap","fartherPositionOverlap","mostOverlap","Math","max","relativeMin","bubbleMin","bubbleMax","workspaceMin","workspaceMax","overlapWidth","min","overlapHeight","relativeLeft","bubbleRight","bubbleLeft","workspaceRight","workspaceLeft","Scrollbar","scrollbarThickness","relativeTop","bubbleTop","bubbleBottom","workspaceTop","workspaceBottom","anchorY","left","top","moveTo","setAttribute","setDragging","adding","getBubbleSize","Size","doubleBorderWidth","steps","relBubbleX","relBubbleY","relAnchorX","relAnchorY","push","rise","run","hypotenuse","sqrt","acos","PI","rightAngle","rightRise","sin","rightRun","cos","bubbleSize","thickness","backoffRatio","baseX1","baseY1","baseX2","baseY2","swirlAngle","swirlRise","swirlRun","join","setColour","hexColour","dispose","removeNode","moveDuringDrag","dragSurface","newLoc","translateSurface","getRelativeToSurfaceXY","setAutoLayout","enable"],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Object representing a UI bubble.\n * @author fraser@google.com (Neil Fraser)\n */\n'use strict';\n\ngoog.provide('Blockly.Bubble');\n\ngoog.require('Blockly.Scrollbar');\ngoog.require('Blockly.Touch');\ngoog.require('Blockly.utils');\ngoog.require('Blockly.utils.Coordinate');\ngoog.require('Blockly.utils.dom');\ngoog.require('Blockly.utils.math');\ngoog.require('Blockly.utils.userAgent');\ngoog.require('Blockly.Workspace');\n\ngoog.requireType('Blockly.utils.Metrics');\n\n\n/**\n * Class for UI bubble.\n * @param {!Blockly.WorkspaceSvg} workspace The workspace on which to draw the\n *     bubble.\n * @param {!Element} content SVG content for the bubble.\n * @param {Element} shape SVG element to avoid eclipsing.\n * @param {!Blockly.utils.Coordinate} anchorXY Absolute position of bubble's\n *     anchor point.\n * @param {?number} bubbleWidth Width of bubble, or null if not resizable.\n * @param {?number} bubbleHeight Height of bubble, or null if not resizable.\n * @constructor\n */\nBlockly.Bubble = function(workspace, content, shape, anchorXY,\n    bubbleWidth, bubbleHeight) {\n  this.workspace_ = workspace;\n  this.content_ = content;\n  this.shape_ = shape;\n\n  /**\n   * Method to call on resize of bubble.\n   * @type {?function()}\n   * @private\n   */\n  this.resizeCallback_ = null;\n\n  /**\n   * Method to call on move of bubble.\n   * @type {?function()}\n   * @private\n   */\n  this.moveCallback_ = null;\n\n  /**\n   * Mouse down on bubbleBack_ event data.\n   * @type {?Blockly.EventData}\n   * @private\n   */\n  this.onMouseDownBubbleWrapper_ = null;\n\n  /**\n   * Mouse down on resizeGroup_ event data.\n   * @type {?Blockly.EventData}\n   * @private\n   */\n  this.onMouseDownResizeWrapper_ = null;\n\n  /**\n   * Describes whether this bubble has been disposed of (nodes and event\n   * listeners removed from the page) or not.\n   * @type {boolean}\n   * @package\n   */\n  this.disposed = false;\n\n  var angle = Blockly.Bubble.ARROW_ANGLE;\n  if (this.workspace_.RTL) {\n    angle = -angle;\n  }\n  this.arrow_radians_ = Blockly.utils.math.toRadians(angle);\n\n  var canvas = workspace.getBubbleCanvas();\n  canvas.appendChild(this.createDom_(content, !!(bubbleWidth && bubbleHeight)));\n\n  this.setAnchorLocation(anchorXY);\n  if (!bubbleWidth || !bubbleHeight) {\n    var bBox = /** @type {SVGLocatable} */ (this.content_).getBBox();\n    bubbleWidth = bBox.width + 2 * Blockly.Bubble.BORDER_WIDTH;\n    bubbleHeight = bBox.height + 2 * Blockly.Bubble.BORDER_WIDTH;\n  }\n  this.setBubbleSize(bubbleWidth, bubbleHeight);\n\n  // Render the bubble.\n  this.positionBubble_();\n  this.renderArrow_();\n  this.rendered_ = true;\n};\n\n/**\n * Width of the border around the bubble.\n */\nBlockly.Bubble.BORDER_WIDTH = 6;\n\n/**\n * Determines the thickness of the base of the arrow in relation to the size\n * of the bubble.  Higher numbers result in thinner arrows.\n */\nBlockly.Bubble.ARROW_THICKNESS = 5;\n\n/**\n * The number of degrees that the arrow bends counter-clockwise.\n */\nBlockly.Bubble.ARROW_ANGLE = 20;\n\n/**\n * The sharpness of the arrow's bend.  Higher numbers result in smoother arrows.\n */\nBlockly.Bubble.ARROW_BEND = 4;\n\n/**\n * Distance between arrow point and anchor point.\n */\nBlockly.Bubble.ANCHOR_RADIUS = 8;\n\n/**\n * Mouse up event data.\n * @type {?Blockly.EventData}\n * @private\n */\nBlockly.Bubble.onMouseUpWrapper_ = null;\n\n/**\n * Mouse move event data.\n * @type {?Blockly.EventData}\n * @private\n */\nBlockly.Bubble.onMouseMoveWrapper_ = null;\n\n/**\n * Stop binding to the global mouseup and mousemove events.\n * @private\n */\nBlockly.Bubble.unbindDragEvents_ = function() {\n  if (Blockly.Bubble.onMouseUpWrapper_) {\n    Blockly.unbindEvent_(Blockly.Bubble.onMouseUpWrapper_);\n    Blockly.Bubble.onMouseUpWrapper_ = null;\n  }\n  if (Blockly.Bubble.onMouseMoveWrapper_) {\n    Blockly.unbindEvent_(Blockly.Bubble.onMouseMoveWrapper_);\n    Blockly.Bubble.onMouseMoveWrapper_ = null;\n  }\n};\n\n/**\n * Handle a mouse-up event while dragging a bubble's border or resize handle.\n * @param {!Event} _e Mouse up event.\n * @private\n */\nBlockly.Bubble.bubbleMouseUp_ = function(_e) {\n  Blockly.Touch.clearTouchIdentifier();\n  Blockly.Bubble.unbindDragEvents_();\n};\n\n/**\n * Flag to stop incremental rendering during construction.\n * @private\n */\nBlockly.Bubble.prototype.rendered_ = false;\n\n/**\n * Absolute coordinate of anchor point, in workspace coordinates.\n * @type {Blockly.utils.Coordinate}\n * @private\n */\nBlockly.Bubble.prototype.anchorXY_ = null;\n\n/**\n * Relative X coordinate of bubble with respect to the anchor's centre,\n * in workspace units.\n * In RTL mode the initial value is negated.\n * @private\n */\nBlockly.Bubble.prototype.relativeLeft_ = 0;\n\n/**\n * Relative Y coordinate of bubble with respect to the anchor's centre, in\n * workspace units.\n * @private\n */\nBlockly.Bubble.prototype.relativeTop_ = 0;\n\n/**\n * Width of bubble, in workspace units.\n * @private\n */\nBlockly.Bubble.prototype.width_ = 0;\n\n/**\n * Height of bubble, in workspace units.\n * @private\n */\nBlockly.Bubble.prototype.height_ = 0;\n\n/**\n * Automatically position and reposition the bubble.\n * @private\n */\nBlockly.Bubble.prototype.autoLayout_ = true;\n\n/**\n * Create the bubble's DOM.\n * @param {!Element} content SVG content for the bubble.\n * @param {boolean} hasResize Add diagonal resize gripper if true.\n * @return {!SVGElement} The bubble's SVG group.\n * @private\n */\nBlockly.Bubble.prototype.createDom_ = function(content, hasResize) {\n  /* Create the bubble.  Here's the markup that will be generated:\n  <g>\n    <g filter=\"url(#blocklyEmbossFilter837493)\">\n      <path d=\"... Z\" />\n      <rect class=\"blocklyDraggable\" rx=\"8\" ry=\"8\" width=\"180\" height=\"180\"/>\n    </g>\n    <g transform=\"translate(165, 165)\" class=\"blocklyResizeSE\">\n      <polygon points=\"0,15 15,15 15,0\"/>\n      <line class=\"blocklyResizeLine\" x1=\"5\" y1=\"14\" x2=\"14\" y2=\"5\"/>\n      <line class=\"blocklyResizeLine\" x1=\"10\" y1=\"14\" x2=\"14\" y2=\"10\"/>\n    </g>\n    [...content goes here...]\n  </g>\n  */\n  this.bubbleGroup_ = Blockly.utils.dom.createSvgElement('g', {}, null);\n  var filter =\n      {'filter': 'url(#' +\n      this.workspace_.getRenderer().getConstants().embossFilterId + ')'};\n  if (Blockly.utils.userAgent.JAVA_FX) {\n    // Multiple reports that JavaFX can't handle filters.\n    // https://github.com/google/blockly/issues/99\n    filter = {};\n  }\n  var bubbleEmboss = Blockly.utils.dom.createSvgElement('g',\n      filter, this.bubbleGroup_);\n  this.bubbleArrow_ = Blockly.utils.dom.createSvgElement('path', {},\n      bubbleEmboss);\n  this.bubbleBack_ = Blockly.utils.dom.createSvgElement('rect',\n      {\n        'class': 'blocklyDraggable',\n        'x': 0,\n        'y': 0,\n        'rx': Blockly.Bubble.BORDER_WIDTH,\n        'ry': Blockly.Bubble.BORDER_WIDTH\n      },\n      bubbleEmboss);\n  if (hasResize) {\n    this.resizeGroup_ = Blockly.utils.dom.createSvgElement('g',\n        {'class': this.workspace_.RTL ?\n                  'blocklyResizeSW' : 'blocklyResizeSE'},\n        this.bubbleGroup_);\n    var resizeSize = 2 * Blockly.Bubble.BORDER_WIDTH;\n    Blockly.utils.dom.createSvgElement('polygon',\n        {'points': '0,x x,x x,0'.replace(/x/g, resizeSize.toString())},\n        this.resizeGroup_);\n    Blockly.utils.dom.createSvgElement('line',\n        {\n          'class': 'blocklyResizeLine',\n          'x1': resizeSize / 3, 'y1': resizeSize - 1,\n          'x2': resizeSize - 1, 'y2': resizeSize / 3\n        }, this.resizeGroup_);\n    Blockly.utils.dom.createSvgElement('line',\n        {\n          'class': 'blocklyResizeLine',\n          'x1': resizeSize * 2 / 3,\n          'y1': resizeSize - 1,\n          'x2': resizeSize - 1,\n          'y2': resizeSize * 2 / 3\n        }, this.resizeGroup_);\n  } else {\n    this.resizeGroup_ = null;\n  }\n\n  if (!this.workspace_.options.readOnly) {\n    this.onMouseDownBubbleWrapper_ = Blockly.bindEventWithChecks_(\n        this.bubbleBack_, 'mousedown', this, this.bubbleMouseDown_);\n    if (this.resizeGroup_) {\n      this.onMouseDownResizeWrapper_ = Blockly.bindEventWithChecks_(\n          this.resizeGroup_, 'mousedown', this, this.resizeMouseDown_);\n    }\n  }\n  this.bubbleGroup_.appendChild(content);\n  return this.bubbleGroup_;\n};\n\n/**\n * Return the root node of the bubble's SVG group.\n * @return {SVGElement} The root SVG node of the bubble's group.\n */\nBlockly.Bubble.prototype.getSvgRoot = function() {\n  return this.bubbleGroup_;\n};\n\n/**\n * Expose the block's ID on the bubble's top-level SVG group.\n * @param {string} id ID of block.\n */\nBlockly.Bubble.prototype.setSvgId = function(id) {\n  if (this.bubbleGroup_.dataset) {\n    this.bubbleGroup_.dataset['blockId'] = id;\n  }\n};\n\n/**\n * Handle a mouse-down on bubble's border.\n * @param {!Event} e Mouse down event.\n * @private\n */\nBlockly.Bubble.prototype.bubbleMouseDown_ = function(e) {\n  var gesture = this.workspace_.getGesture(e);\n  if (gesture) {\n    gesture.handleBubbleStart(e, this);\n  }\n};\n\n/**\n * Show the context menu for this bubble.\n * @param {!Event} _e Mouse event.\n * @package\n */\nBlockly.Bubble.prototype.showContextMenu = function(_e) {\n  // NOP on bubbles, but used by the bubble dragger to pass events to\n  // workspace comments.\n};\n\n/**\n * Get whether this bubble is deletable or not.\n * @return {boolean} True if deletable.\n * @package\n */\nBlockly.Bubble.prototype.isDeletable = function() {\n  return false;\n};\n\n/**\n * Handle a mouse-down on bubble's resize corner.\n * @param {!Event} e Mouse down event.\n * @private\n */\nBlockly.Bubble.prototype.resizeMouseDown_ = function(e) {\n  this.promote();\n  Blockly.Bubble.unbindDragEvents_();\n  if (Blockly.utils.isRightButton(e)) {\n    // No right-click.\n    e.stopPropagation();\n    return;\n  }\n  // Left-click (or middle click)\n  this.workspace_.startDrag(e, new Blockly.utils.Coordinate(\n      this.workspace_.RTL ? -this.width_ : this.width_, this.height_));\n\n  Blockly.Bubble.onMouseUpWrapper_ = Blockly.bindEventWithChecks_(document,\n      'mouseup', this, Blockly.Bubble.bubbleMouseUp_);\n  Blockly.Bubble.onMouseMoveWrapper_ = Blockly.bindEventWithChecks_(document,\n      'mousemove', this, this.resizeMouseMove_);\n  Blockly.hideChaff();\n  // This event has been handled.  No need to bubble up to the document.\n  e.stopPropagation();\n};\n\n/**\n * Resize this bubble to follow the mouse.\n * @param {!Event} e Mouse move event.\n * @private\n */\nBlockly.Bubble.prototype.resizeMouseMove_ = function(e) {\n  this.autoLayout_ = false;\n  var newXY = this.workspace_.moveDrag(e);\n  this.setBubbleSize(this.workspace_.RTL ? -newXY.x : newXY.x, newXY.y);\n  if (this.workspace_.RTL) {\n    // RTL requires the bubble to move its left edge.\n    this.positionBubble_();\n  }\n};\n\n/**\n * Register a function as a callback event for when the bubble is resized.\n * @param {!Function} callback The function to call on resize.\n */\nBlockly.Bubble.prototype.registerResizeEvent = function(callback) {\n  this.resizeCallback_ = callback;\n};\n\n/**\n * Register a function as a callback event for when the bubble is moved.\n * @param {!Function} callback The function to call on move.\n */\nBlockly.Bubble.prototype.registerMoveEvent = function(callback) {\n  this.moveCallback_ = callback;\n};\n\n/**\n * Move this bubble to the top of the stack.\n * @return {boolean} Whether or not the bubble has been moved.\n * @package\n */\nBlockly.Bubble.prototype.promote = function() {\n  var svgGroup = this.bubbleGroup_.parentNode;\n  if (svgGroup.lastChild !== this.bubbleGroup_) {\n    svgGroup.appendChild(this.bubbleGroup_);\n    return true;\n  }\n  return false;\n};\n\n/**\n * Notification that the anchor has moved.\n * Update the arrow and bubble accordingly.\n * @param {!Blockly.utils.Coordinate} xy Absolute location.\n */\nBlockly.Bubble.prototype.setAnchorLocation = function(xy) {\n  this.anchorXY_ = xy;\n  if (this.rendered_) {\n    this.positionBubble_();\n  }\n};\n\n/**\n * Position the bubble so that it does not fall off-screen.\n * @private\n */\nBlockly.Bubble.prototype.layoutBubble_ = function() {\n  // Get the metrics in workspace units.\n  var metrics = this.workspace_.getMetrics();\n  metrics.viewLeft /= this.workspace_.scale;\n  metrics.viewWidth /= this.workspace_.scale;\n  metrics.viewTop /= this.workspace_.scale;\n  metrics.viewHeight /= this.workspace_.scale;\n\n  var optimalLeft = this.getOptimalRelativeLeft_(metrics);\n  var optimalTop = this.getOptimalRelativeTop_(metrics);\n  var bbox = this.shape_.getBBox();\n\n  var topPosition = {\n    x: optimalLeft,\n    y: -this.height_ -\n        this.workspace_.getRenderer().getConstants().MIN_BLOCK_HEIGHT\n  };\n  var startPosition = {x: -this.width_ - 30, y: optimalTop};\n  var endPosition = {x: bbox.width, y: optimalTop};\n  var bottomPosition = {x: optimalLeft, y: bbox.height};\n\n  var closerPosition = bbox.width < bbox.height ? endPosition : bottomPosition;\n  var fartherPosition = bbox.width < bbox.height ? bottomPosition : endPosition;\n\n  var topPositionOverlap = this.getOverlap_(topPosition, metrics);\n  var startPositionOverlap = this.getOverlap_(startPosition, metrics);\n  var closerPositionOverlap = this.getOverlap_(closerPosition, metrics);\n  var fartherPositionOverlap = this.getOverlap_(fartherPosition, metrics);\n\n  // Set the position to whichever position shows the most of the bubble,\n  // with tiebreaks going in the order: top > start > close > far.\n  var mostOverlap = Math.max(topPositionOverlap, startPositionOverlap,\n      closerPositionOverlap, fartherPositionOverlap);\n  if (topPositionOverlap == mostOverlap) {\n    this.relativeLeft_ = topPosition.x;\n    this.relativeTop_ = topPosition.y;\n    return;\n  }\n  if (startPositionOverlap == mostOverlap) {\n    this.relativeLeft_ = startPosition.x;\n    this.relativeTop_ = startPosition.y;\n    return;\n  }\n  if (closerPositionOverlap == mostOverlap) {\n    this.relativeLeft_ = closerPosition.x;\n    this.relativeTop_ = closerPosition.y;\n    return;\n  }\n  // TODO: I believe relativeLeft_ should actually be called relativeStart_\n  //  and then the math should be fixed to reflect this. (hopefully it'll\n  //  make it look simpler)\n  this.relativeLeft_ = fartherPosition.x;\n  this.relativeTop_ = fartherPosition.y;\n};\n\n/**\n * Calculate the what percentage of the bubble overlaps with the visible\n * workspace (what percentage of the bubble is visible).\n * @param {!{x: number, y: number}} relativeMin The position of the top-left\n *     corner of the bubble relative to the anchor point.\n * @param {!Blockly.utils.Metrics} metrics The metrics of the workspace the\n *     bubble will appear in.\n * @return {number} The percentage of the bubble that is visible.\n * @private\n */\nBlockly.Bubble.prototype.getOverlap_ = function(relativeMin, metrics) {\n  // The position of the top-left corner of the bubble in workspace units.\n  var bubbleMin = {\n    x: this.workspace_.RTL ? (this.anchorXY_.x - relativeMin.x - this.width_) :\n        (relativeMin.x + this.anchorXY_.x),\n    y: relativeMin.y + this.anchorXY_.y\n  };\n  // The position of the bottom-right corner of the bubble in workspace units.\n  var bubbleMax = {\n    x: bubbleMin.x + this.width_,\n    y: bubbleMin.y + this.height_\n  };\n\n  // We could adjust these values to account for the scrollbars, but the\n  // bubbles should have been adjusted to not collide with them anyway, so\n  // giving the workspace a slightly larger \"bounding box\" shouldn't affect the\n  // calculation.\n\n  // The position of the top-left corner of the workspace.\n  var workspaceMin = {\n    x: metrics.viewLeft,\n    y: metrics.viewTop\n  };\n  // The position of the bottom-right corner of the workspace.\n  var workspaceMax = {\n    x: metrics.viewLeft + metrics.viewWidth,\n    y: metrics.viewTop + metrics.viewHeight\n  };\n\n  var overlapWidth = Math.min(bubbleMax.x, workspaceMax.x) -\n      Math.max(bubbleMin.x, workspaceMin.x);\n  var overlapHeight = Math.min(bubbleMax.y, workspaceMax.y) -\n      Math.max(bubbleMin.y, workspaceMin.y);\n  return Math.max(0, Math.min(1,\n      (overlapWidth * overlapHeight) / (this.width_ * this.height_)));\n};\n\n/**\n * Calculate what the optimal horizontal position of the top-left corner of the\n * bubble is (relative to the anchor point) so that the most area of the\n * bubble is shown.\n * @param {!Blockly.utils.Metrics} metrics The metrics of the workspace the\n *     bubble will appear in.\n * @return {number} The optimal horizontal position of the top-left corner\n *     of the bubble.\n * @private\n */\nBlockly.Bubble.prototype.getOptimalRelativeLeft_ = function(metrics) {\n  var relativeLeft = -this.width_ / 4;\n\n  // No amount of sliding left or right will give us a better overlap.\n  if (this.width_ > metrics.viewWidth) {\n    return relativeLeft;\n  }\n\n  if (this.workspace_.RTL) {\n    // Bubble coordinates are flipped in RTL.\n    var bubbleRight = this.anchorXY_.x - relativeLeft;\n    var bubbleLeft = bubbleRight - this.width_;\n\n    var workspaceRight = metrics.viewLeft + metrics.viewWidth;\n    var workspaceLeft = metrics.viewLeft +\n        // Thickness in workspace units.\n        (Blockly.Scrollbar.scrollbarThickness / this.workspace_.scale);\n  } else {\n    var bubbleLeft = relativeLeft + this.anchorXY_.x;\n    var bubbleRight = bubbleLeft + this.width_;\n\n    var workspaceLeft = metrics.viewLeft;\n    var workspaceRight = metrics.viewLeft + metrics.viewWidth -\n      // Thickness in workspace units.\n      (Blockly.Scrollbar.scrollbarThickness / this.workspace_.scale);\n  }\n\n  if (this.workspace_.RTL) {\n    if (bubbleLeft < workspaceLeft) {\n      // Slide the bubble right until it is onscreen.\n      relativeLeft = -(workspaceLeft - this.anchorXY_.x + this.width_);\n    } else if (bubbleRight > workspaceRight) {\n      // Slide the bubble left until it is onscreen.\n      relativeLeft = -(workspaceRight - this.anchorXY_.x);\n    }\n  } else {\n    if (bubbleLeft < workspaceLeft) {\n      // Slide the bubble right until it is onscreen.\n      relativeLeft = workspaceLeft - this.anchorXY_.x;\n    } else if (bubbleRight > workspaceRight) {\n      // Slide the bubble left until it is onscreen.\n      relativeLeft = workspaceRight - this.anchorXY_.x - this.width_;\n    }\n  }\n\n  return relativeLeft;\n};\n\n/**\n * Calculate what the optimal vertical position of the top-left corner of\n * the bubble is (relative to the anchor point) so that the most area of the\n * bubble is shown.\n * @param {!Blockly.utils.Metrics} metrics The metrics of the workspace the\n *     bubble will appear in.\n * @return {number} The optimal vertical position of the top-left corner\n *     of the bubble.\n * @private\n */\nBlockly.Bubble.prototype.getOptimalRelativeTop_ = function(metrics) {\n  var relativeTop = -this.height_ / 4;\n\n  // No amount of sliding up or down will give us a better overlap.\n  if (this.height_ > metrics.viewHeight) {\n    return relativeTop;\n  }\n\n  var bubbleTop = this.anchorXY_.y + relativeTop;\n  var bubbleBottom = bubbleTop + this.height_;\n  var workspaceTop = metrics.viewTop;\n  var workspaceBottom = metrics.viewTop + metrics.viewHeight -\n      // Thickness in workspace units.\n      (Blockly.Scrollbar.scrollbarThickness / this.workspace_.scale);\n\n  var anchorY = this.anchorXY_.y;\n  if (bubbleTop < workspaceTop) {\n    // Slide the bubble down until it is onscreen.\n    relativeTop = workspaceTop - anchorY;\n  } else if (bubbleBottom > workspaceBottom) {\n    // Slide the bubble up until it is onscreen.\n    relativeTop = workspaceBottom - anchorY - this.height_;\n  }\n\n  return relativeTop;\n};\n\n/**\n * Move the bubble to a location relative to the anchor's centre.\n * @private\n */\nBlockly.Bubble.prototype.positionBubble_ = function() {\n  var left = this.anchorXY_.x;\n  if (this.workspace_.RTL) {\n    left -= this.relativeLeft_ + this.width_;\n  } else {\n    left += this.relativeLeft_;\n  }\n  var top = this.relativeTop_ + this.anchorXY_.y;\n  this.moveTo(left, top);\n};\n\n/**\n * Move the bubble group to the specified location in workspace coordinates.\n * @param {number} x The x position to move to.\n * @param {number} y The y position to move to.\n * @package\n */\nBlockly.Bubble.prototype.moveTo = function(x, y) {\n  this.bubbleGroup_.setAttribute('transform', 'translate(' + x + ',' + y + ')');\n};\n\n/**\n * Triggers a move callback if one exists at the end of a drag.\n * @param {boolean} adding True if adding, false if removing.\n * @package\n */\nBlockly.Bubble.prototype.setDragging = function(adding) {\n  if (!adding && this.moveCallback_) {\n    this.moveCallback_();\n  }\n};\n\n/**\n * Get the dimensions of this bubble.\n * @return {!Blockly.utils.Size} The height and width of the bubble.\n */\nBlockly.Bubble.prototype.getBubbleSize = function() {\n  return new Blockly.utils.Size(this.width_, this.height_);\n};\n\n/**\n * Size this bubble.\n * @param {number} width Width of the bubble.\n * @param {number} height Height of the bubble.\n */\nBlockly.Bubble.prototype.setBubbleSize = function(width, height) {\n  var doubleBorderWidth = 2 * Blockly.Bubble.BORDER_WIDTH;\n  // Minimum size of a bubble.\n  width = Math.max(width, doubleBorderWidth + 45);\n  height = Math.max(height, doubleBorderWidth + 20);\n  this.width_ = width;\n  this.height_ = height;\n  this.bubbleBack_.setAttribute('width', width);\n  this.bubbleBack_.setAttribute('height', height);\n  if (this.resizeGroup_) {\n    if (this.workspace_.RTL) {\n      // Mirror the resize group.\n      var resizeSize = 2 * Blockly.Bubble.BORDER_WIDTH;\n      this.resizeGroup_.setAttribute('transform', 'translate(' +\n          resizeSize + ',' + (height - doubleBorderWidth) + ') scale(-1 1)');\n    } else {\n      this.resizeGroup_.setAttribute('transform', 'translate(' +\n          (width - doubleBorderWidth) + ',' +\n          (height - doubleBorderWidth) + ')');\n    }\n  }\n  if (this.autoLayout_) {\n    this.layoutBubble_();\n  }\n  this.positionBubble_();\n  this.renderArrow_();\n\n  // Allow the contents to resize.\n  if (this.resizeCallback_) {\n    this.resizeCallback_();\n  }\n};\n\n/**\n * Draw the arrow between the bubble and the origin.\n * @private\n */\nBlockly.Bubble.prototype.renderArrow_ = function() {\n  var steps = [];\n  // Find the relative coordinates of the center of the bubble.\n  var relBubbleX = this.width_ / 2;\n  var relBubbleY = this.height_ / 2;\n  // Find the relative coordinates of the center of the anchor.\n  var relAnchorX = -this.relativeLeft_;\n  var relAnchorY = -this.relativeTop_;\n  if (relBubbleX == relAnchorX && relBubbleY == relAnchorY) {\n    // Null case.  Bubble is directly on top of the anchor.\n    // Short circuit this rather than wade through divide by zeros.\n    steps.push('M ' + relBubbleX + ',' + relBubbleY);\n  } else {\n    // Compute the angle of the arrow's line.\n    var rise = relAnchorY - relBubbleY;\n    var run = relAnchorX - relBubbleX;\n    if (this.workspace_.RTL) {\n      run *= -1;\n    }\n    var hypotenuse = Math.sqrt(rise * rise + run * run);\n    var angle = Math.acos(run / hypotenuse);\n    if (rise < 0) {\n      angle = 2 * Math.PI - angle;\n    }\n    // Compute a line perpendicular to the arrow.\n    var rightAngle = angle + Math.PI / 2;\n    if (rightAngle > Math.PI * 2) {\n      rightAngle -= Math.PI * 2;\n    }\n    var rightRise = Math.sin(rightAngle);\n    var rightRun = Math.cos(rightAngle);\n\n    // Calculate the thickness of the base of the arrow.\n    var bubbleSize = this.getBubbleSize();\n    var thickness = (bubbleSize.width + bubbleSize.height) /\n                    Blockly.Bubble.ARROW_THICKNESS;\n    thickness = Math.min(thickness, bubbleSize.width, bubbleSize.height) / 4;\n\n    // Back the tip of the arrow off of the anchor.\n    var backoffRatio = 1 - Blockly.Bubble.ANCHOR_RADIUS / hypotenuse;\n    relAnchorX = relBubbleX + backoffRatio * run;\n    relAnchorY = relBubbleY + backoffRatio * rise;\n\n    // Coordinates for the base of the arrow.\n    var baseX1 = relBubbleX + thickness * rightRun;\n    var baseY1 = relBubbleY + thickness * rightRise;\n    var baseX2 = relBubbleX - thickness * rightRun;\n    var baseY2 = relBubbleY - thickness * rightRise;\n\n    // Distortion to curve the arrow.\n    var swirlAngle = angle + this.arrow_radians_;\n    if (swirlAngle > Math.PI * 2) {\n      swirlAngle -= Math.PI * 2;\n    }\n    var swirlRise = Math.sin(swirlAngle) *\n        hypotenuse / Blockly.Bubble.ARROW_BEND;\n    var swirlRun = Math.cos(swirlAngle) *\n        hypotenuse / Blockly.Bubble.ARROW_BEND;\n\n    steps.push('M' + baseX1 + ',' + baseY1);\n    steps.push('C' + (baseX1 + swirlRun) + ',' + (baseY1 + swirlRise) +\n               ' ' + relAnchorX + ',' + relAnchorY +\n               ' ' + relAnchorX + ',' + relAnchorY);\n    steps.push('C' + relAnchorX + ',' + relAnchorY +\n               ' ' + (baseX2 + swirlRun) + ',' + (baseY2 + swirlRise) +\n               ' ' + baseX2 + ',' + baseY2);\n  }\n  steps.push('z');\n  this.bubbleArrow_.setAttribute('d', steps.join(' '));\n};\n\n/**\n * Change the colour of a bubble.\n * @param {string} hexColour Hex code of colour.\n */\nBlockly.Bubble.prototype.setColour = function(hexColour) {\n  this.bubbleBack_.setAttribute('fill', hexColour);\n  this.bubbleArrow_.setAttribute('fill', hexColour);\n};\n\n/**\n * Dispose of this bubble.\n */\nBlockly.Bubble.prototype.dispose = function() {\n  if (this.onMouseDownBubbleWrapper_) {\n    Blockly.unbindEvent_(this.onMouseDownBubbleWrapper_);\n  }\n  if (this.onMouseDownResizeWrapper_) {\n    Blockly.unbindEvent_(this.onMouseDownResizeWrapper_);\n  }\n  Blockly.Bubble.unbindDragEvents_();\n  Blockly.utils.dom.removeNode(this.bubbleGroup_);\n  this.disposed = true;\n};\n\n/**\n * Move this bubble during a drag, taking into account whether or not there is\n * a drag surface.\n * @param {Blockly.BlockDragSurfaceSvg} dragSurface The surface that carries\n *     rendered items during a drag, or null if no drag surface is in use.\n * @param {!Blockly.utils.Coordinate} newLoc The location to translate to, in\n *     workspace coordinates.\n * @package\n */\nBlockly.Bubble.prototype.moveDuringDrag = function(dragSurface, newLoc) {\n  if (dragSurface) {\n    dragSurface.translateSurface(newLoc.x, newLoc.y);\n  } else {\n    this.moveTo(newLoc.x, newLoc.y);\n  }\n  if (this.workspace_.RTL) {\n    this.relativeLeft_ = this.anchorXY_.x - newLoc.x - this.width_;\n  } else {\n    this.relativeLeft_ = newLoc.x - this.anchorXY_.x;\n  }\n  this.relativeTop_ = newLoc.y - this.anchorXY_.y;\n  this.renderArrow_();\n};\n\n/**\n * Return the coordinates of the top-left corner of this bubble's body relative\n * to the drawing surface's origin (0,0), in workspace units.\n * @return {!Blockly.utils.Coordinate} Object with .x and .y properties.\n */\nBlockly.Bubble.prototype.getRelativeToSurfaceXY = function() {\n  return new Blockly.utils.Coordinate(\n      this.workspace_.RTL ?\n        -this.relativeLeft_ + this.anchorXY_.x - this.width_ :\n        this.anchorXY_.x + this.relativeLeft_,\n      this.anchorXY_.y + this.relativeTop_);\n};\n\n/**\n * Set whether auto-layout of this bubble is enabled.  The first time a bubble\n * is shown it positions itself to not cover any blocks.  Once a user has\n * dragged it to reposition, it renders where the user put it.\n * @param {boolean} enable True if auto-layout should be enabled, false\n *     otherwise.\n * @package\n */\nBlockly.Bubble.prototype.setAutoLayout = function(enable) {\n  this.autoLayout_ = enable;\n};\n"],"file":"bubble.min.js"}