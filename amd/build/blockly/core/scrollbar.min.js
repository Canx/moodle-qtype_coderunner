'use strict';goog.provide("Blockly.Scrollbar");goog.provide("Blockly.ScrollbarPair");goog.require("Blockly.Touch");goog.require("Blockly.utils");goog.require("Blockly.utils.Coordinate");goog.require("Blockly.utils.dom");goog.require("Blockly.utils.Metrics");Blockly.ScrollbarPair=function(a){this.workspace_=a;this.hScroll=new Blockly.Scrollbar(a,!0,!0,"blocklyMainWorkspaceScrollbar");this.vScroll=new Blockly.Scrollbar(a,!1,!0,"blocklyMainWorkspaceScrollbar");this.corner_=Blockly.utils.dom.createSvgElement("rect",{height:Blockly.Scrollbar.scrollbarThickness,width:Blockly.Scrollbar.scrollbarThickness,class:"blocklyScrollbarBackground"},null);Blockly.utils.dom.insertAfter(this.corner_,a.getBubbleCanvas());this.oldHostMetrics_=null};Blockly.ScrollbarPair.prototype.dispose=function(){Blockly.utils.dom.removeNode(this.corner_);this.corner_=null;this.workspace_=null;this.oldHostMetrics_=null;this.hScroll.dispose();this.hScroll=null;this.vScroll.dispose();this.vScroll=null};Blockly.ScrollbarPair.prototype.resize=function(){var a=this.workspace_.getMetrics();if(!a){return}var b=!1,c=!1;if(!this.oldHostMetrics_||this.oldHostMetrics_.viewWidth!=a.viewWidth||this.oldHostMetrics_.viewHeight!=a.viewHeight||this.oldHostMetrics_.absoluteTop!=a.absoluteTop||this.oldHostMetrics_.absoluteLeft!=a.absoluteLeft){b=!0;c=!0}else{if(!this.oldHostMetrics_||this.oldHostMetrics_.contentWidth!=a.contentWidth||this.oldHostMetrics_.viewLeft!=a.viewLeft||this.oldHostMetrics_.contentLeft!=a.contentLeft){b=!0}if(!this.oldHostMetrics_||this.oldHostMetrics_.contentHeight!=a.contentHeight||this.oldHostMetrics_.viewTop!=a.viewTop||this.oldHostMetrics_.contentTop!=a.contentTop){c=!0}}if(b){this.hScroll.resize(a)}if(c){this.vScroll.resize(a)}if(!this.oldHostMetrics_||this.oldHostMetrics_.viewWidth!=a.viewWidth||this.oldHostMetrics_.absoluteLeft!=a.absoluteLeft){this.corner_.setAttribute("x",this.vScroll.position.x)}if(!this.oldHostMetrics_||this.oldHostMetrics_.viewHeight!=a.viewHeight||this.oldHostMetrics_.absoluteTop!=a.absoluteTop){this.corner_.setAttribute("y",this.hScroll.position.y)}this.oldHostMetrics_=a};Blockly.ScrollbarPair.prototype.set=function(a,b){var c={},d=a*this.hScroll.ratio,e=b*this.vScroll.ratio,f=this.hScroll.scrollViewSize_,g=this.vScroll.scrollViewSize_;c.x=this.getRatio_(d,f);c.y=this.getRatio_(e,g);this.workspace_.setMetrics(c);this.hScroll.setHandlePosition(d);this.vScroll.setHandlePosition(e)};Blockly.ScrollbarPair.prototype.getRatio_=function(a,b){var c=a/b;if(isNaN(c)){return 0}return c};Blockly.Scrollbar=function(a,b,c,d){this.workspace_=a;this.pair_=c||!1;this.horizontal_=b;this.oldHostMetrics_=null;this.ratio=null;this.createDom_(d);this.position=new Blockly.utils.Coordinate(0,0);var e=Blockly.Scrollbar.scrollbarThickness;if(b){this.svgBackground_.setAttribute("height",e);this.outerSvg_.setAttribute("height",e);this.svgHandle_.setAttribute("height",e-5);this.svgHandle_.setAttribute("y",2.5);this.lengthAttribute_="width";this.positionAttribute_="x"}else{this.svgBackground_.setAttribute("width",e);this.outerSvg_.setAttribute("width",e);this.svgHandle_.setAttribute("width",e-5);this.svgHandle_.setAttribute("x",2.5);this.lengthAttribute_="height";this.positionAttribute_="y"}var f=this;this.onMouseDownBarWrapper_=Blockly.bindEventWithChecks_(this.svgBackground_,"mousedown",f,f.onMouseDownBar_);this.onMouseDownHandleWrapper_=Blockly.bindEventWithChecks_(this.svgHandle_,"mousedown",f,f.onMouseDownHandle_)};Blockly.Scrollbar.prototype.origin_=new Blockly.utils.Coordinate(0,0);Blockly.Scrollbar.prototype.startDragMouse_=0;Blockly.Scrollbar.prototype.scrollViewSize_=0;Blockly.Scrollbar.prototype.handleLength_=0;Blockly.Scrollbar.prototype.handlePosition_=0;Blockly.Scrollbar.prototype.isVisible_=!0;Blockly.Scrollbar.prototype.containerVisible_=!0;Blockly.Scrollbar.scrollbarThickness=15;if(Blockly.Touch.TOUCH_ENABLED){Blockly.Scrollbar.scrollbarThickness=25}Blockly.Scrollbar.metricsAreEquivalent_=function(a,b){if(!(a&&b)){return!1}if(a.viewWidth!=b.viewWidth||a.viewHeight!=b.viewHeight||a.viewLeft!=b.viewLeft||a.viewTop!=b.viewTop||a.absoluteTop!=b.absoluteTop||a.absoluteLeft!=b.absoluteLeft||a.contentWidth!=b.contentWidth||a.contentHeight!=b.contentHeight||a.contentLeft!=b.contentLeft||a.contentTop!=b.contentTop){return!1}return!0};Blockly.Scrollbar.prototype.dispose=function(){this.cleanUp_();Blockly.unbindEvent_(this.onMouseDownBarWrapper_);this.onMouseDownBarWrapper_=null;Blockly.unbindEvent_(this.onMouseDownHandleWrapper_);this.onMouseDownHandleWrapper_=null;Blockly.utils.dom.removeNode(this.outerSvg_);this.outerSvg_=null;this.svgGroup_=null;this.svgBackground_=null;if(this.svgHandle_){this.workspace_.getThemeManager().unsubscribe(this.svgHandle_);this.svgHandle_=null}this.workspace_=null};Blockly.Scrollbar.prototype.setHandleLength_=function(a){this.handleLength_=a;this.svgHandle_.setAttribute(this.lengthAttribute_,this.handleLength_)};Blockly.Scrollbar.prototype.setHandlePosition=function(a){this.handlePosition_=a;this.svgHandle_.setAttribute(this.positionAttribute_,this.handlePosition_)};Blockly.Scrollbar.prototype.setScrollViewSize_=function(a){this.scrollViewSize_=a;this.outerSvg_.setAttribute(this.lengthAttribute_,this.scrollViewSize_);this.svgBackground_.setAttribute(this.lengthAttribute_,this.scrollViewSize_)};Blockly.ScrollbarPair.prototype.setContainerVisible=function(a){this.hScroll.setContainerVisible(a);this.vScroll.setContainerVisible(a)};Blockly.Scrollbar.prototype.setPosition=function(a,b){this.position.x=a;this.position.y=b;var c=this.position.x+this.origin_.x,d=this.position.y+this.origin_.y;Blockly.utils.dom.setCssTransform(this.outerSvg_,"translate("+c+"px,"+d+"px)")};Blockly.Scrollbar.prototype.resize=function(a){var b=a;if(!b){b=this.workspace_.getMetrics();if(!b){return}}if(Blockly.Scrollbar.metricsAreEquivalent_(b,this.oldHostMetrics_)){return}this.oldHostMetrics_=b;if(this.horizontal_){this.resizeHorizontal_(b)}else{this.resizeVertical_(b)}this.onScroll_()};Blockly.Scrollbar.prototype.resizeHorizontal_=function(a){this.resizeViewHorizontal(a)};Blockly.Scrollbar.prototype.resizeViewHorizontal=function(a){var b=a.viewWidth-1;if(this.pair_){b-=Blockly.Scrollbar.scrollbarThickness}this.setScrollViewSize_(Math.max(0,b));var c=a.absoluteLeft+.5;if(this.pair_&&this.workspace_.RTL){c+=Blockly.Scrollbar.scrollbarThickness}var d=a.absoluteTop+a.viewHeight-Blockly.Scrollbar.scrollbarThickness-.5;this.setPosition(c,d);this.resizeContentHorizontal(a)};Blockly.Scrollbar.prototype.resizeContentHorizontal=function(a){if(!this.pair_){this.setVisible(this.scrollViewSize_<a.contentWidth)}this.ratio=this.scrollViewSize_/a.contentWidth;if(this.ratio==-Infinity||this.ratio==1/0||isNaN(this.ratio)){this.ratio=0}var b=a.viewWidth*this.ratio;this.setHandleLength_(Math.max(0,b));var c=(a.viewLeft-a.contentLeft)*this.ratio;this.setHandlePosition(this.constrainHandle_(c))};Blockly.Scrollbar.prototype.resizeVertical_=function(a){this.resizeViewVertical(a)};Blockly.Scrollbar.prototype.resizeViewVertical=function(a){var b=a.viewHeight-1;if(this.pair_){b-=Blockly.Scrollbar.scrollbarThickness}this.setScrollViewSize_(Math.max(0,b));var c=a.absoluteLeft+.5;if(!this.workspace_.RTL){c+=a.viewWidth-Blockly.Scrollbar.scrollbarThickness-1}var d=a.absoluteTop+.5;this.setPosition(c,d);this.resizeContentVertical(a)};Blockly.Scrollbar.prototype.resizeContentVertical=function(a){if(!this.pair_){this.setVisible(this.scrollViewSize_<a.contentHeight)}this.ratio=this.scrollViewSize_/a.contentHeight;if(this.ratio==-Infinity||this.ratio==1/0||isNaN(this.ratio)){this.ratio=0}var b=a.viewHeight*this.ratio;this.setHandleLength_(Math.max(0,b));var c=(a.viewTop-a.contentTop)*this.ratio;this.setHandlePosition(this.constrainHandle_(c))};Blockly.Scrollbar.prototype.createDom_=function(a){var b="blocklyScrollbar"+(this.horizontal_?"Horizontal":"Vertical");if(a){b+=" "+a}this.outerSvg_=Blockly.utils.dom.createSvgElement("svg",{class:b},null);this.svgGroup_=Blockly.utils.dom.createSvgElement("g",{},this.outerSvg_);this.svgBackground_=Blockly.utils.dom.createSvgElement("rect",{class:"blocklyScrollbarBackground"},this.svgGroup_);var c=Math.floor((Blockly.Scrollbar.scrollbarThickness-5)/2);this.svgHandle_=Blockly.utils.dom.createSvgElement("rect",{class:"blocklyScrollbarHandle",rx:c,ry:c},this.svgGroup_);this.workspace_.getThemeManager().subscribe(this.svgHandle_,"scrollbarColour","fill");this.workspace_.getThemeManager().subscribe(this.svgHandle_,"scrollbarOpacity","fill-opacity");Blockly.utils.dom.insertAfter(this.outerSvg_,this.workspace_.getParentSvg())};Blockly.Scrollbar.prototype.isVisible=function(){return this.isVisible_};Blockly.Scrollbar.prototype.setContainerVisible=function(a){var b=a!=this.containerVisible_;this.containerVisible_=a;if(b){this.updateDisplay_()}};Blockly.Scrollbar.prototype.setVisible=function(a){var b=a!=this.isVisible();if(this.pair_){throw Error("Unable to toggle visibility of paired scrollbars.")}this.isVisible_=a;if(b){this.updateDisplay_()}};Blockly.Scrollbar.prototype.updateDisplay_=function(){var a=!0;if(!this.containerVisible_){a=!1}else{a=this.isVisible()}if(a){this.outerSvg_.setAttribute("display","block")}else{this.outerSvg_.setAttribute("display","none")}};Blockly.Scrollbar.prototype.onMouseDownBar_=function(a){this.workspace_.markFocused();Blockly.Touch.clearTouchIdentifier();this.cleanUp_();if(Blockly.utils.isRightButton(a)){a.stopPropagation();return}var b=Blockly.utils.mouseToSvg(a,this.workspace_.getParentSvg(),this.workspace_.getInverseScreenCTM()),c=this.horizontal_?b.x:b.y,d=Blockly.utils.getInjectionDivXY_(this.svgHandle_),e=this.horizontal_?d.x:d.y,f=this.handlePosition_,g=.95*this.handleLength_;if(c<=e){f-=g}else if(c>=e+this.handleLength_){f+=g}this.setHandlePosition(this.constrainHandle_(f));this.onScroll_();a.stopPropagation();a.preventDefault()};Blockly.Scrollbar.prototype.onMouseDownHandle_=function(a){this.workspace_.markFocused();this.cleanUp_();if(Blockly.utils.isRightButton(a)){a.stopPropagation();return}this.startDragHandle=this.handlePosition_;this.workspace_.setupDragSurface();this.startDragMouse_=this.horizontal_?a.clientX:a.clientY;Blockly.Scrollbar.onMouseUpWrapper_=Blockly.bindEventWithChecks_(document,"mouseup",this,this.onMouseUpHandle_);Blockly.Scrollbar.onMouseMoveWrapper_=Blockly.bindEventWithChecks_(document,"mousemove",this,this.onMouseMoveHandle_);a.stopPropagation();a.preventDefault()};Blockly.Scrollbar.prototype.onMouseMoveHandle_=function(a){var b=this.horizontal_?a.clientX:a.clientY,c=b-this.startDragMouse_,d=this.startDragHandle+c;this.setHandlePosition(this.constrainHandle_(d));this.onScroll_()};Blockly.Scrollbar.prototype.onMouseUpHandle_=function(){this.workspace_.resetDragSurface();Blockly.Touch.clearTouchIdentifier();this.cleanUp_()};Blockly.Scrollbar.prototype.cleanUp_=function(){Blockly.hideChaff(!0);if(Blockly.Scrollbar.onMouseUpWrapper_){Blockly.unbindEvent_(Blockly.Scrollbar.onMouseUpWrapper_);Blockly.Scrollbar.onMouseUpWrapper_=null}if(Blockly.Scrollbar.onMouseMoveWrapper_){Blockly.unbindEvent_(Blockly.Scrollbar.onMouseMoveWrapper_);Blockly.Scrollbar.onMouseMoveWrapper_=null}};Blockly.Scrollbar.prototype.constrainHandle_=function(a){if(0>=a||isNaN(a)||this.scrollViewSize_<this.handleLength_){a=0}else{a=Math.min(a,this.scrollViewSize_-this.handleLength_)}return a};Blockly.Scrollbar.prototype.onScroll_=function(){var a=this.handlePosition_/this.scrollViewSize_;if(isNaN(a)){a=0}var b={};if(this.horizontal_){b.x=a}else{b.y=a}this.workspace_.setMetrics(b)};Blockly.Scrollbar.prototype.set=function(a){this.setHandlePosition(this.constrainHandle_(a*this.ratio));this.onScroll_()};Blockly.Scrollbar.prototype.setOrigin=function(a,b){this.origin_=new Blockly.utils.Coordinate(a,b)};
//# sourceMappingURL=scrollbar.min.js.map
