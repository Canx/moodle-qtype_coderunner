{"version":3,"sources":["../../../../src/blockly/generators/dart/loops.js"],"names":["goog","provide","require","Blockly","Dart","block","getField","repeats","getFieldValue","valueToCode","ORDER_ASSIGNMENT","branch","statementToCode","addLoopTrap","code","loopVar","variableDB_","getDistinctName","VARIABLE_CATEGORY_NAME","endVar","match","isNumber","until","argument0","ORDER_UNARY_PREFIX","ORDER_NONE","variable0","getName","argument1","increment","up","step","Math","abs","startVar","incVar","INDENT","xfix","STATEMENT_PREFIX","injectId","STATEMENT_SUFFIX","loop","Constants","Loops","CONTROL_FLOW_IN_LOOP_CHECK_MIXIN","getSurroundLoop","suppressPrefixSuffix","Error"],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright 2014 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Generating Dart for loop blocks.\n * @author fraser@google.com (Neil Fraser)\n */\n'use strict';\n\ngoog.provide('Blockly.Dart.loops');\n\ngoog.require('Blockly.Dart');\n\n\nBlockly.Dart['controls_repeat_ext'] = function(block) {\n  // Repeat n times.\n  if (block.getField('TIMES')) {\n    // Internal number.\n    var repeats = String(Number(block.getFieldValue('TIMES')));\n  } else {\n    // External number.\n    var repeats = Blockly.Dart.valueToCode(block, 'TIMES',\n        Blockly.Dart.ORDER_ASSIGNMENT) || '0';\n  }\n  var branch = Blockly.Dart.statementToCode(block, 'DO');\n  branch = Blockly.Dart.addLoopTrap(branch, block);\n  var code = '';\n  var loopVar = Blockly.Dart.variableDB_.getDistinctName(\n      'count', Blockly.VARIABLE_CATEGORY_NAME);\n  var endVar = repeats;\n  if (!repeats.match(/^\\w+$/) && !Blockly.isNumber(repeats)) {\n    endVar = Blockly.Dart.variableDB_.getDistinctName(\n        'repeat_end', Blockly.VARIABLE_CATEGORY_NAME);\n    code += 'var ' + endVar + ' = ' + repeats + ';\\n';\n  }\n  code += 'for (int ' + loopVar + ' = 0; ' +\n      loopVar + ' < ' + endVar + '; ' +\n      loopVar + '++) {\\n' +\n      branch + '}\\n';\n  return code;\n};\n\nBlockly.Dart['controls_repeat'] = Blockly.Dart['controls_repeat_ext'];\n\nBlockly.Dart['controls_whileUntil'] = function(block) {\n  // Do while/until loop.\n  var until = block.getFieldValue('MODE') == 'UNTIL';\n  var argument0 = Blockly.Dart.valueToCode(block, 'BOOL',\n      until ? Blockly.Dart.ORDER_UNARY_PREFIX :\n      Blockly.Dart.ORDER_NONE) || 'false';\n  var branch = Blockly.Dart.statementToCode(block, 'DO');\n  branch = Blockly.Dart.addLoopTrap(branch, block);\n  if (until) {\n    argument0 = '!' + argument0;\n  }\n  return 'while (' + argument0 + ') {\\n' + branch + '}\\n';\n};\n\nBlockly.Dart['controls_for'] = function(block) {\n  // For loop.\n  var variable0 = Blockly.Dart.variableDB_.getName(\n      block.getFieldValue('VAR'), Blockly.VARIABLE_CATEGORY_NAME);\n  var argument0 = Blockly.Dart.valueToCode(block, 'FROM',\n      Blockly.Dart.ORDER_ASSIGNMENT) || '0';\n  var argument1 = Blockly.Dart.valueToCode(block, 'TO',\n      Blockly.Dart.ORDER_ASSIGNMENT) || '0';\n  var increment = Blockly.Dart.valueToCode(block, 'BY',\n      Blockly.Dart.ORDER_ASSIGNMENT) || '1';\n  var branch = Blockly.Dart.statementToCode(block, 'DO');\n  branch = Blockly.Dart.addLoopTrap(branch, block);\n  var code;\n  if (Blockly.isNumber(argument0) && Blockly.isNumber(argument1) &&\n      Blockly.isNumber(increment)) {\n    // All arguments are simple numbers.\n    var up = Number(argument0) <= Number(argument1);\n    code = 'for (' + variable0 + ' = ' + argument0 + '; ' +\n        variable0 + (up ? ' <= ' : ' >= ') + argument1 + '; ' +\n        variable0;\n    var step = Math.abs(Number(increment));\n    if (step == 1) {\n      code += up ? '++' : '--';\n    } else {\n      code += (up ? ' += ' : ' -= ') + step;\n    }\n    code += ') {\\n' + branch + '}\\n';\n  } else {\n    code = '';\n    // Cache non-trivial values to variables to prevent repeated look-ups.\n    var startVar = argument0;\n    if (!argument0.match(/^\\w+$/) && !Blockly.isNumber(argument0)) {\n      startVar = Blockly.Dart.variableDB_.getDistinctName(\n          variable0 + '_start', Blockly.VARIABLE_CATEGORY_NAME);\n      code += 'var ' + startVar + ' = ' + argument0 + ';\\n';\n    }\n    var endVar = argument1;\n    if (!argument1.match(/^\\w+$/) && !Blockly.isNumber(argument1)) {\n      endVar = Blockly.Dart.variableDB_.getDistinctName(\n          variable0 + '_end', Blockly.VARIABLE_CATEGORY_NAME);\n      code += 'var ' + endVar + ' = ' + argument1 + ';\\n';\n    }\n    // Determine loop direction at start, in case one of the bounds\n    // changes during loop execution.\n    var incVar = Blockly.Dart.variableDB_.getDistinctName(\n        variable0 + '_inc', Blockly.VARIABLE_CATEGORY_NAME);\n    code += 'num ' + incVar + ' = ';\n    if (Blockly.isNumber(increment)) {\n      code += Math.abs(increment) + ';\\n';\n    } else {\n      code += '(' + increment + ').abs();\\n';\n    }\n    code += 'if (' + startVar + ' > ' + endVar + ') {\\n';\n    code += Blockly.Dart.INDENT + incVar + ' = -' + incVar + ';\\n';\n    code += '}\\n';\n    code += 'for (' + variable0 + ' = ' + startVar + '; ' +\n        incVar + ' >= 0 ? ' +\n        variable0 + ' <= ' + endVar + ' : ' +\n        variable0 + ' >= ' + endVar + '; ' +\n        variable0 + ' += ' + incVar + ') {\\n' +\n        branch + '}\\n';\n  }\n  return code;\n};\n\nBlockly.Dart['controls_forEach'] = function(block) {\n  // For each loop.\n  var variable0 = Blockly.Dart.variableDB_.getName(\n      block.getFieldValue('VAR'), Blockly.VARIABLE_CATEGORY_NAME);\n  var argument0 = Blockly.Dart.valueToCode(block, 'LIST',\n      Blockly.Dart.ORDER_ASSIGNMENT) || '[]';\n  var branch = Blockly.Dart.statementToCode(block, 'DO');\n  branch = Blockly.Dart.addLoopTrap(branch, block);\n  var code = 'for (var ' + variable0 + ' in ' + argument0 + ') {\\n' +\n      branch + '}\\n';\n  return code;\n};\n\nBlockly.Dart['controls_flow_statements'] = function(block) {\n  // Flow statements: continue, break.\n  var xfix = '';\n  if (Blockly.Dart.STATEMENT_PREFIX) {\n    // Automatic prefix insertion is switched off for this block.  Add manually.\n    xfix += Blockly.Dart.injectId(Blockly.Dart.STATEMENT_PREFIX, block);\n  }\n  if (Blockly.Dart.STATEMENT_SUFFIX) {\n    // Inject any statement suffix here since the regular one at the end\n    // will not get executed if the break/continue is triggered.\n    xfix += Blockly.Dart.injectId(Blockly.Dart.STATEMENT_SUFFIX, block);\n  }\n  if (Blockly.Dart.STATEMENT_PREFIX) {\n    var loop = Blockly.Constants.Loops\n        .CONTROL_FLOW_IN_LOOP_CHECK_MIXIN.getSurroundLoop(block);\n    if (loop && !loop.suppressPrefixSuffix) {\n      // Inject loop's statement prefix here since the regular one at the end\n      // of the loop will not get executed if 'continue' is triggered.\n      // In the case of 'break', a prefix is needed due to the loop's suffix.\n      xfix += Blockly.Dart.injectId(Blockly.Dart.STATEMENT_PREFIX, loop);\n    }\n  }\n  switch (block.getFieldValue('FLOW')) {\n    case 'BREAK':\n      return xfix + 'break;\\n';\n    case 'CONTINUE':\n      return xfix + 'continue;\\n';\n  }\n  throw Error('Unknown flow statement.');\n};\n"],"file":"loops.min.js"}